<!DOCTYPE html>
<head>
<meta charset="UTF-8">
<style>
.r1 {font-style: italic}
.r2 {font-weight: bold}
.r3 {color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold}
.r4 {color: #000080; text-decoration-color: #000080; font-weight: bold}
.r5 {color: #87af00; text-decoration-color: #87af00; font-weight: bold}
.r6 {color: #000080; text-decoration-color: #000080; font-weight: bold; font-style: italic}
.r7 {color: #87af00; text-decoration-color: #87af00; font-weight: bold; font-style: italic}
.r8 {color: #7f7f7f; text-decoration-color: #7f7f7f}
.r9 {color: #000080; text-decoration-color: #000080}
.r10 {color: #87af00; text-decoration-color: #87af00}
.r11 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8; font-style: italic}
.r12 {background-color: #f8f8f8}
.r13 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8; font-weight: bold}
.r14 {color: #000000; text-decoration-color: #000000; background-color: #f8f8f8}
.r15 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8; font-weight: bold}
.r16 {color: #666666; text-decoration-color: #666666; background-color: #f8f8f8}
.r17 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8}
.r18 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8}
.r19 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8}
.r20 {color: #bb6688; text-decoration-color: #bb6688; background-color: #f8f8f8; font-weight: bold}
.r21 {color: #408080; text-decoration-color: #408080; background-color: #f8f8f8; font-style: italic}
.r22 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8; font-weight: bold}
.r23 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8}
.r24 {color: #d2413a; text-decoration-color: #d2413a; background-color: #f8f8f8; font-weight: bold}
.r25 {color: #19177c; text-decoration-color: #19177c; background-color: #f8f8f8}
.r26 {color: #bb6622; text-decoration-color: #bb6622; background-color: #f8f8f8; font-weight: bold}
.r27 {font-weight: bold; font-style: italic}
.r28 {color: #0000ff; text-decoration-color: #0000ff}
body {
    color: #000000;
    background-color: #ffffff;
}
</style>
</head>
<html>
<body>
    <code>
        <pre style="font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span class="r1">c:\users\robertwenink\appdata\local\programs\python\python39\lib\site-packages\scalene\scalene_profiler.py: % of time =  40.00% out</span>
<span class="r1">                                                            of  17.27s.                                                            </span>
+---------------------------------------------------------------------------------------------------------------------------------+
|<span class="r2"> </span><span class="r3">Line</span><span class="r2"> </span>|<span class="r4">Time</span><span class="r2">   </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r5">––––––</span><span class="r2"> </span>|<span class="r2">                                                                                          </span>|
|      |<span class="r6">Python</span><span class="r2"> </span>|<span class="r6">native</span><span class="r2"> </span>|<span class="r6">system</span><span class="r2"> </span>|<span class="r7">GPU</span><span class="r2">    </span>|<span class="r2">c:\users\robertwenink\appdata\local\programs\python\python39\lib\site-packages\scalene\s… </span>|
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">    1 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">&quot;&quot;&quot;Scalene: a scripting-language aware profiler for Python.</span><span class="r12">                              </span> |
|<span class="r8">    2 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">    3 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    https://github.com/plasma-umass/scalene</span><span class="r12">                                              </span> |
|<span class="r8">    4 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">    5 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See the paper &quot;docs/scalene-paper.pdf&quot; in this repository for technical</span><span class="r12">              </span> |
|<span class="r8">    6 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details on an earlier version of Scalene&#x27;s design; note that a</span><span class="r12">                       </span> |
|<span class="r8">    7 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    number of these details have changed.</span><span class="r12">                                                </span> |
|<span class="r8">    8 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">    9 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    by Emery Berger</span><span class="r12">                                                                      </span> |
|<span class="r8">   10 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    https://emeryberger.com</span><span class="r12">                                                              </span> |
|<span class="r8">   11 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   12 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    usage: scalene test/testme.py</span><span class="r12">                                                        </span> |
|<span class="r8">   13 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    usage help: scalene --help</span><span class="r12">                                                           </span> |
|<span class="r8">   14 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   15 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                      </span> |
|<span class="r8">   16 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">argparse</span><span class="r12">                                                                          </span> |
|<span class="r8">   17 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">atexit</span><span class="r12">                                                                            </span> |
|<span class="r8">   18 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">builtins</span><span class="r12">                                                                          </span> |
|<span class="r8">   19 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">dis</span><span class="r12">                                                                               </span> |
|<span class="r8">   20 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">functools</span><span class="r12">                                                                         </span> |
|<span class="r8">   21 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">gc</span><span class="r12">                                                                                </span> |
|<span class="r8">   22 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">inspect</span><span class="r12">                                                                           </span> |
|<span class="r8">   23 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">math</span><span class="r12">                                                                              </span> |
|<span class="r8">   24 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">mmap</span><span class="r12">                                                                              </span> |
|<span class="r8">   25 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">multiprocessing</span><span class="r12">                                                                   </span> |
|<span class="r8">   26 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">queue</span><span class="r12">                                                                             </span> |
|<span class="r8">   27 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">os</span><span class="r12">                                                                                </span> |
|<span class="r8">   28 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">random</span><span class="r12">                                                                            </span> |
|<span class="r8">   29 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">re</span><span class="r12">                                                                                </span> |
|<span class="r8">   30 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">signal</span><span class="r12">                                                                            </span> |
|<span class="r8">   31 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">stat</span><span class="r12">                                                                              </span> |
|<span class="r8">   32 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">sys</span><span class="r12">                                                                               </span> |
|<span class="r8">   33 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">tempfile</span><span class="r12">                                                                          </span> |
|<span class="r8">   34 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">threading</span><span class="r12">                                                                         </span> |
|<span class="r8">   35 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">time</span><span class="r12">                                                                              </span> |
|<span class="r8">   36 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">traceback</span><span class="r12">                                                                         </span> |
|<span class="r8">   37 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   38 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">!=</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                              </span> |
|<span class="r8">   39 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">from</span><span class="r14"> </span><span class="r15">scalene</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> get_line_atomic</span><span class="r12">                                                  </span> |
|<span class="r8">   40 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   41 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">collections</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> defaultdict</span><span class="r12">                                                      </span> |
|<span class="r8">   42 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">functools</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> lru_cache</span><span class="r12">                                                          </span> |
|<span class="r8">   43 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">signal</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> Handlers, Signals</span><span class="r12">                                                     </span> |
|<span class="r8">   44 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">types</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> CodeType, FrameType</span><span class="r12">                                                    </span> |
|<span class="r8">   45 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">typing</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> (</span><span class="r12">                                                                     </span> |
|<span class="r8">   46 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Any,</span><span class="r12">                                                                                 </span> |
|<span class="r8">   47 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Callable,</span><span class="r12">                                                                            </span> |
|<span class="r8">   48 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Dict,</span><span class="r12">                                                                                </span> |
|<span class="r8">   49 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Set,</span><span class="r12">                                                                                 </span> |
|<span class="r8">   50 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    FrozenSet,</span><span class="r12">                                                                           </span> |
|<span class="r8">   51 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    List,</span><span class="r12">                                                                                </span> |
|<span class="r8">   52 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Optional,</span><span class="r12">                                                                            </span> |
|<span class="r8">   53 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Tuple,</span><span class="r12">                                                                               </span> |
|<span class="r8">   54 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Union,</span><span class="r12">                                                                               </span> |
|<span class="r8">   55 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    cast,</span><span class="r12">                                                                                </span> |
|<span class="r8">   56 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">)</span><span class="r12">                                                                                        </span> |
|<span class="r8">   57 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">multiprocessing.process</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> BaseProcess</span><span class="r12">                                          </span> |
|<span class="r8">   58 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   59 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_arguments</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> ScaleneArguments</span><span class="r12">                                   </span> |
|<span class="r8">   60 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_statistics</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> </span><span class="r16">*</span><span class="r12">                                                 </span> |
|<span class="r8">   61 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_output</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> ScaleneOutput</span><span class="r12">                                         </span> |
|<span class="r8">   62 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_preload</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> ScalenePreload</span><span class="r12">                                       </span> |
|<span class="r8">   63 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_signals</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> ScaleneSignals</span><span class="r12">                                       </span> |
|<span class="r8">   64 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_gpu</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> ScaleneGPU</span><span class="r12">                                               </span> |
|<span class="r8">   65 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_parseargs</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> ScaleneParseArgs, StopJupyterExecution</span><span class="r12">             </span> |
|<span class="r8">   66 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">scalene.scalene_sigqueue</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> ScaleneSigQueue</span><span class="r12">                                     </span> |
|<span class="r8">   67 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   68 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">require_python</span><span class="r14">(version: Tuple[</span><span class="r19">int</span><span class="r14">, </span><span class="r19">int</span><span class="r14">]):</span><span class="r12">                                            </span> |
|<span class="r8">   69 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">assert</span><span class="r14"> (sys</span><span class="r16">.</span><span class="r14">version_info </span><span class="r16">&gt;=</span><span class="r14"> version), \</span><span class="r12">                                              </span> |
|<span class="r8">   70 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">           </span><span class="r17">f&quot;Scalene requires Python version </span><span class="r20">{</span><span class="r14">version[</span><span class="r16">0</span><span class="r14">]</span><span class="r20">}</span><span class="r17">.</span><span class="r20">{</span><span class="r14">version[</span><span class="r16">1</span><span class="r14">]</span><span class="r20">}</span><span class="r17"> or above.&quot;</span><span class="r12">        </span> |
|<span class="r8">   71 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   72 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">require_python((</span><span class="r16">3</span><span class="r14">,</span><span class="r16">7</span><span class="r14">) </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">!=</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14"> </span><span class="r13">else</span><span class="r14"> (</span><span class="r16">3</span><span class="r14">,</span><span class="r16">8</span><span class="r14">))</span><span class="r12">                              </span> |
|<span class="r8">   73 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   74 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   75 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Scalene fully supports Unix-like operating systems; in</span><span class="r12">                                 </span> |
|<span class="r8">   76 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># particular, Linux, Mac OS X, and WSL 2 (Windows Subsystem for Linux 2 = Ubuntu).</span><span class="r12">       </span> |
|<span class="r8">   77 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># It also has partial support for Windows.</span><span class="r12">                                               </span> |
|<span class="r8">   78 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   79 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Install our profile decorator.</span><span class="r12">                                                         </span> |
|<span class="r8">   80 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   81 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   82 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">scalene_redirect_profile</span><span class="r14">(func: Any) </span><span class="r16">-&gt;</span><span class="r14"> Any:</span><span class="r12">                                          </span> |
|<span class="r8">   83 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">profile(func)</span><span class="r12">                                                         </span> |
|<span class="r8">   84 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   85 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   86 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">builtins</span><span class="r16">.</span><span class="r14">profile </span><span class="r16">=</span><span class="r14"> scalene_redirect_profile  </span><span class="r21"># type: ignore</span><span class="r12">                              </span> |
|<span class="r8">   87 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   88 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   89 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">class</span><span class="r14"> </span><span class="r15">Scalene</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">   90 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;The Scalene profiler itself.&quot;&quot;&quot;</span><span class="r12">                                                   </span> |
|<span class="r8">   91 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   92 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Debugging flag, for internal use only.</span><span class="r12">                                             </span> |
|<span class="r8">   93 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __debug: </span><span class="r19">bool</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                </span> |
|<span class="r8">   94 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Whether the current profiler is a child</span><span class="r12">                                            </span> |
|<span class="r8">   95 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __is_child </span><span class="r16">=</span><span class="r14"> </span><span class="r16">-1</span><span class="r12">                                                                      </span> |
|<span class="r8">   96 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># the pid of the primary profiler</span><span class="r12">                                                    </span> |
|<span class="r8">   97 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __parent_pid </span><span class="r16">=</span><span class="r14"> </span><span class="r16">-1</span><span class="r12">                                                                    </span> |
|<span class="r8">   98 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Support for @profile</span><span class="r12">                                                               </span> |
|<span class="r8">   99 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># decorated files</span><span class="r12">                                                                    </span> |
|<span class="r8">  100 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __files_to_profile: Dict[Filename, </span><span class="r19">bool</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> defaultdict(</span><span class="r19">bool</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  101 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># decorated functions</span><span class="r12">                                                                </span> |
|<span class="r8">  102 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __functions_to_profile: Dict[Filename, Dict[Any, </span><span class="r19">bool</span><span class="r14">]] </span><span class="r16">=</span><span class="r14"> defaultdict(</span><span class="r13">lambda</span><span class="r14">: {})</span><span class="r12">    </span> |
|<span class="r8">  103 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  104 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># We use these in is_call_function to determine whether a</span><span class="r12">                            </span> |
|<span class="r8">  105 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># particular bytecode is a function call.  We use this to</span><span class="r12">                            </span> |
|<span class="r8">  106 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># distinguish between Python and native code execution when</span><span class="r12">                          </span> |
|<span class="r8">  107 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># running in threads.</span><span class="r12">                                                                </span> |
|<span class="r8">  108 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __call_opcodes: FrozenSet[</span><span class="r19">int</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> </span><span class="r19">frozenset</span><span class="r14">(</span><span class="r12">                                          </span> |
|<span class="r8">  109 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        {</span><span class="r12">                                                                                </span> |
|<span class="r8">  110 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            dis</span><span class="r16">.</span><span class="r14">opmap[op_name]</span><span class="r12">                                                           </span> |
|<span class="r8">  111 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> op_name </span><span class="r22">in</span><span class="r14"> dis</span><span class="r16">.</span><span class="r14">opmap</span><span class="r12">                                                     </span> |
|<span class="r8">  112 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> op_name</span><span class="r16">.</span><span class="r14">startswith(</span><span class="r17">&quot;CALL_FUNCTION&quot;</span><span class="r14">)</span><span class="r12">                                       </span> |
|<span class="r8">  113 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        }</span><span class="r12">                                                                                </span> |
|<span class="r8">  114 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    )</span><span class="r12">                                                                                    </span> |
|<span class="r8">  115 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  116 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Cache the original thread join function, which we replace with our own version.</span><span class="r12">    </span> |
|<span class="r8">  117 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __original_thread_join </span><span class="r16">=</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">Thread</span><span class="r16">.</span><span class="r14">join</span><span class="r12">                                       </span> |
|<span class="r8">  118 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  119 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># As above; we&#x27;ll cache the original thread and replace it.</span><span class="r12">                          </span> |
|<span class="r8">  120 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __original_lock </span><span class="r16">=</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">Lock</span><span class="r12">                                                     </span> |
|<span class="r8">  121 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  122 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __args </span><span class="r16">=</span><span class="r14"> ScaleneArguments()</span><span class="r12">                                                          </span> |
|<span class="r8">  123 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __stats </span><span class="r16">=</span><span class="r14"> ScaleneStatistics()</span><span class="r12">                                                        </span> |
|<span class="r8">  124 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __output </span><span class="r16">=</span><span class="r14"> ScaleneOutput()</span><span class="r12">                                                           </span> |
|<span class="r8">  125 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __gpu </span><span class="r16">=</span><span class="r14"> ScaleneGPU()</span><span class="r12">                                                                 </span> |
|<span class="r8">  126 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  127 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __output</span><span class="r16">.</span><span class="r14">gpu </span><span class="r16">=</span><span class="r14"> __gpu</span><span class="r16">.</span><span class="r14">has_gpu()</span><span class="r12">                                                       </span> |
|<span class="r8">  128 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  129 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  130 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">get_original_lock</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">Lock:</span><span class="r12">                                           </span> |
|<span class="r8">  131 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__original_lock()</span><span class="r12">                                                 </span> |
|<span class="r8">  132 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  133 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Likely names for the Python interpreter.</span><span class="r12">                                           </span> |
|<span class="r8">  134 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __all_python_names </span><span class="r16">=</span><span class="r14"> [</span><span class="r12">                                                               </span> |
|<span class="r8">  135 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">basename(sys</span><span class="r16">.</span><span class="r14">executable),</span><span class="r12">                                                </span> |
|<span class="r8">  136 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">basename(sys</span><span class="r16">.</span><span class="r14">executable) </span><span class="r16">+</span><span class="r14"> </span><span class="r19">str</span><span class="r14">(sys</span><span class="r16">.</span><span class="r14">version_info</span><span class="r16">.</span><span class="r14">major),</span><span class="r12">                  </span> |
|<span class="r8">  137 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">basename(sys</span><span class="r16">.</span><span class="r14">executable)</span><span class="r12">                                                 </span> |
|<span class="r8">  138 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r16">+</span><span class="r14"> </span><span class="r19">str</span><span class="r14">(sys</span><span class="r16">.</span><span class="r14">version_info</span><span class="r16">.</span><span class="r14">major)</span><span class="r12">                                                    </span> |
|<span class="r8">  139 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r16">+</span><span class="r14"> </span><span class="r17">&quot;.&quot;</span><span class="r12">                                                                            </span> |
|<span class="r8">  140 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r16">+</span><span class="r14"> </span><span class="r19">str</span><span class="r14">(sys</span><span class="r16">.</span><span class="r14">version_info</span><span class="r16">.</span><span class="r14">minor),</span><span class="r12">                                                   </span> |
|<span class="r8">  141 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ]</span><span class="r12">                                                                                    </span> |
|<span class="r8">  142 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  143 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># last num seconds between interrupts for CPU sampling.</span><span class="r12">                              </span> |
|<span class="r8">  144 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __last_cpu_sampling_rate: </span><span class="r19">float</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                  </span> |
|<span class="r8">  145 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  146 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># when did we last receive a signal?</span><span class="r12">                                                 </span> |
|<span class="r8">  147 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __last_signal_time_virtual: </span><span class="r19">float</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                </span> |
|<span class="r8">  148 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __last_signal_time_wallclock: </span><span class="r19">float</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                              </span> |
|<span class="r8">  149 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  150 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># path for the program being profiled</span><span class="r12">                                                </span> |
|<span class="r8">  151 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __program_path: </span><span class="r19">str</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;&quot;</span><span class="r12">                                                             </span> |
|<span class="r8">  152 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># temporary directory to hold aliases to Python</span><span class="r12">                                      </span> |
|<span class="r8">  153 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __python_alias_dir: Filename</span><span class="r12">                                                         </span> |
|<span class="r8">  154 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  155 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21">## Profile output parameters</span><span class="r12">                                                         </span> |
|<span class="r8">  156 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  157 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># when we output the next profile</span><span class="r12">                                                    </span> |
|<span class="r8">  158 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __next_output_time: </span><span class="r19">float</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r19">float</span><span class="r14">(</span><span class="r17">&quot;inf&quot;</span><span class="r14">)</span><span class="r12">                                             </span> |
|<span class="r8">  159 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># pid for tracking child processes</span><span class="r12">                                                   </span> |
|<span class="r8">  160 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __pid: </span><span class="r19">int</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                       </span> |
|<span class="r8">  161 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  162 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Things that need to be in sync with the C++ side</span><span class="r12">                                   </span> |
|<span class="r8">  163 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># (see include/sampleheap.hpp, include/samplefile.hpp)</span><span class="r12">                               </span> |
|<span class="r8">  164 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  165 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    MAX_BUFSIZE </span><span class="r16">=</span><span class="r14"> </span><span class="r16">256</span><span class="r14">  </span><span class="r21"># Must match SampleFile::MAX_BUFSIZE</span><span class="r12">                              </span> |
|<span class="r8">  166 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __malloc_buf </span><span class="r16">=</span><span class="r14"> </span><span class="r19">bytearray</span><span class="r14">(MAX_BUFSIZE)</span><span class="r12">                                                </span> |
|<span class="r8">  167 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __memcpy_buf </span><span class="r16">=</span><span class="r14"> </span><span class="r19">bytearray</span><span class="r14">(MAX_BUFSIZE)</span><span class="r12">                                                </span> |
|<span class="r8">  168 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  169 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21">#   file to communicate the number of malloc/free samples (+ PID)</span><span class="r12">                    </span> |
|<span class="r8">  170 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __malloc_signal_filename </span><span class="r16">=</span><span class="r14"> Filename(</span><span class="r17">f&quot;/tmp/scalene-malloc-signal</span><span class="r20">{</span><span class="r14">os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r20">}</span><span class="r17">&quot;</span><span class="r14">)</span><span class="r12">      </span> |
|<span class="r8">  171 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __malloc_lock_filename </span><span class="r16">=</span><span class="r14"> Filename(</span><span class="r17">f&quot;/tmp/scalene-malloc-lock</span><span class="r20">{</span><span class="r14">os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r20">}</span><span class="r17">&quot;</span><span class="r14">)</span><span class="r12">          </span> |
|<span class="r8">  172 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __malloc_signal_position </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                         </span> |
|<span class="r8">  173 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __malloc_lastpos </span><span class="r16">=</span><span class="r14"> </span><span class="r19">bytearray</span><span class="r14">(</span><span class="r16">8</span><span class="r14">)</span><span class="r12">                                                      </span> |
|<span class="r8">  174 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __malloc_signal_mmap </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                          </span> |
|<span class="r8">  175 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                                 </span> |
|<span class="r8">  176 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __malloc_signal_fd </span><span class="r16">=</span><span class="r14"> </span><span class="r19">open</span><span class="r14">(__malloc_signal_filename, </span><span class="r17">&quot;r&quot;</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  177 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        os</span><span class="r16">.</span><span class="r14">unlink(__malloc_signal_fd</span><span class="r16">.</span><span class="r14">name)</span><span class="r12">                                               </span> |
|<span class="r8">  178 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __malloc_lock_fd </span><span class="r16">=</span><span class="r14"> </span><span class="r19">open</span><span class="r14">(__malloc_lock_filename, </span><span class="r17">&quot;r+&quot;</span><span class="r14">)</span><span class="r12">                            </span> |
|<span class="r8">  179 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        os</span><span class="r16">.</span><span class="r14">unlink(__malloc_lock_fd</span><span class="r16">.</span><span class="r14">name)</span><span class="r12">                                                 </span> |
|<span class="r8">  180 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __malloc_signal_mmap </span><span class="r16">=</span><span class="r14"> mmap</span><span class="r16">.</span><span class="r14">mmap(</span><span class="r12">                                                </span> |
|<span class="r8">  181 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            __malloc_signal_fd</span><span class="r16">.</span><span class="r14">fileno(),</span><span class="r12">                                                 </span> |
|<span class="r8">  182 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r16">0</span><span class="r14">,</span><span class="r12">                                                                           </span> |
|<span class="r8">  183 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">MAP_SHARED,</span><span class="r12">                                                             </span> |
|<span class="r8">  184 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">PROT_READ,</span><span class="r12">                                                              </span> |
|<span class="r8">  185 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  186 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __malloc_lock_mmap </span><span class="r16">=</span><span class="r14"> mmap</span><span class="r16">.</span><span class="r14">mmap(</span><span class="r12">                                                  </span> |
|<span class="r8">  187 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            __malloc_lock_fd</span><span class="r16">.</span><span class="r14">fileno(),</span><span class="r12">                                                   </span> |
|<span class="r8">  188 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r16">0</span><span class="r14">,</span><span class="r12">                                                                           </span> |
|<span class="r8">  189 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">MAP_SHARED,</span><span class="r12">                                                             </span> |
|<span class="r8">  190 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">PROT_READ </span><span class="r16">|</span><span class="r14"> mmap</span><span class="r16">.</span><span class="r14">PROT_WRITE,</span><span class="r12">                                            </span> |
|<span class="r8">  191 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  192 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> exc:</span><span class="r12">                                                         </span> |
|<span class="r8">  193 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Ignore if we aren&#x27;t profiling memory.</span><span class="r12">                                          </span> |
|<span class="r8">  194 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">pass</span><span class="r12">                                                                             </span> |
|<span class="r8">  195 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  196 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21">#   file to communicate the number of memcpy samples (+ PID)</span><span class="r12">                         </span> |
|<span class="r8">  197 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __memcpy_signal_filename </span><span class="r16">=</span><span class="r14"> Filename(</span><span class="r17">f&quot;/tmp/scalene-memcpy-signal</span><span class="r20">{</span><span class="r14">os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r20">}</span><span class="r17">&quot;</span><span class="r14">)</span><span class="r12">      </span> |
|<span class="r8">  198 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  199 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __memcpy_lock_filename </span><span class="r16">=</span><span class="r14"> Filename(</span><span class="r17">f&quot;/tmp/scalene-memcpy-lock</span><span class="r20">{</span><span class="r14">os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r20">}</span><span class="r17">&quot;</span><span class="r14">)</span><span class="r12">          </span> |
|<span class="r8">  200 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                                 </span> |
|<span class="r8">  201 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __memcpy_signal_fd </span><span class="r16">=</span><span class="r14"> </span><span class="r19">open</span><span class="r14">(__memcpy_signal_filename, </span><span class="r17">&quot;r&quot;</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  202 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        os</span><span class="r16">.</span><span class="r14">unlink(__memcpy_signal_fd</span><span class="r16">.</span><span class="r14">name)</span><span class="r12">                                               </span> |
|<span class="r8">  203 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __memcpy_lock_fd </span><span class="r16">=</span><span class="r14"> </span><span class="r19">open</span><span class="r14">(__memcpy_lock_filename, </span><span class="r17">&quot;r+&quot;</span><span class="r14">)</span><span class="r12">                            </span> |
|<span class="r8">  204 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        os</span><span class="r16">.</span><span class="r14">unlink(__memcpy_lock_fd</span><span class="r16">.</span><span class="r14">name)</span><span class="r12">                                                 </span> |
|<span class="r8">  205 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __memcpy_signal_mmap </span><span class="r16">=</span><span class="r14"> mmap</span><span class="r16">.</span><span class="r14">mmap(</span><span class="r12">                                                </span> |
|<span class="r8">  206 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            __memcpy_signal_fd</span><span class="r16">.</span><span class="r14">fileno(),</span><span class="r12">                                                 </span> |
|<span class="r8">  207 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r16">0</span><span class="r14">,</span><span class="r12">                                                                           </span> |
|<span class="r8">  208 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">MAP_SHARED,</span><span class="r12">                                                             </span> |
|<span class="r8">  209 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">PROT_READ,</span><span class="r12">                                                              </span> |
|<span class="r8">  210 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  211 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        __memcpy_lock_mmap </span><span class="r16">=</span><span class="r14"> mmap</span><span class="r16">.</span><span class="r14">mmap(</span><span class="r12">                                                  </span> |
|<span class="r8">  212 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            __memcpy_lock_fd</span><span class="r16">.</span><span class="r14">fileno(),</span><span class="r12">                                                   </span> |
|<span class="r8">  213 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r16">0</span><span class="r14">,</span><span class="r12">                                                                           </span> |
|<span class="r8">  214 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">MAP_SHARED,</span><span class="r12">                                                             </span> |
|<span class="r8">  215 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mmap</span><span class="r16">.</span><span class="r14">PROT_READ </span><span class="r16">|</span><span class="r14"> mmap</span><span class="r16">.</span><span class="r14">PROT_WRITE,</span><span class="r12">                                            </span> |
|<span class="r8">  216 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  217 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  218 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14">:</span><span class="r12">                                                                </span> |
|<span class="r8">  219 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">pass</span><span class="r12">                                                                             </span> |
|<span class="r8">  220 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __memcpy_lastpos </span><span class="r16">=</span><span class="r14"> </span><span class="r19">bytearray</span><span class="r14">(</span><span class="r16">8</span><span class="r14">)</span><span class="r12">                                                      </span> |
|<span class="r8">  221 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  222 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Program-specific information:</span><span class="r12">                                                      </span> |
|<span class="r8">  223 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21">#   the name of the program being profiled</span><span class="r12">                                           </span> |
|<span class="r8">  224 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __program_being_profiled </span><span class="r16">=</span><span class="r14"> Filename(</span><span class="r17">&quot;&quot;</span><span class="r14">)</span><span class="r12">                                              </span> |
|<span class="r8">  225 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  226 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Is the thread sleeping? (We use this to properly attribute CPU time.)</span><span class="r12">              </span> |
|<span class="r8">  227 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __is_thread_sleeping: Dict[</span><span class="r19">int</span><span class="r14">, </span><span class="r19">bool</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> defaultdict(</span><span class="r19">bool</span><span class="r14">)  </span><span class="r21"># False by default</span><span class="r12">        </span> |
|<span class="r8">  228 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __child_pids: Set[</span><span class="r19">int</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> </span><span class="r19">set</span><span class="r14">()</span><span class="r12">                                                       </span> |
|<span class="r8">  229 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  230 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@classmethod</span><span class="r12">                                                                         </span> |
|<span class="r8">  231 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">clear_metrics</span><span class="r14">(</span><span class="r19">cls</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  232 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  233 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Clears the various states so that each forked process</span><span class="r12">                            </span> |
|<span class="r8">  234 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        can start with a clean slate</span><span class="r12">                                                     </span> |
|<span class="r8">  235 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  236 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">cls</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">clear()</span><span class="r12">                                                              </span> |
|<span class="r8">  237 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">cls</span><span class="r16">.</span><span class="r14">__child_pids</span><span class="r16">.</span><span class="r14">clear()</span><span class="r12">                                                         </span> |
|<span class="r8">  238 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  239 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@classmethod</span><span class="r12">                                                                         </span> |
|<span class="r8">  240 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">add_child_pid</span><span class="r14">(</span><span class="r19">cls</span><span class="r14">, pid: </span><span class="r19">int</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                            </span> |
|<span class="r8">  241 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">cls</span><span class="r16">.</span><span class="r14">__child_pids</span><span class="r16">.</span><span class="r14">add(pid)</span><span class="r12">                                                        </span> |
|<span class="r8">  242 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  243 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@classmethod</span><span class="r12">                                                                         </span> |
|<span class="r8">  244 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">remove_child_pid</span><span class="r14">(</span><span class="r19">cls</span><span class="r14">, pid: </span><span class="r19">int</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                         </span> |
|<span class="r8">  245 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">cls</span><span class="r16">.</span><span class="r14">__child_pids</span><span class="r16">.</span><span class="r14">remove(pid)</span><span class="r12">                                                     </span> |
|<span class="r8">  246 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  247 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Replacement @profile decorator function.</span><span class="r12">                                           </span> |
|<span class="r8">  248 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># We track which functions - in which files - have been decorated,</span><span class="r12">                   </span> |
|<span class="r8">  249 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># and only report stats for those.</span><span class="r12">                                                   </span> |
|<span class="r8">  250 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  251 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">profile</span><span class="r14">(func: Any) </span><span class="r16">-&gt;</span><span class="r14"> Any:</span><span class="r12">                                                       </span> |
|<span class="r8">  252 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Record the file and function name</span><span class="r12">                                              </span> |
|<span class="r8">  253 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__files_to_profile[func</span><span class="r16">.</span><span class="r25">__code__</span><span class="r16">.</span><span class="r14">co_filename] </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                     </span> |
|<span class="r8">  254 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__functions_to_profile[func</span><span class="r16">.</span><span class="r25">__code__</span><span class="r16">.</span><span class="r14">co_filename][func] </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">           </span> |
|<span class="r8">  255 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  256 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r23">@functools</span><span class="r16">.</span><span class="r14">wraps(func)</span><span class="r12">                                                           </span> |
|<span class="r8">  257 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">def</span><span class="r14"> </span><span class="r18">wrapper_profile</span><span class="r14">(</span><span class="r16">*</span><span class="r14">args: Any, </span><span class="r16">**</span><span class="r14">kwargs: Any) </span><span class="r16">-&gt;</span><span class="r14"> Any:</span><span class="r12">                           </span> |
|<span class="r8">  258 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            value </span><span class="r16">=</span><span class="r14"> func(</span><span class="r16">*</span><span class="r14">args, </span><span class="r16">**</span><span class="r14">kwargs)</span><span class="r12">                                                </span> |
|<span class="r8">  259 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> value</span><span class="r12">                                                                 </span> |
|<span class="r8">  260 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  261 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> wrapper_profile</span><span class="r12">                                                           </span> |
|<span class="r8">  262 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  263 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  264 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">shim</span><span class="r14">(func: Callable[[Any], Any]) </span><span class="r16">-&gt;</span><span class="r14"> Any:</span><span class="r12">                                         </span> |
|<span class="r8">  265 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  266 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Provides a decorator that, when used, calls the wrapped function with the Scalene</span> |
|<span class="r8">  267 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  268 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Wrapped function must be of type (s: Scalene) -&gt; Any</span><span class="r12">                             </span> |
|<span class="r8">  269 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  270 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        This decorator allows for marking a function in a separate file as a drop-in repl</span> |
|<span class="r8">  271 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        library function. The intention is for these functions to replace a function that</span> |
|<span class="r8">  272 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        interferes with Scalene) with a function that awakens periodically to allow for s</span> |
|<span class="r8">  273 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  274 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        func(Scalene)</span><span class="r12">                                                                    </span> |
|<span class="r8">  275 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Returns the function itself to the calling file for the sake</span><span class="r12">                   </span> |
|<span class="r8">  276 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># of not displaying unusual errors if someone attempts to call</span><span class="r12">                   </span> |
|<span class="r8">  277 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># it</span><span class="r12">                                                                             </span> |
|<span class="r8">  278 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r23">@functools</span><span class="r16">.</span><span class="r14">wraps(func)</span><span class="r12">                                                           </span> |
|<span class="r8">  279 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">def</span><span class="r14"> </span><span class="r18">wrapped</span><span class="r14">(</span><span class="r16">*</span><span class="r14">args: Any, </span><span class="r16">**</span><span class="r14">kwargs: Any) </span><span class="r16">-&gt;</span><span class="r14"> Any:</span><span class="r12">                                   </span> |
|<span class="r8">  280 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> func(</span><span class="r16">*</span><span class="r14">args, </span><span class="r16">**</span><span class="r14">kwargs)  </span><span class="r21"># type: ignore</span><span class="r12">                                 </span> |
|<span class="r8">  281 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  282 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> wrapped</span><span class="r12">                                                                   </span> |
|<span class="r8">  283 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  284 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  285 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">set_thread_sleeping</span><span class="r14">(tid: </span><span class="r19">int</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                           </span> |
|<span class="r8">  286 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__is_thread_sleeping[tid] </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                         </span> |
|<span class="r8">  287 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  288 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  289 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">reset_thread_sleeping</span><span class="r14">(tid: </span><span class="r19">int</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                         </span> |
|<span class="r8">  290 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__is_thread_sleeping[tid] </span><span class="r16">=</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                        </span> |
|<span class="r8">  291 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  292 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  293 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@lru_cache</span><span class="r14">(maxsize</span><span class="r16">=</span><span class="r13">None</span><span class="r14">)</span><span class="r12">                                                             </span> |
|<span class="r8">  294 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">is_call_function</span><span class="r14">(code: CodeType, bytei: ByteCodeIndex) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r19">bool</span><span class="r14">:</span><span class="r12">                  </span> |
|<span class="r8">  295 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Returns true iff the bytecode at the given index is a function call.&quot;&quot;&quot;</span><span class="r12">       </span> |
|<span class="r8">  296 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> ins </span><span class="r22">in</span><span class="r14"> dis</span><span class="r16">.</span><span class="r14">get_instructions(code):</span><span class="r12">                                           </span> |
|<span class="r8">  297 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> ins</span><span class="r16">.</span><span class="r14">offset </span><span class="r16">==</span><span class="r14"> bytei </span><span class="r22">and</span><span class="r14"> ins</span><span class="r16">.</span><span class="r14">opcode </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__call_opcodes:</span><span class="r12">             </span> |
|<span class="r8">  298 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">return</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                              </span> |
|<span class="r8">  299 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                     </span> |
|<span class="r8">  300 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  301 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    timer_signals </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                                 </span> |
|<span class="r8">  302 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  303 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  304 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">windows_timer_loop</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                    </span> |
|<span class="r8">  305 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;For Windows, send periodic timer signals; launch as a background thread.&quot;&quot;&quot;</span><span class="r12">   </span> |
|<span class="r8">  306 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">timer_signals </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                     </span> |
|<span class="r8">  307 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">while</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">timer_signals:</span><span class="r12">                                                     </span> |
|<span class="r8">  308 </span>|<span class="r9">   11% </span>|<span class="r9">       </span>|<span class="r9">   9%  </span>|<span class="r10">       </span>|<span class="r14">            time</span><span class="r16">.</span><span class="r14">sleep(Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_sampling_rate)</span><span class="r12">                                 </span> |
|<span class="r8">  309 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">raise_signal(ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_signal)</span><span class="r12">                               </span> |
|<span class="r8">  310 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  311 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  312 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">set_timer_signals</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                     </span> |
|<span class="r8">  313 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Set up timer signals for CPU profiling.&quot;&quot;&quot;</span><span class="r12">                                    </span> |
|<span class="r8">  314 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  315 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8">  316 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">use_virtual_time:</span><span class="r12">                                              </span> |
|<span class="r8">  317 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal </span><span class="r16">=</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">ITIMER_VIRTUAL</span><span class="r12">                      </span> |
|<span class="r8">  318 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  319 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal </span><span class="r16">=</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">ITIMER_REAL</span><span class="r12">                         </span> |
|<span class="r8">  320 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  321 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Now set the appropriate timer signal.</span><span class="r12">                                          </span> |
|<span class="r8">  322 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal </span><span class="r16">==</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">ITIMER_REAL:</span><span class="r12">                        </span> |
|<span class="r8">  323 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_signal </span><span class="r16">=</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">SIGALRM</span><span class="r12">                                   </span> |
|<span class="r8">  324 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal </span><span class="r16">==</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">ITIMER_VIRTUAL:</span><span class="r12">                   </span> |
|<span class="r8">  325 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_signal </span><span class="r16">=</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">SIGVTALRM</span><span class="r12">                                 </span> |
|<span class="r8">  326 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal </span><span class="r16">==</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">ITIMER_PROF:</span><span class="r12">                      </span> |
|<span class="r8">  327 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_signal </span><span class="r16">=</span><span class="r14"> signal</span><span class="r16">.</span><span class="r14">SIGPROF</span><span class="r12">                                   </span> |
|<span class="r8">  328 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># NOT SUPPORTED</span><span class="r12">                                                              </span> |
|<span class="r8">  329 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">assert</span><span class="r14"> </span><span class="r13">False</span><span class="r14">, </span><span class="r17">&quot;ITIMER_PROF is not currently supported.&quot;</span><span class="r12">                      </span> |
|<span class="r8">  330 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  331 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  332 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">start_signal_queues</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                   </span> |
|<span class="r8">  333 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Starts the signal processing queues (i.e., their threads)&quot;&quot;&quot;</span><span class="r12">                  </span> |
|<span class="r8">  334 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__cpu_sigq</span><span class="r16">.</span><span class="r14">start()</span><span class="r12">                                                       </span> |
|<span class="r8">  335 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__alloc_sigq</span><span class="r16">.</span><span class="r14">start()</span><span class="r12">                                                     </span> |
|<span class="r8">  336 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__memcpy_sigq</span><span class="r16">.</span><span class="r14">start()</span><span class="r12">                                                    </span> |
|<span class="r8">  337 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  338 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  339 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">stop_signal_queues</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                    </span> |
|<span class="r8">  340 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Stops the signal processing queues (i.e., their threads)&quot;&quot;&quot;</span><span class="r12">                   </span> |
|<span class="r8">  341 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__cpu_sigq</span><span class="r16">.</span><span class="r14">stop()</span><span class="r12">                                                        </span> |
|<span class="r8">  342 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__alloc_sigq</span><span class="r16">.</span><span class="r14">stop()</span><span class="r12">                                                      </span> |
|<span class="r8">  343 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__memcpy_sigq</span><span class="r16">.</span><span class="r14">stop()</span><span class="r12">                                                     </span> |
|<span class="r8">  344 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  345 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  346 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">malloc_signal_handler</span><span class="r14">(</span><span class="r12">                                                           </span> |
|<span class="r8">  347 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8">  348 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  349 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  350 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__alloc_sigq</span><span class="r16">.</span><span class="r14">put((signum, this_frame))</span><span class="r12">                                   </span> |
|<span class="r8">  351 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  352 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  353 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">free_signal_handler</span><span class="r14">(</span><span class="r12">                                                             </span> |
|<span class="r8">  354 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8">  355 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  356 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  357 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__alloc_sigq</span><span class="r16">.</span><span class="r14">put((signum, this_frame))</span><span class="r12">                                   </span> |
|<span class="r8">  358 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  359 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  360 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">memcpy_signal_handler</span><span class="r14">(</span><span class="r12">                                                           </span> |
|<span class="r8">  361 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8">  362 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  363 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  364 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__memcpy_sigq</span><span class="r16">.</span><span class="r14">put((signum, this_frame))</span><span class="r12">                                  </span> |
|<span class="r8">  365 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  366 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  367 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">enable_signals</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8">  368 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Set up the signal handlers to handle interrupts for profiling and start the</span><span class="r12">   </span> |
|<span class="r8">  369 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        timer interrupts.&quot;&quot;&quot;</span><span class="r12">                                                             </span> |
|<span class="r8">  370 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  371 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">timer_signals </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                 </span> |
|<span class="r8">  372 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">signal(</span><span class="r12">                                                               </span> |
|<span class="r8">  373 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_signal,</span><span class="r12">                                               </span> |
|<span class="r8">  374 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">cpu_signal_handler,</span><span class="r12">                                              </span> |
|<span class="r8">  375 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  376 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># On Windows, we simulate timer signals by running a background thread.</span><span class="r12">      </span> |
|<span class="r8">  377 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">timer_signals </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                 </span> |
|<span class="r8">  378 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            t </span><span class="r16">=</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">Thread(target</span><span class="r16">=</span><span class="r14">Scalene</span><span class="r16">.</span><span class="r14">windows_timer_loop)</span><span class="r12">                      </span> |
|<span class="r8">  379 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            t</span><span class="r16">.</span><span class="r14">start()</span><span class="r12">                                                                    </span> |
|<span class="r8">  380 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">start_signal_queues()</span><span class="r12">                                                </span> |
|<span class="r8">  381 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8">  382 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">start_signal_queues()</span><span class="r12">                                                    </span> |
|<span class="r8">  383 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Set signal handlers for memory allocation and memcpy events.</span><span class="r12">                   </span> |
|<span class="r8">  384 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">signal(ScaleneSignals</span><span class="r16">.</span><span class="r14">malloc_signal, Scalene</span><span class="r16">.</span><span class="r14">malloc_signal_handler)</span><span class="r12">       </span> |
|<span class="r8">  385 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">signal(ScaleneSignals</span><span class="r16">.</span><span class="r14">free_signal, Scalene</span><span class="r16">.</span><span class="r14">free_signal_handler)</span><span class="r12">           </span> |
|<span class="r8">  386 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">signal(</span><span class="r12">                                                                   </span> |
|<span class="r8">  387 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">memcpy_signal,</span><span class="r12">                                                </span> |
|<span class="r8">  388 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">memcpy_signal_handler,</span><span class="r12">                                               </span> |
|<span class="r8">  389 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  390 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Set every signal to restart interrupted system calls.</span><span class="r12">                          </span> |
|<span class="r8">  391 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">siginterrupt(ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_signal, </span><span class="r13">False</span><span class="r14">)</span><span class="r12">                            </span> |
|<span class="r8">  392 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">siginterrupt(ScaleneSignals</span><span class="r16">.</span><span class="r14">malloc_signal, </span><span class="r13">False</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  393 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">siginterrupt(ScaleneSignals</span><span class="r16">.</span><span class="r14">free_signal, </span><span class="r13">False</span><span class="r14">)</span><span class="r12">                           </span> |
|<span class="r8">  394 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">siginterrupt(ScaleneSignals</span><span class="r16">.</span><span class="r14">memcpy_signal, </span><span class="r13">False</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  395 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Turn on the CPU profiling timer to run at the sampling rate (exactly once).</span><span class="r12">    </span> |
|<span class="r8">  396 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">signal(</span><span class="r12">                                                                   </span> |
|<span class="r8">  397 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_signal,</span><span class="r12">                                                   </span> |
|<span class="r8">  398 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">cpu_signal_handler,</span><span class="r12">                                                  </span> |
|<span class="r8">  399 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  400 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">setitimer(</span><span class="r12">                                                                </span> |
|<span class="r8">  401 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal,</span><span class="r12">                                             </span> |
|<span class="r8">  402 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_sampling_rate,</span><span class="r12">                                            </span> |
|<span class="r8">  403 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r16">0</span><span class="r14">,</span><span class="r12">                                                                           </span> |
|<span class="r8">  404 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  405 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  406 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">__init__</span><span class="r14">(</span><span class="r12">                                                                        </span> |
|<span class="r8">  407 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r14">,</span><span class="r12">                                                                            </span> |
|<span class="r8">  408 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        arguments: argparse</span><span class="r16">.</span><span class="r14">Namespace,</span><span class="r12">                                                   </span> |
|<span class="r8">  409 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        program_being_profiled: Optional[Filename] </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r14">,</span><span class="r12">                               </span> |
|<span class="r8">  410 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ):</span><span class="r12">                                                                                   </span> |
|<span class="r8">  411 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">import</span><span class="r14"> </span><span class="r15">scalene.replacement_pjoin</span><span class="r12">                                                 </span> |
|<span class="r8">  412 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  413 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Hijack lock, poll, thread_join, fork, and exit.</span><span class="r12">                                </span> |
|<span class="r8">  414 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">import</span><span class="r14"> </span><span class="r15">scalene.replacement_lock</span><span class="r12">                                                  </span> |
|<span class="r8">  415 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">import</span><span class="r14"> </span><span class="r15">scalene.replacement_thread_join</span><span class="r12">                                           </span> |
|<span class="r8">  416 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">import</span><span class="r14"> </span><span class="r15">scalene.replacement_exit</span><span class="r12">                                                  </span> |
|<span class="r8">  417 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">import</span><span class="r14"> </span><span class="r15">scalene.replacement_mp_lock</span><span class="r12">                                               </span> |
|<span class="r8">  418 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  419 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">!=</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  420 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">import</span><span class="r14"> </span><span class="r15">scalene.replacement_poll_selector</span><span class="r12">                                     </span> |
|<span class="r8">  421 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">import</span><span class="r14"> </span><span class="r15">scalene.replacement_fork</span><span class="r12">                                              </span> |
|<span class="r8">  422 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  423 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__args </span><span class="r16">=</span><span class="r14"> cast(ScaleneArguments, arguments)</span><span class="r12">                               </span> |
|<span class="r8">  424 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__cpu_sigq </span><span class="r16">=</span><span class="r14"> ScaleneSigQueue(Scalene</span><span class="r16">.</span><span class="r14">cpu_sigqueue_processor)</span><span class="r12">             </span> |
|<span class="r8">  425 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__alloc_sigq </span><span class="r16">=</span><span class="r14"> ScaleneSigQueue(Scalene</span><span class="r16">.</span><span class="r14">alloc_sigqueue_processor)</span><span class="r12">         </span> |
|<span class="r8">  426 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__memcpy_sigq </span><span class="r16">=</span><span class="r14"> ScaleneSigQueue(Scalene</span><span class="r16">.</span><span class="r14">memcpy_sigqueue_processor)</span><span class="r12">       </span> |
|<span class="r8">  427 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  428 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">set_timer_signals()</span><span class="r12">                                                      </span> |
|<span class="r8">  429 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> arguments</span><span class="r16">.</span><span class="r14">pid:</span><span class="r12">                                                                </span> |
|<span class="r8">  430 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Child process.</span><span class="r12">                                                             </span> |
|<span class="r8">  431 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># We need to use the same directory as the parent.</span><span class="r12">                           </span> |
|<span class="r8">  432 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># The parent always puts this directory as the first entry in the PATH.</span><span class="r12">      </span> |
|<span class="r8">  433 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Extract the alias directory from the path.</span><span class="r12">                                 </span> |
|<span class="r8">  434 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            dirname </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">environ[</span><span class="r17">&quot;PATH&quot;</span><span class="r14">]</span><span class="r16">.</span><span class="r14">split(os</span><span class="r16">.</span><span class="r14">pathsep)[</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                            </span> |
|<span class="r8">  435 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir </span><span class="r16">=</span><span class="r14"> Filename(dirname)</span><span class="r12">                               </span> |
|<span class="r8">  436 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__pid </span><span class="r16">=</span><span class="r14"> arguments</span><span class="r16">.</span><span class="r14">pid</span><span class="r12">                                                </span> |
|<span class="r8">  437 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  438 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  439 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Parent process.</span><span class="r12">                                                            </span> |
|<span class="r8">  440 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir </span><span class="r16">=</span><span class="r14"> Filename(tempfile</span><span class="r16">.</span><span class="r14">mkdtemp(prefix</span><span class="r16">=</span><span class="r17">&quot;scalene&quot;</span><span class="r14">))</span><span class="r12">    </span> |
|<span class="r8">  441 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Create a temporary directory to hold aliases to the Python</span><span class="r12">                 </span> |
|<span class="r8">  442 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># executable, so scalene can handle multiple processes; each</span><span class="r12">                 </span> |
|<span class="r8">  443 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># one is a shell script that redirects to Scalene.</span><span class="r12">                           </span> |
|<span class="r8">  444 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__pid </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                            </span> |
|<span class="r8">  445 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cmdline </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;&quot;</span><span class="r12">                                                                 </span> |
|<span class="r8">  446 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Pass along commands from the invoking command line.</span><span class="r12">                        </span> |
|<span class="r8">  447 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cmdline </span><span class="r16">+=</span><span class="r14"> </span><span class="r17">f&quot; --cpu-sampling-rate=</span><span class="r20">{</span><span class="r14">arguments</span><span class="r16">.</span><span class="r14">cpu_sampling_rate</span><span class="r20">}</span><span class="r17">&quot;</span><span class="r12">             </span> |
|<span class="r8">  448 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> arguments</span><span class="r16">.</span><span class="r14">use_virtual_time:</span><span class="r12">                                               </span> |
|<span class="r8">  449 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                cmdline </span><span class="r16">+=</span><span class="r14"> </span><span class="r17">&quot; --use-virtual-time&quot;</span><span class="r12">                                         </span> |
|<span class="r8">  450 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r17">&quot;off&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> arguments </span><span class="r22">and</span><span class="r14"> arguments</span><span class="r16">.</span><span class="r14">off:</span><span class="r12">                                     </span> |
|<span class="r8">  451 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                cmdline </span><span class="r16">+=</span><span class="r14"> </span><span class="r17">&quot; --off&quot;</span><span class="r12">                                                      </span> |
|<span class="r8">  452 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> arguments</span><span class="r16">.</span><span class="r14">cpu_only:</span><span class="r12">                                                       </span> |
|<span class="r8">  453 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                cmdline </span><span class="r16">+=</span><span class="r14"> </span><span class="r17">&quot; --cpu-only&quot;</span><span class="r12">                                                 </span> |
|<span class="r8">  454 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  455 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            environ </span><span class="r16">=</span><span class="r14"> ScalenePreload</span><span class="r16">.</span><span class="r14">get_preload_environ(arguments)</span><span class="r12">                      </span> |
|<span class="r8">  456 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            preface </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27; &#x27;</span><span class="r16">.</span><span class="r14">join(</span><span class="r17">&#x27;=&#x27;</span><span class="r16">.</span><span class="r14">join((k,</span><span class="r19">str</span><span class="r14">(v))) </span><span class="r13">for</span><span class="r14"> (k,v) </span><span class="r22">in</span><span class="r14"> environ</span><span class="r16">.</span><span class="r14">items())</span><span class="r12">        </span> |
|<span class="r8">  457 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  458 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Add the --pid field so we can propagate it to the child.</span><span class="r12">                   </span> |
|<span class="r8">  459 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cmdline </span><span class="r16">+=</span><span class="r14"> </span><span class="r17">f&quot; --pid=</span><span class="r20">{</span><span class="r14">os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r20">}</span><span class="r17"> ---&quot;</span><span class="r12">                                       </span> |
|<span class="r8">  460 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            payload </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;&quot;&quot;#!/bin/bash</span><span class="r12">                                                     </span> |
|<span class="r8">  461 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r17">    echo $$</span><span class="r12">                                                                              </span> |
|<span class="r8">  462 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r17">    </span><span class="r20">%s</span><span class="r17"> </span><span class="r20">%s</span><span class="r17"> -m scalene </span><span class="r20">%s</span><span class="r17"> $@</span><span class="r12">                                                               </span> |
|<span class="r8">  463 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r17">    &quot;&quot;&quot;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (</span><span class="r12">                                                                              </span> |
|<span class="r8">  464 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                preface,</span><span class="r12">                                                                 </span> |
|<span class="r8">  465 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                sys</span><span class="r16">.</span><span class="r14">executable,</span><span class="r12">                                                          </span> |
|<span class="r8">  466 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                cmdline,</span><span class="r12">                                                                 </span> |
|<span class="r8">  467 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  468 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Now create all the files.</span><span class="r12">                                                  </span> |
|<span class="r8">  469 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> name </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__all_python_names:</span><span class="r12">                                      </span> |
|<span class="r8">  470 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                fname </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">join(Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir, name)</span><span class="r12">                   </span> |
|<span class="r8">  471 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">with</span><span class="r14"> </span><span class="r19">open</span><span class="r14">(fname, </span><span class="r17">&quot;w&quot;</span><span class="r14">) </span><span class="r13">as</span><span class="r14"> file:</span><span class="r12">                                           </span> |
|<span class="r8">  472 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    file</span><span class="r16">.</span><span class="r14">write(payload)</span><span class="r12">                                                  </span> |
|<span class="r8">  473 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                os</span><span class="r16">.</span><span class="r14">chmod(fname, stat</span><span class="r16">.</span><span class="r14">S_IXUSR </span><span class="r16">|</span><span class="r14"> stat</span><span class="r16">.</span><span class="r14">S_IRUSR </span><span class="r16">|</span><span class="r14"> stat</span><span class="r16">.</span><span class="r14">S_IWUSR)</span><span class="r12">              </span> |
|<span class="r8">  474 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Finally, insert this directory into the path.</span><span class="r12">                              </span> |
|<span class="r8">  475 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sys</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">insert(</span><span class="r16">0</span><span class="r14">, Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir)</span><span class="r12">                               </span> |
|<span class="r8">  476 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            os</span><span class="r16">.</span><span class="r14">environ[</span><span class="r17">&quot;PATH&quot;</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> (</span><span class="r12">                                                       </span> |
|<span class="r8">  477 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir </span><span class="r16">+</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">pathsep </span><span class="r16">+</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">environ[</span><span class="r17">&quot;PATH&quot;</span><span class="r14">]</span><span class="r12">             </span> |
|<span class="r8">  478 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  479 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Force the executable (if anyone invokes it later) to point to one of our al</span> |
|<span class="r8">  480 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sys</span><span class="r16">.</span><span class="r14">executable </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__all_python_names[</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                               </span> |
|<span class="r8">  481 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  482 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Register the exit handler to run when the program terminates or we quit.</span><span class="r12">       </span> |
|<span class="r8">  483 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        atexit</span><span class="r16">.</span><span class="r14">register(Scalene</span><span class="r16">.</span><span class="r14">exit_handler)</span><span class="r12">                                            </span> |
|<span class="r8">  484 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Store relevant names (program, path).</span><span class="r12">                                          </span> |
|<span class="r8">  485 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> program_being_profiled:</span><span class="r12">                                                       </span> |
|<span class="r8">  486 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__program_being_profiled </span><span class="r16">=</span><span class="r14"> Filename(</span><span class="r12">                                 </span> |
|<span class="r8">  487 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">abspath(program_being_profiled)</span><span class="r12">                                  </span> |
|<span class="r8">  488 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  489 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  490 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  491 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">cpu_signal_handler</span><span class="r14">(</span><span class="r12">                                                              </span> |
|<span class="r8">  492 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8">  493 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  494 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  495 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Wrapper for CPU signal handlers.&quot;&quot;&quot;</span><span class="r12">                                           </span> |
|<span class="r8">  496 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        now_virtual </span><span class="r16">=</span><span class="r14"> time</span><span class="r16">.</span><span class="r14">process_time()</span><span class="r12">                                                </span> |
|<span class="r8">  497 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        now_wallclock </span><span class="r16">=</span><span class="r14"> time</span><span class="r16">.</span><span class="r14">perf_counter()</span><span class="r12">                                              </span> |
|<span class="r8">  498 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> (</span><span class="r12">                                                                             </span> |
|<span class="r8">  499 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_virtual </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                                    </span> |
|<span class="r8">  500 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r22">or</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_wallclock </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                               </span> |
|<span class="r8">  501 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ):</span><span class="r12">                                                                               </span> |
|<span class="r8">  502 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_virtual </span><span class="r16">=</span><span class="r14"> now_virtual</span><span class="r12">                             </span> |
|<span class="r8">  503 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_wallclock </span><span class="r16">=</span><span class="r14"> now_wallclock</span><span class="r12">                         </span> |
|<span class="r8">  504 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Sample GPU load as well.</span><span class="r12">                                                       </span> |
|<span class="r8">  505 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gpu_load </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__gpu</span><span class="r16">.</span><span class="r14">load()</span><span class="r12">                                                  </span> |
|<span class="r8">  506 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gpu_mem_used </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__gpu</span><span class="r16">.</span><span class="r14">memory_used()</span><span class="r12">                                       </span> |
|<span class="r8">  507 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__cpu_sigq</span><span class="r16">.</span><span class="r14">put(</span><span class="r12">                                                          </span> |
|<span class="r8">  508 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            (</span><span class="r12">                                                                            </span> |
|<span class="r8">  509 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                signum,</span><span class="r12">                                                                  </span> |
|<span class="r8">  510 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                this_frame,</span><span class="r12">                                                              </span> |
|<span class="r8">  511 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                now_virtual,</span><span class="r12">                                                             </span> |
|<span class="r8">  512 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                now_wallclock,</span><span class="r12">                                                           </span> |
|<span class="r8">  513 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                gpu_load,</span><span class="r12">                                                                </span> |
|<span class="r8">  514 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                gpu_mem_used,</span><span class="r12">                                                            </span> |
|<span class="r8">  515 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_virtual,</span><span class="r12">                                      </span> |
|<span class="r8">  516 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_wallclock,</span><span class="r12">                                    </span> |
|<span class="r8">  517 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  518 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  519 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">!=</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  520 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">setitimer(</span><span class="r12">                                                            </span> |
|<span class="r8">  521 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal,</span><span class="r12">                                         </span> |
|<span class="r8">  522 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_sampling_rate,</span><span class="r12">                                        </span> |
|<span class="r8">  523 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r16">0</span><span class="r14">,</span><span class="r12">                                                                       </span> |
|<span class="r8">  524 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  525 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_virtual </span><span class="r16">=</span><span class="r14"> time</span><span class="r16">.</span><span class="r14">process_time()</span><span class="r12">                         </span> |
|<span class="r8">  526 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__last_signal_time_wallclock </span><span class="r16">=</span><span class="r14"> time</span><span class="r16">.</span><span class="r14">perf_counter()</span><span class="r12">                       </span> |
|<span class="r8">  527 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  528 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  529 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">profile_this_code</span><span class="r14">(fname: Filename, lineno: LineNumber) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r19">bool</span><span class="r14">:</span><span class="r12">                  </span> |
|<span class="r8">  530 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;When using @profile, only profile files &amp; lines that have been decorated.&quot;&quot;&quot;</span><span class="r12">  </span> |
|<span class="r8">  531 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__files_to_profile:</span><span class="r12">                                               </span> |
|<span class="r8">  532 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                                  </span> |
|<span class="r8">  533 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> fname </span><span class="r22">not</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__files_to_profile:</span><span class="r12">                                      </span> |
|<span class="r8">  534 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                 </span> |
|<span class="r8">  535 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Now check to see if it&#x27;s the right line range.</span><span class="r12">                                 </span> |
|<span class="r8">  536 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> fn </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__functions_to_profile[fname]:</span><span class="r12">                                 </span> |
|<span class="r8">  537 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            lines, line_start </span><span class="r16">=</span><span class="r14"> inspect</span><span class="r16">.</span><span class="r14">getsourcelines(fn)</span><span class="r12">                               </span> |
|<span class="r8">  538 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> lineno </span><span class="r16">&gt;=</span><span class="r14"> line_start </span><span class="r22">and</span><span class="r14"> lineno </span><span class="r16">&lt;</span><span class="r14"> line_start </span><span class="r16">+</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(lines):</span><span class="r12">                </span> |
|<span class="r8">  539 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Yes, it&#x27;s in range.</span><span class="r12">                                                    </span> |
|<span class="r8">  540 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">return</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                              </span> |
|<span class="r8">  541 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                     </span> |
|<span class="r8">  542 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  543 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  544 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">cpu_sigqueue_processor</span><span class="r14">(</span><span class="r12">                                                          </span> |
|<span class="r8">  545 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        _signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">       </span> |
|<span class="r8">  546 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  547 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        now_virtual: </span><span class="r19">float</span><span class="r14">,</span><span class="r12">                                                              </span> |
|<span class="r8">  548 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        now_wallclock: </span><span class="r19">float</span><span class="r14">,</span><span class="r12">                                                            </span> |
|<span class="r8">  549 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gpu_load: </span><span class="r19">float</span><span class="r14">,</span><span class="r12">                                                                 </span> |
|<span class="r8">  550 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gpu_mem_used: </span><span class="r19">float</span><span class="r14">,</span><span class="r12">                                                             </span> |
|<span class="r8">  551 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        prev_virtual: </span><span class="r19">float</span><span class="r14">,</span><span class="r12">                                                             </span> |
|<span class="r8">  552 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        prev_wallclock: </span><span class="r19">float</span><span class="r14">,</span><span class="r12">                                                           </span> |
|<span class="r8">  553 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  554 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Handle interrupts for CPU profiling.&quot;&quot;&quot;</span><span class="r12">                                       </span> |
|<span class="r8">  555 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># We have recorded how long it has been since we received a timer</span><span class="r12">                </span> |
|<span class="r8">  556 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># before.  See the logic below.</span><span class="r12">                                                  </span> |
|<span class="r8">  557 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># If it&#x27;s time to print some profiling info, do so.</span><span class="r12">                              </span> |
|<span class="r8">  558 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> now_wallclock </span><span class="r16">&gt;=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__next_output_time:</span><span class="r12">                                  </span> |
|<span class="r8">  559 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Print out the profile. Set the next output time, stop</span><span class="r12">                      </span> |
|<span class="r8">  560 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># signals, print the profile, and then start signals</span><span class="r12">                         </span> |
|<span class="r8">  561 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># again.</span><span class="r12">                                                                     </span> |
|<span class="r8">  562 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__next_output_time </span><span class="r16">+=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">profile_interval</span><span class="r12">                </span> |
|<span class="r8">  563 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            stats </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r12">                                                      </span> |
|<span class="r8">  564 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># pause queues to prevent updates while we output</span><span class="r12">                            </span> |
|<span class="r8">  565 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">with</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__cpu_sigq</span><span class="r16">.</span><span class="r14">lock, Scalene</span><span class="r16">.</span><span class="r14">__alloc_sigq</span><span class="r16">.</span><span class="r14">lock, Scalene</span><span class="r16">.</span><span class="r14">__memcpy_sig</span> |
|<span class="r8">  566 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">stop_clock()</span><span class="r12">                                                       </span> |
|<span class="r8">  567 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                output </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__output</span><span class="r12">                                                </span> |
|<span class="r8">  568 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                output</span><span class="r16">.</span><span class="r14">output_profiles(</span><span class="r12">                                                  </span> |
|<span class="r8">  569 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    stats,</span><span class="r12">                                                               </span> |
|<span class="r8">  570 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__pid,</span><span class="r12">                                                       </span> |
|<span class="r8">  571 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">profile_this_code,</span><span class="r12">                                           </span> |
|<span class="r8">  572 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir,</span><span class="r12">                                          </span> |
|<span class="r8">  573 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    profile_memory</span><span class="r16">=</span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_only,</span><span class="r12">                          </span> |
|<span class="r8">  574 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    reduced_profile</span><span class="r16">=</span><span class="r14">Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">reduced_profile,</span><span class="r12">                      </span> |
|<span class="r8">  575 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                )</span><span class="r12">                                                                        </span> |
|<span class="r8">  576 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">start_clock()</span><span class="r12">                                                      </span> |
|<span class="r8">  577 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r12">                                                                             </span> |
|<span class="r8">  578 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Here we take advantage of an ostensible limitation of Python:</span><span class="r12">                  </span> |
|<span class="r8">  579 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># it only delivers signals after the interpreter has given up</span><span class="r12">                    </span> |
|<span class="r8">  580 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># control. This seems to mean that sampling is limited to code</span><span class="r12">                   </span> |
|<span class="r8">  581 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># running purely in the interpreter, and in fact, that was a limitation</span><span class="r12">          </span> |
|<span class="r8">  582 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># of the first version of Scalene, meaning that native code was entirely ignored.</span> |
|<span class="r8">  583 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21">#</span><span class="r12">                                                                                </span> |
|<span class="r8">  584 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># (cf. https://docs.python.org/3.9/library/signal.html#execution-of-python-signal</span> |
|<span class="r8">  585 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21">#</span><span class="r12">                                                                                </span> |
|<span class="r8">  586 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># However: lemons -&gt; lemonade: this &quot;problem&quot; is in fact</span><span class="r12">                         </span> |
|<span class="r8">  587 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># an effective way to separate out time spent in</span><span class="r12">                                 </span> |
|<span class="r8">  588 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Python vs. time spent in native code &quot;for free&quot;!  If we get</span><span class="r12">                    </span> |
|<span class="r8">  589 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># the signal immediately, we must be running in the</span><span class="r12">                              </span> |
|<span class="r8">  590 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># interpreter. On the other hand, if it was delayed, that means</span><span class="r12">                  </span> |
|<span class="r8">  591 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># we are running code OUTSIDE the interpreter, e.g.,</span><span class="r12">                             </span> |
|<span class="r8">  592 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># native code (be it inside of Python or in a library). We</span><span class="r12">                       </span> |
|<span class="r8">  593 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># account for this time by tracking the elapsed (process) time</span><span class="r12">                   </span> |
|<span class="r8">  594 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># and compare it to the interval, and add any computed delay</span><span class="r12">                     </span> |
|<span class="r8">  595 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># (as if it were sampled) to the C counter.</span><span class="r12">                                      </span> |
|<span class="r8">  596 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        elapsed_virtual </span><span class="r16">=</span><span class="r14"> now_virtual </span><span class="r16">-</span><span class="r14"> prev_virtual</span><span class="r12">                                     </span> |
|<span class="r8">  597 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        elapsed_wallclock </span><span class="r16">=</span><span class="r14"> now_wallclock </span><span class="r16">-</span><span class="r14"> prev_wallclock</span><span class="r12">                               </span> |
|<span class="r8">  598 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># CPU utilization is the fraction of time spent on the CPU</span><span class="r12">                       </span> |
|<span class="r8">  599 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># over the total wallclock time.</span><span class="r12">                                                 </span> |
|<span class="r8">  600 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8">  601 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cpu_utilization </span><span class="r16">=</span><span class="r14"> elapsed_virtual </span><span class="r16">/</span><span class="r14"> elapsed_wallclock</span><span class="r12">                        </span> |
|<span class="r8">  602 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">ZeroDivisionError</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8">  603 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cpu_utilization </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                                                        </span> |
|<span class="r8">  604 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> cpu_utilization </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">1.0</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8">  605 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Sometimes, for some reason, virtual time exceeds</span><span class="r12">                           </span> |
|<span class="r8">  606 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># wallclock time, which makes no sense...</span><span class="r12">                                    </span> |
|<span class="r8">  607 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cpu_utilization </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1.0</span><span class="r12">                                                        </span> |
|<span class="r8">  608 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> cpu_utilization </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">0.0</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8">  609 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cpu_utilization </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                                                        </span> |
|<span class="r8">  610 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Deal with an odd case reported here: https://github.com/plasma-umass/scalene/is</span> |
|<span class="r8">  611 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># (Note: probably obsolete now that Scalene is using the nvidia wrappers, but jus</span> |
|<span class="r8">  612 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># We don&#x27;t want to report &#x27;nan&#x27;, so turn the load into 0.</span><span class="r12">                        </span> |
|<span class="r8">  613 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> math</span><span class="r16">.</span><span class="r14">isnan(gpu_load):</span><span class="r12">                                                         </span> |
|<span class="r8">  614 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            gpu_load </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                                                               </span> |
|<span class="r8">  615 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gpu_time </span><span class="r16">=</span><span class="r14"> gpu_load </span><span class="r16">*</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__last_cpu_sampling_rate</span><span class="r12">                           </span> |
|<span class="r8">  616 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">total_gpu_samples </span><span class="r16">+=</span><span class="r14"> gpu_time</span><span class="r12">                                    </span> |
|<span class="r8">  617 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        python_time </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__last_cpu_sampling_rate</span><span class="r12">                                   </span> |
|<span class="r8">  618 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        c_time </span><span class="r16">=</span><span class="r14"> elapsed_virtual </span><span class="r16">-</span><span class="r14"> python_time</span><span class="r12">                                           </span> |
|<span class="r8">  619 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> c_time </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8">  620 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            c_time </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                   </span> |
|<span class="r8">  621 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  622 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Update counters for every running thread.</span><span class="r12">                                      </span> |
|<span class="r8">  623 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        new_frames </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">compute_frames_to_record(this_frame)</span><span class="r12">                        </span> |
|<span class="r8">  624 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Now update counters (weighted) for every frame we are tracking.</span><span class="r12">                </span> |
|<span class="r8">  625 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        total_time </span><span class="r16">=</span><span class="r14"> python_time </span><span class="r16">+</span><span class="r14"> c_time</span><span class="r12">                                                </span> |
|<span class="r8">  626 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  627 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># First, find out how many frames are not sleeping.  We need</span><span class="r12">                     </span> |
|<span class="r8">  628 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># to know this number so we can parcel out time appropriately</span><span class="r12">                    </span> |
|<span class="r8">  629 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># (equally to each running thread).</span><span class="r12">                                              </span> |
|<span class="r8">  630 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        total_frames </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                 </span> |
|<span class="r8">  631 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> (frame, tident, orig_frame) </span><span class="r22">in</span><span class="r14"> new_frames:</span><span class="r12">                                   </span> |
|<span class="r8">  632 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__is_thread_sleeping[tident]:</span><span class="r12">                                 </span> |
|<span class="r8">  633 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                total_frames </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                        </span> |
|<span class="r8">  634 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> total_frames </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                            </span> |
|<span class="r8">  635 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8">  636 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        normalized_time </span><span class="r16">=</span><span class="r14"> total_time </span><span class="r16">/</span><span class="r14"> total_frames</span><span class="r12">                                      </span> |
|<span class="r8">  637 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  638 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Now attribute execution time.</span><span class="r12">                                                  </span> |
|<span class="r8">  639 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> (frame, tident, orig_frame) </span><span class="r22">in</span><span class="r14"> new_frames:</span><span class="r12">                                   </span> |
|<span class="r8">  640 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            fname </span><span class="r16">=</span><span class="r14"> Filename(frame</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename)</span><span class="r12">                                   </span> |
|<span class="r8">  641 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            lineno </span><span class="r16">=</span><span class="r14"> LineNumber(frame</span><span class="r16">.</span><span class="r14">f_lineno)</span><span class="r12">                                          </span> |
|<span class="r8">  642 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">enter_function_meta(frame, Scalene</span><span class="r16">.</span><span class="r14">__stats)</span><span class="r12">                          </span> |
|<span class="r8">  643 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> frame </span><span class="r16">==</span><span class="r14"> new_frames[</span><span class="r16">0</span><span class="r14">][</span><span class="r16">0</span><span class="r14">]:</span><span class="r12">                                                </span> |
|<span class="r8">  644 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Main thread.</span><span class="r12">                                                           </span> |
|<span class="r8">  645 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__is_thread_sleeping[tident]:</span><span class="r12">                             </span> |
|<span class="r8">  646 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  647 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_samples_python[fname][lineno] </span><span class="r16">+=</span><span class="r14"> (</span><span class="r12">               </span> |
|<span class="r8">  648 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        python_time </span><span class="r16">/</span><span class="r14"> total_frames</span><span class="r12">                                       </span> |
|<span class="r8">  649 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    )</span><span class="r12">                                                                    </span> |
|<span class="r8">  650 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_samples_c[fname][lineno] </span><span class="r16">+=</span><span class="r14"> (</span><span class="r12">                    </span> |
|<span class="r8">  651 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        c_time </span><span class="r16">/</span><span class="r14"> total_frames</span><span class="r12">                                            </span> |
|<span class="r8">  652 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    )</span><span class="r12">                                                                    </span> |
|<span class="r8">  653 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_samples[fname] </span><span class="r16">+=</span><span class="r14"> (</span><span class="r12">                              </span> |
|<span class="r8">  654 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        python_time </span><span class="r16">+</span><span class="r14"> c_time</span><span class="r12">                                             </span> |
|<span class="r8">  655 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    ) </span><span class="r16">/</span><span class="r14"> total_frames</span><span class="r12">                                                     </span> |
|<span class="r8">  656 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_utilization[fname][lineno]</span><span class="r16">.</span><span class="r14">push(cpu_utilization)</span><span class="r12"> </span> |
|<span class="r8">  657 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">gpu_samples[fname][lineno] </span><span class="r16">+=</span><span class="r14"> (</span><span class="r12">                      </span> |
|<span class="r8">  658 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        gpu_time </span><span class="r16">/</span><span class="r14"> total_frames</span><span class="r12">                                          </span> |
|<span class="r8">  659 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    )</span><span class="r12">                                                                    </span> |
|<span class="r8">  660 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  661 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  662 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># We can&#x27;t play the same game here of attributing</span><span class="r12">                        </span> |
|<span class="r8">  663 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># time, because we are in a thread, and threads don&#x27;t</span><span class="r12">                    </span> |
|<span class="r8">  664 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># get signals in Python. Instead, we check if the</span><span class="r12">                        </span> |
|<span class="r8">  665 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># bytecode instruction being executed is a function</span><span class="r12">                      </span> |
|<span class="r8">  666 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># call.  If so, we attribute all the time to native.</span><span class="r12">                     </span> |
|<span class="r8">  667 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># NOTE: for now, we don&#x27;t try to attribute GPU time to threads.</span><span class="r12">          </span> |
|<span class="r8">  668 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__is_thread_sleeping[tident]:</span><span class="r12">                             </span> |
|<span class="r8">  669 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Check if the original caller is stuck inside a call.</span><span class="r12">               </span> |
|<span class="r8">  670 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">is_call_function(</span><span class="r12">                                         </span> |
|<span class="r8">  671 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        orig_frame</span><span class="r16">.</span><span class="r14">f_code,</span><span class="r12">                                               </span> |
|<span class="r8">  672 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        ByteCodeIndex(orig_frame</span><span class="r16">.</span><span class="r14">f_lasti),</span><span class="r12">                               </span> |
|<span class="r8">  673 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    ):</span><span class="r12">                                                                   </span> |
|<span class="r8">  674 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r21"># It is. Attribute time to native.</span><span class="r12">                               </span> |
|<span class="r8">  675 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_samples_c[fname][lineno] </span><span class="r16">+=</span><span class="r14"> normalized_time</span><span class="r12">  </span> |
|<span class="r8">  676 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                </span> |
|<span class="r8">  677 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r21"># Not in a call function so we attribute the time to Python.</span><span class="r12">     </span> |
|<span class="r8">  678 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_samples_python[fname][</span><span class="r12">                       </span> |
|<span class="r8">  679 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            lineno</span><span class="r12">                                                       </span> |
|<span class="r8">  680 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        ] </span><span class="r16">+=</span><span class="r14"> normalized_time</span><span class="r12">                                             </span> |
|<span class="r8">  681 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_samples[fname] </span><span class="r16">+=</span><span class="r14"> normalized_time</span><span class="r12">                </span> |
|<span class="r8">  682 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">cpu_utilization[fname][lineno]</span><span class="r16">.</span><span class="r14">push(cpu_utilization)</span><span class="r12"> </span> |
|<span class="r8">  683 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  684 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">del</span><span class="r14"> new_frames</span><span class="r12">                                                                   </span> |
|<span class="r8">  685 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  686 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">total_cpu_samples </span><span class="r16">+=</span><span class="r14"> total_time</span><span class="r12">                                  </span> |
|<span class="r8">  687 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r13">False</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  688 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Pick a new random interval, distributed around the mean.</span><span class="r12">                   </span> |
|<span class="r8">  689 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            next_interval </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                                                          </span> |
|<span class="r8">  690 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">while</span><span class="r14"> next_interval </span><span class="r16">&lt;=</span><span class="r14"> </span><span class="r16">0.0</span><span class="r14">:</span><span class="r12">                                                  </span> |
|<span class="r8">  691 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Choose a normally distributed random number around the</span><span class="r12">                 </span> |
|<span class="r8">  692 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># mean for the next interval. By setting the standard</span><span class="r12">                    </span> |
|<span class="r8">  693 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># deviation to a fraction of the mean, we know by</span><span class="r12">                        </span> |
|<span class="r8">  694 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># properties of the normal distribution that the</span><span class="r12">                         </span> |
|<span class="r8">  695 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># likelihood of iterating this loop more than once is</span><span class="r12">                    </span> |
|<span class="r8">  696 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># low. For a fraction 1/f, the probability is</span><span class="r12">                            </span> |
|<span class="r8">  697 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># p = 1-(math.erf(f/math.sqrt(2)))/2</span><span class="r12">                                     </span> |
|<span class="r8">  698 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                next_interval </span><span class="r16">=</span><span class="r14"> random</span><span class="r16">.</span><span class="r14">normalvariate(</span><span class="r12">                                    </span> |
|<span class="r8">  699 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_sampling_rate,</span><span class="r12">                                    </span> |
|<span class="r8">  700 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_sampling_rate </span><span class="r16">/</span><span class="r14"> </span><span class="r16">3.0</span><span class="r14">,</span><span class="r12">                              </span> |
|<span class="r8">  701 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                )</span><span class="r12">                                                                        </span> |
|<span class="r8">  702 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  703 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            next_interval </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_sampling_rate</span><span class="r12">                             </span> |
|<span class="r8">  704 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__last_cpu_sampling_rate </span><span class="r16">=</span><span class="r14"> next_interval</span><span class="r12">                                 </span> |
|<span class="r8">  705 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  706 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Returns final frame (up to a line in a file we are profiling), the thread identifie</span> |
|<span class="r8">  707 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  708 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">compute_frames_to_record</span><span class="r14">(</span><span class="r12">                                                        </span> |
|<span class="r8">  709 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  710 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> List[Tuple[FrameType, </span><span class="r19">int</span><span class="r14">, FrameType]]:</span><span class="r12">                                         </span> |
|<span class="r8">  711 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Collects all stack frames that Scalene actually processes.&quot;&quot;&quot;</span><span class="r12">                 </span> |
|<span class="r8">  712 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        frames: List[Tuple[FrameType, </span><span class="r19">int</span><span class="r14">]] </span><span class="r16">=</span><span class="r14"> [</span><span class="r12">                                          </span> |
|<span class="r8">  713 </span>|<span class="r9">   11% </span>|<span class="r9">       </span>|<span class="r9">   9%  </span>|<span class="r10">       </span>|<span class="r14">            (</span><span class="r12">                                                                            </span> |
|<span class="r8">  714 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                cast(</span><span class="r12">                                                                    </span> |
|<span class="r8">  715 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  716 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    sys</span><span class="r16">.</span><span class="r14">_current_frames()</span><span class="r16">.</span><span class="r14">get(cast(</span><span class="r19">int</span><span class="r14">, t</span><span class="r16">.</span><span class="r14">ident), </span><span class="r13">None</span><span class="r14">),</span><span class="r12">                 </span> |
|<span class="r8">  717 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ),</span><span class="r12">                                                                       </span> |
|<span class="r8">  718 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                cast(</span><span class="r19">int</span><span class="r14">, t</span><span class="r16">.</span><span class="r14">ident),</span><span class="r12">                                                      </span> |
|<span class="r8">  719 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  720 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> t </span><span class="r22">in</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">enumerate()</span><span class="r12">                                               </span> |
|<span class="r8">  721 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> t </span><span class="r16">!=</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">main_thread()</span><span class="r12">                                              </span> |
|<span class="r8">  722 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ]</span><span class="r12">                                                                                </span> |
|<span class="r8">  723 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Put the main thread in the front.</span><span class="r12">                                              </span> |
|<span class="r8">  724 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        frames</span><span class="r16">.</span><span class="r14">insert(</span><span class="r12">                                                                   </span> |
|<span class="r8">  725 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r16">0</span><span class="r14">,</span><span class="r12">                                                                           </span> |
|<span class="r8">  726 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            (</span><span class="r12">                                                                            </span> |
|<span class="r8">  727 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                sys</span><span class="r16">.</span><span class="r14">_current_frames()</span><span class="r16">.</span><span class="r14">get(</span><span class="r12">                                               </span> |
|<span class="r8">  728 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    cast(</span><span class="r19">int</span><span class="r14">, threading</span><span class="r16">.</span><span class="r14">main_thread()</span><span class="r16">.</span><span class="r14">ident), </span><span class="r13">None</span><span class="r12">                       </span> |
|<span class="r8">  729 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ),</span><span class="r12">                                                                       </span> |
|<span class="r8">  730 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                cast(</span><span class="r19">int</span><span class="r14">, threading</span><span class="r16">.</span><span class="r14">main_thread()</span><span class="r16">.</span><span class="r14">ident),</span><span class="r12">                                </span> |
|<span class="r8">  731 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ),</span><span class="r12">                                                                           </span> |
|<span class="r8">  732 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  733 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Process all the frames to remove ones we aren&#x27;t going to track.</span><span class="r12">                </span> |
|<span class="r8">  734 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        new_frames: List[Tuple[FrameType, </span><span class="r19">int</span><span class="r14">, FrameType]] </span><span class="r16">=</span><span class="r14"> []</span><span class="r12">                          </span> |
|<span class="r8">  735 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> (frame, tident) </span><span class="r22">in</span><span class="r14"> frames:</span><span class="r12">                                                   </span> |
|<span class="r8">  736 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            orig_frame </span><span class="r16">=</span><span class="r14"> frame</span><span class="r12">                                                           </span> |
|<span class="r8">  737 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> frame:</span><span class="r12">                                                                </span> |
|<span class="r8">  738 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">continue</span><span class="r12">                                                                 </span> |
|<span class="r8">  739 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            fname </span><span class="r16">=</span><span class="r14"> frame</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename</span><span class="r12">                                             </span> |
|<span class="r8">  740 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Record samples only for files we care about.</span><span class="r12">                               </span> |
|<span class="r8">  741 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> fname:</span><span class="r12">                                                                </span> |
|<span class="r8">  742 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># &#x27;eval/compile&#x27; gives no f_code.co_filename.  We have</span><span class="r12">                   </span> |
|<span class="r8">  743 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># to look back into the outer frame in order to check</span><span class="r12">                    </span> |
|<span class="r8">  744 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># the co_filename.</span><span class="r12">                                                       </span> |
|<span class="r8">  745 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                back </span><span class="r16">=</span><span class="r14"> cast(FrameType, frame</span><span class="r16">.</span><span class="r14">f_back)</span><span class="r12">                                     </span> |
|<span class="r8">  746 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                fname </span><span class="r16">=</span><span class="r14"> Filename(back</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename)</span><span class="r12">                                </span> |
|<span class="r8">  747 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">while</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">should_trace(fname):</span><span class="r12">                                       </span> |
|<span class="r8">  748 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Walk the stack backwards until we hit a frame that</span><span class="r12">                     </span> |
|<span class="r8">  749 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># IS one we should trace (if there is one).  i.e., if</span><span class="r12">                    </span> |
|<span class="r8">  750 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># it&#x27;s in the code being profiled, and it is just</span><span class="r12">                        </span> |
|<span class="r8">  751 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># calling stuff deep in libraries.</span><span class="r12">                                       </span> |
|<span class="r8">  752 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> frame:</span><span class="r12">                                                                </span> |
|<span class="r8">  753 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    frame </span><span class="r16">=</span><span class="r14"> cast(FrameType, frame</span><span class="r16">.</span><span class="r14">f_back)</span><span class="r12">                                </span> |
|<span class="r8">  754 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">if</span><span class="r14"> frame:</span><span class="r12">                                                            </span> |
|<span class="r8">  755 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        fname </span><span class="r16">=</span><span class="r14"> frame</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename</span><span class="r12">                                 </span> |
|<span class="r8">  756 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r13">continue</span><span class="r12">                                                         </span> |
|<span class="r8">  757 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                    </span> |
|<span class="r8">  758 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">break</span><span class="r12">                                                                </span> |
|<span class="r8">  759 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> frame:</span><span class="r12">                                                                    </span> |
|<span class="r8">  760 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                new_frames</span><span class="r16">.</span><span class="r14">append((frame, tident, orig_frame))</span><span class="r12">                           </span> |
|<span class="r8">  761 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> new_frames</span><span class="r12">                                                                </span> |
|<span class="r8">  762 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  763 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  764 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">enter_function_meta</span><span class="r14">(frame: FrameType, stats: ScaleneStatistics) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">         </span> |
|<span class="r8">  765 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        fname </span><span class="r16">=</span><span class="r14"> Filename(frame</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename)</span><span class="r12">                                       </span> |
|<span class="r8">  766 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        lineno </span><span class="r16">=</span><span class="r14"> LineNumber(frame</span><span class="r16">.</span><span class="r14">f_lineno)</span><span class="r12">                                              </span> |
|<span class="r8">  767 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        f </span><span class="r16">=</span><span class="r14"> frame</span><span class="r12">                                                                        </span> |
|<span class="r8">  768 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8">  769 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">while</span><span class="r14"> </span><span class="r17">&quot;&lt;&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> Filename(f</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_name):</span><span class="r12">                                     </span> |
|<span class="r8">  770 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                f </span><span class="r16">=</span><span class="r14"> cast(FrameType, frame</span><span class="r16">.</span><span class="r14">f_back)</span><span class="r12">                                        </span> |
|<span class="r8">  771 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> (</span><span class="r12">                                                                     </span> |
|<span class="r8">  772 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r17">&quot;&lt;genexpr&gt;&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_name</span><span class="r12">                                      </span> |
|<span class="r8">  773 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r22">or</span><span class="r14"> </span><span class="r17">&quot;&lt;module&gt;&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_name</span><span class="r12">                                    </span> |
|<span class="r8">  774 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r22">or</span><span class="r14"> </span><span class="r17">&quot;&lt;listcomp&gt;&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_name</span><span class="r12">                                  </span> |
|<span class="r8">  775 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ):</span><span class="r12">                                                                       </span> |
|<span class="r8">  776 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">return</span><span class="r12">                                                               </span> |
|<span class="r8">  777 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14">:</span><span class="r12">                                                                          </span> |
|<span class="r8">  778 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8">  779 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">should_trace(f</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename):</span><span class="r12">                               </span> |
|<span class="r8">  780 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8">  781 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  782 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        fn_name </span><span class="r16">=</span><span class="r14"> Filename(f</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_name)</span><span class="r12">                                             </span> |
|<span class="r8">  783 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        firstline </span><span class="r16">=</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_firstlineno</span><span class="r12">                                              </span> |
|<span class="r8">  784 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Prepend the class, if any</span><span class="r12">                                                      </span> |
|<span class="r8">  785 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">while</span><span class="r14"> (</span><span class="r12">                                                                          </span> |
|<span class="r8">  786 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            f</span><span class="r12">                                                                            </span> |
|<span class="r8">  787 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r22">and</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_back</span><span class="r12">                                                                 </span> |
|<span class="r8">  788 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r22">and</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_back</span><span class="r16">.</span><span class="r14">f_code</span><span class="r12">                                                          </span> |
|<span class="r8">  789 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># NOTE: next line disabled as it is interfering with name resolution for thre</span> |
|<span class="r8">  790 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># and Scalene.should_trace(f.f_back.f_code.co_filename)</span><span class="r12">                      </span> |
|<span class="r8">  791 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ):</span><span class="r12">                                                                               </span> |
|<span class="r8">  792 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r17">&quot;self&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_locals:</span><span class="r12">                                                     </span> |
|<span class="r8">  793 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                prepend_name </span><span class="r16">=</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_locals[</span><span class="r17">&quot;self&quot;</span><span class="r14">]</span><span class="r16">.</span><span class="r25">__class__</span><span class="r16">.</span><span class="r25">__name__</span><span class="r12">                     </span> |
|<span class="r8">  794 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> </span><span class="r17">&quot;Scalene&quot;</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> prepend_name:</span><span class="r12">                                        </span> |
|<span class="r8">  795 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    fn_name </span><span class="r16">=</span><span class="r14"> prepend_name </span><span class="r16">+</span><span class="r14"> </span><span class="r17">&quot;.&quot;</span><span class="r14"> </span><span class="r16">+</span><span class="r14"> fn_name</span><span class="r12">                               </span> |
|<span class="r8">  796 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">break</span><span class="r12">                                                                    </span> |
|<span class="r8">  797 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r17">&quot;cls&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_locals:</span><span class="r12">                                                      </span> |
|<span class="r8">  798 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                prepend_name </span><span class="r16">=</span><span class="r14"> </span><span class="r19">getattr</span><span class="r14">(f</span><span class="r16">.</span><span class="r14">f_locals[</span><span class="r17">&quot;cls&quot;</span><span class="r14">], </span><span class="r17">&quot;__name__&quot;</span><span class="r14">, </span><span class="r13">None</span><span class="r14">)</span><span class="r12">              </span> |
|<span class="r8">  799 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> prepend_name </span><span class="r22">or</span><span class="r14"> </span><span class="r17">&quot;Scalene&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> prepend_name:</span><span class="r12">                        </span> |
|<span class="r8">  800 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">break</span><span class="r12">                                                                </span> |
|<span class="r8">  801 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                fn_name </span><span class="r16">=</span><span class="r14"> prepend_name </span><span class="r16">+</span><span class="r14"> </span><span class="r17">&quot;.&quot;</span><span class="r14"> </span><span class="r16">+</span><span class="r14"> fn_name</span><span class="r12">                                   </span> |
|<span class="r8">  802 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">break</span><span class="r12">                                                                    </span> |
|<span class="r8">  803 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            f </span><span class="r16">=</span><span class="r14"> f</span><span class="r16">.</span><span class="r14">f_back</span><span class="r12">                                                                 </span> |
|<span class="r8">  804 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  805 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        stats</span><span class="r16">.</span><span class="r14">function_map[fname][lineno] </span><span class="r16">=</span><span class="r14"> fn_name</span><span class="r12">                                      </span> |
|<span class="r8">  806 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        stats</span><span class="r16">.</span><span class="r14">firstline_map[fn_name] </span><span class="r16">=</span><span class="r14"> LineNumber(firstline)</span><span class="r12">                             </span> |
|<span class="r8">  807 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  808 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  809 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">read_malloc_mmap</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r19">bool</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  810 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  811 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                 </span> |
|<span class="r8">  812 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> get_line_atomic</span><span class="r16">.</span><span class="r14">get_line_atomic(</span><span class="r12">                                          </span> |
|<span class="r8">  813 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__malloc_lock_mmap,</span><span class="r12">                                                  </span> |
|<span class="r8">  814 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__malloc_signal_mmap,</span><span class="r12">                                                </span> |
|<span class="r8">  815 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__malloc_buf,</span><span class="r12">                                                        </span> |
|<span class="r8">  816 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__malloc_lastpos,</span><span class="r12">                                                    </span> |
|<span class="r8">  817 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8">  818 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  819 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  820 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">alloc_sigqueue_processor</span><span class="r14">(</span><span class="r12">                                                        </span> |
|<span class="r8">  821 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8">  822 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8">  823 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  824 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Handle interrupts for memory profiling (mallocs and frees).&quot;&quot;&quot;</span><span class="r12">                </span> |
|<span class="r8">  825 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        stats </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r12">                                                          </span> |
|<span class="r8">  826 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        new_frames </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">compute_frames_to_record(this_frame)</span><span class="r12">                        </span> |
|<span class="r8">  827 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> new_frames:</span><span class="r12">                                                               </span> |
|<span class="r8">  828 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8">  829 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        curr_pid </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r12">                                                           </span> |
|<span class="r8">  830 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Process the input array from where we left off reading last time.</span><span class="r12">              </span> |
|<span class="r8">  831 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        arr: List[Tuple[</span><span class="r19">int</span><span class="r14">, </span><span class="r19">str</span><span class="r14">, </span><span class="r19">float</span><span class="r14">, </span><span class="r19">float</span><span class="r14">, </span><span class="r19">str</span><span class="r14">]] </span><span class="r16">=</span><span class="r14"> []</span><span class="r12">                               </span> |
|<span class="r8">  832 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8">  833 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">while</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">read_malloc_mmap():</span><span class="r12">                                            </span> |
|<span class="r8">  834 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                count_str </span><span class="r16">=</span><span class="r14"> (</span><span class="r12">                                                            </span> |
|<span class="r8">  835 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Scalene</span><span class="r16">.</span><span class="r14">__malloc_buf</span><span class="r16">.</span><span class="r14">rstrip(</span><span class="r17">b&quot;</span><span class="r26">\x00</span><span class="r17">&quot;</span><span class="r14">)</span><span class="r16">.</span><span class="r14">split(</span><span class="r17">b&quot;</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r14">)[</span><span class="r16">0</span><span class="r14">]</span><span class="r16">.</span><span class="r14">decode(</span><span class="r17">&quot;ascii&quot;</span><span class="r14">)</span><span class="r12"> </span> |
|<span class="r8">  836 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                )</span><span class="r12">                                                                        </span> |
|<span class="r8">  837 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> count_str</span><span class="r16">.</span><span class="r14">strip() </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;&quot;</span><span class="r14">:</span><span class="r12">                                              </span> |
|<span class="r8">  838 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">break</span><span class="r12">                                                                </span> |
|<span class="r8">  839 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                (</span><span class="r12">                                                                        </span> |
|<span class="r8">  840 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    action,</span><span class="r12">                                                              </span> |
|<span class="r8">  841 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    alloc_time_str,</span><span class="r12">                                                      </span> |
|<span class="r8">  842 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    count_str,</span><span class="r12">                                                           </span> |
|<span class="r8">  843 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    python_fraction_str,</span><span class="r12">                                                 </span> |
|<span class="r8">  844 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    pid,</span><span class="r12">                                                                 </span> |
|<span class="r8">  845 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    pointer,</span><span class="r12">                                                             </span> |
|<span class="r8">  846 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ) </span><span class="r16">=</span><span class="r14"> count_str</span><span class="r16">.</span><span class="r14">split(</span><span class="r17">&quot;,&quot;</span><span class="r14">)</span><span class="r12">                                                 </span> |
|<span class="r8">  847 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># assert action in [&quot;M&quot;, &quot;f&quot;, &quot;F&quot;]</span><span class="r12">                                       </span> |
|<span class="r8">  848 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(curr_pid) </span><span class="r16">==</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(pid):</span><span class="r12">                                            </span> |
|<span class="r8">  849 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    arr</span><span class="r16">.</span><span class="r14">append(</span><span class="r12">                                                          </span> |
|<span class="r8">  850 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        (</span><span class="r12">                                                                </span> |
|<span class="r8">  851 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            </span><span class="r19">int</span><span class="r14">(alloc_time_str),</span><span class="r12">                                         </span> |
|<span class="r8">  852 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            action,</span><span class="r12">                                                      </span> |
|<span class="r8">  853 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            </span><span class="r19">float</span><span class="r14">(count_str),</span><span class="r12">                                            </span> |
|<span class="r8">  854 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            </span><span class="r19">float</span><span class="r14">(python_fraction_str),</span><span class="r12">                                  </span> |
|<span class="r8">  855 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            pointer,</span><span class="r12">                                                     </span> |
|<span class="r8">  856 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        )</span><span class="r12">                                                                </span> |
|<span class="r8">  857 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    )</span><span class="r12">                                                                    </span> |
|<span class="r8">  858 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  859 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">FileNotFoundError</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8">  860 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8">  861 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  862 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        arr</span><span class="r16">.</span><span class="r14">sort()</span><span class="r12">                                                                       </span> |
|<span class="r8">  863 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Iterate through the array to compute the new current footprint.</span><span class="r12">                </span> |
|<span class="r8">  864 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># and update the global __memory_footprint_samples.</span><span class="r12">                              </span> |
|<span class="r8">  865 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        before </span><span class="r16">=</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">current_footprint</span><span class="r12">                                                 </span> |
|<span class="r8">  866 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        prevmax </span><span class="r16">=</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">max_footprint</span><span class="r12">                                                    </span> |
|<span class="r8">  867 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        freed_last_trigger </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                           </span> |
|<span class="r8">  868 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> item </span><span class="r22">in</span><span class="r14"> arr:</span><span class="r12">                                                                 </span> |
|<span class="r8">  869 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            _alloc_time, action, count, python_fraction, pointer </span><span class="r16">=</span><span class="r14"> item</span><span class="r12">                  </span> |
|<span class="r8">  870 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            count </span><span class="r16">/=</span><span class="r14"> </span><span class="r16">1024</span><span class="r14"> </span><span class="r16">*</span><span class="r14"> </span><span class="r16">1024</span><span class="r12">                                                         </span> |
|<span class="r8">  871 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            is_malloc </span><span class="r16">=</span><span class="r14"> action </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;M&quot;</span><span class="r12">                                                    </span> |
|<span class="r8">  872 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> is_malloc:</span><span class="r12">                                                                </span> |
|<span class="r8">  873 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">current_footprint </span><span class="r16">+=</span><span class="r14"> count</span><span class="r12">                                         </span> |
|<span class="r8">  874 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">current_footprint </span><span class="r16">&gt;</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">max_footprint:</span><span class="r12">                        </span> |
|<span class="r8">  875 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    stats</span><span class="r16">.</span><span class="r14">max_footprint </span><span class="r16">=</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">current_footprint</span><span class="r12">                        </span> |
|<span class="r8">  876 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  877 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">current_footprint </span><span class="r16">-=</span><span class="r14"> count</span><span class="r12">                                         </span> |
|<span class="r8">  878 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> action </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;f&quot;</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8">  879 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Check if pointer actually matches</span><span class="r12">                                  </span> |
|<span class="r8">  880 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">if</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">last_malloc_triggered[</span><span class="r16">2</span><span class="r14">] </span><span class="r16">==</span><span class="r14"> pointer:</span><span class="r12">                        </span> |
|<span class="r8">  881 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        freed_last_trigger </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                          </span> |
|<span class="r8">  882 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            stats</span><span class="r16">.</span><span class="r14">memory_footprint_samples</span><span class="r16">.</span><span class="r14">add(stats</span><span class="r16">.</span><span class="r14">current_footprint)</span><span class="r12">                  </span> |
|<span class="r8">  883 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        after </span><span class="r16">=</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">current_footprint</span><span class="r12">                                                  </span> |
|<span class="r8">  884 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  885 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> freed_last_trigger:</span><span class="r12">                                                           </span> |
|<span class="r8">  886 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> freed_last_trigger </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                   </span> |
|<span class="r8">  887 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Ignore the case where we have multiple last triggers in the sample file</span> |
|<span class="r8">  888 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># since this can lead to false positives.</span><span class="r12">                                </span> |
|<span class="r8">  889 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">pass</span><span class="r12">                                                                     </span> |
|<span class="r8">  890 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  891 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># We freed the last allocation trigger. Adjust scores.</span><span class="r12">                   </span> |
|<span class="r8">  892 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                this_fn, this_ln, this_ptr </span><span class="r16">=</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">last_malloc_triggered</span><span class="r12">                 </span> |
|<span class="r8">  893 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> this_ln </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                         </span> |
|<span class="r8">  894 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    mallocs, frees </span><span class="r16">=</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">leak_score[this_fn][this_ln]</span><span class="r12">                  </span> |
|<span class="r8">  895 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    stats</span><span class="r16">.</span><span class="r14">leak_score[this_fn][this_ln] </span><span class="r16">=</span><span class="r14"> (</span><span class="r12">                               </span> |
|<span class="r8">  896 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        mallocs,</span><span class="r12">                                                         </span> |
|<span class="r8">  897 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        frees </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r14">,</span><span class="r12">                                                       </span> |
|<span class="r8">  898 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    )</span><span class="r12">                                                                    </span> |
|<span class="r8">  899 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            stats</span><span class="r16">.</span><span class="r14">last_malloc_triggered </span><span class="r16">=</span><span class="r14"> (</span><span class="r12">                                              </span> |
|<span class="r8">  900 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Filename(</span><span class="r17">&quot;&quot;</span><span class="r14">),</span><span class="r12">                                                            </span> |
|<span class="r8">  901 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                LineNumber(</span><span class="r16">0</span><span class="r14">),</span><span class="r12">                                                           </span> |
|<span class="r8">  902 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Address(</span><span class="r17">&quot;0x0&quot;</span><span class="r14">),</span><span class="r12">                                                          </span> |
|<span class="r8">  903 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  904 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  905 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Now update the memory footprint for every running frame.</span><span class="r12">                       </span> |
|<span class="r8">  906 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># This is a pain, since we don&#x27;t know to whom to attribute memory,</span><span class="r12">               </span> |
|<span class="r8">  907 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># so we may overcount.</span><span class="r12">                                                           </span> |
|<span class="r8">  908 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  909 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> (frame, _tident, _orig_frame) </span><span class="r22">in</span><span class="r14"> new_frames:</span><span class="r12">                                 </span> |
|<span class="r8">  910 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            fname </span><span class="r16">=</span><span class="r14"> Filename(frame</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename)</span><span class="r12">                                   </span> |
|<span class="r8">  911 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            lineno </span><span class="r16">=</span><span class="r14"> LineNumber(frame</span><span class="r16">.</span><span class="r14">f_lineno)</span><span class="r12">                                          </span> |
|<span class="r8">  912 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  913 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Walk the stack backwards until we find a proper function</span><span class="r12">                   </span> |
|<span class="r8">  914 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># name (as in, one that doesn&#x27;t contain &quot;&lt;&quot;, which</span><span class="r12">                           </span> |
|<span class="r8">  915 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># indicates things like list comprehensions).</span><span class="r12">                                </span> |
|<span class="r8">  916 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">enter_function_meta(frame, stats)</span><span class="r12">                                    </span> |
|<span class="r8">  917 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            bytei </span><span class="r16">=</span><span class="r14"> ByteCodeIndex(frame</span><span class="r16">.</span><span class="r14">f_lasti)</span><span class="r12">                                         </span> |
|<span class="r8">  918 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Add the byte index to the set for this line (if it&#x27;s not there already).</span><span class="r12">   </span> |
|<span class="r8">  919 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            stats</span><span class="r16">.</span><span class="r14">bytei_map[fname][lineno]</span><span class="r16">.</span><span class="r14">add(bytei)</span><span class="r12">                                    </span> |
|<span class="r8">  920 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            curr </span><span class="r16">=</span><span class="r14"> before</span><span class="r12">                                                                </span> |
|<span class="r8">  921 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            python_frac </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                                                            </span> |
|<span class="r8">  922 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            allocs </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0.0</span><span class="r12">                                                                 </span> |
|<span class="r8">  923 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            last_malloc </span><span class="r16">=</span><span class="r14"> (Filename(</span><span class="r17">&quot;&quot;</span><span class="r14">), LineNumber(</span><span class="r16">0</span><span class="r14">), Address(</span><span class="r17">&quot;0x0&quot;</span><span class="r14">))</span><span class="r12">                  </span> |
|<span class="r8">  924 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            malloc_pointer </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;0x0&quot;</span><span class="r12">                                                       </span> |
|<span class="r8">  925 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Go through the array again and add each updated current footprint.</span><span class="r12">         </span> |
|<span class="r8">  926 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> item </span><span class="r22">in</span><span class="r14"> arr:</span><span class="r12">                                                             </span> |
|<span class="r8">  927 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                _alloc_time, action, count, python_fraction, pointer </span><span class="r16">=</span><span class="r14"> item</span><span class="r12">              </span> |
|<span class="r8">  928 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                count </span><span class="r16">/=</span><span class="r14"> </span><span class="r16">1024</span><span class="r14"> </span><span class="r16">*</span><span class="r14"> </span><span class="r16">1024</span><span class="r12">                                                     </span> |
|<span class="r8">  929 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                is_malloc </span><span class="r16">=</span><span class="r14"> action </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;M&quot;</span><span class="r12">                                                </span> |
|<span class="r8">  930 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> is_malloc:</span><span class="r12">                                                            </span> |
|<span class="r8">  931 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    allocs </span><span class="r16">+=</span><span class="r14"> count</span><span class="r12">                                                      </span> |
|<span class="r8">  932 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    curr </span><span class="r16">+=</span><span class="r14"> count</span><span class="r12">                                                        </span> |
|<span class="r8">  933 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    python_frac </span><span class="r16">+=</span><span class="r14"> python_fraction </span><span class="r16">*</span><span class="r14"> count</span><span class="r12">                               </span> |
|<span class="r8">  934 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    malloc_pointer </span><span class="r16">=</span><span class="r14"> pointer</span><span class="r12">                                             </span> |
|<span class="r8">  935 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                    </span> |
|<span class="r8">  936 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    curr </span><span class="r16">-=</span><span class="r14"> count</span><span class="r12">                                                        </span> |
|<span class="r8">  937 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">per_line_footprint_samples[fname][lineno]</span><span class="r16">.</span><span class="r14">add(curr)</span><span class="r12">                </span> |
|<span class="r8">  938 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">assert</span><span class="r14"> curr </span><span class="r16">==</span><span class="r14"> after</span><span class="r12">                                                         </span> |
|<span class="r8">  939 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># If we allocated anything, then mark this as the last triggering malloc</span><span class="r12">     </span> |
|<span class="r8">  940 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> allocs </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                               </span> |
|<span class="r8">  941 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                last_malloc </span><span class="r16">=</span><span class="r14"> (</span><span class="r12">                                                          </span> |
|<span class="r8">  942 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Filename(fname),</span><span class="r12">                                                     </span> |
|<span class="r8">  943 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    LineNumber(lineno),</span><span class="r12">                                                  </span> |
|<span class="r8">  944 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    Address(malloc_pointer),</span><span class="r12">                                             </span> |
|<span class="r8">  945 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                )</span><span class="r12">                                                                        </span> |
|<span class="r8">  946 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># If there was a net increase in memory, treat it as if it</span><span class="r12">                   </span> |
|<span class="r8">  947 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># was a malloc; otherwise, treat it as if it was a</span><span class="r12">                           </span> |
|<span class="r8">  948 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># free. This is for later reporting of net memory gain /</span><span class="r12">                     </span> |
|<span class="r8">  949 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># loss per line of code.</span><span class="r12">                                                     </span> |
|<span class="r8">  950 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> after </span><span class="r16">&gt;</span><span class="r14"> before:</span><span class="r12">                                                           </span> |
|<span class="r8">  951 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">memory_malloc_samples[fname][lineno][bytei] </span><span class="r16">+=</span><span class="r14"> after </span><span class="r16">-</span><span class="r14"> before</span><span class="r12">      </span> |
|<span class="r8">  952 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">memory_python_samples[fname][lineno][bytei] </span><span class="r16">+=</span><span class="r14"> (</span><span class="r12">                   </span> |
|<span class="r8">  953 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    python_frac </span><span class="r16">/</span><span class="r14"> allocs</span><span class="r12">                                                 </span> |
|<span class="r8">  954 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ) </span><span class="r16">*</span><span class="r14"> (after </span><span class="r16">-</span><span class="r14"> before)</span><span class="r12">                                                     </span> |
|<span class="r8">  955 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">malloc_samples[fname] </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                         </span> |
|<span class="r8">  956 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">memory_malloc_count[fname][lineno][bytei] </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                     </span> |
|<span class="r8">  957 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">total_memory_malloc_samples </span><span class="r16">+=</span><span class="r14"> after </span><span class="r16">-</span><span class="r14"> before</span><span class="r12">                      </span> |
|<span class="r8">  958 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  959 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">memory_free_samples[fname][lineno][bytei] </span><span class="r16">+=</span><span class="r14"> before </span><span class="r16">-</span><span class="r14"> after</span><span class="r12">        </span> |
|<span class="r8">  960 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">memory_free_count[fname][lineno][bytei] </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                       </span> |
|<span class="r8">  961 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">total_memory_free_samples </span><span class="r16">+=</span><span class="r14"> before </span><span class="r16">-</span><span class="r14"> after</span><span class="r12">                        </span> |
|<span class="r8">  962 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            stats</span><span class="r16">.</span><span class="r14">allocation_velocity </span><span class="r16">=</span><span class="r14"> (</span><span class="r12">                                                </span> |
|<span class="r8">  963 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">allocation_velocity[</span><span class="r16">0</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> (after </span><span class="r16">-</span><span class="r14"> before),</span><span class="r12">                         </span> |
|<span class="r8">  964 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">allocation_velocity[</span><span class="r16">1</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> allocs,</span><span class="r12">                                   </span> |
|<span class="r8">  965 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  966 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Update leak score if we just increased the max footprint (starting at a fix</span> |
|<span class="r8">  967 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> prevmax </span><span class="r16">&lt;</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">max_footprint </span><span class="r22">and</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">max_footprint </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">100</span><span class="r14">:</span><span class="r12">              </span> |
|<span class="r8">  968 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">last_malloc_triggered </span><span class="r16">=</span><span class="r14"> last_malloc</span><span class="r12">                                </span> |
|<span class="r8">  969 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                mallocs, frees </span><span class="r16">=</span><span class="r14"> stats</span><span class="r16">.</span><span class="r14">leak_score[fname][lineno]</span><span class="r12">                         </span> |
|<span class="r8">  970 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">leak_score[fname][lineno] </span><span class="r16">=</span><span class="r14"> (mallocs </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r14">, frees)</span><span class="r12">                   </span> |
|<span class="r8">  971 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">del</span><span class="r14"> this_frame</span><span class="r12">                                                                   </span> |
|<span class="r8">  972 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  973 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __cpu_sigq </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                                    </span> |
|<span class="r8">  974 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __alloc_sigq </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                                  </span> |
|<span class="r8">  975 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    __memcpy_sigq </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                                 </span> |
|<span class="r8">  976 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  977 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  978 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">before_fork</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                           </span> |
|<span class="r8">  979 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Executed just before a fork.&quot;&quot;&quot;</span><span class="r12">                                               </span> |
|<span class="r8">  980 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">stop_signal_queues()</span><span class="r12">                                                     </span> |
|<span class="r8">  981 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  982 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  983 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">after_fork_in_parent</span><span class="r14">(childPid: </span><span class="r19">int</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                     </span> |
|<span class="r8">  984 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Executed by the parent process after a fork.&quot;&quot;&quot;</span><span class="r12">                               </span> |
|<span class="r8">  985 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">add_child_pid(childPid)</span><span class="r12">                                                  </span> |
|<span class="r8">  986 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">start_signal_queues()</span><span class="r12">                                                    </span> |
|<span class="r8">  987 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  988 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8">  989 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">after_fork_in_child</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                   </span> |
|<span class="r8">  990 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  991 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Executed by a child process after a fork and mutates the</span><span class="r12">                         </span> |
|<span class="r8">  992 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        current profiler into a child.</span><span class="r12">                                                   </span> |
|<span class="r8">  993 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  994 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__is_child </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                        </span> |
|<span class="r8">  995 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  996 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">clear_metrics()</span><span class="r12">                                                          </span> |
|<span class="r8">  997 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__gpu</span><span class="r16">.</span><span class="r14">has_gpu():</span><span class="r12">                                                      </span> |
|<span class="r8">  998 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__gpu</span><span class="r16">.</span><span class="r14">nvml_reinit()</span><span class="r12">                                                  </span> |
|<span class="r8">  999 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Note-- __parent_pid of the topmost process is its own pid</span><span class="r12">                      </span> |
|<span class="r8"> 1000 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__pid </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__parent_pid</span><span class="r12">                                             </span> |
|<span class="r8"> 1001 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r17">&quot;off&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args </span><span class="r22">or</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">off:</span><span class="r12">                        </span> |
|<span class="r8"> 1002 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">enable_signals()</span><span class="r12">                                                     </span> |
|<span class="r8"> 1003 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1004 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1005 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">read_memcpy_mmap</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r19">bool</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8"> 1006 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8"> 1007 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1008 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> get_line_atomic</span><span class="r16">.</span><span class="r14">get_line_atomic(</span><span class="r12">                                          </span> |
|<span class="r8"> 1009 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__memcpy_lock_mmap,</span><span class="r12">                                                  </span> |
|<span class="r8"> 1010 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__memcpy_signal_mmap,</span><span class="r12">                                                </span> |
|<span class="r8"> 1011 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__memcpy_buf,</span><span class="r12">                                                        </span> |
|<span class="r8"> 1012 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__memcpy_lastpos,</span><span class="r12">                                                    </span> |
|<span class="r8"> 1013 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1014 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1015 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1016 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">memcpy_sigqueue_processor</span><span class="r14">(</span><span class="r12">                                                       </span> |
|<span class="r8"> 1017 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8"> 1018 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        frame: FrameType,</span><span class="r12">                                                                </span> |
|<span class="r8"> 1019 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1020 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        curr_pid </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r12">                                                           </span> |
|<span class="r8"> 1021 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        new_frames </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">compute_frames_to_record(frame)</span><span class="r12">                             </span> |
|<span class="r8"> 1022 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> new_frames:</span><span class="r12">                                                               </span> |
|<span class="r8"> 1023 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1024 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        arr: List[Tuple[</span><span class="r19">int</span><span class="r14">, </span><span class="r19">int</span><span class="r14">]] </span><span class="r16">=</span><span class="r14"> []</span><span class="r12">                                                  </span> |
|<span class="r8"> 1025 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Process the input array.</span><span class="r12">                                                       </span> |
|<span class="r8"> 1026 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1027 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__memcpy_signal_mmap:</span><span class="r12">                                             </span> |
|<span class="r8"> 1028 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">while</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">read_memcpy_mmap():</span><span class="r12">                                        </span> |
|<span class="r8"> 1029 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    count_str </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__memcpy_buf</span><span class="r16">.</span><span class="r14">split(</span><span class="r17">b&quot;</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r14">)[</span><span class="r16">0</span><span class="r14">]</span><span class="r16">.</span><span class="r14">decode(</span><span class="r17">&quot;ascii&quot;</span><span class="r14">)</span><span class="r12">     </span> |
|<span class="r8"> 1030 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    (memcpy_time_str, count_str2, pid) </span><span class="r16">=</span><span class="r14"> count_str</span><span class="r16">.</span><span class="r14">split(</span><span class="r17">&quot;,&quot;</span><span class="r14">)</span><span class="r12">            </span> |
|<span class="r8"> 1031 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">if</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(curr_pid) </span><span class="r16">==</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(pid):</span><span class="r12">                                        </span> |
|<span class="r8"> 1032 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        arr</span><span class="r16">.</span><span class="r14">append((</span><span class="r19">int</span><span class="r14">(memcpy_time_str), </span><span class="r19">int</span><span class="r14">(count_str2)))</span><span class="r12">              </span> |
|<span class="r8"> 1033 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> e:</span><span class="r12">                                                          </span> |
|<span class="r8"> 1034 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1035 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        arr</span><span class="r16">.</span><span class="r14">sort()</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1036 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1037 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        stats </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r12">                                                          </span> |
|<span class="r8"> 1038 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> item </span><span class="r22">in</span><span class="r14"> arr:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1039 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            _memcpy_time, count </span><span class="r16">=</span><span class="r14"> item</span><span class="r12">                                                   </span> |
|<span class="r8"> 1040 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> (the_frame, _tident, _orig_frame) </span><span class="r22">in</span><span class="r14"> new_frames:</span><span class="r12">                         </span> |
|<span class="r8"> 1041 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                fname </span><span class="r16">=</span><span class="r14"> Filename(the_frame</span><span class="r16">.</span><span class="r14">f_code</span><span class="r16">.</span><span class="r14">co_filename)</span><span class="r12">                           </span> |
|<span class="r8"> 1042 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                line_no </span><span class="r16">=</span><span class="r14"> LineNumber(the_frame</span><span class="r16">.</span><span class="r14">f_lineno)</span><span class="r12">                                 </span> |
|<span class="r8"> 1043 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                bytei </span><span class="r16">=</span><span class="r14"> ByteCodeIndex(the_frame</span><span class="r16">.</span><span class="r14">f_lasti)</span><span class="r12">                                 </span> |
|<span class="r8"> 1044 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Add the byte index to the set for this line.</span><span class="r12">                           </span> |
|<span class="r8"> 1045 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">bytei_map[fname][line_no]</span><span class="r16">.</span><span class="r14">add(bytei)</span><span class="r12">                               </span> |
|<span class="r8"> 1046 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                stats</span><span class="r16">.</span><span class="r14">memcpy_samples[fname][line_no] </span><span class="r16">+=</span><span class="r14"> count</span><span class="r12">                            </span> |
|<span class="r8"> 1047 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">del</span><span class="r14"> frame</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1048 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1049 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1050 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@lru_cache</span><span class="r14">(</span><span class="r13">None</span><span class="r14">)</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1051 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">should_trace</span><span class="r14">(filename: </span><span class="r19">str</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r19">bool</span><span class="r14">:</span><span class="r12">                                             </span> |
|<span class="r8"> 1052 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Return true if the filename is one we should trace.&quot;&quot;&quot;</span><span class="r12">                        </span> |
|<span class="r8"> 1053 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> filename:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1054 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1055 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># If the @profile decorator has been used,</span><span class="r12">                                       </span> |
|<span class="r8"> 1056 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># we restrict profiling to files containing decorated functions.</span><span class="r12">                 </span> |
|<span class="r8"> 1057 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__files_to_profile:</span><span class="r12">                                                   </span> |
|<span class="r8"> 1058 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> filename </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__files_to_profile</span><span class="r12">                                </span> |
|<span class="r8"> 1059 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Generic handling follows (when no @profile decorator has been used).</span><span class="r12">           </span> |
|<span class="r8"> 1060 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        profile_only_list </span><span class="r16">=</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">profile_only</span><span class="r16">.</span><span class="r14">split(</span><span class="r17">&quot;,&quot;</span><span class="r14">)</span><span class="r12">                       </span> |
|<span class="r8"> 1061 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r17">&quot;site-packages&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> filename </span><span class="r22">or</span><span class="r14"> </span><span class="r17">&quot;/lib/python&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> filename:</span><span class="r12">                     </span> |
|<span class="r8"> 1062 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Don&#x27;t profile Python internals by default.</span><span class="r12">                                 </span> |
|<span class="r8"> 1063 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">profile_all:</span><span class="r12">                                           </span> |
|<span class="r8"> 1064 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                             </span> |
|<span class="r8"> 1065 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> filename[</span><span class="r16">0</span><span class="r14">] </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;&lt;&quot;</span><span class="r14">:</span><span class="r12">                                                           </span> |
|<span class="r8"> 1066 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r17">&quot;&lt;ipython&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> filename:</span><span class="r12">                                                   </span> |
|<span class="r8"> 1067 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Profiling code created in a Jupyter cell:</span><span class="r12">                              </span> |
|<span class="r8"> 1068 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># create a file to hold the contents.</span><span class="r12">                                    </span> |
|<span class="r8"> 1069 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">import</span><span class="r14"> </span><span class="r15">IPython</span><span class="r12">                                                           </span> |
|<span class="r8"> 1070 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">import</span><span class="r14"> </span><span class="r15">re</span><span class="r12">                                                                </span> |
|<span class="r8"> 1071 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1072 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Find the input where the function was defined;</span><span class="r12">                         </span> |
|<span class="r8"> 1073 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># we need this to properly annotate the code.</span><span class="r12">                            </span> |
|<span class="r8"> 1074 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                result </span><span class="r16">=</span><span class="r14"> re</span><span class="r16">.</span><span class="r14">match(</span><span class="r17">&quot;&lt;ipython-input-([0-9]+)-.*&gt;&quot;</span><span class="r14">, filename)</span><span class="r12">               </span> |
|<span class="r8"> 1075 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> result:</span><span class="r12">                                                               </span> |
|<span class="r8"> 1076 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Write the cell&#x27;s contents into the file.</span><span class="r12">                           </span> |
|<span class="r8"> 1077 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">with</span><span class="r14"> </span><span class="r19">open</span><span class="r14">(filename, </span><span class="r17">&quot;w+&quot;</span><span class="r14">) </span><span class="r13">as</span><span class="r14"> f:</span><span class="r12">                                      </span> |
|<span class="r8"> 1078 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        f</span><span class="r16">.</span><span class="r14">write(</span><span class="r12">                                                         </span> |
|<span class="r8"> 1079 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            IPython</span><span class="r16">.</span><span class="r14">get_ipython()</span><span class="r16">.</span><span class="r14">history_manager</span><span class="r16">.</span><span class="r14">input_hist_raw[</span><span class="r12">        </span> |
|<span class="r8"> 1080 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                                </span><span class="r19">int</span><span class="r14">(result</span><span class="r16">.</span><span class="r14">group(</span><span class="r16">1</span><span class="r14">))</span><span class="r12">                                     </span> |
|<span class="r8"> 1081 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            ]</span><span class="r12">                                                            </span> |
|<span class="r8"> 1082 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        )</span><span class="r12">                                                                </span> |
|<span class="r8"> 1083 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">return</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                              </span> |
|<span class="r8"> 1084 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1085 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Not a real file and not a function created in Jupyter.</span><span class="r12">                 </span> |
|<span class="r8"> 1086 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                             </span> |
|<span class="r8"> 1087 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r17">&quot;scalene/scalene&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> filename:</span><span class="r12">                                                </span> |
|<span class="r8"> 1088 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Don&#x27;t profile the profiler.</span><span class="r12">                                                </span> |
|<span class="r8"> 1089 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1090 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        found_in_profile_only </span><span class="r16">=</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                    </span> |
|<span class="r8"> 1091 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> prof </span><span class="r22">in</span><span class="r14"> profile_only_list:</span><span class="r12">                                                   </span> |
|<span class="r8"> 1092 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> prof </span><span class="r22">in</span><span class="r14"> filename:</span><span class="r12">                                                         </span> |
|<span class="r8"> 1093 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                found_in_profile_only </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                             </span> |
|<span class="r8"> 1094 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">break</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1095 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1096 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> found_in_profile_only:</span><span class="r12">                                                    </span> |
|<span class="r8"> 1097 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1098 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">profile_all:</span><span class="r12">                                                   </span> |
|<span class="r8"> 1099 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Profile everything else, except for &quot;only&quot; choices.</span><span class="r12">                        </span> |
|<span class="r8"> 1100 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            found_in_profile_only </span><span class="r16">=</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                </span> |
|<span class="r8"> 1101 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> prof </span><span class="r22">in</span><span class="r14"> profile_only_list:</span><span class="r12">                                               </span> |
|<span class="r8"> 1102 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> prof </span><span class="r22">in</span><span class="r14"> filename:</span><span class="r12">                                                     </span> |
|<span class="r8"> 1103 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">return</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                          </span> |
|<span class="r8"> 1104 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> profile_only_list </span><span class="r22">and</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> found_in_profile_only:</span><span class="r12">                          </span> |
|<span class="r8"> 1105 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">return</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                             </span> |
|<span class="r8"> 1106 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1107 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Profile anything in the program&#x27;s directory or a child directory,</span><span class="r12">              </span> |
|<span class="r8"> 1108 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># but nothing else, unless otherwise specified.</span><span class="r12">                                  </span> |
|<span class="r8"> 1109 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        filename </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">abspath(filename)</span><span class="r12">                                             </span> |
|<span class="r8"> 1110 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__program_path </span><span class="r22">in</span><span class="r14"> filename</span><span class="r12">                                        </span> |
|<span class="r8"> 1111 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1112 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1113 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">clear_mmap_data</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                       </span> |
|<span class="r8"> 1114 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_only:</span><span class="r12">                                                  </span> |
|<span class="r8"> 1115 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">while</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">read_malloc_mmap(): </span><span class="r13">pass</span><span class="r12">                                       </span> |
|<span class="r8"> 1116 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__memcpy_signal_mmap:</span><span class="r12">                                             </span> |
|<span class="r8"> 1117 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">while</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">read_memcpy_mmap(): </span><span class="r13">pass</span><span class="r12">                                   </span> |
|<span class="r8"> 1118 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1119 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1120 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">start</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1121 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Initiate profiling.&quot;&quot;&quot;</span><span class="r12">                                                        </span> |
|<span class="r8"> 1122 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">clear_mmap_data()</span><span class="r12">                                                        </span> |
|<span class="r8"> 1123 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">start_clock()</span><span class="r12">                                                    </span> |
|<span class="r8"> 1124 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">enable_signals()</span><span class="r12">                                                         </span> |
|<span class="r8"> 1125 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1126 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1127 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">stop</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1128 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Complete profiling.&quot;&quot;&quot;</span><span class="r12">                                                        </span> |
|<span class="r8"> 1129 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">disable_signals()</span><span class="r12">                                                        </span> |
|<span class="r8"> 1130 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">stop_clock()</span><span class="r12">                                                     </span> |
|<span class="r8"> 1131 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1132 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1133 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">start_signal_handler</span><span class="r14">(</span><span class="r12">                                                            </span> |
|<span class="r8"> 1134 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8"> 1135 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8"> 1136 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1137 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> pid </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__child_pids:</span><span class="r12">                                                 </span> |
|<span class="r8"> 1138 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            os</span><span class="r16">.</span><span class="r14">kill(pid, ScaleneSignals</span><span class="r16">.</span><span class="r14">start_profiling_signal)</span><span class="r12">                          </span> |
|<span class="r8"> 1139 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">start()</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1140 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1141 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1142 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">stop_signal_handler</span><span class="r14">(</span><span class="r12">                                                             </span> |
|<span class="r8"> 1143 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8"> 1144 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8"> 1145 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1146 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> pid </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__child_pids:</span><span class="r12">                                                 </span> |
|<span class="r8"> 1147 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            os</span><span class="r16">.</span><span class="r14">kill(pid, ScaleneSignals</span><span class="r16">.</span><span class="r14">stop_profiling_signal)</span><span class="r12">                           </span> |
|<span class="r8"> 1148 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">stop()</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1149 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1150 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1151 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">disable_signals</span><span class="r14">(retry: </span><span class="r19">bool</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r14">) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                     </span> |
|<span class="r8"> 1152 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;Turn off the profiling signals.&quot;&quot;&quot;</span><span class="r12">                                            </span> |
|<span class="r8"> 1153 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8"> 1154 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">timer_signals </span><span class="r16">=</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                </span> |
|<span class="r8"> 1155 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1156 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1157 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">setitimer(ScaleneSignals</span><span class="r16">.</span><span class="r14">cpu_timer_signal, </span><span class="r16">0</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8"> 1158 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">signal(ScaleneSignals</span><span class="r16">.</span><span class="r14">malloc_signal, signal</span><span class="r16">.</span><span class="r14">SIG_IGN)</span><span class="r12">                  </span> |
|<span class="r8"> 1159 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">signal(ScaleneSignals</span><span class="r16">.</span><span class="r14">free_signal, signal</span><span class="r16">.</span><span class="r14">SIG_IGN)</span><span class="r12">                    </span> |
|<span class="r8"> 1160 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">signal(ScaleneSignals</span><span class="r16">.</span><span class="r14">memcpy_signal, signal</span><span class="r16">.</span><span class="r14">SIG_IGN)</span><span class="r12">                  </span> |
|<span class="r8"> 1161 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">stop_signal_queues()</span><span class="r12">                                                 </span> |
|<span class="r8"> 1162 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> e:</span><span class="r12">                                                       </span> |
|<span class="r8"> 1163 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Retry just in case we get interrupted by one of our own signals.</span><span class="r12">           </span> |
|<span class="r8"> 1164 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> retry:</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1165 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">disable_signals(retry</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                     </span> |
|<span class="r8"> 1166 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1167 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1168 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">exit_handler</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                          </span> |
|<span class="r8"> 1169 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;When we exit, disable all signals.&quot;&quot;&quot;</span><span class="r12">                                         </span> |
|<span class="r8"> 1170 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">disable_signals()</span><span class="r12">                                                        </span> |
|<span class="r8"> 1171 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Delete the temporary directory.</span><span class="r12">                                                </span> |
|<span class="r8"> 1172 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1173 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__pid:</span><span class="r12">                                                        </span> |
|<span class="r8"> 1174 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir</span><span class="r16">.</span><span class="r14">cleanup()</span><span class="r12">                                     </span> |
|<span class="r8"> 1175 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14">:</span><span class="r12">                                                            </span> |
|<span class="r8"> 1176 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1177 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1178 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            os</span><span class="r16">.</span><span class="r14">remove(</span><span class="r17">f&quot;/tmp/scalene-malloc-lock</span><span class="r20">{</span><span class="r14">os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r20">}</span><span class="r17">&quot;</span><span class="r14">)</span><span class="r12">                          </span> |
|<span class="r8"> 1179 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14">:</span><span class="r12">                                                            </span> |
|<span class="r8"> 1180 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1181 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1182 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1183 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">termination_handler</span><span class="r14">(</span><span class="r12">                                                             </span> |
|<span class="r8"> 1184 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signum: Union[Callable[[Signals, FrameType], </span><span class="r13">None</span><span class="r14">], </span><span class="r19">int</span><span class="r14">, Handlers, </span><span class="r13">None</span><span class="r14">],</span><span class="r12">        </span> |
|<span class="r8"> 1185 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        this_frame: FrameType,</span><span class="r12">                                                           </span> |
|<span class="r8"> 1186 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1187 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        sys</span><span class="r16">.</span><span class="r14">exit(</span><span class="r16">-1</span><span class="r14">)</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1188 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1189 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">profile_code</span><span class="r14">(</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1190 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r14">,</span><span class="r12">                                                                            </span> |
|<span class="r8"> 1191 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        code: </span><span class="r19">str</span><span class="r14">,</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1192 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        the_globals: Dict[</span><span class="r19">str</span><span class="r14">, </span><span class="r19">str</span><span class="r14">],</span><span class="r12">                                                     </span> |
|<span class="r8"> 1193 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        the_locals: Dict[</span><span class="r19">str</span><span class="r14">, </span><span class="r19">str</span><span class="r14">],</span><span class="r12">                                                      </span> |
|<span class="r8"> 1194 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r19">int</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 1195 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># If --off is set, tell all children to not profile and stop profiling before we </span> |
|<span class="r8"> 1196 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r17">&quot;off&quot;</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args </span><span class="r22">or</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">off:</span><span class="r12">                        </span> |
|<span class="r8"> 1197 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">start()</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1198 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Run the code being profiled.</span><span class="r12">                                                   </span> |
|<span class="r8"> 1199 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        exit_status </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1200 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1201 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            exec(code, the_globals, the_locals)</span><span class="r12">                                          </span> |
|<span class="r8"> 1202 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">SystemExit</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> se:</span><span class="r12">                                                         </span> |
|<span class="r8"> 1203 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Intercept sys.exit and propagate the error code.</span><span class="r12">                           </span> |
|<span class="r8"> 1204 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            exit_status </span><span class="r16">=</span><span class="r14"> se</span><span class="r16">.</span><span class="r14">code</span><span class="r12">                                                        </span> |
|<span class="r8"> 1205 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> e:</span><span class="r12">                                                       </span> |
|<span class="r8"> 1206 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">print</span><span class="r14">(</span><span class="r17">&quot;Error in program being profiled:</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r14">, e)</span><span class="r12">                               </span> |
|<span class="r8"> 1207 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            traceback</span><span class="r16">.</span><span class="r14">print_exc()</span><span class="r12">                                                        </span> |
|<span class="r8"> 1208 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">stop()</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1209 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># If we&#x27;ve collected any samples, dump them.</span><span class="r12">                                     </span> |
|<span class="r8"> 1210 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__output</span><span class="r16">.</span><span class="r14">output_profiles(</span><span class="r12">                                             </span> |
|<span class="r8"> 1211 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__stats,</span><span class="r12">                                                             </span> |
|<span class="r8"> 1212 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__pid,</span><span class="r12">                                                               </span> |
|<span class="r8"> 1213 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">profile_this_code,</span><span class="r12">                                                   </span> |
|<span class="r8"> 1214 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">__python_alias_dir,</span><span class="r12">                                                  </span> |
|<span class="r8"> 1215 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            profile_memory</span><span class="r16">=</span><span class="r22">not</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">cpu_only,</span><span class="r12">                                  </span> |
|<span class="r8"> 1216 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            reduced_profile</span><span class="r16">=</span><span class="r14">Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">reduced_profile,</span><span class="r12">                              </span> |
|<span class="r8"> 1217 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ):</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1218 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1219 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 1220 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">print</span><span class="r14">(</span><span class="r17">&quot;Scalene: Program did not run for long enough to profile.&quot;</span><span class="r14">)</span><span class="r12">            </span> |
|<span class="r8"> 1221 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> exit_status</span><span class="r12">                                                               </span> |
|<span class="r8"> 1222 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1223 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1224 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">process_args</span><span class="r14">(args: argparse</span><span class="r16">.</span><span class="r14">Namespace) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                  </span> |
|<span class="r8"> 1225 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__args </span><span class="r16">=</span><span class="r14"> cast(ScaleneArguments, args)</span><span class="r12">                                    </span> |
|<span class="r8"> 1226 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__next_output_time </span><span class="r16">=</span><span class="r14"> (</span><span class="r12">                                                   </span> |
|<span class="r8"> 1227 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            time</span><span class="r16">.</span><span class="r14">perf_counter() </span><span class="r16">+</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__args</span><span class="r16">.</span><span class="r14">profile_interval</span><span class="r12">                        </span> |
|<span class="r8"> 1228 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1229 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__output</span><span class="r16">.</span><span class="r14">html </span><span class="r16">=</span><span class="r14"> args</span><span class="r16">.</span><span class="r14">html</span><span class="r12">                                                </span> |
|<span class="r8"> 1230 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__output</span><span class="r16">.</span><span class="r14">output_file </span><span class="r16">=</span><span class="r14"> args</span><span class="r16">.</span><span class="r14">outfile</span><span class="r12">                                      </span> |
|<span class="r8"> 1231 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__is_child </span><span class="r16">=</span><span class="r14"> args</span><span class="r16">.</span><span class="r14">pid </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                               </span> |
|<span class="r8"> 1232 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># the pid of the primary profiler</span><span class="r12">                                                </span> |
|<span class="r8"> 1233 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__parent_pid </span><span class="r16">=</span><span class="r14"> args</span><span class="r16">.</span><span class="r14">pid </span><span class="r13">if</span><span class="r14"> Scalene</span><span class="r16">.</span><span class="r14">__is_child </span><span class="r13">else</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r12">           </span> |
|<span class="r8"> 1234 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1235 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1236 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">main</span><span class="r14">() </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1237 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        (</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1238 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            args,</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1239 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            left,</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1240 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ) </span><span class="r16">=</span><span class="r14"> ScaleneParseArgs</span><span class="r16">.</span><span class="r14">parse_args()</span><span class="r12">                                                </span> |
|<span class="r8"> 1241 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">run_profiler(args, left)</span><span class="r12">                                                 </span> |
|<span class="r8"> 1242 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1243 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r23">@staticmethod</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1244 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">run_profiler</span><span class="r14">(args: argparse</span><span class="r16">.</span><span class="r14">Namespace, left: List[</span><span class="r19">str</span><span class="r14">]) </span><span class="r16">-&gt;</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                 </span> |
|<span class="r8"> 1245 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Set up signal handlers for starting and stopping profiling.</span><span class="r12">                    </span> |
|<span class="r8"> 1246 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">signal(</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1247 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ScaleneSignals</span><span class="r16">.</span><span class="r14">start_profiling_signal, Scalene</span><span class="r16">.</span><span class="r14">start_signal_handler</span><span class="r12">          </span> |
|<span class="r8"> 1248 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        )</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1249 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signal</span><span class="r16">.</span><span class="r14">signal(ScaleneSignals</span><span class="r16">.</span><span class="r14">stop_profiling_signal, Scalene</span><span class="r16">.</span><span class="r14">stop_signal_handler)</span><span class="r12"> </span> |
|<span class="r8"> 1250 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">platform </span><span class="r16">!=</span><span class="r14"> </span><span class="r17">&quot;win32&quot;</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8"> 1251 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">siginterrupt(ScaleneSignals</span><span class="r16">.</span><span class="r14">start_profiling_signal, </span><span class="r13">False</span><span class="r14">)</span><span class="r12">            </span> |
|<span class="r8"> 1252 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            signal</span><span class="r16">.</span><span class="r14">siginterrupt(ScaleneSignals</span><span class="r16">.</span><span class="r14">stop_profiling_signal, </span><span class="r13">False</span><span class="r14">)</span><span class="r12">             </span> |
|<span class="r8"> 1253 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1254 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        did_preload </span><span class="r16">=</span><span class="r14"> ScalenePreload</span><span class="r16">.</span><span class="r14">setup_preload(args)</span><span class="r12">                                 </span> |
|<span class="r8"> 1255 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> did_preload:</span><span class="r12">                                                              </span> |
|<span class="r8"> 1256 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1257 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># If running in the background, print the PID.</span><span class="r12">                           </span> |
|<span class="r8"> 1258 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">getpgrp() </span><span class="r16">!=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">tcgetpgrp(sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">fileno()):</span><span class="r12">                    </span> |
|<span class="r8"> 1259 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># In the background.</span><span class="r12">                                                 </span> |
|<span class="r8"> 1260 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r19">print</span><span class="r14">(</span><span class="r17">f&quot;Scalene now profiling process </span><span class="r20">{</span><span class="r14">os</span><span class="r16">.</span><span class="r14">getpid()</span><span class="r20">}</span><span class="r17">&quot;</span><span class="r14">)</span><span class="r12">                </span> |
|<span class="r8"> 1261 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r19">print</span><span class="r14">(</span><span class="r12">                                                               </span> |
|<span class="r8"> 1262 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r17">f&quot;  to disable profiling: python3 -m scalene.profile --off --pid </span> |
|<span class="r8"> 1263 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    )</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1264 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r19">print</span><span class="r14">(</span><span class="r12">                                                               </span> |
|<span class="r8"> 1265 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r17">f&quot;  to resume profiling:  python3 -m scalene.profile --on  --pid </span> |
|<span class="r8"> 1266 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    )</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1267 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">except</span><span class="r14">:</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1268 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">pass</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1269 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        Scalene</span><span class="r16">.</span><span class="r14">__stats</span><span class="r16">.</span><span class="r14">clear_all()</span><span class="r12">                                                      </span> |
|<span class="r8"> 1270 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        sys</span><span class="r16">.</span><span class="r14">argv </span><span class="r16">=</span><span class="r14"> left</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1271 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1272 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            multiprocessing</span><span class="r16">.</span><span class="r14">set_start_method(</span><span class="r17">&quot;fork&quot;</span><span class="r14">)</span><span class="r12">                                     </span> |
|<span class="r8"> 1273 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14">:</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1274 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1275 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1276 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            Scalene</span><span class="r16">.</span><span class="r14">process_args(args)</span><span class="r12">                                                   </span> |
|<span class="r8"> 1277 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1278 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Look for something ending in &#x27;.py&#x27;. Treat the first one as our executab</span> |
|<span class="r8"> 1279 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                progs </span><span class="r16">=</span><span class="r14"> [x </span><span class="r13">for</span><span class="r14"> x </span><span class="r22">in</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">argv </span><span class="r13">if</span><span class="r14"> re</span><span class="r16">.</span><span class="r14">match(</span><span class="r17">&quot;.*\.py$&quot;</span><span class="r14">, x)]</span><span class="r12">                  </span> |
|<span class="r8"> 1280 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># Just in case that didn&#x27;t work, try sys.argv[0] and __file__.</span><span class="r12">           </span> |
|<span class="r8"> 1281 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1282 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    progs</span><span class="r16">.</span><span class="r14">append(sys</span><span class="r16">.</span><span class="r14">argv[</span><span class="r16">0</span><span class="r14">])</span><span class="r12">                                            </span> |
|<span class="r8"> 1283 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    progs</span><span class="r16">.</span><span class="r14">append(</span><span class="r25">__file__</span><span class="r14">)</span><span class="r12">                                               </span> |
|<span class="r8"> 1284 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">except</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1285 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">pass</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1286 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">with</span><span class="r14"> </span><span class="r19">open</span><span class="r14">(progs[</span><span class="r16">0</span><span class="r14">], </span><span class="r17">&quot;rb&quot;</span><span class="r14">) </span><span class="r13">as</span><span class="r14"> prog_being_profiled:</span><span class="r12">                        </span> |
|<span class="r8"> 1287 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Read in the code and compile it.</span><span class="r12">                                   </span> |
|<span class="r8"> 1288 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1289 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        code </span><span class="r16">=</span><span class="r14"> </span><span class="r19">compile</span><span class="r14">(</span><span class="r12">                                                  </span> |
|<span class="r8"> 1290 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            prog_being_profiled</span><span class="r16">.</span><span class="r14">read(),</span><span class="r12">                                  </span> |
|<span class="r8"> 1291 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            progs[</span><span class="r16">0</span><span class="r14">],</span><span class="r12">                                                    </span> |
|<span class="r8"> 1292 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            </span><span class="r17">&quot;exec&quot;</span><span class="r14">,</span><span class="r12">                                                      </span> |
|<span class="r8"> 1293 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        )</span><span class="r12">                                                                </span> |
|<span class="r8"> 1294 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">except</span><span class="r14"> </span><span class="r24">SyntaxError</span><span class="r14">:</span><span class="r12">                                                  </span> |
|<span class="r8"> 1295 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        traceback</span><span class="r16">.</span><span class="r14">print_exc()</span><span class="r12">                                            </span> |
|<span class="r8"> 1296 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        sys</span><span class="r16">.</span><span class="r14">exit(</span><span class="r16">-1</span><span class="r14">)</span><span class="r12">                                                     </span> |
|<span class="r8"> 1297 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Push the program&#x27;s path.</span><span class="r12">                                           </span> |
|<span class="r8"> 1298 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    program_path </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">dirname(os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">abspath(progs[</span><span class="r16">0</span><span class="r14">]))</span><span class="r12">            </span> |
|<span class="r8"> 1299 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    sys</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">insert(</span><span class="r16">0</span><span class="r14">, program_path)</span><span class="r12">                                     </span> |
|<span class="r8"> 1300 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">if</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(args</span><span class="r16">.</span><span class="r14">program_path) </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                       </span> |
|<span class="r8"> 1301 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        Scalene</span><span class="r16">.</span><span class="r14">__program_path </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">abspath(args</span><span class="r16">.</span><span class="r14">program_path)</span><span class="r12">      </span> |
|<span class="r8"> 1302 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                </span> |
|<span class="r8"> 1303 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        Scalene</span><span class="r16">.</span><span class="r14">__program_path </span><span class="r16">=</span><span class="r14"> program_path</span><span class="r12">                            </span> |
|<span class="r8"> 1304 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Grab local and global variables.</span><span class="r12">                                   </span> |
|<span class="r8"> 1305 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">import</span><span class="r14"> </span><span class="r15">__main__</span><span class="r12">                                                      </span> |
|<span class="r8"> 1306 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1307 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    the_locals </span><span class="r16">=</span><span class="r14"> __main__</span><span class="r16">.</span><span class="r25">__dict__</span><span class="r12">                                       </span> |
|<span class="r8"> 1308 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    the_globals </span><span class="r16">=</span><span class="r14"> __main__</span><span class="r16">.</span><span class="r25">__dict__</span><span class="r12">                                      </span> |
|<span class="r8"> 1309 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Splice in the name of the file being executed instead of the profil</span> |
|<span class="r8"> 1310 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    the_globals[</span><span class="r17">&quot;__file__&quot;</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">basename(progs[</span><span class="r16">0</span><span class="r14">])</span><span class="r12">                 </span> |
|<span class="r8"> 1311 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Some mysterious module foo to make this work the same with -m as wi</span> |
|<span class="r8"> 1312 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    the_globals[</span><span class="r17">&quot;__spec__&quot;</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                       </span> |
|<span class="r8"> 1313 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Start the profiler.</span><span class="r12">                                                </span> |
|<span class="r8"> 1314 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    fullname </span><span class="r16">=</span><span class="r14"> os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">join(program_path, os</span><span class="r16">.</span><span class="r14">path</span><span class="r16">.</span><span class="r14">basename(progs[</span><span class="r16">0</span><span class="r14">]))</span><span class="r12">    </span> |
|<span class="r8"> 1315 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r21"># Do a GC before we start.</span><span class="r12">                                           </span> |
|<span class="r8"> 1316 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    gc</span><span class="r16">.</span><span class="r14">collect()</span><span class="r12">                                                         </span> |
|<span class="r8"> 1317 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    profiler </span><span class="r16">=</span><span class="r14"> Scalene(args, Filename(fullname))</span><span class="r12">                         </span> |
|<span class="r8"> 1318 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1319 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r21"># We exit with this status (returning error code as appropriate).</span> |
|<span class="r8"> 1320 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        exit_status </span><span class="r16">=</span><span class="r14"> profiler</span><span class="r16">.</span><span class="r14">profile_code(</span><span class="r12">                             </span> |
|<span class="r8"> 1321 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                            code, the_locals, the_globals</span><span class="r12">                                </span> |
|<span class="r8"> 1322 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        )</span><span class="r12">                                                                </span> |
|<span class="r8"> 1323 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        sys</span><span class="r16">.</span><span class="r14">exit(exit_status)</span><span class="r12">                                            </span> |
|<span class="r8"> 1324 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">except</span><span class="r14"> StopJupyterExecution:</span><span class="r12">                                         </span> |
|<span class="r8"> 1325 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r21"># Running in Jupyter notebooks</span><span class="r12">                                   </span> |
|<span class="r8"> 1326 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r13">pass</span><span class="r12">                                                             </span> |
|<span class="r8"> 1327 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">except</span><span class="r14"> </span><span class="r24">AttributeError</span><span class="r14">:</span><span class="r12">                                               </span> |
|<span class="r8"> 1328 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r21"># don&#x27;t let the handler below mask programming errors</span><span class="r12">            </span> |
|<span class="r8"> 1329 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r13">raise</span><span class="r12">                                                            </span> |
|<span class="r8"> 1330 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">except</span><span class="r14"> </span><span class="r24">Exception</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> ex:</span><span class="r12">                                              </span> |
|<span class="r8"> 1331 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        template </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;Scalene: An exception of type </span><span class="r20">{0}</span><span class="r17"> occurred. Arguments</span> |
|<span class="r8"> 1332 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        message </span><span class="r16">=</span><span class="r14"> template</span><span class="r16">.</span><span class="r14">format(</span><span class="r19">type</span><span class="r14">(ex)</span><span class="r16">.</span><span class="r25">__name__</span><span class="r14">, ex</span><span class="r16">.</span><span class="r14">args)</span><span class="r12">            </span> |
|<span class="r8"> 1333 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r19">print</span><span class="r14">(message)</span><span class="r12">                                                   </span> |
|<span class="r8"> 1334 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        </span><span class="r19">print</span><span class="r14">(traceback</span><span class="r16">.</span><span class="r14">format_exc())</span><span class="r12">                                    </span> |
|<span class="r8"> 1335 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">except</span><span class="r14"> (</span><span class="r24">FileNotFoundError</span><span class="r14">, </span><span class="r24">IOError</span><span class="r14">):</span><span class="r12">                                         </span> |
|<span class="r8"> 1336 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">print</span><span class="r14">(</span><span class="r17">&quot;Scalene: could not find input file &quot;</span><span class="r14"> </span><span class="r16">+</span><span class="r14"> progs[</span><span class="r16">0</span><span class="r14">])</span><span class="r12">                  </span> |
|<span class="r8"> 1337 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                sys</span><span class="r16">.</span><span class="r14">exit(</span><span class="r16">-1</span><span class="r14">)</span><span class="r12">                                                             </span> |
|<span class="r8"> 1338 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">SystemExit</span><span class="r14">:</span><span class="r12">                                                               </span> |
|<span class="r8"> 1339 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1340 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> StopJupyterExecution:</span><span class="r12">                                                     </span> |
|<span class="r8"> 1341 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">pass</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1342 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14">:</span><span class="r12">                                                            </span> |
|<span class="r8"> 1343 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">print</span><span class="r14">(</span><span class="r17">&quot;Scalene failed to initialize.</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r14"> </span><span class="r16">+</span><span class="r14"> traceback</span><span class="r16">.</span><span class="r14">format_exc())</span><span class="r12">            </span> |
|<span class="r8"> 1344 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sys</span><span class="r16">.</span><span class="r14">exit(</span><span class="r16">-1</span><span class="r14">)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1345 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">finally</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1346 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1347 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__malloc_signal_fd</span><span class="r16">.</span><span class="r14">close()</span><span class="r12">                                       </span> |
|<span class="r8"> 1348 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__malloc_lock_fd</span><span class="r16">.</span><span class="r14">close()</span><span class="r12">                                         </span> |
|<span class="r8"> 1349 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__memcpy_signal_fd</span><span class="r16">.</span><span class="r14">close()</span><span class="r12">                                       </span> |
|<span class="r8"> 1350 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                Scalene</span><span class="r16">.</span><span class="r14">__memcpy_lock_fd</span><span class="r16">.</span><span class="r14">close()</span><span class="r12">                                         </span> |
|<span class="r8"> 1351 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">except</span><span class="r14"> </span><span class="r24">BaseException</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8"> 1352 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">pass</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1353 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1354 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1355 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">if</span><span class="r14"> </span><span class="r25">__name__</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;__main__&quot;</span><span class="r14">:</span><span class="r12">                                                               </span> |
|<span class="r8"> 1356 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    Scalene</span><span class="r16">.</span><span class="r14">main()</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1357 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|                                                                                          |
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r27">function summary for c:\users\robertwenink\appdata\local\programs\python\python39\lib\si…</span> |
|<span class="r8">  303 </span>|<span class="r9">   11% </span>|<span class="r9">       </span>|<span class="r9">   9%  </span>|<span class="r10">       </span>|<span class="r14">Thread</span><span class="r16">.</span><span class="r14">windows_timer_loop</span><span class="r12">                                                                </span> |
|<span class="r8">  707 </span>|<span class="r9">   11% </span>|<span class="r9">       </span>|<span class="r9">   9%  </span>|<span class="r10">       </span>|<span class="r14">compute_frames_to_record</span><span class="r12">                                                                 </span> |
+---------------------------------------------------------------------------------------------------------------------------------+
<span class="r1">c:\users\robertwenink\appdata\local\programs\python\python39\lib\site-packages\scalene\scalene_sigqueue.py: % of time =  40.03% out</span>
<span class="r1">                                                            of  17.27s.                                                            </span>
+---------------------------------------------------------------------------------------------------------------------------------+
|<span class="r2"> </span><span class="r3">Line</span><span class="r2"> </span>|<span class="r4">Time</span><span class="r2">   </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r5">––––––</span><span class="r2"> </span>|<span class="r2">                                                                                          </span>|
|      |<span class="r6">Python</span><span class="r2"> </span>|<span class="r6">native</span><span class="r2"> </span>|<span class="r6">system</span><span class="r2"> </span>|<span class="r7">GPU</span><span class="r2">    </span>|<span class="r2">c:\users\robertwenink\appdata\local\programs\python\python39\lib\site-packages\scalene\s… </span>|
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">    1 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">queue</span><span class="r12">                                                                             </span> |
|<span class="r8">    2 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">threading</span><span class="r12">                                                                         </span> |
|<span class="r8">    3 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">    4 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">    5 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">class</span><span class="r14"> </span><span class="r15">ScaleneSigQueue</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8">    6 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">__init__</span><span class="r14">(</span><span class="r19">self</span><span class="r14">, process):</span><span class="r12">                                                         </span> |
|<span class="r8">    7 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">queue </span><span class="r16">=</span><span class="r14"> queue</span><span class="r16">.</span><span class="r14">SimpleQueue()</span><span class="r12">                                                 </span> |
|<span class="r8">    8 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">process </span><span class="r16">=</span><span class="r14"> process</span><span class="r12">                                                           </span> |
|<span class="r8">    9 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">thread </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                               </span> |
|<span class="r8">   10 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">lock </span><span class="r16">=</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">RLock() </span><span class="r21"># held while processing an item</span><span class="r12">                    </span> |
|<span class="r8">   11 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   12 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">put</span><span class="r14">(</span><span class="r19">self</span><span class="r14">, item):</span><span class="r12">                                                                 </span> |
|<span class="r8">   13 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">queue</span><span class="r16">.</span><span class="r14">put(item)</span><span class="r12">                                                             </span> |
|<span class="r8">   14 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   15 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">get</span><span class="r14">(</span><span class="r19">self</span><span class="r14">):</span><span class="r12">                                                                       </span> |
|<span class="r8">   16 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">queue</span><span class="r16">.</span><span class="r14">get()</span><span class="r12">                                                          </span> |
|<span class="r8">   17 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   18 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">start</span><span class="r14">(</span><span class="r19">self</span><span class="r14">):</span><span class="r12">                                                                     </span> |
|<span class="r8">   19 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># We use a daemon thread to defensively avoid hanging if we never join with it</span><span class="r12">   </span> |
|<span class="r8">   20 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">thread:</span><span class="r12">                                                              </span> |
|<span class="r8">   21 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">thread </span><span class="r16">=</span><span class="r14"> threading</span><span class="r16">.</span><span class="r14">Thread(target</span><span class="r16">=</span><span class="r19">self</span><span class="r16">.</span><span class="r14">run, daemon</span><span class="r16">=</span><span class="r13">True</span><span class="r14">)</span><span class="r12">                 </span> |
|<span class="r8">   22 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">thread</span><span class="r16">.</span><span class="r14">start()</span><span class="r12">                                                          </span> |
|<span class="r8">   23 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   24 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">stop</span><span class="r14">(</span><span class="r19">self</span><span class="r14">):</span><span class="r12">                                                                      </span> |
|<span class="r8">   25 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">thread:</span><span class="r12">                                                                  </span> |
|<span class="r8">   26 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">queue</span><span class="r16">.</span><span class="r14">put(</span><span class="r13">None</span><span class="r14">)</span><span class="r12">                                                         </span> |
|<span class="r8">   27 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># We need to join all threads before a fork() to avoid an inconsistent</span><span class="r12">       </span> |
|<span class="r8">   28 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># state, locked mutexes, etc.</span><span class="r12">                                                </span> |
|<span class="r8">   29 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">thread</span><span class="r16">.</span><span class="r14">join()</span><span class="r12">                                                           </span> |
|<span class="r8">   30 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">thread </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                           </span> |
|<span class="r8">   31 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   32 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">run</span><span class="r14">(</span><span class="r19">self</span><span class="r14">):</span><span class="r12">                                                                       </span> |
|<span class="r8">   33 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">while</span><span class="r14"> </span><span class="r13">True</span><span class="r14">:</span><span class="r12">                                                                      </span> |
|<span class="r8">   34 </span>|<span class="r9">   22% </span>|<span class="r9">       </span>|<span class="r9">  18%  </span>|<span class="r10">       </span>|<span class="r14">            item </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">queue</span><span class="r16">.</span><span class="r14">get()</span><span class="r12">                                                      </span> |
|<span class="r8">   35 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> item </span><span class="r16">==</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:  </span><span class="r21"># None == stop request</span><span class="r12">                                     </span> |
|<span class="r8">   36 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">break</span><span class="r12">                                                                    </span> |
|<span class="r8">   37 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">with</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">lock:</span><span class="r12">                                                              </span> |
|<span class="r8">   38 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">self</span><span class="r16">.</span><span class="r14">process(</span><span class="r16">*</span><span class="r14">item)</span><span class="r12">                                                      </span> |
|<span class="r8">   39 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|                                                                                          |
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r27">function summary for c:\users\robertwenink\appdata\local\programs\python\python39\lib\si…</span> |
|<span class="r8">   32 </span>|<span class="r9">   22% </span>|<span class="r9">       </span>|<span class="r9">  18%  </span>|<span class="r10">       </span>|<span class="r14">run</span><span class="r12">                                                                                      </span> |
+---------------------------------------------------------------------------------------------------------------------------------+
<span class="r1"> c:\users\robertwenink\appdata\local\programs\python\python39\lib\site-packages\numpy\linalg\linalg.py: % of time =  14.05% out of </span>
<span class="r1">                                                              17.27s.                                                              </span>
+---------------------------------------------------------------------------------------------------------------------------------+
|<span class="r2"> </span><span class="r3">Line</span><span class="r2"> </span>|<span class="r4">Time</span><span class="r2">   </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r5">––––––</span><span class="r2"> </span>|<span class="r2">                                                                                          </span>|
|      |<span class="r6">Python</span><span class="r2"> </span>|<span class="r6">native</span><span class="r2"> </span>|<span class="r6">system</span><span class="r2"> </span>|<span class="r7">GPU</span><span class="r2">    </span>|<span class="r2">c:\users\robertwenink\appdata\local\programs\python\python39\lib\site-packages\numpy\lin… </span>|
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">    1 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">&quot;&quot;&quot;Lite version of scipy.linalg.</span><span class="r12">                                                         </span> |
|<span class="r8">    2 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">    3 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">Notes</span><span class="r12">                                                                                    </span> |
|<span class="r8">    4 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">-----</span><span class="r12">                                                                                    </span> |
|<span class="r8">    5 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">This module is a lite version of the linalg.py module in SciPy which</span><span class="r12">                     </span> |
|<span class="r8">    6 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">contains high-level Python interface to the LAPACK library.  The lite</span><span class="r12">                    </span> |
|<span class="r8">    7 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">version only accesses the following LAPACK functions: dgesv, zgesv,</span><span class="r12">                      </span> |
|<span class="r8">    8 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">dgeev, zgeev, dgesdd, zgesdd, dgelsd, zgelsd, dsyevd, zheevd, dgetrf,</span><span class="r12">                    </span> |
|<span class="r8">    9 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">zgetrf, dpotrf, zpotrf, dgeqrf, zgeqrf, zungqr, dorgqr.</span><span class="r12">                                  </span> |
|<span class="r8">   10 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                      </span> |
|<span class="r8">   11 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   12 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">__all__ </span><span class="r16">=</span><span class="r14"> [</span><span class="r17">&#x27;matrix_power&#x27;</span><span class="r14">, </span><span class="r17">&#x27;solve&#x27;</span><span class="r14">, </span><span class="r17">&#x27;tensorsolve&#x27;</span><span class="r14">, </span><span class="r17">&#x27;tensorinv&#x27;</span><span class="r14">, </span><span class="r17">&#x27;inv&#x27;</span><span class="r14">,</span><span class="r12">                   </span> |
|<span class="r8">   13 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">           </span><span class="r17">&#x27;cholesky&#x27;</span><span class="r14">, </span><span class="r17">&#x27;eigvals&#x27;</span><span class="r14">, </span><span class="r17">&#x27;eigvalsh&#x27;</span><span class="r14">, </span><span class="r17">&#x27;pinv&#x27;</span><span class="r14">, </span><span class="r17">&#x27;slogdet&#x27;</span><span class="r14">, </span><span class="r17">&#x27;det&#x27;</span><span class="r14">,</span><span class="r12">                  </span> |
|<span class="r8">   14 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">           </span><span class="r17">&#x27;svd&#x27;</span><span class="r14">, </span><span class="r17">&#x27;eig&#x27;</span><span class="r14">, </span><span class="r17">&#x27;eigh&#x27;</span><span class="r14">, </span><span class="r17">&#x27;lstsq&#x27;</span><span class="r14">, </span><span class="r17">&#x27;norm&#x27;</span><span class="r14">, </span><span class="r17">&#x27;qr&#x27;</span><span class="r14">, </span><span class="r17">&#x27;cond&#x27;</span><span class="r14">, </span><span class="r17">&#x27;matrix_rank&#x27;</span><span class="r14">,</span><span class="r12">           </span> |
|<span class="r8">   15 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">           </span><span class="r17">&#x27;LinAlgError&#x27;</span><span class="r14">, </span><span class="r17">&#x27;multi_dot&#x27;</span><span class="r14">]</span><span class="r12">                                                   </span> |
|<span class="r8">   16 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   17 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">functools</span><span class="r12">                                                                         </span> |
|<span class="r8">   18 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">operator</span><span class="r12">                                                                          </span> |
|<span class="r8">   19 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">warnings</span><span class="r12">                                                                          </span> |
|<span class="r8">   20 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   21 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">numpy.core</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> (</span><span class="r12">                                                                 </span> |
|<span class="r8">   22 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    array, asarray, zeros, empty, empty_like, intc, single, double,</span><span class="r12">                      </span> |
|<span class="r8">   23 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    csingle, cdouble, inexact, complexfloating, newaxis, </span><span class="r19">all</span><span class="r14">, Inf, dot,</span><span class="r12">                  </span> |
|<span class="r8">   24 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    add, multiply, sqrt, fastCopyAndTranspose, </span><span class="r19">sum</span><span class="r14">, isfinite,</span><span class="r12">                            </span> |
|<span class="r8">   25 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    finfo, errstate, geterrobj, moveaxis, amin, amax, product, </span><span class="r19">abs</span><span class="r14">,</span><span class="r12">                      </span> |
|<span class="r8">   26 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    atleast_2d, intp, asanyarray, object_, matmul,</span><span class="r12">                                       </span> |
|<span class="r8">   27 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    swapaxes, divide, count_nonzero, isnan, sign, argsort, sort</span><span class="r12">                          </span> |
|<span class="r8">   28 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">)</span><span class="r12">                                                                                        </span> |
|<span class="r8">   29 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">numpy.core.multiarray</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> normalize_axis_index</span><span class="r12">                                   </span> |
|<span class="r8">   30 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">numpy.core.overrides</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> set_module</span><span class="r12">                                              </span> |
|<span class="r8">   31 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">numpy.core</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> overrides</span><span class="r12">                                                         </span> |
|<span class="r8">   32 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">numpy.lib.twodim_base</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> triu, eye</span><span class="r12">                                              </span> |
|<span class="r8">   33 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">numpy.linalg</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> lapack_lite, _umath_linalg</span><span class="r12">                                      </span> |
|<span class="r8">   34 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   35 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   36 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">array_function_dispatch </span><span class="r16">=</span><span class="r14"> functools</span><span class="r16">.</span><span class="r14">partial(</span><span class="r12">                                             </span> |
|<span class="r8">   37 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    overrides</span><span class="r16">.</span><span class="r14">array_function_dispatch, module</span><span class="r16">=</span><span class="r17">&#x27;numpy.linalg&#x27;</span><span class="r14">)</span><span class="r12">                            </span> |
|<span class="r8">   38 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   39 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   40 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">fortran_int </span><span class="r16">=</span><span class="r14"> intc</span><span class="r12">                                                                       </span> |
|<span class="r8">   41 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   42 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   43 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@set_module</span><span class="r14">(</span><span class="r17">&#x27;numpy.linalg&#x27;</span><span class="r14">)</span><span class="r12">                                                              </span> |
|<span class="r8">   44 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">class</span><span class="r14"> </span><span class="r15">LinAlgError</span><span class="r14">(</span><span class="r24">Exception</span><span class="r14">):</span><span class="r12">                                                            </span> |
|<span class="r8">   45 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">   46 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Generic Python-exception-derived object raised by linalg functions.</span><span class="r12">                  </span> |
|<span class="r8">   47 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   48 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    General purpose exception class, derived from Python&#x27;s exception.Exception</span><span class="r12">           </span> |
|<span class="r8">   49 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    class, programmatically raised in linalg functions when a Linear</span><span class="r12">                     </span> |
|<span class="r8">   50 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Algebra-related condition would prevent further correct execution of the</span><span class="r12">             </span> |
|<span class="r8">   51 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    function.</span><span class="r12">                                                                            </span> |
|<span class="r8">   52 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   53 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">   54 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">   55 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    None</span><span class="r12">                                                                                 </span> |
|<span class="r8">   56 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   57 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">   58 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">   59 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy import linalg as LA</span><span class="r12">                                                   </span> |
|<span class="r8">   60 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.inv(np.zeros((2,2)))</span><span class="r12">                                                          </span> |
|<span class="r8">   61 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Traceback (most recent call last):</span><span class="r12">                                                   </span> |
|<span class="r8">   62 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">      File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><span class="r12">                                                </span> |
|<span class="r8">   63 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">      File &quot;...linalg.py&quot;, line 350,</span><span class="r12">                                                     </span> |
|<span class="r8">   64 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        in inv return wrap(solve(a, identity(a.shape[0], dtype=a.dtype)))</span><span class="r12">                </span> |
|<span class="r8">   65 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">      File &quot;...linalg.py&quot;, line 249,</span><span class="r12">                                                     </span> |
|<span class="r8">   66 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        in solve</span><span class="r12">                                                                         </span> |
|<span class="r8">   67 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        raise LinAlgError(&#x27;Singular matrix&#x27;)</span><span class="r12">                                             </span> |
|<span class="r8">   68 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    numpy.linalg.LinAlgError: Singular matrix</span><span class="r12">                                            </span> |
|<span class="r8">   69 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   70 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">   71 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   72 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   73 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_determine_error_states</span><span class="r14">():</span><span class="r12">                                                           </span> |
|<span class="r8">   74 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    errobj </span><span class="r16">=</span><span class="r14"> geterrobj()</span><span class="r12">                                                                 </span> |
|<span class="r8">   75 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    bufsize </span><span class="r16">=</span><span class="r14"> errobj[</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                                                  </span> |
|<span class="r8">   76 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   77 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">with</span><span class="r14"> errstate(invalid</span><span class="r16">=</span><span class="r17">&#x27;call&#x27;</span><span class="r14">, over</span><span class="r16">=</span><span class="r17">&#x27;ignore&#x27;</span><span class="r14">,</span><span class="r12">                                         </span> |
|<span class="r8">   78 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                  divide</span><span class="r16">=</span><span class="r17">&#x27;ignore&#x27;</span><span class="r14">, under</span><span class="r16">=</span><span class="r17">&#x27;ignore&#x27;</span><span class="r14">):</span><span class="r12">                                      </span> |
|<span class="r8">   79 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        invalid_call_errmask </span><span class="r16">=</span><span class="r14"> geterrobj()[</span><span class="r16">1</span><span class="r14">]</span><span class="r12">                                            </span> |
|<span class="r8">   80 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   81 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> [bufsize, invalid_call_errmask, </span><span class="r13">None</span><span class="r14">]</span><span class="r12">                                         </span> |
|<span class="r8">   82 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   83 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Dealing with errors in _umath_linalg</span><span class="r12">                                                   </span> |
|<span class="r8">   84 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">_linalg_error_extobj </span><span class="r16">=</span><span class="r14"> _determine_error_states()</span><span class="r12">                                         </span> |
|<span class="r8">   85 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">del</span><span class="r14"> _determine_error_states</span><span class="r12">                                                              </span> |
|<span class="r8">   86 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   87 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_raise_linalgerror_singular</span><span class="r14">(err, flag):</span><span class="r12">                                              </span> |
|<span class="r8">   88 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&quot;Singular matrix&quot;</span><span class="r14">)</span><span class="r12">                                                 </span> |
|<span class="r8">   89 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   90 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_raise_linalgerror_nonposdef</span><span class="r14">(err, flag):</span><span class="r12">                                             </span> |
|<span class="r8">   91 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&quot;Matrix is not positive definite&quot;</span><span class="r14">)</span><span class="r12">                                 </span> |
|<span class="r8">   92 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   93 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_raise_linalgerror_eigenvalues_nonconvergence</span><span class="r14">(err, flag):</span><span class="r12">                            </span> |
|<span class="r8">   94 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&quot;Eigenvalues did not converge&quot;</span><span class="r14">)</span><span class="r12">                                    </span> |
|<span class="r8">   95 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   96 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_raise_linalgerror_svd_nonconvergence</span><span class="r14">(err, flag):</span><span class="r12">                                    </span> |
|<span class="r8">   97 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&quot;SVD did not converge&quot;</span><span class="r14">)</span><span class="r12">                                            </span> |
|<span class="r8">   98 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   99 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_raise_linalgerror_lstsq</span><span class="r14">(err, flag):</span><span class="r12">                                                 </span> |
|<span class="r8">  100 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&quot;SVD did not converge in Linear Least Squares&quot;</span><span class="r14">)</span><span class="r12">                    </span> |
|<span class="r8">  101 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  102 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">get_linalg_error_extobj</span><span class="r14">(callback):</span><span class="r12">                                                   </span> |
|<span class="r8">  103 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> </span><span class="r19">list</span><span class="r14">(_linalg_error_extobj)  </span><span class="r21"># make a copy</span><span class="r12">                                   </span> |
|<span class="r8">  104 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj[</span><span class="r16">2</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> callback</span><span class="r12">                                                                 </span> |
|<span class="r8">  105 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> extobj</span><span class="r12">                                                                        </span> |
|<span class="r8">  106 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  107 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_makearray</span><span class="r14">(a):</span><span class="r12">                                                                       </span> |
|<span class="r8">  108 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    new </span><span class="r16">=</span><span class="r14"> asarray(a)</span><span class="r12">                                                                     </span> |
|<span class="r8">  109 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    wrap </span><span class="r16">=</span><span class="r14"> </span><span class="r19">getattr</span><span class="r14">(a, </span><span class="r17">&quot;__array_prepare__&quot;</span><span class="r14">, new</span><span class="r16">.</span><span class="r14">__array_wrap__)</span><span class="r12">                           </span> |
|<span class="r8">  110 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> new, wrap</span><span class="r12">                                                                     </span> |
|<span class="r8">  111 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  112 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">isComplexType</span><span class="r14">(t):</span><span class="r12">                                                                    </span> |
|<span class="r8">  113 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> </span><span class="r19">issubclass</span><span class="r14">(t, complexfloating)</span><span class="r12">                                                </span> |
|<span class="r8">  114 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  115 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">_real_types_map </span><span class="r16">=</span><span class="r14"> {single : single,</span><span class="r12">                                                      </span> |
|<span class="r8">  116 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                   double : double,</span><span class="r12">                                                      </span> |
|<span class="r8">  117 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                   csingle : single,</span><span class="r12">                                                     </span> |
|<span class="r8">  118 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                   cdouble : double}</span><span class="r12">                                                     </span> |
|<span class="r8">  119 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  120 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">_complex_types_map </span><span class="r16">=</span><span class="r14"> {single : csingle,</span><span class="r12">                                                  </span> |
|<span class="r8">  121 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      double : cdouble,</span><span class="r12">                                                  </span> |
|<span class="r8">  122 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      csingle : csingle,</span><span class="r12">                                                 </span> |
|<span class="r8">  123 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      cdouble : cdouble}</span><span class="r12">                                                 </span> |
|<span class="r8">  124 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  125 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_realType</span><span class="r14">(t, default</span><span class="r16">=</span><span class="r14">double):</span><span class="r12">                                                        </span> |
|<span class="r8">  126 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> _real_types_map</span><span class="r16">.</span><span class="r14">get(t, default)</span><span class="r12">                                               </span> |
|<span class="r8">  127 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  128 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_complexType</span><span class="r14">(t, default</span><span class="r16">=</span><span class="r14">cdouble):</span><span class="r12">                                                    </span> |
|<span class="r8">  129 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> _complex_types_map</span><span class="r16">.</span><span class="r14">get(t, default)</span><span class="r12">                                            </span> |
|<span class="r8">  130 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  131 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_linalgRealType</span><span class="r14">(t):</span><span class="r12">                                                                  </span> |
|<span class="r8">  132 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;Cast the type t to either double or cdouble.&quot;&quot;&quot;</span><span class="r12">                                   </span> |
|<span class="r8">  133 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> double</span><span class="r12">                                                                        </span> |
|<span class="r8">  134 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  135 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_commonType</span><span class="r14">(</span><span class="r16">*</span><span class="r14">arrays):</span><span class="r12">                                                                </span> |
|<span class="r8">  136 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># in lite version, use higher precision (always double or cdouble)</span><span class="r12">                   </span> |
|<span class="r8">  137 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    result_type </span><span class="r16">=</span><span class="r14"> single</span><span class="r12">                                                                 </span> |
|<span class="r8">  138 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    is_complex </span><span class="r16">=</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                                   </span> |
|<span class="r8">  139 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays:</span><span class="r12">                                                                     </span> |
|<span class="r8">  140 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">issubclass</span><span class="r14">(a</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">type, inexact):</span><span class="r12">                                            </span> |
|<span class="r8">  141 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> isComplexType(a</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">type):</span><span class="r12">                                              </span> |
|<span class="r8">  142 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                is_complex </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                        </span> |
|<span class="r8">  143 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            rt </span><span class="r16">=</span><span class="r14"> _realType(a</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">type, default</span><span class="r16">=</span><span class="r13">None</span><span class="r14">)</span><span class="r12">                                   </span> |
|<span class="r8">  144 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> rt </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                               </span> |
|<span class="r8">  145 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r21"># unsupported inexact scalar</span><span class="r12">                                             </span> |
|<span class="r8">  146 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">TypeError</span><span class="r14">(</span><span class="r17">&quot;array type </span><span class="r20">%s</span><span class="r17"> is unsupported in linalg&quot;</span><span class="r14"> </span><span class="r16">%</span><span class="r12">               </span> |
|<span class="r8">  147 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                        (a</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">name,))</span><span class="r12">                                                 </span> |
|<span class="r8">  148 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  149 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            rt </span><span class="r16">=</span><span class="r14"> double</span><span class="r12">                                                                  </span> |
|<span class="r8">  150 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> rt </span><span class="r22">is</span><span class="r14"> double:</span><span class="r12">                                                                 </span> |
|<span class="r8">  151 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            result_type </span><span class="r16">=</span><span class="r14"> double</span><span class="r12">                                                         </span> |
|<span class="r8">  152 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> is_complex:</span><span class="r12">                                                                       </span> |
|<span class="r8">  153 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        t </span><span class="r16">=</span><span class="r14"> cdouble</span><span class="r12">                                                                      </span> |
|<span class="r8">  154 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        result_type </span><span class="r16">=</span><span class="r14"> _complex_types_map[result_type]</span><span class="r12">                                    </span> |
|<span class="r8">  155 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  156 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        t </span><span class="r16">=</span><span class="r14"> double</span><span class="r12">                                                                       </span> |
|<span class="r8">  157 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> t, result_type</span><span class="r12">                                                                </span> |
|<span class="r8">  158 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  159 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  160 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># _fastCopyAndTranpose assumes the input is 2D (as all the calls in here are).</span><span class="r12">           </span> |
|<span class="r8">  161 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  162 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">_fastCT </span><span class="r16">=</span><span class="r14"> fastCopyAndTranspose</span><span class="r12">                                                           </span> |
|<span class="r8">  163 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  164 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_to_native_byte_order</span><span class="r14">(</span><span class="r16">*</span><span class="r14">arrays):</span><span class="r12">                                                      </span> |
|<span class="r8">  165 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ret </span><span class="r16">=</span><span class="r14"> []</span><span class="r12">                                                                             </span> |
|<span class="r8">  166 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> arr </span><span class="r22">in</span><span class="r14"> arrays:</span><span class="r12">                                                                   </span> |
|<span class="r8">  167 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> arr</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">byteorder </span><span class="r22">not</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> (</span><span class="r17">&#x27;=&#x27;</span><span class="r14">, </span><span class="r17">&#x27;|&#x27;</span><span class="r14">):</span><span class="r12">                                        </span> |
|<span class="r8">  168 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret</span><span class="r16">.</span><span class="r14">append(asarray(arr, dtype</span><span class="r16">=</span><span class="r14">arr</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">newbyteorder(</span><span class="r17">&#x27;=&#x27;</span><span class="r14">)))</span><span class="r12">                  </span> |
|<span class="r8">  169 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  170 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret</span><span class="r16">.</span><span class="r14">append(arr)</span><span class="r12">                                                              </span> |
|<span class="r8">  171 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(ret) </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                                    </span> |
|<span class="r8">  172 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> ret[</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                                                    </span> |
|<span class="r8">  173 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  174 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> ret</span><span class="r12">                                                                       </span> |
|<span class="r8">  175 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  176 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_fastCopyAndTranspose</span><span class="r14">(</span><span class="r19">type</span><span class="r14">, </span><span class="r16">*</span><span class="r14">arrays):</span><span class="r12">                                                </span> |
|<span class="r8">  177 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    cast_arrays </span><span class="r16">=</span><span class="r14"> ()</span><span class="r12">                                                                     </span> |
|<span class="r8">  178 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays:</span><span class="r12">                                                                     </span> |
|<span class="r8">  179 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">type </span><span class="r22">is</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r19">type</span><span class="r14">:</span><span class="r12">                                                     </span> |
|<span class="r8">  180 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            a </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">astype(</span><span class="r19">type</span><span class="r14">)</span><span class="r12">                                                           </span> |
|<span class="r8">  181 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        cast_arrays </span><span class="r16">=</span><span class="r14"> cast_arrays </span><span class="r16">+</span><span class="r14"> (_fastCT(a),)</span><span class="r12">                                        </span> |
|<span class="r8">  182 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(cast_arrays) </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                            </span> |
|<span class="r8">  183 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> cast_arrays[</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                                            </span> |
|<span class="r8">  184 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  185 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> cast_arrays</span><span class="r12">                                                               </span> |
|<span class="r8">  186 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  187 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_assert_2d</span><span class="r14">(</span><span class="r16">*</span><span class="r14">arrays):</span><span class="r12">                                                                 </span> |
|<span class="r8">  188 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays:</span><span class="r12">                                                                     </span> |
|<span class="r8">  189 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8">  190 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;</span><span class="r20">%d</span><span class="r17">-dimensional array given. Array must be &#x27;</span><span class="r12">               </span> |
|<span class="r8">  191 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r17">&#x27;two-dimensional&#x27;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">ndim)</span><span class="r12">                                          </span> |
|<span class="r8">  192 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  193 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_assert_stacked_2d</span><span class="r14">(</span><span class="r16">*</span><span class="r14">arrays):</span><span class="r12">                                                         </span> |
|<span class="r8">  194 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays:</span><span class="r12">                                                                     </span> |
|<span class="r8">  195 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8">  196 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;</span><span class="r20">%d</span><span class="r17">-dimensional array given. Array must be &#x27;</span><span class="r12">               </span> |
|<span class="r8">  197 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r17">&#x27;at least two-dimensional&#x27;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">ndim)</span><span class="r12">                                 </span> |
|<span class="r8">  198 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  199 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_assert_stacked_square</span><span class="r14">(</span><span class="r16">*</span><span class="r14">arrays):</span><span class="r12">                                                     </span> |
|<span class="r8">  200 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays:</span><span class="r12">                                                                     </span> |
|<span class="r8">  201 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        m, n </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">:]</span><span class="r12">                                                              </span> |
|<span class="r8">  202 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> m </span><span class="r16">!=</span><span class="r14"> n:</span><span class="r12">                                                                       </span> |
|<span class="r8">  203 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;Last 2 dimensions of the array must be square&#x27;</span><span class="r14">)</span><span class="r12">           </span> |
|<span class="r8">  204 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  205 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_assert_finite</span><span class="r14">(</span><span class="r16">*</span><span class="r14">arrays):</span><span class="r12">                                                             </span> |
|<span class="r8">  206 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays:</span><span class="r12">                                                                     </span> |
|<span class="r8">  207 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> isfinite(a)</span><span class="r16">.</span><span class="r14">all():</span><span class="r12">                                                        </span> |
|<span class="r8">  208 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&quot;Array must not contain infs or NaNs&quot;</span><span class="r14">)</span><span class="r12">                     </span> |
|<span class="r8">  209 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  210 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_is_empty_2d</span><span class="r14">(arr):</span><span class="r12">                                                                   </span> |
|<span class="r8">  211 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># check size first for efficiency</span><span class="r12">                                                    </span> |
|<span class="r8">  212 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> arr</span><span class="r16">.</span><span class="r14">size </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> product(arr</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">:]) </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                </span> |
|<span class="r8">  213 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  214 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  215 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">transpose</span><span class="r14">(a):</span><span class="r12">                                                                        </span> |
|<span class="r8">  216 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  217 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Transpose each matrix in a stack of matrices.</span><span class="r12">                                        </span> |
|<span class="r8">  218 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  219 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Unlike np.transpose, this only swaps the last two axes, rather than all of</span><span class="r12">           </span> |
|<span class="r8">  220 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    them</span><span class="r12">                                                                                 </span> |
|<span class="r8">  221 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  222 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  223 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  224 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (...,M,N) array_like</span><span class="r12">                                                             </span> |
|<span class="r8">  225 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  226 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  227 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  228 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    aT : (...,N,M) ndarray</span><span class="r12">                                                               </span> |
|<span class="r8">  229 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  230 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> swapaxes(a, </span><span class="r16">-1</span><span class="r14">, </span><span class="r16">-2</span><span class="r14">)</span><span class="r12">                                                           </span> |
|<span class="r8">  231 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  232 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Linear equations</span><span class="r12">                                                                       </span> |
|<span class="r8">  233 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  234 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_tensorsolve_dispatcher</span><span class="r14">(a, b, axes</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                            </span> |
|<span class="r8">  235 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a, b)</span><span class="r12">                                                                        </span> |
|<span class="r8">  236 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  237 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  238 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_tensorsolve_dispatcher)</span><span class="r12">                                        </span> |
|<span class="r8">  239 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">tensorsolve</span><span class="r14">(a, b, axes</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                        </span> |
|<span class="r8">  240 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  241 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Solve the tensor equation ``a x = b`` for x.</span><span class="r12">                                         </span> |
|<span class="r8">  242 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  243 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    It is assumed that all indices of `x` are summed over in the product,</span><span class="r12">                </span> |
|<span class="r8">  244 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    together with the rightmost indices of `a`, as is done in, for example,</span><span class="r12">              </span> |
|<span class="r8">  245 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``tensordot(a, x, axes=b.ndim)``.</span><span class="r12">                                                    </span> |
|<span class="r8">  246 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  247 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  248 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  249 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : array_like</span><span class="r12">                                                                       </span> |
|<span class="r8">  250 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Coefficient tensor, of shape ``b.shape + Q``. `Q`, a tuple, equals</span><span class="r12">               </span> |
|<span class="r8">  251 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        the shape of that sub-tensor of `a` consisting of the appropriate</span><span class="r12">                </span> |
|<span class="r8">  252 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        number of its rightmost indices, and must be such that</span><span class="r12">                           </span> |
|<span class="r8">  253 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``prod(Q) == prod(b.shape)`` (in which sense `a` is said to be</span><span class="r12">                   </span> |
|<span class="r8">  254 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &#x27;square&#x27;).</span><span class="r12">                                                                       </span> |
|<span class="r8">  255 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    b : array_like</span><span class="r12">                                                                       </span> |
|<span class="r8">  256 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Right-hand tensor, which can be of any shape.</span><span class="r12">                                    </span> |
|<span class="r8">  257 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    axes : tuple of ints, optional</span><span class="r12">                                                       </span> |
|<span class="r8">  258 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Axes in `a` to reorder to the right, before inversion.</span><span class="r12">                           </span> |
|<span class="r8">  259 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If None (default), no reordering is done.</span><span class="r12">                                        </span> |
|<span class="r8">  260 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  261 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  262 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  263 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    x : ndarray, shape Q</span><span class="r12">                                                                 </span> |
|<span class="r8">  264 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  265 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8">  266 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8">  267 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8">  268 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If `a` is singular or not &#x27;square&#x27; (in the above sense).</span><span class="r12">                         </span> |
|<span class="r8">  269 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  270 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8">  271 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  272 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    numpy.tensordot, tensorinv, numpy.einsum</span><span class="r12">                                             </span> |
|<span class="r8">  273 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  274 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">  275 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  276 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.eye(2*3*4)</span><span class="r12">                                                                </span> |
|<span class="r8">  277 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a.shape = (2*3, 4, 2, 3, 4)</span><span class="r12">                                                      </span> |
|<span class="r8">  278 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.random.randn(2*3, 4)</span><span class="r12">                                                      </span> |
|<span class="r8">  279 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; x = np.linalg.tensorsolve(a, b)</span><span class="r12">                                                  </span> |
|<span class="r8">  280 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; x.shape</span><span class="r12">                                                                          </span> |
|<span class="r8">  281 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (2, 3, 4)</span><span class="r12">                                                                            </span> |
|<span class="r8">  282 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(np.tensordot(a, x, axes=3), b)</span><span class="r12">                                       </span> |
|<span class="r8">  283 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  284 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  285 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  286 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8">  287 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    b </span><span class="r16">=</span><span class="r14"> asarray(b)</span><span class="r12">                                                                       </span> |
|<span class="r8">  288 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    an </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">ndim</span><span class="r12">                                                                          </span> |
|<span class="r8">  289 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  290 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> axes </span><span class="r22">is</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                 </span> |
|<span class="r8">  291 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        allaxes </span><span class="r16">=</span><span class="r14"> </span><span class="r19">list</span><span class="r14">(</span><span class="r19">range</span><span class="r14">(</span><span class="r16">0</span><span class="r14">, an))</span><span class="r12">                                                     </span> |
|<span class="r8">  292 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> k </span><span class="r22">in</span><span class="r14"> axes:</span><span class="r12">                                                                   </span> |
|<span class="r8">  293 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            allaxes</span><span class="r16">.</span><span class="r14">remove(k)</span><span class="r12">                                                            </span> |
|<span class="r8">  294 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            allaxes</span><span class="r16">.</span><span class="r14">insert(an, k)</span><span class="r12">                                                        </span> |
|<span class="r8">  295 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        a </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">transpose(allaxes)</span><span class="r12">                                                         </span> |
|<span class="r8">  296 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  297 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    oldshape </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-</span><span class="r14">(an</span><span class="r16">-</span><span class="r14">b</span><span class="r16">.</span><span class="r14">ndim):]</span><span class="r12">                                                    </span> |
|<span class="r8">  298 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    prod </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                                             </span> |
|<span class="r8">  299 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> k </span><span class="r22">in</span><span class="r14"> oldshape:</span><span class="r12">                                                                   </span> |
|<span class="r8">  300 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        prod </span><span class="r16">*=</span><span class="r14"> k</span><span class="r12">                                                                        </span> |
|<span class="r8">  301 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  302 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">reshape(</span><span class="r16">-1</span><span class="r14">, prod)</span><span class="r12">                                                              </span> |
|<span class="r8">  303 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    b </span><span class="r16">=</span><span class="r14"> b</span><span class="r16">.</span><span class="r14">ravel()</span><span class="r12">                                                                        </span> |
|<span class="r8">  304 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    res </span><span class="r16">=</span><span class="r14"> wrap(solve(a, b))</span><span class="r12">                                                              </span> |
|<span class="r8">  305 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    res</span><span class="r16">.</span><span class="r14">shape </span><span class="r16">=</span><span class="r14"> oldshape</span><span class="r12">                                                                 </span> |
|<span class="r8">  306 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> res</span><span class="r12">                                                                           </span> |
|<span class="r8">  307 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  308 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  309 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_solve_dispatcher</span><span class="r14">(a, b):</span><span class="r12">                                                             </span> |
|<span class="r8">  310 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a, b)</span><span class="r12">                                                                        </span> |
|<span class="r8">  311 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  312 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  313 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_solve_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8">  314 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">solve</span><span class="r14">(a, b):</span><span class="r12">                                                                         </span> |
|<span class="r8">  315 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  316 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Solve a linear matrix equation, or system of linear scalar equations.</span><span class="r12">                </span> |
|<span class="r8">  317 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  318 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Computes the &quot;exact&quot; solution, `x`, of the well-determined, i.e., full</span><span class="r12">               </span> |
|<span class="r8">  319 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    rank, linear matrix equation `ax = b`.</span><span class="r12">                                               </span> |
|<span class="r8">  320 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  321 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  322 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  323 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8">  324 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Coefficient matrix.</span><span class="r12">                                                              </span> |
|<span class="r8">  325 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    b : {(..., M,), (..., M, K)}, array_like</span><span class="r12">                                             </span> |
|<span class="r8">  326 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Ordinate or &quot;dependent variable&quot; values.</span><span class="r12">                                         </span> |
|<span class="r8">  327 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  328 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  329 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  330 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    x : {(..., M,), (..., M, K)} ndarray</span><span class="r12">                                                 </span> |
|<span class="r8">  331 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Solution to the system a x = b.  Returned shape is identical to `b`.</span><span class="r12">             </span> |
|<span class="r8">  332 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  333 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8">  334 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8">  335 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8">  336 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If `a` is singular or not square.</span><span class="r12">                                                </span> |
|<span class="r8">  337 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  338 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8">  339 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  340 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.solve : Similar function in SciPy.</span><span class="r12">                                      </span> |
|<span class="r8">  341 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  342 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8">  343 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8">  344 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  345 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8">  346 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  347 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8">  348 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8">  349 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  350 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The solutions are computed using LAPACK routine ``_gesv``.</span><span class="r12">                           </span> |
|<span class="r8">  351 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  352 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `a` must be square and of full-rank, i.e., all rows (or, equivalently,</span><span class="r12">               </span> |
|<span class="r8">  353 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    columns) must be linearly independent; if either is not true, use</span><span class="r12">                    </span> |
|<span class="r8">  354 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `lstsq` for the least-squares best &quot;solution&quot; of the</span><span class="r12">                                 </span> |
|<span class="r8">  355 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    system/equation.</span><span class="r12">                                                                     </span> |
|<span class="r8">  356 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  357 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8">  358 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  359 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [1] G. Strang, *Linear Algebra and Its Applications*, 2nd Ed., Orlando,</span><span class="r12">           </span> |
|<span class="r8">  360 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           FL, Academic Press, Inc., 1980, pg. 22.</span><span class="r12">                                       </span> |
|<span class="r8">  361 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  362 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">  363 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  364 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Solve the system of equations ``x0 + 2 * x1 = 1`` and ``3 * x0 + 5 * x1 = 2``:</span><span class="r12">       </span> |
|<span class="r8">  365 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  366 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1, 2], [3, 5]])</span><span class="r12">                                                   </span> |
|<span class="r8">  367 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.array([1, 2])</span><span class="r12">                                                             </span> |
|<span class="r8">  368 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; x = np.linalg.solve(a, b)</span><span class="r12">                                                        </span> |
|<span class="r8">  369 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; x</span><span class="r12">                                                                                </span> |
|<span class="r8">  370 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([-1.,  1.])</span><span class="r12">                                                                    </span> |
|<span class="r8">  371 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  372 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Check that the solution is correct:</span><span class="r12">                                                  </span> |
|<span class="r8">  373 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  374 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(np.dot(a, x), b)</span><span class="r12">                                                     </span> |
|<span class="r8">  375 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  376 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  377 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  378 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, _ </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                                 </span> |
|<span class="r8">  379 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8">  380 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8">  381 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    b, wrap </span><span class="r16">=</span><span class="r14"> _makearray(b)</span><span class="r12">                                                              </span> |
|<span class="r8">  382 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a, b)</span><span class="r12">                                                      </span> |
|<span class="r8">  383 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  384 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># We use the b = (..., M,) logic, only if the number of extra dimensions</span><span class="r12">             </span> |
|<span class="r8">  385 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># match exactly</span><span class="r12">                                                                      </span> |
|<span class="r8">  386 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> b</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">-</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                             </span> |
|<span class="r8">  387 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">solve1</span><span class="r12">                                                    </span> |
|<span class="r8">  388 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  389 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">solve</span><span class="r12">                                                     </span> |
|<span class="r8">  390 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  391 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;DD-&gt;D&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;dd-&gt;d&#x27;</span><span class="r12">                                 </span> |
|<span class="r8">  392 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(_raise_linalgerror_singular)</span><span class="r12">                        </span> |
|<span class="r8">  393 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    r </span><span class="r16">=</span><span class="r14"> gufunc(a, b, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                                 </span> |
|<span class="r8">  394 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  395 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> wrap(r</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">))</span><span class="r12">                                          </span> |
|<span class="r8">  396 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  397 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  398 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_tensorinv_dispatcher</span><span class="r14">(a, ind</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                  </span> |
|<span class="r8">  399 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a,)</span><span class="r12">                                                                          </span> |
|<span class="r8">  400 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  401 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  402 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_tensorinv_dispatcher)</span><span class="r12">                                          </span> |
|<span class="r8">  403 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">tensorinv</span><span class="r14">(a, ind</span><span class="r16">=2</span><span class="r14">):</span><span class="r12">                                                                 </span> |
|<span class="r8">  404 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  405 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the &#x27;inverse&#x27; of an N-dimensional array.</span><span class="r12">                                     </span> |
|<span class="r8">  406 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  407 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The result is an inverse for `a` relative to the tensordot operation</span><span class="r12">                 </span> |
|<span class="r8">  408 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``tensordot(a, b, ind)``, i. e., up to floating-point accuracy,</span><span class="r12">                      </span> |
|<span class="r8">  409 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``tensordot(tensorinv(a), a, ind)`` is the &quot;identity&quot; tensor for the</span><span class="r12">                 </span> |
|<span class="r8">  410 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    tensordot operation.</span><span class="r12">                                                                 </span> |
|<span class="r8">  411 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  412 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  413 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  414 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : array_like</span><span class="r12">                                                                       </span> |
|<span class="r8">  415 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Tensor to &#x27;invert&#x27;. Its shape must be &#x27;square&#x27;, i. e.,</span><span class="r12">                           </span> |
|<span class="r8">  416 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``prod(a.shape[:ind]) == prod(a.shape[ind:])``.</span><span class="r12">                                  </span> |
|<span class="r8">  417 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ind : int, optional</span><span class="r12">                                                                  </span> |
|<span class="r8">  418 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Number of first indices that are involved in the inverse sum.</span><span class="r12">                    </span> |
|<span class="r8">  419 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Must be a positive integer, default is 2.</span><span class="r12">                                        </span> |
|<span class="r8">  420 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  421 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  422 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  423 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    b : ndarray</span><span class="r12">                                                                          </span> |
|<span class="r8">  424 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        `a`&#x27;s tensordot inverse, shape ``a.shape[ind:] + a.shape[:ind]``.</span><span class="r12">                </span> |
|<span class="r8">  425 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  426 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8">  427 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8">  428 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8">  429 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If `a` is singular or not &#x27;square&#x27; (in the above sense).</span><span class="r12">                         </span> |
|<span class="r8">  430 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  431 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8">  432 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  433 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    numpy.tensordot, tensorsolve</span><span class="r12">                                                         </span> |
|<span class="r8">  434 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  435 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">  436 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  437 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.eye(4*6)</span><span class="r12">                                                                  </span> |
|<span class="r8">  438 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a.shape = (4, 6, 8, 3)</span><span class="r12">                                                           </span> |
|<span class="r8">  439 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; ainv = np.linalg.tensorinv(a, ind=2)</span><span class="r12">                                             </span> |
|<span class="r8">  440 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; ainv.shape</span><span class="r12">                                                                       </span> |
|<span class="r8">  441 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (8, 3, 4, 6)</span><span class="r12">                                                                         </span> |
|<span class="r8">  442 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.random.randn(4, 6)</span><span class="r12">                                                        </span> |
|<span class="r8">  443 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(np.tensordot(ainv, b), np.linalg.tensorsolve(a, b))</span><span class="r12">                  </span> |
|<span class="r8">  444 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  445 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  446 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.eye(4*6)</span><span class="r12">                                                                  </span> |
|<span class="r8">  447 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a.shape = (24, 8, 3)</span><span class="r12">                                                             </span> |
|<span class="r8">  448 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; ainv = np.linalg.tensorinv(a, ind=1)</span><span class="r12">                                             </span> |
|<span class="r8">  449 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; ainv.shape</span><span class="r12">                                                                       </span> |
|<span class="r8">  450 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (8, 3, 24)</span><span class="r12">                                                                           </span> |
|<span class="r8">  451 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.random.randn(24)</span><span class="r12">                                                          </span> |
|<span class="r8">  452 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(np.tensordot(ainv, b, 1), np.linalg.tensorsolve(a, b))</span><span class="r12">               </span> |
|<span class="r8">  453 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  454 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  455 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  456 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> asarray(a)</span><span class="r12">                                                                       </span> |
|<span class="r8">  457 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    oldshape </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">shape</span><span class="r12">                                                                   </span> |
|<span class="r8">  458 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    prod </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                                             </span> |
|<span class="r8">  459 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> ind </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                          </span> |
|<span class="r8">  460 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        invshape </span><span class="r16">=</span><span class="r14"> oldshape[ind:] </span><span class="r16">+</span><span class="r14"> oldshape[:ind]</span><span class="r12">                                       </span> |
|<span class="r8">  461 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> k </span><span class="r22">in</span><span class="r14"> oldshape[ind:]:</span><span class="r12">                                                         </span> |
|<span class="r8">  462 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            prod </span><span class="r16">*=</span><span class="r14"> k</span><span class="r12">                                                                    </span> |
|<span class="r8">  463 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  464 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">&quot;Invalid ind argument.&quot;</span><span class="r14">)</span><span class="r12">                                        </span> |
|<span class="r8">  465 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">reshape(prod, </span><span class="r16">-1</span><span class="r14">)</span><span class="r12">                                                              </span> |
|<span class="r8">  466 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ia </span><span class="r16">=</span><span class="r14"> inv(a)</span><span class="r12">                                                                          </span> |
|<span class="r8">  467 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> ia</span><span class="r16">.</span><span class="r14">reshape(</span><span class="r16">*</span><span class="r14">invshape)</span><span class="r12">                                                         </span> |
|<span class="r8">  468 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  469 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  470 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Matrix inversion</span><span class="r12">                                                                       </span> |
|<span class="r8">  471 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  472 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_unary_dispatcher</span><span class="r14">(a):</span><span class="r12">                                                                </span> |
|<span class="r8">  473 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a,)</span><span class="r12">                                                                          </span> |
|<span class="r8">  474 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  475 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  476 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_unary_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8">  477 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">inv</span><span class="r14">(a):</span><span class="r12">                                                                              </span> |
|<span class="r8">  478 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  479 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the (multiplicative) inverse of a matrix.</span><span class="r12">                                    </span> |
|<span class="r8">  480 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  481 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Given a square matrix `a`, return the matrix `ainv` satisfying</span><span class="r12">                       </span> |
|<span class="r8">  482 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``dot(a, ainv) = dot(ainv, a) = eye(a.shape[0])``.</span><span class="r12">                                   </span> |
|<span class="r8">  483 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  484 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  485 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  486 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8">  487 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Matrix to be inverted.</span><span class="r12">                                                           </span> |
|<span class="r8">  488 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  489 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  490 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  491 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ainv : (..., M, M) ndarray or matrix</span><span class="r12">                                                 </span> |
|<span class="r8">  492 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        (Multiplicative) inverse of the matrix `a`.</span><span class="r12">                                      </span> |
|<span class="r8">  493 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  494 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8">  495 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8">  496 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8">  497 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If `a` is not square or inversion fails.</span><span class="r12">                                         </span> |
|<span class="r8">  498 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  499 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8">  500 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  501 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.inv : Similar function in SciPy.</span><span class="r12">                                        </span> |
|<span class="r8">  502 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  503 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8">  504 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8">  505 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  506 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8">  507 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  508 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8">  509 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8">  510 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  511 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">  512 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  513 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy.linalg import inv</span><span class="r12">                                                     </span> |
|<span class="r8">  514 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1., 2.], [3., 4.]])</span><span class="r12">                                               </span> |
|<span class="r8">  515 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; ainv = inv(a)</span><span class="r12">                                                                    </span> |
|<span class="r8">  516 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(np.dot(a, ainv), np.eye(2))</span><span class="r12">                                          </span> |
|<span class="r8">  517 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  518 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(np.dot(ainv, a), np.eye(2))</span><span class="r12">                                          </span> |
|<span class="r8">  519 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  520 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  521 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If a is a matrix object, then the return value is a matrix as well:</span><span class="r12">                  </span> |
|<span class="r8">  522 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  523 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; ainv = inv(np.matrix(a))</span><span class="r12">                                                         </span> |
|<span class="r8">  524 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; ainv</span><span class="r12">                                                                             </span> |
|<span class="r8">  525 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    matrix([[-2. ,  1. ],</span><span class="r12">                                                                </span> |
|<span class="r8">  526 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            [ 1.5, -0.5]])</span><span class="r12">                                                               </span> |
|<span class="r8">  527 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  528 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Inverses of several matrices can be computed at once:</span><span class="r12">                                </span> |
|<span class="r8">  529 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  530 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[[1., 2.], [3., 4.]], [[1, 3], [3, 5]]])</span><span class="r12">                           </span> |
|<span class="r8">  531 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; inv(a)</span><span class="r12">                                                                           </span> |
|<span class="r8">  532 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[[-2.  ,  1.  ],</span><span class="r12">                                                              </span> |
|<span class="r8">  533 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            [ 1.5 , -0.5 ]],</span><span class="r12">                                                             </span> |
|<span class="r8">  534 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [[-1.25,  0.75],</span><span class="r12">                                                              </span> |
|<span class="r8">  535 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            [ 0.75, -0.25]]])</span><span class="r12">                                                            </span> |
|<span class="r8">  536 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  537 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  538 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8">  539 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8">  540 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8">  541 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8">  542 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  543 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;D&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;d&#x27;</span><span class="r12">                                   </span> |
|<span class="r8">  544 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(_raise_linalgerror_singular)</span><span class="r12">                        </span> |
|<span class="r8">  545 </span>|<span class="r9">    6% </span>|<span class="r9">    2% </span>|<span class="r9">   7%  </span>|<span class="r10"> 15%   </span>|<span class="r14">    ainv </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">inv(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                      </span> |
|<span class="r8">  546 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> wrap(ainv</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">))</span><span class="r12">                                       </span> |
|<span class="r8">  547 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  548 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  549 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_matrix_power_dispatcher</span><span class="r14">(a, n):</span><span class="r12">                                                      </span> |
|<span class="r8">  550 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a,)</span><span class="r12">                                                                          </span> |
|<span class="r8">  551 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  552 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  553 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_matrix_power_dispatcher)</span><span class="r12">                                       </span> |
|<span class="r8">  554 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">matrix_power</span><span class="r14">(a, n):</span><span class="r12">                                                                  </span> |
|<span class="r8">  555 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  556 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raise a square matrix to the (integer) power `n`.</span><span class="r12">                                    </span> |
|<span class="r8">  557 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  558 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    For positive integers `n`, the power is computed by repeated matrix</span><span class="r12">                  </span> |
|<span class="r8">  559 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    squarings and matrix multiplications. If ``n == 0``, the identity matrix</span><span class="r12">             </span> |
|<span class="r8">  560 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of the same shape as M is returned. If ``n &lt; 0``, the inverse</span><span class="r12">                        </span> |
|<span class="r8">  561 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    is computed and then raised to the ``abs(n)``.</span><span class="r12">                                       </span> |
|<span class="r8">  562 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  563 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. note:: Stacks of object matrices are not currently supported.</span><span class="r12">                     </span> |
|<span class="r8">  564 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  565 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  566 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  567 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8">  568 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Matrix to be &quot;powered&quot;.</span><span class="r12">                                                          </span> |
|<span class="r8">  569 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    n : int</span><span class="r12">                                                                              </span> |
|<span class="r8">  570 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The exponent can be any integer or long integer, positive,</span><span class="r12">                       </span> |
|<span class="r8">  571 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        negative, or zero.</span><span class="r12">                                                               </span> |
|<span class="r8">  572 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  573 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  574 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  575 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a**n : (..., M, M) ndarray or matrix object</span><span class="r12">                                          </span> |
|<span class="r8">  576 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The return value is the same shape and type as `M`;</span><span class="r12">                              </span> |
|<span class="r8">  577 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        if the exponent is positive or zero then the type of the</span><span class="r12">                         </span> |
|<span class="r8">  578 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        elements is the same as those of `M`. If the exponent is</span><span class="r12">                         </span> |
|<span class="r8">  579 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        negative the elements are floating-point.</span><span class="r12">                                        </span> |
|<span class="r8">  580 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  581 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8">  582 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8">  583 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8">  584 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        For matrices that are not square or that (for negative powers) cannot</span><span class="r12">            </span> |
|<span class="r8">  585 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        be inverted numerically.</span><span class="r12">                                                         </span> |
|<span class="r8">  586 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  587 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">  588 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  589 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy.linalg import matrix_power</span><span class="r12">                                            </span> |
|<span class="r8">  590 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; i = np.array([[0, 1], [-1, 0]]) # matrix equiv. of the imaginary unit</span><span class="r12">            </span> |
|<span class="r8">  591 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_power(i, 3) # should = -i</span><span class="r12">                                                 </span> |
|<span class="r8">  592 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 0, -1],</span><span class="r12">                                                                     </span> |
|<span class="r8">  593 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 1,  0]])</span><span class="r12">                                                                    </span> |
|<span class="r8">  594 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_power(i, 0)</span><span class="r12">                                                               </span> |
|<span class="r8">  595 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[1, 0],</span><span class="r12">                                                                       </span> |
|<span class="r8">  596 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0, 1]])</span><span class="r12">                                                                      </span> |
|<span class="r8">  597 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_power(i, -3) # should = 1/(-i) = i, but w/ f.p. elements</span><span class="r12">                  </span> |
|<span class="r8">  598 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 0.,  1.],</span><span class="r12">                                                                   </span> |
|<span class="r8">  599 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [-1.,  0.]])</span><span class="r12">                                                                  </span> |
|<span class="r8">  600 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  601 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Somewhat more sophisticated example</span><span class="r12">                                                  </span> |
|<span class="r8">  602 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  603 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; q = np.zeros((4, 4))</span><span class="r12">                                                             </span> |
|<span class="r8">  604 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; q[0:2, 0:2] = -i</span><span class="r12">                                                                 </span> |
|<span class="r8">  605 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; q[2:4, 2:4] = i</span><span class="r12">                                                                  </span> |
|<span class="r8">  606 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; q # one of the three quaternion units not equal to 1</span><span class="r12">                             </span> |
|<span class="r8">  607 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 0., -1.,  0.,  0.],</span><span class="r12">                                                         </span> |
|<span class="r8">  608 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 1.,  0.,  0.,  0.],</span><span class="r12">                                                         </span> |
|<span class="r8">  609 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.,  0.,  0.,  1.],</span><span class="r12">                                                         </span> |
|<span class="r8">  610 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.,  0., -1.,  0.]])</span><span class="r12">                                                        </span> |
|<span class="r8">  611 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_power(q, 2) # = -np.eye(4)</span><span class="r12">                                                </span> |
|<span class="r8">  612 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[-1.,  0.,  0.,  0.],</span><span class="r12">                                                         </span> |
|<span class="r8">  613 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0., -1.,  0.,  0.],</span><span class="r12">                                                         </span> |
|<span class="r8">  614 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.,  0., -1.,  0.],</span><span class="r12">                                                         </span> |
|<span class="r8">  615 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.,  0.,  0., -1.]])</span><span class="r12">                                                        </span> |
|<span class="r8">  616 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  617 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  618 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> asanyarray(a)</span><span class="r12">                                                                    </span> |
|<span class="r8">  619 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8">  620 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8">  621 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  622 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                                 </span> |
|<span class="r8">  623 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        n </span><span class="r16">=</span><span class="r14"> operator</span><span class="r16">.</span><span class="r14">index(n)</span><span class="r12">                                                            </span> |
|<span class="r8">  624 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">except</span><span class="r14"> </span><span class="r24">TypeError</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> e:</span><span class="r12">                                                               </span> |
|<span class="r8">  625 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">TypeError</span><span class="r14">(</span><span class="r17">&quot;exponent must be an integer&quot;</span><span class="r14">) </span><span class="r13">from</span><span class="r14"> </span><span class="r15">e</span><span class="r12">                            </span> |
|<span class="r8">  626 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  627 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Fall back on dot for object arrays. Object arrays are not supported by</span><span class="r12">             </span> |
|<span class="r8">  628 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># the current implementation of matmul using einsum</span><span class="r12">                                  </span> |
|<span class="r8">  629 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">dtype </span><span class="r16">!=</span><span class="r14"> </span><span class="r19">object</span><span class="r14">:</span><span class="r12">                                                                </span> |
|<span class="r8">  630 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        fmatmul </span><span class="r16">=</span><span class="r14"> matmul</span><span class="r12">                                                                 </span> |
|<span class="r8">  631 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                    </span> |
|<span class="r8">  632 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        fmatmul </span><span class="r16">=</span><span class="r14"> dot</span><span class="r12">                                                                    </span> |
|<span class="r8">  633 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  634 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">NotImplementedError</span><span class="r14">(</span><span class="r12">                                                       </span> |
|<span class="r8">  635 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;matrix_power not supported for stacks of object arrays&quot;</span><span class="r14">)</span><span class="r12">                    </span> |
|<span class="r8">  636 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  637 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> n </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  638 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        a </span><span class="r16">=</span><span class="r14"> empty_like(a)</span><span class="r12">                                                                </span> |
|<span class="r8">  639 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        a[</span><span class="r16">...</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> eye(a</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">], dtype</span><span class="r16">=</span><span class="r14">a</span><span class="r16">.</span><span class="r14">dtype)</span><span class="r12">                                         </span> |
|<span class="r8">  640 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> a</span><span class="r12">                                                                         </span> |
|<span class="r8">  641 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  642 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> n </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                          </span> |
|<span class="r8">  643 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        a </span><span class="r16">=</span><span class="r14"> inv(a)</span><span class="r12">                                                                       </span> |
|<span class="r8">  644 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        n </span><span class="r16">=</span><span class="r14"> </span><span class="r19">abs</span><span class="r14">(n)</span><span class="r12">                                                                       </span> |
|<span class="r8">  645 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  646 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># short-cuts.</span><span class="r12">                                                                        </span> |
|<span class="r8">  647 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> n </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8">  648 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> a</span><span class="r12">                                                                         </span> |
|<span class="r8">  649 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  650 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> n </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8">  651 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> fmatmul(a, a)</span><span class="r12">                                                             </span> |
|<span class="r8">  652 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  653 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> n </span><span class="r16">==</span><span class="r14"> </span><span class="r16">3</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8">  654 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> fmatmul(fmatmul(a, a), a)</span><span class="r12">                                                 </span> |
|<span class="r8">  655 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  656 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Use binary decomposition to reduce the number of matrix multiplications.</span><span class="r12">           </span> |
|<span class="r8">  657 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Here, we iterate over the bits of n, from LSB to MSB, raise `a` to</span><span class="r12">                 </span> |
|<span class="r8">  658 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># increasing powers of 2, and multiply into the result as needed.</span><span class="r12">                    </span> |
|<span class="r8">  659 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    z </span><span class="r16">=</span><span class="r14"> result </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                                    </span> |
|<span class="r8">  660 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">while</span><span class="r14"> n </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8">  661 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        z </span><span class="r16">=</span><span class="r14"> a </span><span class="r13">if</span><span class="r14"> z </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14"> </span><span class="r13">else</span><span class="r14"> fmatmul(z, z)</span><span class="r12">                                            </span> |
|<span class="r8">  662 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        n, bit </span><span class="r16">=</span><span class="r14"> </span><span class="r19">divmod</span><span class="r14">(n, </span><span class="r16">2</span><span class="r14">)</span><span class="r12">                                                            </span> |
|<span class="r8">  663 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> bit:</span><span class="r12">                                                                          </span> |
|<span class="r8">  664 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            result </span><span class="r16">=</span><span class="r14"> z </span><span class="r13">if</span><span class="r14"> result </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14"> </span><span class="r13">else</span><span class="r14"> fmatmul(result, z)</span><span class="r12">                         </span> |
|<span class="r8">  665 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  666 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> result</span><span class="r12">                                                                        </span> |
|<span class="r8">  667 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  668 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  669 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Cholesky decomposition</span><span class="r12">                                                                 </span> |
|<span class="r8">  670 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  671 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  672 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_unary_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8">  673 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">cholesky</span><span class="r14">(a):</span><span class="r12">                                                                         </span> |
|<span class="r8">  674 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  675 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Cholesky decomposition.</span><span class="r12">                                                              </span> |
|<span class="r8">  676 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  677 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Return the Cholesky decomposition, `L * L.H`, of the square matrix `a`,</span><span class="r12">              </span> |
|<span class="r8">  678 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    where `L` is lower-triangular and .H is the conjugate transpose operator</span><span class="r12">             </span> |
|<span class="r8">  679 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (which is the ordinary transpose if `a` is real-valued).  `a` must be</span><span class="r12">                </span> |
|<span class="r8">  680 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Hermitian (symmetric if real-valued) and positive-definite. No</span><span class="r12">                       </span> |
|<span class="r8">  681 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    checking is performed to verify whether `a` is Hermitian or not.</span><span class="r12">                     </span> |
|<span class="r8">  682 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    In addition, only the lower-triangular and diagonal elements of `a`</span><span class="r12">                  </span> |
|<span class="r8">  683 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    are used. Only `L` is actually returned.</span><span class="r12">                                             </span> |
|<span class="r8">  684 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  685 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  686 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  687 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8">  688 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Hermitian (symmetric if all elements are real), positive-definite</span><span class="r12">                </span> |
|<span class="r8">  689 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        input matrix.</span><span class="r12">                                                                    </span> |
|<span class="r8">  690 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  691 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  692 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  693 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    L : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8">  694 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Upper or lower-triangular Cholesky factor of `a`.  Returns a</span><span class="r12">                     </span> |
|<span class="r8">  695 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        matrix object if `a` is a matrix object.</span><span class="r12">                                         </span> |
|<span class="r8">  696 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  697 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8">  698 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8">  699 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8">  700 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">       If the decomposition fails, for example, if `a` is not</span><span class="r12">                            </span> |
|<span class="r8">  701 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">       positive-definite.</span><span class="r12">                                                                </span> |
|<span class="r8">  702 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  703 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8">  704 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  705 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.cholesky : Similar function in SciPy.</span><span class="r12">                                   </span> |
|<span class="r8">  706 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.cholesky_banded : Cholesky decompose a banded Hermitian</span><span class="r12">                 </span> |
|<span class="r8">  707 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">                                   positive-definite matrix.</span><span class="r12">                             </span> |
|<span class="r8">  708 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.cho_factor : Cholesky decomposition of a matrix, to use in</span><span class="r12">              </span> |
|<span class="r8">  709 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">                              `scipy.linalg.cho_solve`.</span><span class="r12">                                  </span> |
|<span class="r8">  710 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  711 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8">  712 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8">  713 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  714 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8">  715 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  716 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8">  717 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8">  718 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  719 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The Cholesky decomposition is often used as a fast way of solving</span><span class="r12">                    </span> |
|<span class="r8">  720 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  721 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. math:: A \\mathbf{x} = \\mathbf{b}</span><span class="r12">                                                </span> |
|<span class="r8">  722 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  723 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (when `A` is both Hermitian/symmetric and positive-definite).</span><span class="r12">                        </span> |
|<span class="r8">  724 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  725 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    First, we solve for :math:`\\mathbf{y}` in</span><span class="r12">                                           </span> |
|<span class="r8">  726 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  727 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. math:: L \\mathbf{y} = \\mathbf{b},</span><span class="r12">                                               </span> |
|<span class="r8">  728 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  729 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    and then for :math:`\\mathbf{x}` in</span><span class="r12">                                                  </span> |
|<span class="r8">  730 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  731 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. math:: L.H \\mathbf{x} = \\mathbf{y}.</span><span class="r12">                                             </span> |
|<span class="r8">  732 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  733 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">  734 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  735 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = np.array([[1,-2j],[2j,5]])</span><span class="r12">                                                   </span> |
|<span class="r8">  736 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A</span><span class="r12">                                                                                </span> |
|<span class="r8">  737 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 1.+0.j, -0.-2.j],</span><span class="r12">                                                           </span> |
|<span class="r8">  738 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.+2.j,  5.+0.j]])</span><span class="r12">                                                          </span> |
|<span class="r8">  739 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; L = np.linalg.cholesky(A)</span><span class="r12">                                                        </span> |
|<span class="r8">  740 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; L</span><span class="r12">                                                                                </span> |
|<span class="r8">  741 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[1.+0.j, 0.+0.j],</span><span class="r12">                                                             </span> |
|<span class="r8">  742 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.+2.j, 1.+0.j]])</span><span class="r12">                                                            </span> |
|<span class="r8">  743 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.dot(L, L.T.conj()) # verify that L * L.H = A</span><span class="r12">                                  </span> |
|<span class="r8">  744 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[1.+0.j, 0.-2.j],</span><span class="r12">                                                             </span> |
|<span class="r8">  745 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.+2.j, 5.+0.j]])</span><span class="r12">                                                            </span> |
|<span class="r8">  746 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = [[1,-2j],[2j,5]] # what happens if A is only array_like?</span><span class="r12">                     </span> |
|<span class="r8">  747 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.linalg.cholesky(A) # an ndarray object is returned</span><span class="r12">                            </span> |
|<span class="r8">  748 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[1.+0.j, 0.+0.j],</span><span class="r12">                                                             </span> |
|<span class="r8">  749 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.+2.j, 1.+0.j]])</span><span class="r12">                                                            </span> |
|<span class="r8">  750 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # But a matrix object is returned if A is a matrix object</span><span class="r12">                        </span> |
|<span class="r8">  751 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.linalg.cholesky(np.matrix(A))</span><span class="r12">                                                 </span> |
|<span class="r8">  752 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    matrix([[ 1.+0.j,  0.+0.j],</span><span class="r12">                                                          </span> |
|<span class="r8">  753 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            [ 0.+2.j,  1.+0.j]])</span><span class="r12">                                                         </span> |
|<span class="r8">  754 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  755 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  756 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(_raise_linalgerror_nonposdef)</span><span class="r12">                       </span> |
|<span class="r8">  757 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">cholesky_lo</span><span class="r12">                                                   </span> |
|<span class="r8">  758 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8">  759 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8">  760 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8">  761 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8">  762 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;D&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;d&#x27;</span><span class="r12">                                   </span> |
|<span class="r8">  763 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    r </span><span class="r16">=</span><span class="r14"> gufunc(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                                    </span> |
|<span class="r8">  764 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> wrap(r</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">))</span><span class="r12">                                          </span> |
|<span class="r8">  765 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  766 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  767 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># QR decomposition</span><span class="r12">                                                                       </span> |
|<span class="r8">  768 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  769 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_qr_dispatcher</span><span class="r14">(a, mode</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                        </span> |
|<span class="r8">  770 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a,)</span><span class="r12">                                                                          </span> |
|<span class="r8">  771 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  772 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  773 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_qr_dispatcher)</span><span class="r12">                                                 </span> |
|<span class="r8">  774 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">qr</span><span class="r14">(a, mode</span><span class="r16">=</span><span class="r17">&#x27;reduced&#x27;</span><span class="r14">):</span><span class="r12">                                                               </span> |
|<span class="r8">  775 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  776 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the qr factorization of a matrix.</span><span class="r12">                                            </span> |
|<span class="r8">  777 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  778 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Factor the matrix `a` as *qr*, where `q` is orthonormal and `r` is</span><span class="r12">                   </span> |
|<span class="r8">  779 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    upper-triangular.</span><span class="r12">                                                                    </span> |
|<span class="r8">  780 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  781 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  782 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  783 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : array_like, shape (M, N)</span><span class="r12">                                                         </span> |
|<span class="r8">  784 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Matrix to be factored.</span><span class="r12">                                                           </span> |
|<span class="r8">  785 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    mode : {&#x27;reduced&#x27;, &#x27;complete&#x27;, &#x27;r&#x27;, &#x27;raw&#x27;}, optional</span><span class="r12">                                 </span> |
|<span class="r8">  786 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If K = min(M, N), then</span><span class="r12">                                                           </span> |
|<span class="r8">  787 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  788 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        * &#x27;reduced&#x27;  : returns q, r with dimensions (M, K), (K, N) (default)</span><span class="r12">             </span> |
|<span class="r8">  789 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        * &#x27;complete&#x27; : returns q, r with dimensions (M, M), (M, N)</span><span class="r12">                       </span> |
|<span class="r8">  790 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        * &#x27;r&#x27;        : returns r only with dimensions (K, N)</span><span class="r12">                             </span> |
|<span class="r8">  791 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        * &#x27;raw&#x27;      : returns h, tau with dimensions (N, M), (K,)</span><span class="r12">                       </span> |
|<span class="r8">  792 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  793 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The options &#x27;reduced&#x27;, &#x27;complete, and &#x27;raw&#x27; are new in numpy 1.8,</span><span class="r12">                </span> |
|<span class="r8">  794 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        see the notes for more information. The default is &#x27;reduced&#x27;, and to</span><span class="r12">             </span> |
|<span class="r8">  795 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        maintain backward compatibility with earlier versions of numpy both</span><span class="r12">              </span> |
|<span class="r8">  796 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        it and the old default &#x27;full&#x27; can be omitted. Note that array h</span><span class="r12">                  </span> |
|<span class="r8">  797 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        returned in &#x27;raw&#x27; mode is transposed for calling Fortran. The</span><span class="r12">                    </span> |
|<span class="r8">  798 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &#x27;economic&#x27; mode is deprecated.  The modes &#x27;full&#x27; and &#x27;economic&#x27; may</span><span class="r12">              </span> |
|<span class="r8">  799 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        be passed using only the first letter for backwards compatibility,</span><span class="r12">               </span> |
|<span class="r8">  800 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        but all others must be spelled out. See the Notes for more</span><span class="r12">                       </span> |
|<span class="r8">  801 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        explanation.</span><span class="r12">                                                                     </span> |
|<span class="r8">  802 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  803 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  804 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8">  805 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8">  806 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    q : ndarray of float or complex, optional</span><span class="r12">                                            </span> |
|<span class="r8">  807 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        A matrix with orthonormal columns. When mode = &#x27;complete&#x27; the</span><span class="r12">                    </span> |
|<span class="r8">  808 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        result is an orthogonal/unitary matrix depending on whether or not</span><span class="r12">               </span> |
|<span class="r8">  809 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        a is real/complex. The determinant may be either +/- 1 in that</span><span class="r12">                   </span> |
|<span class="r8">  810 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        case.</span><span class="r12">                                                                            </span> |
|<span class="r8">  811 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    r : ndarray of float or complex, optional</span><span class="r12">                                            </span> |
|<span class="r8">  812 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The upper-triangular matrix.</span><span class="r12">                                                     </span> |
|<span class="r8">  813 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (h, tau) : ndarrays of np.double or np.cdouble, optional</span><span class="r12">                             </span> |
|<span class="r8">  814 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The array h contains the Householder reflectors that generate q</span><span class="r12">                  </span> |
|<span class="r8">  815 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        along with r. The tau array contains scaling factors for the</span><span class="r12">                     </span> |
|<span class="r8">  816 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        reflectors. In the deprecated  &#x27;economic&#x27; mode only h is returned.</span><span class="r12">               </span> |
|<span class="r8">  817 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  818 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8">  819 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8">  820 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8">  821 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If factoring fails.</span><span class="r12">                                                              </span> |
|<span class="r8">  822 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  823 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8">  824 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  825 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.qr : Similar function in SciPy.</span><span class="r12">                                         </span> |
|<span class="r8">  826 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.rq : Compute RQ decomposition of a matrix.</span><span class="r12">                              </span> |
|<span class="r8">  827 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  828 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8">  829 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8">  830 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This is an interface to the LAPACK routines ``dgeqrf``, ``zgeqrf``,</span><span class="r12">                  </span> |
|<span class="r8">  831 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``dorgqr``, and ``zungqr``.</span><span class="r12">                                                          </span> |
|<span class="r8">  832 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  833 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    For more information on the qr factorization, see for example:</span><span class="r12">                       </span> |
|<span class="r8">  834 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    https://en.wikipedia.org/wiki/QR_factorization</span><span class="r12">                                       </span> |
|<span class="r8">  835 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  836 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Subclasses of `ndarray` are preserved except for the &#x27;raw&#x27; mode. So if</span><span class="r12">               </span> |
|<span class="r8">  837 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `a` is of type `matrix`, all the return values will be matrices too.</span><span class="r12">                 </span> |
|<span class="r8">  838 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  839 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    New &#x27;reduced&#x27;, &#x27;complete&#x27;, and &#x27;raw&#x27; options for mode were added in</span><span class="r12">                  </span> |
|<span class="r8">  840 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    NumPy 1.8.0 and the old option &#x27;full&#x27; was made an alias of &#x27;reduced&#x27;.  In</span><span class="r12">            </span> |
|<span class="r8">  841 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    addition the options &#x27;full&#x27; and &#x27;economic&#x27; were deprecated.  Because</span><span class="r12">                 </span> |
|<span class="r8">  842 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &#x27;full&#x27; was the previous default and &#x27;reduced&#x27; is the new default,</span><span class="r12">                    </span> |
|<span class="r8">  843 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    backward compatibility can be maintained by letting `mode` default.</span><span class="r12">                  </span> |
|<span class="r8">  844 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The &#x27;raw&#x27; option was added so that LAPACK routines that can multiply</span><span class="r12">                 </span> |
|<span class="r8">  845 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    arrays by q using the Householder reflectors can be used. Note that in</span><span class="r12">               </span> |
|<span class="r8">  846 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    this case the returned arrays are of type np.double or np.cdouble and</span><span class="r12">                </span> |
|<span class="r8">  847 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the h array is transposed to be FORTRAN compatible.  No routines using</span><span class="r12">               </span> |
|<span class="r8">  848 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the &#x27;raw&#x27; return are currently exposed by numpy, but some are available</span><span class="r12">              </span> |
|<span class="r8">  849 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    in lapack_lite and just await the necessary work.</span><span class="r12">                                    </span> |
|<span class="r8">  850 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  851 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8">  852 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8">  853 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.random.randn(9, 6)</span><span class="r12">                                                        </span> |
|<span class="r8">  854 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; q, r = np.linalg.qr(a)</span><span class="r12">                                                           </span> |
|<span class="r8">  855 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(a, np.dot(q, r))  # a does equal qr</span><span class="r12">                                  </span> |
|<span class="r8">  856 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  857 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; r2 = np.linalg.qr(a, mode=&#x27;r&#x27;)</span><span class="r12">                                                   </span> |
|<span class="r8">  858 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(r, r2)  # mode=&#x27;r&#x27; returns the same r as mode=&#x27;full&#x27;</span><span class="r12">                 </span> |
|<span class="r8">  859 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8">  860 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  861 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Example illustrating a common use of `qr`: solving of least squares</span><span class="r12">                  </span> |
|<span class="r8">  862 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    problems</span><span class="r12">                                                                             </span> |
|<span class="r8">  863 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  864 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    What are the least-squares-best `m` and `y0` in ``y = y0 + mx`` for</span><span class="r12">                  </span> |
|<span class="r8">  865 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the following data: {(0,1), (1,0), (1,2), (2,1)}. (Graph the points</span><span class="r12">                  </span> |
|<span class="r8">  866 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    and you&#x27;ll see that it should be y0 = 0, m = 1.)  The answer is provided</span><span class="r12">             </span> |
|<span class="r8">  867 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    by solving the over-determined matrix equation ``Ax = b``, where::</span><span class="r12">                   </span> |
|<span class="r8">  868 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  869 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">      A = array([[0, 1], [1, 1], [1, 1], [2, 1]])</span><span class="r12">                                        </span> |
|<span class="r8">  870 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">      x = array([[y0], [m]])</span><span class="r12">                                                             </span> |
|<span class="r8">  871 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">      b = array([[1], [0], [2], [1]])</span><span class="r12">                                                    </span> |
|<span class="r8">  872 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  873 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If A = qr such that q is orthonormal (which is always possible via</span><span class="r12">                   </span> |
|<span class="r8">  874 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Gram-Schmidt), then ``x = inv(r) * (q.T) * b``.  (In numpy practice,</span><span class="r12">                 </span> |
|<span class="r8">  875 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    however, we simply use `lstsq`.)</span><span class="r12">                                                     </span> |
|<span class="r8">  876 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  877 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = np.array([[0, 1], [1, 1], [1, 1], [2, 1]])</span><span class="r12">                                   </span> |
|<span class="r8">  878 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A</span><span class="r12">                                                                                </span> |
|<span class="r8">  879 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[0, 1],</span><span class="r12">                                                                       </span> |
|<span class="r8">  880 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [1, 1],</span><span class="r12">                                                                       </span> |
|<span class="r8">  881 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [1, 1],</span><span class="r12">                                                                       </span> |
|<span class="r8">  882 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [2, 1]])</span><span class="r12">                                                                      </span> |
|<span class="r8">  883 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.array([1, 0, 2, 1])</span><span class="r12">                                                       </span> |
|<span class="r8">  884 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; q, r = np.linalg.qr(A)</span><span class="r12">                                                           </span> |
|<span class="r8">  885 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; p = np.dot(q.T, b)</span><span class="r12">                                                               </span> |
|<span class="r8">  886 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.dot(np.linalg.inv(r), p)</span><span class="r12">                                                      </span> |
|<span class="r8">  887 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([  1.1e-16,   1.0e+00])</span><span class="r12">                                                        </span> |
|<span class="r8">  888 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  889 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  890 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> mode </span><span class="r22">not</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> (</span><span class="r17">&#x27;reduced&#x27;</span><span class="r14">, </span><span class="r17">&#x27;complete&#x27;</span><span class="r14">, </span><span class="r17">&#x27;r&#x27;</span><span class="r14">, </span><span class="r17">&#x27;raw&#x27;</span><span class="r14">):</span><span class="r12">                                  </span> |
|<span class="r8">  891 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> mode </span><span class="r22">in</span><span class="r14"> (</span><span class="r17">&#x27;f&#x27;</span><span class="r14">, </span><span class="r17">&#x27;full&#x27;</span><span class="r14">):</span><span class="r12">                                                        </span> |
|<span class="r8">  892 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># 2013-04-01, 1.8</span><span class="r12">                                                            </span> |
|<span class="r8">  893 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            msg </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;&quot;</span><span class="r16">.</span><span class="r14">join((</span><span class="r12">                                                              </span> |
|<span class="r8">  894 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r17">&quot;The &#x27;full&#x27; option is deprecated in favor of &#x27;reduced&#x27;.</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r14">,</span><span class="r12">          </span> |
|<span class="r8">  895 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r17">&quot;For backward compatibility let mode default.&quot;</span><span class="r14">))</span><span class="r12">                     </span> |
|<span class="r8">  896 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            warnings</span><span class="r16">.</span><span class="r14">warn(msg, </span><span class="r24">DeprecationWarning</span><span class="r14">, stacklevel</span><span class="r16">=3</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  897 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mode </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;reduced&#x27;</span><span class="r12">                                                             </span> |
|<span class="r8">  898 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> mode </span><span class="r22">in</span><span class="r14"> (</span><span class="r17">&#x27;e&#x27;</span><span class="r14">, </span><span class="r17">&#x27;economic&#x27;</span><span class="r14">):</span><span class="r12">                                                  </span> |
|<span class="r8">  899 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># 2013-04-01, 1.8</span><span class="r12">                                                            </span> |
|<span class="r8">  900 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            msg </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;The &#x27;economic&#x27; option is deprecated.&quot;</span><span class="r12">                                 </span> |
|<span class="r8">  901 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            warnings</span><span class="r16">.</span><span class="r14">warn(msg, </span><span class="r24">DeprecationWarning</span><span class="r14">, stacklevel</span><span class="r16">=3</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  902 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            mode </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;economic&#x27;</span><span class="r12">                                                            </span> |
|<span class="r8">  903 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  904 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">f&quot;Unrecognized mode &#x27;</span><span class="r20">{</span><span class="r14">mode</span><span class="r20">}</span><span class="r17">&#x27;&quot;</span><span class="r14">)</span><span class="r12">                              </span> |
|<span class="r8">  905 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  906 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8">  907 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_2d(a)</span><span class="r12">                                                                        </span> |
|<span class="r8">  908 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    m, n </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">shape</span><span class="r12">                                                                       </span> |
|<span class="r8">  909 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8">  910 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> _fastCopyAndTranspose(t, a)</span><span class="r12">                                                      </span> |
|<span class="r8">  911 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> _to_native_byte_order(a)</span><span class="r12">                                                         </span> |
|<span class="r8">  912 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    mn </span><span class="r16">=</span><span class="r14"> </span><span class="r19">min</span><span class="r14">(m, n)</span><span class="r12">                                                                       </span> |
|<span class="r8">  913 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    tau </span><span class="r16">=</span><span class="r14"> zeros((mn,), t)</span><span class="r12">                                                                </span> |
|<span class="r8">  914 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  915 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> isComplexType(t):</span><span class="r12">                                                                 </span> |
|<span class="r8">  916 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        lapack_routine </span><span class="r16">=</span><span class="r14"> lapack_lite</span><span class="r16">.</span><span class="r14">zgeqrf</span><span class="r12">                                              </span> |
|<span class="r8">  917 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        routine_name </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;zgeqrf&#x27;</span><span class="r12">                                                          </span> |
|<span class="r8">  918 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  919 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        lapack_routine </span><span class="r16">=</span><span class="r14"> lapack_lite</span><span class="r16">.</span><span class="r14">dgeqrf</span><span class="r12">                                              </span> |
|<span class="r8">  920 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        routine_name </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;dgeqrf&#x27;</span><span class="r12">                                                          </span> |
|<span class="r8">  921 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  922 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># calculate optimal size of work data &#x27;work&#x27;</span><span class="r12">                                         </span> |
|<span class="r8">  923 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    lwork </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                                            </span> |
|<span class="r8">  924 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    work </span><span class="r16">=</span><span class="r14"> zeros((lwork,), t)</span><span class="r12">                                                            </span> |
|<span class="r8">  925 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    results </span><span class="r16">=</span><span class="r14"> lapack_routine(m, n, a, </span><span class="r19">max</span><span class="r14">(</span><span class="r16">1</span><span class="r14">, m), tau, work, </span><span class="r16">-1</span><span class="r14">, </span><span class="r16">0</span><span class="r14">)</span><span class="r12">                       </span> |
|<span class="r8">  926 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">] </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                             </span> |
|<span class="r8">  927 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;</span><span class="r20">%s</span><span class="r17"> returns </span><span class="r20">%d</span><span class="r17">&#x27;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (routine_name, results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">]))</span><span class="r12">             </span> |
|<span class="r8">  928 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  929 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># do qr decomposition</span><span class="r12">                                                                </span> |
|<span class="r8">  930 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    lwork </span><span class="r16">=</span><span class="r14"> </span><span class="r19">max</span><span class="r14">(</span><span class="r16">1</span><span class="r14">, n, </span><span class="r19">int</span><span class="r14">(</span><span class="r19">abs</span><span class="r14">(work[</span><span class="r16">0</span><span class="r14">])))</span><span class="r12">                                                 </span> |
|<span class="r8">  931 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    work </span><span class="r16">=</span><span class="r14"> zeros((lwork,), t)</span><span class="r12">                                                            </span> |
|<span class="r8">  932 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    results </span><span class="r16">=</span><span class="r14"> lapack_routine(m, n, a, </span><span class="r19">max</span><span class="r14">(</span><span class="r16">1</span><span class="r14">, m), tau, work, lwork, </span><span class="r16">0</span><span class="r14">)</span><span class="r12">                    </span> |
|<span class="r8">  933 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">] </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                             </span> |
|<span class="r8">  934 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;</span><span class="r20">%s</span><span class="r17"> returns </span><span class="r20">%d</span><span class="r17">&#x27;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (routine_name, results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">]))</span><span class="r12">             </span> |
|<span class="r8">  935 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  936 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># handle modes that don&#x27;t return q</span><span class="r12">                                                   </span> |
|<span class="r8">  937 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> mode </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;r&#x27;</span><span class="r14">:</span><span class="r12">                                                                      </span> |
|<span class="r8">  938 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        r </span><span class="r16">=</span><span class="r14"> _fastCopyAndTranspose(result_t, a[:, :mn])</span><span class="r12">                                   </span> |
|<span class="r8">  939 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> wrap(triu(r))</span><span class="r12">                                                             </span> |
|<span class="r8">  940 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  941 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> mode </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;raw&#x27;</span><span class="r14">:</span><span class="r12">                                                                    </span> |
|<span class="r8">  942 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> a, tau</span><span class="r12">                                                                    </span> |
|<span class="r8">  943 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  944 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> mode </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;economic&#x27;</span><span class="r14">:</span><span class="r12">                                                               </span> |
|<span class="r8">  945 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> t </span><span class="r16">!=</span><span class="r14"> result_t :</span><span class="r12">                                                               </span> |
|<span class="r8">  946 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            a </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                           </span> |
|<span class="r8">  947 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> wrap(a</span><span class="r16">.</span><span class="r14">T)</span><span class="r12">                                                                 </span> |
|<span class="r8">  948 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  949 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21">#  generate q from a</span><span class="r12">                                                                 </span> |
|<span class="r8">  950 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> mode </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;complete&#x27;</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> m </span><span class="r16">&gt;</span><span class="r14"> n:</span><span class="r12">                                                     </span> |
|<span class="r8">  951 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        mc </span><span class="r16">=</span><span class="r14"> m</span><span class="r12">                                                                           </span> |
|<span class="r8">  952 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        q </span><span class="r16">=</span><span class="r14"> empty((m, m), t)</span><span class="r12">                                                             </span> |
|<span class="r8">  953 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  954 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        mc </span><span class="r16">=</span><span class="r14"> mn</span><span class="r12">                                                                          </span> |
|<span class="r8">  955 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        q </span><span class="r16">=</span><span class="r14"> empty((n, m), t)</span><span class="r12">                                                             </span> |
|<span class="r8">  956 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    q[:n] </span><span class="r16">=</span><span class="r14"> a</span><span class="r12">                                                                            </span> |
|<span class="r8">  957 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  958 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> isComplexType(t):</span><span class="r12">                                                                 </span> |
|<span class="r8">  959 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        lapack_routine </span><span class="r16">=</span><span class="r14"> lapack_lite</span><span class="r16">.</span><span class="r14">zungqr</span><span class="r12">                                              </span> |
|<span class="r8">  960 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        routine_name </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;zungqr&#x27;</span><span class="r12">                                                          </span> |
|<span class="r8">  961 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8">  962 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        lapack_routine </span><span class="r16">=</span><span class="r14"> lapack_lite</span><span class="r16">.</span><span class="r14">dorgqr</span><span class="r12">                                              </span> |
|<span class="r8">  963 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        routine_name </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;dorgqr&#x27;</span><span class="r12">                                                          </span> |
|<span class="r8">  964 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  965 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># determine optimal lwork</span><span class="r12">                                                            </span> |
|<span class="r8">  966 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    lwork </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                                            </span> |
|<span class="r8">  967 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    work </span><span class="r16">=</span><span class="r14"> zeros((lwork,), t)</span><span class="r12">                                                            </span> |
|<span class="r8">  968 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    results </span><span class="r16">=</span><span class="r14"> lapack_routine(m, mc, mn, q, </span><span class="r19">max</span><span class="r14">(</span><span class="r16">1</span><span class="r14">, m), tau, work, </span><span class="r16">-1</span><span class="r14">, </span><span class="r16">0</span><span class="r14">)</span><span class="r12">                  </span> |
|<span class="r8">  969 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">] </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                             </span> |
|<span class="r8">  970 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;</span><span class="r20">%s</span><span class="r17"> returns </span><span class="r20">%d</span><span class="r17">&#x27;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (routine_name, results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">]))</span><span class="r12">             </span> |
|<span class="r8">  971 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  972 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># compute q</span><span class="r12">                                                                          </span> |
|<span class="r8">  973 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    lwork </span><span class="r16">=</span><span class="r14"> </span><span class="r19">max</span><span class="r14">(</span><span class="r16">1</span><span class="r14">, n, </span><span class="r19">int</span><span class="r14">(</span><span class="r19">abs</span><span class="r14">(work[</span><span class="r16">0</span><span class="r14">])))</span><span class="r12">                                                 </span> |
|<span class="r8">  974 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    work </span><span class="r16">=</span><span class="r14"> zeros((lwork,), t)</span><span class="r12">                                                            </span> |
|<span class="r8">  975 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    results </span><span class="r16">=</span><span class="r14"> lapack_routine(m, mc, mn, q, </span><span class="r19">max</span><span class="r14">(</span><span class="r16">1</span><span class="r14">, m), tau, work, lwork, </span><span class="r16">0</span><span class="r14">)</span><span class="r12">               </span> |
|<span class="r8">  976 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">] </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                             </span> |
|<span class="r8">  977 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;</span><span class="r20">%s</span><span class="r17"> returns </span><span class="r20">%d</span><span class="r17">&#x27;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (routine_name, results[</span><span class="r17">&#x27;info&#x27;</span><span class="r14">]))</span><span class="r12">             </span> |
|<span class="r8">  978 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  979 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    q </span><span class="r16">=</span><span class="r14"> _fastCopyAndTranspose(result_t, q[:mc])</span><span class="r12">                                          </span> |
|<span class="r8">  980 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    r </span><span class="r16">=</span><span class="r14"> _fastCopyAndTranspose(result_t, a[:, :mc])</span><span class="r12">                                       </span> |
|<span class="r8">  981 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  982 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> wrap(q), wrap(triu(r))</span><span class="r12">                                                        </span> |
|<span class="r8">  983 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  984 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  985 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Eigenvalues</span><span class="r12">                                                                            </span> |
|<span class="r8">  986 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  987 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  988 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_unary_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8">  989 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">eigvals</span><span class="r14">(a):</span><span class="r12">                                                                          </span> |
|<span class="r8">  990 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">  991 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the eigenvalues of a general matrix.</span><span class="r12">                                         </span> |
|<span class="r8">  992 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  993 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Main difference between `eigvals` and `eig`: the eigenvectors aren&#x27;t</span><span class="r12">                 </span> |
|<span class="r8">  994 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    returned.</span><span class="r12">                                                                            </span> |
|<span class="r8">  995 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  996 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8">  997 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8">  998 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8">  999 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        A complex- or real-valued matrix whose eigenvalues will be computed.</span><span class="r12">             </span> |
|<span class="r8"> 1000 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1001 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1002 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1003 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    w : (..., M,) ndarray</span><span class="r12">                                                                </span> |
|<span class="r8"> 1004 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The eigenvalues, each repeated according to its multiplicity.</span><span class="r12">                    </span> |
|<span class="r8"> 1005 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        They are not necessarily ordered, nor are they necessarily</span><span class="r12">                       </span> |
|<span class="r8"> 1006 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        real for real matrices.</span><span class="r12">                                                          </span> |
|<span class="r8"> 1007 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1008 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1009 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1010 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1011 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the eigenvalue computation does not converge.</span><span class="r12">                                 </span> |
|<span class="r8"> 1012 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1013 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1014 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1015 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eig : eigenvalues and right eigenvectors of general arrays</span><span class="r12">                           </span> |
|<span class="r8"> 1016 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigvalsh : eigenvalues of real symmetric or complex Hermitian</span><span class="r12">                        </span> |
|<span class="r8"> 1017 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">               (conjugate symmetric) arrays.</span><span class="r12">                                             </span> |
|<span class="r8"> 1018 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigh : eigenvalues and eigenvectors of real symmetric or complex</span><span class="r12">                     </span> |
|<span class="r8"> 1019 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           Hermitian (conjugate symmetric) arrays.</span><span class="r12">                                       </span> |
|<span class="r8"> 1020 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.eigvals : Similar function in SciPy.</span><span class="r12">                                    </span> |
|<span class="r8"> 1021 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1022 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1023 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1024 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1025 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8"> 1026 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1027 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8"> 1028 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1029 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1030 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This is implemented using the ``_geev`` LAPACK routines which compute</span><span class="r12">                </span> |
|<span class="r8"> 1031 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the eigenvalues and eigenvectors of general square arrays.</span><span class="r12">                           </span> |
|<span class="r8"> 1032 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1033 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1034 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1035 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Illustration, using the fact that the eigenvalues of a diagonal matrix</span><span class="r12">               </span> |
|<span class="r8"> 1036 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    are its diagonal elements, that multiplying a matrix on the left</span><span class="r12">                     </span> |
|<span class="r8"> 1037 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    by an orthogonal matrix, `Q`, and on the right by `Q.T` (the transpose</span><span class="r12">               </span> |
|<span class="r8"> 1038 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of `Q`), preserves the eigenvalues of the &quot;middle&quot; matrix.  In other words,</span><span class="r12">          </span> |
|<span class="r8"> 1039 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    if `Q` is orthogonal, then ``Q * A * Q.T`` has the same eigenvalues as</span><span class="r12">               </span> |
|<span class="r8"> 1040 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``A``:</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1041 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1042 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy import linalg as LA</span><span class="r12">                                                   </span> |
|<span class="r8"> 1043 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; x = np.random.random()</span><span class="r12">                                                           </span> |
|<span class="r8"> 1044 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; Q = np.array([[np.cos(x), -np.sin(x)], [np.sin(x), np.cos(x)]])</span><span class="r12">                  </span> |
|<span class="r8"> 1045 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(Q[0, :]), LA.norm(Q[1, :]), np.dot(Q[0, :],Q[1, :])</span><span class="r12">                      </span> |
|<span class="r8"> 1046 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (1.0, 1.0, 0.0)</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1047 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1048 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Now multiply a diagonal matrix by ``Q`` on one side and by ``Q.T`` on the other:</span><span class="r12">     </span> |
|<span class="r8"> 1049 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1050 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; D = np.diag((-1,1))</span><span class="r12">                                                              </span> |
|<span class="r8"> 1051 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.eigvals(D)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1052 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([-1.,  1.])</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1053 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = np.dot(Q, D)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1054 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = np.dot(A, Q.T)</span><span class="r12">                                                               </span> |
|<span class="r8"> 1055 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.eigvals(A)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1056 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([ 1., -1.]) # random</span><span class="r12">                                                           </span> |
|<span class="r8"> 1057 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1058 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1059 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1060 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1061 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8"> 1062 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_finite(a)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1063 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 1064 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1065 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(</span><span class="r12">                                                    </span> |
|<span class="r8"> 1066 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        _raise_linalgerror_eigenvalues_nonconvergence)</span><span class="r12">                                   </span> |
|<span class="r8"> 1067 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;D&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;D&#x27;</span><span class="r12">                                   </span> |
|<span class="r8"> 1068 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    w </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">eigvals(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                     </span> |
|<span class="r8"> 1069 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1070 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> isComplexType(t):</span><span class="r12">                                                             </span> |
|<span class="r8"> 1071 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">all</span><span class="r14">(w</span><span class="r16">.</span><span class="r14">imag </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">):</span><span class="r12">                                                             </span> |
|<span class="r8"> 1072 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            w </span><span class="r16">=</span><span class="r14"> w</span><span class="r16">.</span><span class="r14">real</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1073 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            result_t </span><span class="r16">=</span><span class="r14"> _realType(result_t)</span><span class="r12">                                               </span> |
|<span class="r8"> 1074 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 1075 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            result_t </span><span class="r16">=</span><span class="r14"> _complexType(result_t)</span><span class="r12">                                            </span> |
|<span class="r8"> 1076 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1077 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> w</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                                </span> |
|<span class="r8"> 1078 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1079 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1080 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_eigvalsh_dispatcher</span><span class="r14">(a, UPLO</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                  </span> |
|<span class="r8"> 1081 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a,)</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1082 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1083 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1084 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_eigvalsh_dispatcher)</span><span class="r12">                                           </span> |
|<span class="r8"> 1085 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">eigvalsh</span><span class="r14">(a, UPLO</span><span class="r16">=</span><span class="r17">&#x27;L&#x27;</span><span class="r14">):</span><span class="r12">                                                               </span> |
|<span class="r8"> 1086 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1087 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the eigenvalues of a complex Hermitian or real symmetric matrix.</span><span class="r12">             </span> |
|<span class="r8"> 1088 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1089 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Main difference from eigh: the eigenvectors are not computed.</span><span class="r12">                        </span> |
|<span class="r8"> 1090 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1091 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1092 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1093 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8"> 1094 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        A complex- or real-valued matrix whose eigenvalues are to be</span><span class="r12">                     </span> |
|<span class="r8"> 1095 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        computed.</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1096 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    UPLO : {&#x27;L&#x27;, &#x27;U&#x27;}, optional</span><span class="r12">                                                          </span> |
|<span class="r8"> 1097 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Specifies whether the calculation is done with the lower triangular</span><span class="r12">              </span> |
|<span class="r8"> 1098 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        part of `a` (&#x27;L&#x27;, default) or the upper triangular part (&#x27;U&#x27;).</span><span class="r12">                   </span> |
|<span class="r8"> 1099 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Irrespective of this value only the real parts of the diagonal will</span><span class="r12">              </span> |
|<span class="r8"> 1100 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        be considered in the computation to preserve the notion of a Hermitian</span><span class="r12">           </span> |
|<span class="r8"> 1101 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        matrix. It therefore follows that the imaginary part of the diagonal</span><span class="r12">             </span> |
|<span class="r8"> 1102 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        will always be treated as zero.</span><span class="r12">                                                  </span> |
|<span class="r8"> 1103 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1104 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1105 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1106 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    w : (..., M,) ndarray</span><span class="r12">                                                                </span> |
|<span class="r8"> 1107 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The eigenvalues in ascending order, each repeated according to</span><span class="r12">                   </span> |
|<span class="r8"> 1108 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        its multiplicity.</span><span class="r12">                                                                </span> |
|<span class="r8"> 1109 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1110 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1111 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1112 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1113 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the eigenvalue computation does not converge.</span><span class="r12">                                 </span> |
|<span class="r8"> 1114 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1115 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1116 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1117 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigh : eigenvalues and eigenvectors of real symmetric or complex Hermitian</span><span class="r12">           </span> |
|<span class="r8"> 1118 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           (conjugate symmetric) arrays.</span><span class="r12">                                                 </span> |
|<span class="r8"> 1119 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigvals : eigenvalues of general real or complex arrays.</span><span class="r12">                             </span> |
|<span class="r8"> 1120 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eig : eigenvalues and right eigenvectors of general real or complex</span><span class="r12">                  </span> |
|<span class="r8"> 1121 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">          arrays.</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1122 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.eigvalsh : Similar function in SciPy.</span><span class="r12">                                   </span> |
|<span class="r8"> 1123 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1124 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1125 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1126 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1127 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8"> 1128 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1129 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8"> 1130 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1131 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1132 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The eigenvalues are computed using LAPACK routines ``_syevd``, ``_heevd``.</span><span class="r12">           </span> |
|<span class="r8"> 1133 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1134 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1135 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1136 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy import linalg as LA</span><span class="r12">                                                   </span> |
|<span class="r8"> 1137 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1, -2j], [2j, 5]])</span><span class="r12">                                                </span> |
|<span class="r8"> 1138 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.eigvalsh(a)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1139 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([ 0.17157288,  5.82842712]) # may vary</span><span class="r12">                                         </span> |
|<span class="r8"> 1140 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1141 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # demonstrate the treatment of the imaginary part of the diagonal</span><span class="r12">                </span> |
|<span class="r8"> 1142 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[5+2j, 9-2j], [0+2j, 2-1j]])</span><span class="r12">                                       </span> |
|<span class="r8"> 1143 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1144 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[5.+2.j, 9.-2.j],</span><span class="r12">                                                             </span> |
|<span class="r8"> 1145 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.+2.j, 2.-1.j]])</span><span class="r12">                                                            </span> |
|<span class="r8"> 1146 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # with UPLO=&#x27;L&#x27; this is numerically equivalent to using LA.eigvals()</span><span class="r12">             </span> |
|<span class="r8"> 1147 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # with:</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1148 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.array([[5.+0.j, 0.-2.j], [0.+2.j, 2.-0.j]])</span><span class="r12">                               </span> |
|<span class="r8"> 1149 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1150 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[5.+0.j, 0.-2.j],</span><span class="r12">                                                             </span> |
|<span class="r8"> 1151 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.+2.j, 2.+0.j]])</span><span class="r12">                                                            </span> |
|<span class="r8"> 1152 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; wa = LA.eigvalsh(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1153 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; wb = LA.eigvals(b)</span><span class="r12">                                                               </span> |
|<span class="r8"> 1154 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; wa; wb</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1155 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([1., 6.])</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1156 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([6.+0.j, 1.+0.j])</span><span class="r12">                                                              </span> |
|<span class="r8"> 1157 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1158 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1159 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    UPLO </span><span class="r16">=</span><span class="r14"> UPLO</span><span class="r16">.</span><span class="r14">upper()</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1160 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> UPLO </span><span class="r22">not</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> (</span><span class="r17">&#x27;L&#x27;</span><span class="r14">, </span><span class="r17">&#x27;U&#x27;</span><span class="r14">):</span><span class="r12">                                                           </span> |
|<span class="r8"> 1161 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">&quot;UPLO argument must be &#x27;L&#x27; or &#x27;U&#x27;&quot;</span><span class="r14">)</span><span class="r12">                             </span> |
|<span class="r8"> 1162 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1163 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(</span><span class="r12">                                                    </span> |
|<span class="r8"> 1164 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        _raise_linalgerror_eigenvalues_nonconvergence)</span><span class="r12">                                   </span> |
|<span class="r8"> 1165 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> UPLO </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;L&#x27;</span><span class="r14">:</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1166 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">eigvalsh_lo</span><span class="r12">                                               </span> |
|<span class="r8"> 1167 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1168 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">eigvalsh_up</span><span class="r12">                                               </span> |
|<span class="r8"> 1169 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1170 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1171 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1172 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8"> 1173 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 1174 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;d&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;d&#x27;</span><span class="r12">                                   </span> |
|<span class="r8"> 1175 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    w </span><span class="r16">=</span><span class="r14"> gufunc(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                                    </span> |
|<span class="r8"> 1176 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> w</span><span class="r16">.</span><span class="r14">astype(_realType(result_t), copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                     </span> |
|<span class="r8"> 1177 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1178 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_convertarray</span><span class="r14">(a):</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1179 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 1180 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> _fastCT(a</span><span class="r16">.</span><span class="r14">astype(t))</span><span class="r12">                                                             </span> |
|<span class="r8"> 1181 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> a, t, result_t</span><span class="r12">                                                                </span> |
|<span class="r8"> 1182 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1183 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1184 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Eigenvectors</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1185 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1186 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1187 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_unary_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8"> 1188 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">eig</span><span class="r14">(a):</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1189 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1190 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the eigenvalues and right eigenvectors of a square array.</span><span class="r12">                    </span> |
|<span class="r8"> 1191 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1192 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1193 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1194 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array</span><span class="r12">                                                                </span> |
|<span class="r8"> 1195 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Matrices for which the eigenvalues and right eigenvectors will</span><span class="r12">                   </span> |
|<span class="r8"> 1196 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        be computed</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1197 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1198 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1199 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1200 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    w : (..., M) array</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1201 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The eigenvalues, each repeated according to its multiplicity.</span><span class="r12">                    </span> |
|<span class="r8"> 1202 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The eigenvalues are not necessarily ordered. The resulting</span><span class="r12">                       </span> |
|<span class="r8"> 1203 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        array will be of complex type, unless the imaginary part is</span><span class="r12">                      </span> |
|<span class="r8"> 1204 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        zero in which case it will be cast to a real type. When `a`</span><span class="r12">                      </span> |
|<span class="r8"> 1205 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        is real the resulting eigenvalues will be real (0 imaginary</span><span class="r12">                      </span> |
|<span class="r8"> 1206 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        part) or occur in conjugate pairs</span><span class="r12">                                                </span> |
|<span class="r8"> 1207 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1208 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    v : (..., M, M) array</span><span class="r12">                                                                </span> |
|<span class="r8"> 1209 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The normalized (unit &quot;length&quot;) eigenvectors, such that the</span><span class="r12">                       </span> |
|<span class="r8"> 1210 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        column ``v[:,i]`` is the eigenvector corresponding to the</span><span class="r12">                        </span> |
|<span class="r8"> 1211 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        eigenvalue ``w[i]``.</span><span class="r12">                                                             </span> |
|<span class="r8"> 1212 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1213 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1214 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1215 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1216 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the eigenvalue computation does not converge.</span><span class="r12">                                 </span> |
|<span class="r8"> 1217 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1218 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1219 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1220 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigvals : eigenvalues of a non-symmetric array.</span><span class="r12">                                      </span> |
|<span class="r8"> 1221 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigh : eigenvalues and eigenvectors of a real symmetric or complex</span><span class="r12">                   </span> |
|<span class="r8"> 1222 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           Hermitian (conjugate symmetric) array.</span><span class="r12">                                        </span> |
|<span class="r8"> 1223 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigvalsh : eigenvalues of a real symmetric or complex Hermitian</span><span class="r12">                      </span> |
|<span class="r8"> 1224 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">               (conjugate symmetric) array.</span><span class="r12">                                              </span> |
|<span class="r8"> 1225 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.eig : Similar function in SciPy that also solves the</span><span class="r12">                    </span> |
|<span class="r8"> 1226 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">                       generalized eigenvalue problem.</span><span class="r12">                                   </span> |
|<span class="r8"> 1227 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.schur : Best choice for unitary and other non-Hermitian</span><span class="r12">                 </span> |
|<span class="r8"> 1228 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">                         normal matrices.</span><span class="r12">                                                </span> |
|<span class="r8"> 1229 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1230 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1231 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1232 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1233 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8"> 1234 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1235 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8"> 1236 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1237 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1238 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This is implemented using the ``_geev`` LAPACK routines which compute</span><span class="r12">                </span> |
|<span class="r8"> 1239 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the eigenvalues and eigenvectors of general square arrays.</span><span class="r12">                           </span> |
|<span class="r8"> 1240 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1241 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The number `w` is an eigenvalue of `a` if there exists a vector</span><span class="r12">                      </span> |
|<span class="r8"> 1242 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `v` such that ``a @ v = w * v``. Thus, the arrays `a`, `w`, and</span><span class="r12">                      </span> |
|<span class="r8"> 1243 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `v` satisfy the equations ``a @ v[:,i] = w[i] * v[:,i]``</span><span class="r12">                             </span> |
|<span class="r8"> 1244 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    for :math:`i \\in \\{0,...,M-1\\}`.</span><span class="r12">                                                  </span> |
|<span class="r8"> 1245 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1246 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The array `v` of eigenvectors may not be of maximum rank, that is, some</span><span class="r12">              </span> |
|<span class="r8"> 1247 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of the columns may be linearly dependent, although round-off error may</span><span class="r12">               </span> |
|<span class="r8"> 1248 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    obscure that fact. If the eigenvalues are all different, then theoretically</span><span class="r12">          </span> |
|<span class="r8"> 1249 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the eigenvectors are linearly independent and `a` can be diagonalized by</span><span class="r12">             </span> |
|<span class="r8"> 1250 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a similarity transformation using `v`, i.e, ``inv(v) @ a @ v`` is diagonal.</span><span class="r12">          </span> |
|<span class="r8"> 1251 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1252 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    For non-Hermitian normal matrices the SciPy function `scipy.linalg.schur`</span><span class="r12">            </span> |
|<span class="r8"> 1253 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    is preferred because the matrix `v` is guaranteed to be unitary, which is</span><span class="r12">            </span> |
|<span class="r8"> 1254 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    not the case when using `eig`. The Schur factorization produces an</span><span class="r12">                   </span> |
|<span class="r8"> 1255 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    upper triangular matrix rather than a diagonal matrix, but for normal</span><span class="r12">                </span> |
|<span class="r8"> 1256 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    matrices only the diagonal of the upper triangular matrix is needed, the</span><span class="r12">             </span> |
|<span class="r8"> 1257 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    rest is roundoff error.</span><span class="r12">                                                              </span> |
|<span class="r8"> 1258 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1259 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Finally, it is emphasized that `v` consists of the *right* (as in</span><span class="r12">                    </span> |
|<span class="r8"> 1260 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    right-hand side) eigenvectors of `a`.  A vector `y` satisfying</span><span class="r12">                       </span> |
|<span class="r8"> 1261 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``y.T @ a = z * y.T`` for some number `z` is called a *left*</span><span class="r12">                         </span> |
|<span class="r8"> 1262 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigenvector of `a`, and, in general, the left and right eigenvectors</span><span class="r12">                 </span> |
|<span class="r8"> 1263 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of a matrix are not necessarily the (perhaps conjugate) transposes</span><span class="r12">                   </span> |
|<span class="r8"> 1264 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of each other.</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1265 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1266 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1267 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1268 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    G. Strang, *Linear Algebra and Its Applications*, 2nd Ed., Orlando, FL,</span><span class="r12">              </span> |
|<span class="r8"> 1269 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Academic Press, Inc., 1980, Various pp.</span><span class="r12">                                              </span> |
|<span class="r8"> 1270 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1271 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1272 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1273 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy import linalg as LA</span><span class="r12">                                                   </span> |
|<span class="r8"> 1274 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1275 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (Almost) trivial example with real e-values and e-vectors.</span><span class="r12">                           </span> |
|<span class="r8"> 1276 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1277 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w, v = LA.eig(np.diag((1, 2, 3)))</span><span class="r12">                                                </span> |
|<span class="r8"> 1278 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w; v</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1279 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([1., 2., 3.])</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1280 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[1., 0., 0.],</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1281 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0., 1., 0.],</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1282 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0., 0., 1.]])</span><span class="r12">                                                                </span> |
|<span class="r8"> 1283 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1284 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Real matrix possessing complex e-values and e-vectors; note that the</span><span class="r12">                 </span> |
|<span class="r8"> 1285 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    e-values are complex conjugates of each other.</span><span class="r12">                                       </span> |
|<span class="r8"> 1286 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1287 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w, v = LA.eig(np.array([[1, -1], [1, 1]]))</span><span class="r12">                                       </span> |
|<span class="r8"> 1288 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w; v</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1289 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([1.+1.j, 1.-1.j])</span><span class="r12">                                                              </span> |
|<span class="r8"> 1290 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[0.70710678+0.j        , 0.70710678-0.j        ],</span><span class="r12">                             </span> |
|<span class="r8"> 1291 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.        -0.70710678j, 0.        +0.70710678j]])</span><span class="r12">                            </span> |
|<span class="r8"> 1292 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1293 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Complex-valued matrix with real e-values (but complex-valued e-vectors);</span><span class="r12">             </span> |
|<span class="r8"> 1294 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    note that ``a.conj().T == a``, i.e., `a` is Hermitian.</span><span class="r12">                               </span> |
|<span class="r8"> 1295 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1296 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1, 1j], [-1j, 1]])</span><span class="r12">                                                </span> |
|<span class="r8"> 1297 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w, v = LA.eig(a)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1298 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w; v</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1299 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([2.+0.j, 0.+0.j])</span><span class="r12">                                                              </span> |
|<span class="r8"> 1300 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 0.        +0.70710678j,  0.70710678+0.j        ], # may vary</span><span class="r12">                </span> |
|<span class="r8"> 1301 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.70710678+0.j        , -0.        +0.70710678j]])</span><span class="r12">                          </span> |
|<span class="r8"> 1302 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1303 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Be careful about round-off error!</span><span class="r12">                                                    </span> |
|<span class="r8"> 1304 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1305 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1 + 1e-9, 0], [0, 1 - 1e-9]])</span><span class="r12">                                     </span> |
|<span class="r8"> 1306 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # Theor. e-values are 1 +/- 1e-9</span><span class="r12">                                                 </span> |
|<span class="r8"> 1307 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w, v = LA.eig(a)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1308 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w; v</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1309 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([1., 1.])</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1310 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[1., 0.],</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1311 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0., 1.]])</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1312 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1313 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1314 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1315 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1316 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8"> 1317 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_finite(a)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1318 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 1319 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1320 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(</span><span class="r12">                                                    </span> |
|<span class="r8"> 1321 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        _raise_linalgerror_eigenvalues_nonconvergence)</span><span class="r12">                                   </span> |
|<span class="r8"> 1322 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;DD&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;DD&#x27;</span><span class="r12">                                 </span> |
|<span class="r8"> 1323 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    w, vt </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">eig(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                     </span> |
|<span class="r8"> 1324 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1325 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> isComplexType(t) </span><span class="r22">and</span><span class="r14"> </span><span class="r19">all</span><span class="r14">(w</span><span class="r16">.</span><span class="r14">imag </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0.0</span><span class="r14">):</span><span class="r12">                                      </span> |
|<span class="r8"> 1326 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        w </span><span class="r16">=</span><span class="r14"> w</span><span class="r16">.</span><span class="r14">real</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1327 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        vt </span><span class="r16">=</span><span class="r14"> vt</span><span class="r16">.</span><span class="r14">real</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1328 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        result_t </span><span class="r16">=</span><span class="r14"> _realType(result_t)</span><span class="r12">                                                   </span> |
|<span class="r8"> 1329 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1330 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        result_t </span><span class="r16">=</span><span class="r14"> _complexType(result_t)</span><span class="r12">                                                </span> |
|<span class="r8"> 1331 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1332 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    vt </span><span class="r16">=</span><span class="r14"> vt</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                                 </span> |
|<span class="r8"> 1333 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> w</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">), wrap(vt)</span><span class="r12">                                      </span> |
|<span class="r8"> 1334 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1335 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1336 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_eigvalsh_dispatcher)</span><span class="r12">                                           </span> |
|<span class="r8"> 1337 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">eigh</span><span class="r14">(a, UPLO</span><span class="r16">=</span><span class="r17">&#x27;L&#x27;</span><span class="r14">):</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1338 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1339 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Return the eigenvalues and eigenvectors of a complex Hermitian</span><span class="r12">                       </span> |
|<span class="r8"> 1340 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (conjugate symmetric) or a real symmetric matrix.</span><span class="r12">                                    </span> |
|<span class="r8"> 1341 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1342 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns two objects, a 1-D array containing the eigenvalues of `a`, and</span><span class="r12">              </span> |
|<span class="r8"> 1343 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a 2-D square array or matrix (depending on the input type) of the</span><span class="r12">                    </span> |
|<span class="r8"> 1344 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    corresponding eigenvectors (in columns).</span><span class="r12">                                             </span> |
|<span class="r8"> 1345 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1346 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1347 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1348 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array</span><span class="r12">                                                                </span> |
|<span class="r8"> 1349 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Hermitian or real symmetric matrices whose eigenvalues and</span><span class="r12">                       </span> |
|<span class="r8"> 1350 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        eigenvectors are to be computed.</span><span class="r12">                                                 </span> |
|<span class="r8"> 1351 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    UPLO : {&#x27;L&#x27;, &#x27;U&#x27;}, optional</span><span class="r12">                                                          </span> |
|<span class="r8"> 1352 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Specifies whether the calculation is done with the lower triangular</span><span class="r12">              </span> |
|<span class="r8"> 1353 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        part of `a` (&#x27;L&#x27;, default) or the upper triangular part (&#x27;U&#x27;).</span><span class="r12">                   </span> |
|<span class="r8"> 1354 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Irrespective of this value only the real parts of the diagonal will</span><span class="r12">              </span> |
|<span class="r8"> 1355 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        be considered in the computation to preserve the notion of a Hermitian</span><span class="r12">           </span> |
|<span class="r8"> 1356 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        matrix. It therefore follows that the imaginary part of the diagonal</span><span class="r12">             </span> |
|<span class="r8"> 1357 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        will always be treated as zero.</span><span class="r12">                                                  </span> |
|<span class="r8"> 1358 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1359 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1360 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1361 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    w : (..., M) ndarray</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1362 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The eigenvalues in ascending order, each repeated according to</span><span class="r12">                   </span> |
|<span class="r8"> 1363 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        its multiplicity.</span><span class="r12">                                                                </span> |
|<span class="r8"> 1364 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    v : {(..., M, M) ndarray, (..., M, M) matrix}</span><span class="r12">                                        </span> |
|<span class="r8"> 1365 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The column ``v[:, i]`` is the normalized eigenvector corresponding</span><span class="r12">               </span> |
|<span class="r8"> 1366 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        to the eigenvalue ``w[i]``.  Will return a matrix object if `a` is</span><span class="r12">               </span> |
|<span class="r8"> 1367 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        a matrix object.</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1368 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1369 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1370 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1371 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1372 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the eigenvalue computation does not converge.</span><span class="r12">                                 </span> |
|<span class="r8"> 1373 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1374 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1375 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1376 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigvalsh : eigenvalues of real symmetric or complex Hermitian</span><span class="r12">                        </span> |
|<span class="r8"> 1377 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">               (conjugate symmetric) arrays.</span><span class="r12">                                             </span> |
|<span class="r8"> 1378 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eig : eigenvalues and right eigenvectors for non-symmetric arrays.</span><span class="r12">                   </span> |
|<span class="r8"> 1379 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    eigvals : eigenvalues of non-symmetric arrays.</span><span class="r12">                                       </span> |
|<span class="r8"> 1380 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.eigh : Similar function in SciPy (but also solves the</span><span class="r12">                   </span> |
|<span class="r8"> 1381 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">                        generalized eigenvalue problem).</span><span class="r12">                                 </span> |
|<span class="r8"> 1382 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1383 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1384 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1385 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1386 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8"> 1387 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1388 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8"> 1389 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1390 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1391 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The eigenvalues/eigenvectors are computed using LAPACK routines ``_syevd``,</span><span class="r12">          </span> |
|<span class="r8"> 1392 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``_heevd``.</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1393 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1394 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The eigenvalues of real symmetric or complex Hermitian matrices are</span><span class="r12">                  </span> |
|<span class="r8"> 1395 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    always real. [1]_ The array `v` of (column) eigenvectors is unitary</span><span class="r12">                  </span> |
|<span class="r8"> 1396 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    and `a`, `w`, and `v` satisfy the equations</span><span class="r12">                                          </span> |
|<span class="r8"> 1397 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``dot(a, v[:, i]) = w[i] * v[:, i]``.</span><span class="r12">                                                </span> |
|<span class="r8"> 1398 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1399 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1400 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1401 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [1] G. Strang, *Linear Algebra and Its Applications*, 2nd Ed., Orlando,</span><span class="r12">           </span> |
|<span class="r8"> 1402 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           FL, Academic Press, Inc., 1980, pg. 222.</span><span class="r12">                                      </span> |
|<span class="r8"> 1403 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1404 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1405 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1406 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy import linalg as LA</span><span class="r12">                                                   </span> |
|<span class="r8"> 1407 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1, -2j], [2j, 5]])</span><span class="r12">                                                </span> |
|<span class="r8"> 1408 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1409 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 1.+0.j, -0.-2.j],</span><span class="r12">                                                           </span> |
|<span class="r8"> 1410 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.+2.j,  5.+0.j]])</span><span class="r12">                                                          </span> |
|<span class="r8"> 1411 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w, v = LA.eigh(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1412 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w; v</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1413 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([0.17157288, 5.82842712])</span><span class="r12">                                                      </span> |
|<span class="r8"> 1414 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[-0.92387953+0.j        , -0.38268343+0.j        ], # may vary</span><span class="r12">                </span> |
|<span class="r8"> 1415 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.        +0.38268343j,  0.        -0.92387953j]])</span><span class="r12">                          </span> |
|<span class="r8"> 1416 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1417 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.dot(a, v[:, 0]) - w[0] * v[:, 0] # verify 1st e-val/vec pair</span><span class="r12">                  </span> |
|<span class="r8"> 1418 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([5.55111512e-17+0.0000000e+00j, 0.00000000e+00+1.2490009e-16j])</span><span class="r12">                </span> |
|<span class="r8"> 1419 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.dot(a, v[:, 1]) - w[1] * v[:, 1] # verify 2nd e-val/vec pair</span><span class="r12">                  </span> |
|<span class="r8"> 1420 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([0.+0.j, 0.+0.j])</span><span class="r12">                                                              </span> |
|<span class="r8"> 1421 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1422 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = np.matrix(a) # what happens if input is a matrix object</span><span class="r12">                      </span> |
|<span class="r8"> 1423 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1424 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    matrix([[ 1.+0.j, -0.-2.j],</span><span class="r12">                                                          </span> |
|<span class="r8"> 1425 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            [ 0.+2.j,  5.+0.j]])</span><span class="r12">                                                         </span> |
|<span class="r8"> 1426 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w, v = LA.eigh(A)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1427 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; w; v</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1428 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([0.17157288, 5.82842712])</span><span class="r12">                                                      </span> |
|<span class="r8"> 1429 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    matrix([[-0.92387953+0.j        , -0.38268343+0.j        ], # may vary</span><span class="r12">               </span> |
|<span class="r8"> 1430 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            [ 0.        +0.38268343j,  0.        -0.92387953j]])</span><span class="r12">                         </span> |
|<span class="r8"> 1431 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1432 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # demonstrate the treatment of the imaginary part of the diagonal</span><span class="r12">                </span> |
|<span class="r8"> 1433 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[5+2j, 9-2j], [0+2j, 2-1j]])</span><span class="r12">                                       </span> |
|<span class="r8"> 1434 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1435 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[5.+2.j, 9.-2.j],</span><span class="r12">                                                             </span> |
|<span class="r8"> 1436 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.+2.j, 2.-1.j]])</span><span class="r12">                                                            </span> |
|<span class="r8"> 1437 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # with UPLO=&#x27;L&#x27; this is numerically equivalent to using LA.eig() with:</span><span class="r12">           </span> |
|<span class="r8"> 1438 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.array([[5.+0.j, 0.-2.j], [0.+2.j, 2.-0.j]])</span><span class="r12">                               </span> |
|<span class="r8"> 1439 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1440 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[5.+0.j, 0.-2.j],</span><span class="r12">                                                             </span> |
|<span class="r8"> 1441 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [0.+2.j, 2.+0.j]])</span><span class="r12">                                                            </span> |
|<span class="r8"> 1442 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; wa, va = LA.eigh(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1443 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; wb, vb = LA.eig(b)</span><span class="r12">                                                               </span> |
|<span class="r8"> 1444 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; wa; wb</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1445 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([1., 6.])</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1446 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([6.+0.j, 1.+0.j])</span><span class="r12">                                                              </span> |
|<span class="r8"> 1447 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; va; vb</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1448 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[-0.4472136 +0.j        , -0.89442719+0.j        ], # may vary</span><span class="r12">                </span> |
|<span class="r8"> 1449 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0.        +0.89442719j,  0.        -0.4472136j ]])</span><span class="r12">                          </span> |
|<span class="r8"> 1450 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 0.89442719+0.j       , -0.        +0.4472136j],</span><span class="r12">                             </span> |
|<span class="r8"> 1451 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [-0.        +0.4472136j,  0.89442719+0.j       ]])</span><span class="r12">                            </span> |
|<span class="r8"> 1452 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1453 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    UPLO </span><span class="r16">=</span><span class="r14"> UPLO</span><span class="r16">.</span><span class="r14">upper()</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1454 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> UPLO </span><span class="r22">not</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> (</span><span class="r17">&#x27;L&#x27;</span><span class="r14">, </span><span class="r17">&#x27;U&#x27;</span><span class="r14">):</span><span class="r12">                                                           </span> |
|<span class="r8"> 1455 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">&quot;UPLO argument must be &#x27;L&#x27; or &#x27;U&#x27;&quot;</span><span class="r14">)</span><span class="r12">                             </span> |
|<span class="r8"> 1456 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1457 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1458 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1459 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8"> 1460 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 1461 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1462 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(</span><span class="r12">                                                    </span> |
|<span class="r8"> 1463 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        _raise_linalgerror_eigenvalues_nonconvergence)</span><span class="r12">                                   </span> |
|<span class="r8"> 1464 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> UPLO </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;L&#x27;</span><span class="r14">:</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1465 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">eigh_lo</span><span class="r12">                                                   </span> |
|<span class="r8"> 1466 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1467 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">eigh_up</span><span class="r12">                                                   </span> |
|<span class="r8"> 1468 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1469 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;dD&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;dd&#x27;</span><span class="r12">                                 </span> |
|<span class="r8"> 1470 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    w, vt </span><span class="r16">=</span><span class="r14"> gufunc(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                                </span> |
|<span class="r8"> 1471 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    w </span><span class="r16">=</span><span class="r14"> w</span><span class="r16">.</span><span class="r14">astype(_realType(result_t), copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                        </span> |
|<span class="r8"> 1472 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    vt </span><span class="r16">=</span><span class="r14"> vt</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                                 </span> |
|<span class="r8"> 1473 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> w, wrap(vt)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1474 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1475 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1476 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Singular value decomposition</span><span class="r12">                                                           </span> |
|<span class="r8"> 1477 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1478 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_svd_dispatcher</span><span class="r14">(a, full_matrices</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, compute_uv</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">             </span> |
|<span class="r8"> 1479 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a,)</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1480 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1481 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1482 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_svd_dispatcher)</span><span class="r12">                                                </span> |
|<span class="r8"> 1483 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">svd</span><span class="r14">(a, full_matrices</span><span class="r16">=</span><span class="r13">True</span><span class="r14">, compute_uv</span><span class="r16">=</span><span class="r13">True</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r13">False</span><span class="r14">):</span><span class="r12">                        </span> |
|<span class="r8"> 1484 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1485 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Singular Value Decomposition.</span><span class="r12">                                                        </span> |
|<span class="r8"> 1486 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1487 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    When `a` is a 2D array, it is factorized as ``u @ np.diag(s) @ vh</span><span class="r12">                    </span> |
|<span class="r8"> 1488 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    = (u * s) @ vh``, where `u` and `vh` are 2D unitary arrays and `s` is a 1D</span><span class="r12">           </span> |
|<span class="r8"> 1489 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array of `a`&#x27;s singular values. When `a` is higher-dimensional, SVD is</span><span class="r12">               </span> |
|<span class="r8"> 1490 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    applied in stacked mode as explained below.</span><span class="r12">                                          </span> |
|<span class="r8"> 1491 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1492 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1493 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1494 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, N) array_like</span><span class="r12">                                                           </span> |
|<span class="r8"> 1495 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        A real or complex array with ``a.ndim &gt;= 2``.</span><span class="r12">                                    </span> |
|<span class="r8"> 1496 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    full_matrices : bool, optional</span><span class="r12">                                                       </span> |
|<span class="r8"> 1497 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If True (default), `u` and `vh` have the shapes ``(..., M, M)`` and</span><span class="r12">              </span> |
|<span class="r8"> 1498 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``(..., N, N)``, respectively.  Otherwise, the shapes are</span><span class="r12">                        </span> |
|<span class="r8"> 1499 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``(..., M, K)`` and ``(..., K, N)``, respectively, where</span><span class="r12">                         </span> |
|<span class="r8"> 1500 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``K = min(M, N)``.</span><span class="r12">                                                               </span> |
|<span class="r8"> 1501 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    compute_uv : bool, optional</span><span class="r12">                                                          </span> |
|<span class="r8"> 1502 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Whether or not to compute `u` and `vh` in addition to `s`.  True</span><span class="r12">                 </span> |
|<span class="r8"> 1503 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        by default.</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1504 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    hermitian : bool, optional</span><span class="r12">                                                           </span> |
|<span class="r8"> 1505 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If True, `a` is assumed to be Hermitian (symmetric if real-valued),</span><span class="r12">              </span> |
|<span class="r8"> 1506 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        enabling a more efficient method for finding singular values.</span><span class="r12">                    </span> |
|<span class="r8"> 1507 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Defaults to False.</span><span class="r12">                                                               </span> |
|<span class="r8"> 1508 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1509 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionadded:: 1.17.0</span><span class="r12">                                                         </span> |
|<span class="r8"> 1510 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1511 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1512 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1513 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    u : { (..., M, M), (..., M, K) } array</span><span class="r12">                                               </span> |
|<span class="r8"> 1514 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Unitary array(s). The first ``a.ndim - 2`` dimensions have the same</span><span class="r12">              </span> |
|<span class="r8"> 1515 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        size as those of the input `a`. The size of the last two dimensions</span><span class="r12">              </span> |
|<span class="r8"> 1516 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        depends on the value of `full_matrices`. Only returned when</span><span class="r12">                      </span> |
|<span class="r8"> 1517 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        `compute_uv` is True.</span><span class="r12">                                                            </span> |
|<span class="r8"> 1518 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    s : (..., K) array</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1519 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Vector(s) with the singular values, within each vector sorted in</span><span class="r12">                 </span> |
|<span class="r8"> 1520 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        descending order. The first ``a.ndim - 2`` dimensions have the same</span><span class="r12">              </span> |
|<span class="r8"> 1521 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        size as those of the input `a`.</span><span class="r12">                                                  </span> |
|<span class="r8"> 1522 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    vh : { (..., N, N), (..., K, N) } array</span><span class="r12">                                              </span> |
|<span class="r8"> 1523 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Unitary array(s). The first ``a.ndim - 2`` dimensions have the same</span><span class="r12">              </span> |
|<span class="r8"> 1524 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        size as those of the input `a`. The size of the last two dimensions</span><span class="r12">              </span> |
|<span class="r8"> 1525 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        depends on the value of `full_matrices`. Only returned when</span><span class="r12">                      </span> |
|<span class="r8"> 1526 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        `compute_uv` is True.</span><span class="r12">                                                            </span> |
|<span class="r8"> 1527 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1528 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1529 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1530 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1531 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If SVD computation does not converge.</span><span class="r12">                                            </span> |
|<span class="r8"> 1532 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1533 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1534 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1535 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.svd : Similar function in SciPy.</span><span class="r12">                                        </span> |
|<span class="r8"> 1536 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.svdvals : Compute singular values of a matrix.</span><span class="r12">                          </span> |
|<span class="r8"> 1537 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1538 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1539 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1540 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1541 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionchanged:: 1.8.0</span><span class="r12">                                                            </span> |
|<span class="r8"> 1542 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">       Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                </span> |
|<span class="r8"> 1543 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">       details.</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1544 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1545 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The decomposition is performed using LAPACK routine ``_gesdd``.</span><span class="r12">                      </span> |
|<span class="r8"> 1546 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1547 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    SVD is usually described for the factorization of a 2D matrix :math:`A`.</span><span class="r12">             </span> |
|<span class="r8"> 1548 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The higher-dimensional case will be discussed below. In the 2D case, SVD is</span><span class="r12">          </span> |
|<span class="r8"> 1549 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    written as :math:`A = U S V^H`, where :math:`A = a`, :math:`U= u`,</span><span class="r12">                   </span> |
|<span class="r8"> 1550 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    :math:`S= \\mathtt{np.diag}(s)` and :math:`V^H = vh`. The 1D array `s`</span><span class="r12">               </span> |
|<span class="r8"> 1551 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    contains the singular values of `a` and `u` and `vh` are unitary. The rows</span><span class="r12">           </span> |
|<span class="r8"> 1552 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of `vh` are the eigenvectors of :math:`A^H A` and the columns of `u` are</span><span class="r12">             </span> |
|<span class="r8"> 1553 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the eigenvectors of :math:`A A^H`. In both cases the corresponding</span><span class="r12">                   </span> |
|<span class="r8"> 1554 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (possibly non-zero) eigenvalues are given by ``s**2``.</span><span class="r12">                               </span> |
|<span class="r8"> 1555 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1556 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If `a` has more than two dimensions, then broadcasting rules apply, as</span><span class="r12">               </span> |
|<span class="r8"> 1557 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    explained in :ref:`routines.linalg-broadcasting`. This means that SVD is</span><span class="r12">             </span> |
|<span class="r8"> 1558 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    working in &quot;stacked&quot; mode: it iterates over all indices of the first</span><span class="r12">                 </span> |
|<span class="r8"> 1559 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``a.ndim - 2`` dimensions and for each combination SVD is applied to the</span><span class="r12">             </span> |
|<span class="r8"> 1560 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    last two indices. The matrix `a` can be reconstructed from the</span><span class="r12">                       </span> |
|<span class="r8"> 1561 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    decomposition with either ``(u * s[..., None, :]) @ vh`` or</span><span class="r12">                          </span> |
|<span class="r8"> 1562 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``u @ (s[..., None] * vh)``. (The ``@`` operator can be replaced by the</span><span class="r12">              </span> |
|<span class="r8"> 1563 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    function ``np.matmul`` for python versions below 3.5.)</span><span class="r12">                               </span> |
|<span class="r8"> 1564 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1565 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If `a` is a ``matrix`` object (as opposed to an ``ndarray``), then so are</span><span class="r12">            </span> |
|<span class="r8"> 1566 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    all the return values.</span><span class="r12">                                                               </span> |
|<span class="r8"> 1567 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1568 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1569 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1570 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.random.randn(9, 6) + 1j*np.random.randn(9, 6)</span><span class="r12">                             </span> |
|<span class="r8"> 1571 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = np.random.randn(2, 7, 8, 3) + 1j*np.random.randn(2, 7, 8, 3)</span><span class="r12">                 </span> |
|<span class="r8"> 1572 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1573 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Reconstruction based on full SVD, 2D case:</span><span class="r12">                                           </span> |
|<span class="r8"> 1574 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1575 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u, s, vh = np.linalg.svd(a, full_matrices=True)</span><span class="r12">                                  </span> |
|<span class="r8"> 1576 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u.shape, s.shape, vh.shape</span><span class="r12">                                                       </span> |
|<span class="r8"> 1577 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ((9, 9), (6,), (6, 6))</span><span class="r12">                                                               </span> |
|<span class="r8"> 1578 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(a, np.dot(u[:, :6] * s, vh))</span><span class="r12">                                         </span> |
|<span class="r8"> 1579 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1580 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; smat = np.zeros((9, 6), dtype=complex)</span><span class="r12">                                           </span> |
|<span class="r8"> 1581 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; smat[:6, :6] = np.diag(s)</span><span class="r12">                                                        </span> |
|<span class="r8"> 1582 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(a, np.dot(u, np.dot(smat, vh)))</span><span class="r12">                                      </span> |
|<span class="r8"> 1583 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1584 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1585 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Reconstruction based on reduced SVD, 2D case:</span><span class="r12">                                        </span> |
|<span class="r8"> 1586 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1587 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u, s, vh = np.linalg.svd(a, full_matrices=False)</span><span class="r12">                                 </span> |
|<span class="r8"> 1588 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u.shape, s.shape, vh.shape</span><span class="r12">                                                       </span> |
|<span class="r8"> 1589 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ((9, 6), (6,), (6, 6))</span><span class="r12">                                                               </span> |
|<span class="r8"> 1590 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(a, np.dot(u * s, vh))</span><span class="r12">                                                </span> |
|<span class="r8"> 1591 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1592 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; smat = np.diag(s)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1593 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(a, np.dot(u, np.dot(smat, vh)))</span><span class="r12">                                      </span> |
|<span class="r8"> 1594 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1595 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1596 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Reconstruction based on full SVD, 4D case:</span><span class="r12">                                           </span> |
|<span class="r8"> 1597 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1598 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u, s, vh = np.linalg.svd(b, full_matrices=True)</span><span class="r12">                                  </span> |
|<span class="r8"> 1599 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u.shape, s.shape, vh.shape</span><span class="r12">                                                       </span> |
|<span class="r8"> 1600 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ((2, 7, 8, 8), (2, 7, 3), (2, 7, 3, 3))</span><span class="r12">                                              </span> |
|<span class="r8"> 1601 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(b, np.matmul(u[..., :3] * s[..., None, :], vh))</span><span class="r12">                      </span> |
|<span class="r8"> 1602 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1603 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(b, np.matmul(u[..., :3], s[..., None] * vh))</span><span class="r12">                         </span> |
|<span class="r8"> 1604 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1605 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1606 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Reconstruction based on reduced SVD, 4D case:</span><span class="r12">                                        </span> |
|<span class="r8"> 1607 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1608 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u, s, vh = np.linalg.svd(b, full_matrices=False)</span><span class="r12">                                 </span> |
|<span class="r8"> 1609 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; u.shape, s.shape, vh.shape</span><span class="r12">                                                       </span> |
|<span class="r8"> 1610 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ((2, 7, 8, 3), (2, 7, 3), (2, 7, 3, 3))</span><span class="r12">                                              </span> |
|<span class="r8"> 1611 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(b, np.matmul(u * s[..., None, :], vh))</span><span class="r12">                               </span> |
|<span class="r8"> 1612 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1613 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(b, np.matmul(u, s[..., None] * vh))</span><span class="r12">                                  </span> |
|<span class="r8"> 1614 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1615 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1616 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1617 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">import</span><span class="r14"> </span><span class="r15">numpy</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> </span><span class="r15">_nx</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1618 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1619 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1620 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> hermitian:</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1621 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># note: lapack svd returns eigenvalues with s ** 2 sorted descending,</span><span class="r12">            </span> |
|<span class="r8"> 1622 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># but eig returns s sorted ascending, so we re-order the eigenvalues</span><span class="r12">             </span> |
|<span class="r8"> 1623 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># and related arrays to have the correct order</span><span class="r12">                                   </span> |
|<span class="r8"> 1624 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> compute_uv:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1625 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            s, u </span><span class="r16">=</span><span class="r14"> eigh(a)</span><span class="r12">                                                               </span> |
|<span class="r8"> 1626 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sgn </span><span class="r16">=</span><span class="r14"> sign(s)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1627 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            s </span><span class="r16">=</span><span class="r14"> </span><span class="r19">abs</span><span class="r14">(s)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1628 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sidx </span><span class="r16">=</span><span class="r14"> argsort(s)[</span><span class="r16">...</span><span class="r14">, ::</span><span class="r16">-1</span><span class="r14">]</span><span class="r12">                                                 </span> |
|<span class="r8"> 1629 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sgn </span><span class="r16">=</span><span class="r14"> _nx</span><span class="r16">.</span><span class="r14">take_along_axis(sgn, sidx, axis</span><span class="r16">=-1</span><span class="r14">)</span><span class="r12">                                </span> |
|<span class="r8"> 1630 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            s </span><span class="r16">=</span><span class="r14"> _nx</span><span class="r16">.</span><span class="r14">take_along_axis(s, sidx, axis</span><span class="r16">=-1</span><span class="r14">)</span><span class="r12">                                    </span> |
|<span class="r8"> 1631 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            u </span><span class="r16">=</span><span class="r14"> _nx</span><span class="r16">.</span><span class="r14">take_along_axis(u, sidx[</span><span class="r16">...</span><span class="r14">, </span><span class="r13">None</span><span class="r14">, :], axis</span><span class="r16">=-1</span><span class="r14">)</span><span class="r12">                      </span> |
|<span class="r8"> 1632 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># singular values are unsigned, move the sign into v</span><span class="r12">                         </span> |
|<span class="r8"> 1633 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            vt </span><span class="r16">=</span><span class="r14"> transpose(u </span><span class="r16">*</span><span class="r14"> sgn[</span><span class="r16">...</span><span class="r14">, </span><span class="r13">None</span><span class="r14">, :])</span><span class="r16">.</span><span class="r14">conjugate()</span><span class="r12">                            </span> |
|<span class="r8"> 1634 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> wrap(u), s, wrap(vt)</span><span class="r12">                                                  </span> |
|<span class="r8"> 1635 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 1636 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            s </span><span class="r16">=</span><span class="r14"> eigvalsh(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1637 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            s </span><span class="r16">=</span><span class="r14"> s[</span><span class="r16">...</span><span class="r14">, ::</span><span class="r16">-1</span><span class="r14">]</span><span class="r12">                                                             </span> |
|<span class="r8"> 1638 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            s </span><span class="r16">=</span><span class="r14"> </span><span class="r19">abs</span><span class="r14">(s)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1639 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> sort(s)[</span><span class="r16">...</span><span class="r14">, ::</span><span class="r16">-1</span><span class="r14">]</span><span class="r12">                                                    </span> |
|<span class="r8"> 1640 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1641 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1642 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 1643 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1644 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(_raise_linalgerror_svd_nonconvergence)</span><span class="r12">              </span> |
|<span class="r8"> 1645 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1646 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    m, n </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">:]</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1647 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> compute_uv:</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1648 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> full_matrices:</span><span class="r12">                                                                </span> |
|<span class="r8"> 1649 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> m </span><span class="r16">&lt;</span><span class="r14"> n:</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1650 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">svd_m_f</span><span class="r12">                                           </span> |
|<span class="r8"> 1651 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1652 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">svd_n_f</span><span class="r12">                                           </span> |
|<span class="r8"> 1653 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 1654 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> m </span><span class="r16">&lt;</span><span class="r14"> n:</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1655 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">svd_m_s</span><span class="r12">                                           </span> |
|<span class="r8"> 1656 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1657 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">svd_n_s</span><span class="r12">                                           </span> |
|<span class="r8"> 1658 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1659 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;DdD&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;ddd&#x27;</span><span class="r12">                           </span> |
|<span class="r8"> 1660 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        u, s, vh </span><span class="r16">=</span><span class="r14"> gufunc(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                         </span> |
|<span class="r8"> 1661 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        u </span><span class="r16">=</span><span class="r14"> u</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                               </span> |
|<span class="r8"> 1662 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        s </span><span class="r16">=</span><span class="r14"> s</span><span class="r16">.</span><span class="r14">astype(_realType(result_t), copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                    </span> |
|<span class="r8"> 1663 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        vh </span><span class="r16">=</span><span class="r14"> vh</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                             </span> |
|<span class="r8"> 1664 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> wrap(u), s, wrap(vh)</span><span class="r12">                                                      </span> |
|<span class="r8"> 1665 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1666 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> m </span><span class="r16">&lt;</span><span class="r14"> n:</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1667 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">svd_m</span><span class="r12">                                                 </span> |
|<span class="r8"> 1668 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 1669 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">svd_n</span><span class="r12">                                                 </span> |
|<span class="r8"> 1670 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1671 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;d&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;d&#x27;</span><span class="r12">                               </span> |
|<span class="r8"> 1672 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        s </span><span class="r16">=</span><span class="r14"> gufunc(a, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">                                </span> |
|<span class="r8"> 1673 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        s </span><span class="r16">=</span><span class="r14"> s</span><span class="r16">.</span><span class="r14">astype(_realType(result_t), copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                    </span> |
|<span class="r8"> 1674 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> s</span><span class="r12">                                                                         </span> |
|<span class="r8"> 1675 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1676 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1677 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_cond_dispatcher</span><span class="r14">(x, p</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                         </span> |
|<span class="r8"> 1678 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (x,)</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1679 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1680 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1681 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_cond_dispatcher)</span><span class="r12">                                               </span> |
|<span class="r8"> 1682 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">cond</span><span class="r14">(x, p</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1683 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1684 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the condition number of a matrix.</span><span class="r12">                                            </span> |
|<span class="r8"> 1685 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1686 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This function is capable of returning the condition number using</span><span class="r12">                     </span> |
|<span class="r8"> 1687 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    one of seven different norms, depending on the value of `p` (see</span><span class="r12">                     </span> |
|<span class="r8"> 1688 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters below).</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1689 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1690 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1691 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1692 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    x : (..., M, N) array_like</span><span class="r12">                                                           </span> |
|<span class="r8"> 1693 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The matrix whose condition number is sought.</span><span class="r12">                                     </span> |
|<span class="r8"> 1694 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    p : {None, 1, -1, 2, -2, inf, -inf, &#x27;fro&#x27;}, optional</span><span class="r12">                                 </span> |
|<span class="r8"> 1695 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Order of the norm:</span><span class="r12">                                                               </span> |
|<span class="r8"> 1696 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1697 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        =====  ============================</span><span class="r12">                                              </span> |
|<span class="r8"> 1698 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        p      norm for matrices</span><span class="r12">                                                         </span> |
|<span class="r8"> 1699 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        =====  ============================</span><span class="r12">                                              </span> |
|<span class="r8"> 1700 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        None   2-norm, computed directly using the ``SVD``</span><span class="r12">                               </span> |
|<span class="r8"> 1701 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &#x27;fro&#x27;  Frobenius norm</span><span class="r12">                                                            </span> |
|<span class="r8"> 1702 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        inf    max(sum(abs(x), axis=1))</span><span class="r12">                                                  </span> |
|<span class="r8"> 1703 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        -inf   min(sum(abs(x), axis=1))</span><span class="r12">                                                  </span> |
|<span class="r8"> 1704 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        1      max(sum(abs(x), axis=0))</span><span class="r12">                                                  </span> |
|<span class="r8"> 1705 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        -1     min(sum(abs(x), axis=0))</span><span class="r12">                                                  </span> |
|<span class="r8"> 1706 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        2      2-norm (largest sing. value)</span><span class="r12">                                              </span> |
|<span class="r8"> 1707 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        -2     smallest singular value</span><span class="r12">                                                   </span> |
|<span class="r8"> 1708 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        =====  ============================</span><span class="r12">                                              </span> |
|<span class="r8"> 1709 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1710 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        inf means the numpy.inf object, and the Frobenius norm is</span><span class="r12">                        </span> |
|<span class="r8"> 1711 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        the root-of-sum-of-squares norm.</span><span class="r12">                                                 </span> |
|<span class="r8"> 1712 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1713 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1714 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1715 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    c : {float, inf}</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1716 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The condition number of the matrix. May be infinite.</span><span class="r12">                             </span> |
|<span class="r8"> 1717 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1718 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1719 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1720 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    numpy.linalg.norm</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1721 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1722 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1723 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1724 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The condition number of `x` is defined as the norm of `x` times the</span><span class="r12">                  </span> |
|<span class="r8"> 1725 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    norm of the inverse of `x` [1]_; the norm can be the usual L2-norm</span><span class="r12">                   </span> |
|<span class="r8"> 1726 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (root-of-sum-of-squares) or one of a number of other matrix norms.</span><span class="r12">                   </span> |
|<span class="r8"> 1727 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1728 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1729 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1730 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [1] G. Strang, *Linear Algebra and Its Applications*, Orlando, FL,</span><span class="r12">                </span> |
|<span class="r8"> 1731 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           Academic Press, Inc., 1980, pg. 285.</span><span class="r12">                                          </span> |
|<span class="r8"> 1732 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1733 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1734 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1735 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy import linalg as LA</span><span class="r12">                                                   </span> |
|<span class="r8"> 1736 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1, 0, -1], [0, 1, 0], [1, 0, 1]])</span><span class="r12">                                 </span> |
|<span class="r8"> 1737 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1738 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 1,  0, -1],</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1739 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 0,  1,  0],</span><span class="r12">                                                                 </span> |
|<span class="r8"> 1740 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 1,  0,  1]])</span><span class="r12">                                                                </span> |
|<span class="r8"> 1741 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1742 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    1.4142135623730951</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1743 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a, &#x27;fro&#x27;)</span><span class="r12">                                                                </span> |
|<span class="r8"> 1744 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    3.1622776601683795</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1745 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a, np.inf)</span><span class="r12">                                                               </span> |
|<span class="r8"> 1746 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    2.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1747 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a, -np.inf)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1748 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    1.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1749 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a, 1)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1750 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    2.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1751 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a, -1)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1752 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    1.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1753 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a, 2)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1754 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    1.4142135623730951</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1755 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.cond(a, -2)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1756 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0.70710678118654746 # may vary</span><span class="r12">                                                       </span> |
|<span class="r8"> 1757 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; min(LA.svd(a, compute_uv=False))*min(LA.svd(LA.inv(a), compute_uv=False))</span><span class="r12">        </span> |
|<span class="r8"> 1758 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0.70710678118654746 # may vary</span><span class="r12">                                                       </span> |
|<span class="r8"> 1759 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1760 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1761 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    x </span><span class="r16">=</span><span class="r14"> asarray(x)  </span><span class="r21"># in case we have a matrix</span><span class="r12">                                           </span> |
|<span class="r8"> 1762 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> _is_empty_2d(x):</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1763 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&quot;cond is not defined on empty arrays&quot;</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8"> 1764 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> p </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14"> </span><span class="r22">or</span><span class="r14"> p </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14"> </span><span class="r22">or</span><span class="r14"> p </span><span class="r16">==</span><span class="r14"> </span><span class="r16">-2</span><span class="r14">:</span><span class="r12">                                                   </span> |
|<span class="r8"> 1765 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        s </span><span class="r16">=</span><span class="r14"> svd(x, compute_uv</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                                     </span> |
|<span class="r8"> 1766 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">with</span><span class="r14"> errstate(</span><span class="r19">all</span><span class="r16">=</span><span class="r17">&#x27;ignore&#x27;</span><span class="r14">):</span><span class="r12">                                                     </span> |
|<span class="r8"> 1767 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> p </span><span class="r16">==</span><span class="r14"> </span><span class="r16">-2</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1768 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                r </span><span class="r16">=</span><span class="r14"> s[</span><span class="r16">...</span><span class="r14">, </span><span class="r16">-1</span><span class="r14">] </span><span class="r16">/</span><span class="r14"> s[</span><span class="r16">...</span><span class="r14">, </span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                               </span> |
|<span class="r8"> 1769 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1770 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                r </span><span class="r16">=</span><span class="r14"> s[</span><span class="r16">...</span><span class="r14">, </span><span class="r16">0</span><span class="r14">] </span><span class="r16">/</span><span class="r14"> s[</span><span class="r16">...</span><span class="r14">, </span><span class="r16">-1</span><span class="r14">]</span><span class="r12">                                               </span> |
|<span class="r8"> 1771 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1772 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Call inv(x) ignoring errors. The result array will</span><span class="r12">                             </span> |
|<span class="r8"> 1773 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># contain nans in the entries where inversion failed.</span><span class="r12">                            </span> |
|<span class="r8"> 1774 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        _assert_stacked_2d(x)</span><span class="r12">                                                            </span> |
|<span class="r8"> 1775 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        _assert_stacked_square(x)</span><span class="r12">                                                        </span> |
|<span class="r8"> 1776 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(x)</span><span class="r12">                                                     </span> |
|<span class="r8"> 1777 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;D&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;d&#x27;</span><span class="r12">                               </span> |
|<span class="r8"> 1778 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">with</span><span class="r14"> errstate(</span><span class="r19">all</span><span class="r16">=</span><span class="r17">&#x27;ignore&#x27;</span><span class="r14">):</span><span class="r12">                                                     </span> |
|<span class="r8"> 1779 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            invx </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">inv(x, signature</span><span class="r16">=</span><span class="r14">signature)</span><span class="r12">                             </span> |
|<span class="r8"> 1780 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            r </span><span class="r16">=</span><span class="r14"> norm(x, p, axis</span><span class="r16">=</span><span class="r14">(</span><span class="r16">-2</span><span class="r14">, </span><span class="r16">-1</span><span class="r14">)) </span><span class="r16">*</span><span class="r14"> norm(invx, p, axis</span><span class="r16">=</span><span class="r14">(</span><span class="r16">-2</span><span class="r14">, </span><span class="r16">-1</span><span class="r14">))</span><span class="r12">                 </span> |
|<span class="r8"> 1781 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        r </span><span class="r16">=</span><span class="r14"> r</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                               </span> |
|<span class="r8"> 1782 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1783 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Convert nans to infs unless the original array had nan entries</span><span class="r12">                     </span> |
|<span class="r8"> 1784 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    r </span><span class="r16">=</span><span class="r14"> asarray(r)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1785 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    nan_mask </span><span class="r16">=</span><span class="r14"> isnan(r)</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1786 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> nan_mask</span><span class="r16">.</span><span class="r14">any():</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1787 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        nan_mask </span><span class="r16">&amp;=</span><span class="r14"> </span><span class="r16">~</span><span class="r14">isnan(x)</span><span class="r16">.</span><span class="r14">any(axis</span><span class="r16">=</span><span class="r14">(</span><span class="r16">-2</span><span class="r14">, </span><span class="r16">-1</span><span class="r14">))</span><span class="r12">                                         </span> |
|<span class="r8"> 1788 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> r</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1789 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            r[nan_mask] </span><span class="r16">=</span><span class="r14"> Inf</span><span class="r12">                                                            </span> |
|<span class="r8"> 1790 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> nan_mask:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1791 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            r[()] </span><span class="r16">=</span><span class="r14"> Inf</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1792 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1793 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Convention is to return scalars instead of 0d arrays</span><span class="r12">                               </span> |
|<span class="r8"> 1794 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> r</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1795 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        r </span><span class="r16">=</span><span class="r14"> r[()]</span><span class="r12">                                                                        </span> |
|<span class="r8"> 1796 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1797 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> r</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1798 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1799 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1800 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_matrix_rank_dispatcher</span><span class="r14">(M, tol</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                </span> |
|<span class="r8"> 1801 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (M,)</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1802 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1803 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1804 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_matrix_rank_dispatcher)</span><span class="r12">                                        </span> |
|<span class="r8"> 1805 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">matrix_rank</span><span class="r14">(M, tol</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r13">False</span><span class="r14">):</span><span class="r12">                                           </span> |
|<span class="r8"> 1806 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1807 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Return matrix rank of array using SVD method</span><span class="r12">                                         </span> |
|<span class="r8"> 1808 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1809 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Rank of the array is the number of singular values of the array that are</span><span class="r12">             </span> |
|<span class="r8"> 1810 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    greater than `tol`.</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1811 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1812 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionchanged:: 1.14</span><span class="r12">                                                             </span> |
|<span class="r8"> 1813 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">       Can now operate on stacks of matrices</span><span class="r12">                                             </span> |
|<span class="r8"> 1814 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1815 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1816 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1817 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    M : {(M,), (..., M, N)} array_like</span><span class="r12">                                                   </span> |
|<span class="r8"> 1818 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Input vector or stack of matrices.</span><span class="r12">                                               </span> |
|<span class="r8"> 1819 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    tol : (...) array_like, float, optional</span><span class="r12">                                              </span> |
|<span class="r8"> 1820 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Threshold below which SVD values are considered zero. If `tol` is</span><span class="r12">                </span> |
|<span class="r8"> 1821 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        None, and ``S`` is an array with singular values for `M`, and</span><span class="r12">                    </span> |
|<span class="r8"> 1822 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``eps`` is the epsilon value for datatype of ``S``, then `tol` is</span><span class="r12">                </span> |
|<span class="r8"> 1823 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        set to ``S.max() * max(M.shape) * eps``.</span><span class="r12">                                         </span> |
|<span class="r8"> 1824 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1825 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionchanged:: 1.14</span><span class="r12">                                                         </span> |
|<span class="r8"> 1826 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           Broadcasted against the stack of matrices</span><span class="r12">                                     </span> |
|<span class="r8"> 1827 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    hermitian : bool, optional</span><span class="r12">                                                           </span> |
|<span class="r8"> 1828 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If True, `M` is assumed to be Hermitian (symmetric if real-valued),</span><span class="r12">              </span> |
|<span class="r8"> 1829 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        enabling a more efficient method for finding singular values.</span><span class="r12">                    </span> |
|<span class="r8"> 1830 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Defaults to False.</span><span class="r12">                                                               </span> |
|<span class="r8"> 1831 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1832 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionadded:: 1.14</span><span class="r12">                                                           </span> |
|<span class="r8"> 1833 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1834 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1835 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1836 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    rank : (...) array_like</span><span class="r12">                                                              </span> |
|<span class="r8"> 1837 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Rank of M.</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1838 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1839 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1840 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1841 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The default threshold to detect rank deficiency is a test on the magnitude</span><span class="r12">           </span> |
|<span class="r8"> 1842 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of the singular values of `M`.  By default, we identify singular values less</span><span class="r12">         </span> |
|<span class="r8"> 1843 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    than ``S.max() * max(M.shape) * eps`` as indicating rank deficiency (with</span><span class="r12">            </span> |
|<span class="r8"> 1844 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the symbols defined above). This is the algorithm MATLAB uses [1].  It also</span><span class="r12">          </span> |
|<span class="r8"> 1845 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    appears in *Numerical recipes* in the discussion of SVD solutions for linear</span><span class="r12">         </span> |
|<span class="r8"> 1846 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    least squares [2].</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1847 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1848 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This default threshold is designed to detect rank deficiency accounting for</span><span class="r12">          </span> |
|<span class="r8"> 1849 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the numerical errors of the SVD computation.  Imagine that there is a column</span><span class="r12">         </span> |
|<span class="r8"> 1850 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    in `M` that is an exact (in floating point) linear combination of other</span><span class="r12">              </span> |
|<span class="r8"> 1851 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    columns in `M`. Computing the SVD on `M` will not produce a singular value</span><span class="r12">           </span> |
|<span class="r8"> 1852 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    exactly equal to 0 in general: any difference of the smallest SVD value from</span><span class="r12">         </span> |
|<span class="r8"> 1853 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0 will be caused by numerical imprecision in the calculation of the SVD.</span><span class="r12">             </span> |
|<span class="r8"> 1854 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Our threshold for small SVD values takes this numerical imprecision into</span><span class="r12">             </span> |
|<span class="r8"> 1855 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    account, and the default threshold will detect such numerical rank</span><span class="r12">                   </span> |
|<span class="r8"> 1856 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    deficiency.  The threshold may declare a matrix `M` rank deficient even if</span><span class="r12">           </span> |
|<span class="r8"> 1857 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the linear combination of some columns of `M` is not exactly equal to</span><span class="r12">                </span> |
|<span class="r8"> 1858 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    another column of `M` but only numerically very close to another column of</span><span class="r12">           </span> |
|<span class="r8"> 1859 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `M`.</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1860 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1861 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    We chose our default threshold because it is in wide use.  Other thresholds</span><span class="r12">          </span> |
|<span class="r8"> 1862 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    are possible.  For example, elsewhere in the 2007 edition of *Numerical</span><span class="r12">              </span> |
|<span class="r8"> 1863 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    recipes* there is an alternative threshold of ``S.max() *</span><span class="r12">                            </span> |
|<span class="r8"> 1864 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    np.finfo(M.dtype).eps / 2. * np.sqrt(m + n + 1.)``. The authors describe</span><span class="r12">             </span> |
|<span class="r8"> 1865 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    this threshold as being based on &quot;expected roundoff error&quot; (p 71).</span><span class="r12">                   </span> |
|<span class="r8"> 1866 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1867 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The thresholds above deal with floating point roundoff error in the</span><span class="r12">                  </span> |
|<span class="r8"> 1868 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    calculation of the SVD.  However, you may have more information about the</span><span class="r12">            </span> |
|<span class="r8"> 1869 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    sources of error in `M` that would make you consider other tolerance values</span><span class="r12">          </span> |
|<span class="r8"> 1870 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    to detect *effective* rank deficiency.  The most useful measure of the</span><span class="r12">               </span> |
|<span class="r8"> 1871 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    tolerance depends on the operations you intend to use on your matrix.  For</span><span class="r12">           </span> |
|<span class="r8"> 1872 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    example, if your data come from uncertain measurements with uncertainties</span><span class="r12">            </span> |
|<span class="r8"> 1873 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    greater than floating point epsilon, choosing a tolerance near that</span><span class="r12">                  </span> |
|<span class="r8"> 1874 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    uncertainty may be preferable.  The tolerance may be absolute if the</span><span class="r12">                 </span> |
|<span class="r8"> 1875 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    uncertainties are absolute rather than relative.</span><span class="r12">                                     </span> |
|<span class="r8"> 1876 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1877 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1878 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1879 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [1] MATLAB reference documention, &quot;Rank&quot;</span><span class="r12">                                          </span> |
|<span class="r8"> 1880 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           https://www.mathworks.com/help/techdoc/ref/rank.html</span><span class="r12">                          </span> |
|<span class="r8"> 1881 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [2] W. H. Press, S. A. Teukolsky, W. T. Vetterling and B. P. Flannery,</span><span class="r12">            </span> |
|<span class="r8"> 1882 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           &quot;Numerical Recipes (3rd edition)&quot;, Cambridge University Press, 2007,</span><span class="r12">          </span> |
|<span class="r8"> 1883 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           page 795.</span><span class="r12">                                                                     </span> |
|<span class="r8"> 1884 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1885 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1886 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1887 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy.linalg import matrix_rank</span><span class="r12">                                             </span> |
|<span class="r8"> 1888 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_rank(np.eye(4)) # Full rank matrix</span><span class="r12">                                        </span> |
|<span class="r8"> 1889 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    4</span><span class="r12">                                                                                    </span> |
|<span class="r8"> 1890 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; I=np.eye(4); I[-1,-1] = 0. # rank deficient matrix</span><span class="r12">                               </span> |
|<span class="r8"> 1891 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_rank(I)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 1892 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    3</span><span class="r12">                                                                                    </span> |
|<span class="r8"> 1893 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_rank(np.ones((4,))) # 1 dimension - rank 1 unless all 0</span><span class="r12">                   </span> |
|<span class="r8"> 1894 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    1</span><span class="r12">                                                                                    </span> |
|<span class="r8"> 1895 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; matrix_rank(np.zeros((4,)))</span><span class="r12">                                                      </span> |
|<span class="r8"> 1896 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0</span><span class="r12">                                                                                    </span> |
|<span class="r8"> 1897 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1898 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    M </span><span class="r16">=</span><span class="r14"> asarray(M)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1899 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> M</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                       </span> |
|<span class="r8"> 1900 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(</span><span class="r22">not</span><span class="r14"> </span><span class="r19">all</span><span class="r14">(M</span><span class="r16">==0</span><span class="r14">))</span><span class="r12">                                                        </span> |
|<span class="r8"> 1901 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    S </span><span class="r16">=</span><span class="r14"> svd(M, compute_uv</span><span class="r16">=</span><span class="r13">False</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r14">hermitian)</span><span class="r12">                                    </span> |
|<span class="r8"> 1902 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> tol </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                      </span> |
|<span class="r8"> 1903 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        tol </span><span class="r16">=</span><span class="r14"> S</span><span class="r16">.</span><span class="r14">max(axis</span><span class="r16">=-1</span><span class="r14">, keepdims</span><span class="r16">=</span><span class="r13">True</span><span class="r14">) </span><span class="r16">*</span><span class="r14"> </span><span class="r19">max</span><span class="r14">(M</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">:]) </span><span class="r16">*</span><span class="r14"> finfo(S</span><span class="r16">.</span><span class="r14">dtype)</span><span class="r16">.</span><span class="r14">eps</span><span class="r12">     </span> |
|<span class="r8"> 1904 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1905 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        tol </span><span class="r16">=</span><span class="r14"> asarray(tol)[</span><span class="r16">...</span><span class="r14">, newaxis]</span><span class="r12">                                                 </span> |
|<span class="r8"> 1906 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> count_nonzero(S </span><span class="r16">&gt;</span><span class="r14"> tol, axis</span><span class="r16">=-1</span><span class="r14">)</span><span class="r12">                                               </span> |
|<span class="r8"> 1907 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1908 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1909 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Generalized inverse</span><span class="r12">                                                                    </span> |
|<span class="r8"> 1910 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1911 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_pinv_dispatcher</span><span class="r14">(a, rcond</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                     </span> |
|<span class="r8"> 1912 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a,)</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1913 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1914 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1915 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_pinv_dispatcher)</span><span class="r12">                                               </span> |
|<span class="r8"> 1916 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">pinv</span><span class="r14">(a, rcond</span><span class="r16">=1e-15</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r13">False</span><span class="r14">):</span><span class="r12">                                               </span> |
|<span class="r8"> 1917 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1918 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the (Moore-Penrose) pseudo-inverse of a matrix.</span><span class="r12">                              </span> |
|<span class="r8"> 1919 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1920 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Calculate the generalized inverse of a matrix using its</span><span class="r12">                              </span> |
|<span class="r8"> 1921 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    singular-value decomposition (SVD) and including all</span><span class="r12">                                 </span> |
|<span class="r8"> 1922 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    *large* singular values.</span><span class="r12">                                                             </span> |
|<span class="r8"> 1923 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1924 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionchanged:: 1.14</span><span class="r12">                                                             </span> |
|<span class="r8"> 1925 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">       Can now operate on stacks of matrices</span><span class="r12">                                             </span> |
|<span class="r8"> 1926 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1927 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1928 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1929 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, N) array_like</span><span class="r12">                                                           </span> |
|<span class="r8"> 1930 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Matrix or stack of matrices to be pseudo-inverted.</span><span class="r12">                               </span> |
|<span class="r8"> 1931 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    rcond : (...) array_like of float</span><span class="r12">                                                    </span> |
|<span class="r8"> 1932 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Cutoff for small singular values.</span><span class="r12">                                                </span> |
|<span class="r8"> 1933 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Singular values less than or equal to</span><span class="r12">                                            </span> |
|<span class="r8"> 1934 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``rcond * largest_singular_value`` are set to zero.</span><span class="r12">                              </span> |
|<span class="r8"> 1935 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Broadcasts against the stack of matrices.</span><span class="r12">                                        </span> |
|<span class="r8"> 1936 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    hermitian : bool, optional</span><span class="r12">                                                           </span> |
|<span class="r8"> 1937 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If True, `a` is assumed to be Hermitian (symmetric if real-valued),</span><span class="r12">              </span> |
|<span class="r8"> 1938 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        enabling a more efficient method for finding singular values.</span><span class="r12">                    </span> |
|<span class="r8"> 1939 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Defaults to False.</span><span class="r12">                                                               </span> |
|<span class="r8"> 1940 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1941 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionadded:: 1.17.0</span><span class="r12">                                                         </span> |
|<span class="r8"> 1942 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1943 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1944 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 1945 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    B : (..., N, M) ndarray</span><span class="r12">                                                              </span> |
|<span class="r8"> 1946 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The pseudo-inverse of `a`. If `a` is a `matrix` instance, then so</span><span class="r12">                </span> |
|<span class="r8"> 1947 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        is `B`.</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1948 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1949 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1950 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8"> 1951 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8"> 1952 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the SVD computation does not converge.</span><span class="r12">                                        </span> |
|<span class="r8"> 1953 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1954 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1955 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1956 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.pinv : Similar function in SciPy.</span><span class="r12">                                       </span> |
|<span class="r8"> 1957 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.pinv2 : Similar function in SciPy (SVD-based).</span><span class="r12">                          </span> |
|<span class="r8"> 1958 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.pinvh : Compute the (Moore-Penrose) pseudo-inverse of a</span><span class="r12">                 </span> |
|<span class="r8"> 1959 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">                         Hermitian matrix.</span><span class="r12">                                               </span> |
|<span class="r8"> 1960 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1961 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1962 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 1963 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The pseudo-inverse of a matrix A, denoted :math:`A^+`, is</span><span class="r12">                            </span> |
|<span class="r8"> 1964 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    defined as: &quot;the matrix that &#x27;solves&#x27; [the least-squares problem]</span><span class="r12">                    </span> |
|<span class="r8"> 1965 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    :math:`Ax = b`,&quot; i.e., if :math:`\\bar{x}` is said solution, then</span><span class="r12">                    </span> |
|<span class="r8"> 1966 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    :math:`A^+` is that matrix such that :math:`\\bar{x} = A^+b`.</span><span class="r12">                        </span> |
|<span class="r8"> 1967 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1968 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    It can be shown that if :math:`Q_1 \\Sigma Q_2^T = A` is the singular</span><span class="r12">                </span> |
|<span class="r8"> 1969 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    value decomposition of A, then</span><span class="r12">                                                       </span> |
|<span class="r8"> 1970 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    :math:`A^+ = Q_2 \\Sigma^+ Q_1^T`, where :math:`Q_{1,2}` are</span><span class="r12">                         </span> |
|<span class="r8"> 1971 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    orthogonal matrices, :math:`\\Sigma` is a diagonal matrix consisting</span><span class="r12">                 </span> |
|<span class="r8"> 1972 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of A&#x27;s so-called singular values, (followed, typically, by</span><span class="r12">                           </span> |
|<span class="r8"> 1973 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    zeros), and then :math:`\\Sigma^+` is simply the diagonal matrix</span><span class="r12">                     </span> |
|<span class="r8"> 1974 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    consisting of the reciprocals of A&#x27;s singular values</span><span class="r12">                                 </span> |
|<span class="r8"> 1975 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (again, followed by zeros). [1]_</span><span class="r12">                                                     </span> |
|<span class="r8"> 1976 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1977 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1978 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 1979 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [1] G. Strang, *Linear Algebra and Its Applications*, 2nd Ed., Orlando,</span><span class="r12">           </span> |
|<span class="r8"> 1980 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           FL, Academic Press, Inc., 1980, pp. 139-142.</span><span class="r12">                                  </span> |
|<span class="r8"> 1981 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1982 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1983 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 1984 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The following example checks that ``a * a+ * a == a`` and</span><span class="r12">                            </span> |
|<span class="r8"> 1985 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``a+ * a * a+ == a+``:</span><span class="r12">                                                               </span> |
|<span class="r8"> 1986 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1987 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.random.randn(9, 6)</span><span class="r12">                                                        </span> |
|<span class="r8"> 1988 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; B = np.linalg.pinv(a)</span><span class="r12">                                                            </span> |
|<span class="r8"> 1989 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(a, np.dot(a, np.dot(B, a)))</span><span class="r12">                                          </span> |
|<span class="r8"> 1990 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1991 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.allclose(B, np.dot(B, np.dot(a, B)))</span><span class="r12">                                          </span> |
|<span class="r8"> 1992 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    True</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 1993 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 1994 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 1995 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, wrap </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                              </span> |
|<span class="r8"> 1996 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    rcond </span><span class="r16">=</span><span class="r14"> asarray(rcond)</span><span class="r12">                                                               </span> |
|<span class="r8"> 1997 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> _is_empty_2d(a):</span><span class="r12">                                                                  </span> |
|<span class="r8"> 1998 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        m, n </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">:]</span><span class="r12">                                                              </span> |
|<span class="r8"> 1999 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        res </span><span class="r16">=</span><span class="r14"> empty(a</span><span class="r16">.</span><span class="r14">shape[:</span><span class="r16">-2</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> (n, m), dtype</span><span class="r16">=</span><span class="r14">a</span><span class="r16">.</span><span class="r14">dtype)</span><span class="r12">                                </span> |
|<span class="r8"> 2000 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> wrap(res)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2001 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">conjugate()</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2002 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    u, s, vt </span><span class="r16">=</span><span class="r14"> svd(a, full_matrices</span><span class="r16">=</span><span class="r13">False</span><span class="r14">, hermitian</span><span class="r16">=</span><span class="r14">hermitian)</span><span class="r12">                          </span> |
|<span class="r8"> 2003 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2004 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># discard small singular values</span><span class="r12">                                                      </span> |
|<span class="r8"> 2005 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    cutoff </span><span class="r16">=</span><span class="r14"> rcond[</span><span class="r16">...</span><span class="r14">, newaxis] </span><span class="r16">*</span><span class="r14"> amax(s, axis</span><span class="r16">=-1</span><span class="r14">, keepdims</span><span class="r16">=</span><span class="r13">True</span><span class="r14">)</span><span class="r12">                       </span> |
|<span class="r8"> 2006 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    large </span><span class="r16">=</span><span class="r14"> s </span><span class="r16">&gt;</span><span class="r14"> cutoff</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2007 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    s </span><span class="r16">=</span><span class="r14"> divide(</span><span class="r16">1</span><span class="r14">, s, where</span><span class="r16">=</span><span class="r14">large, out</span><span class="r16">=</span><span class="r14">s)</span><span class="r12">                                                 </span> |
|<span class="r8"> 2008 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    s[</span><span class="r16">~</span><span class="r14">large] </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                        </span> |
|<span class="r8"> 2009 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2010 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    res </span><span class="r16">=</span><span class="r14"> matmul(transpose(vt), multiply(s[</span><span class="r16">...</span><span class="r14">, newaxis], transpose(u)))</span><span class="r12">                 </span> |
|<span class="r8"> 2011 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> wrap(res)</span><span class="r12">                                                                     </span> |
|<span class="r8"> 2012 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2013 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2014 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Determinant</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2015 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2016 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2017 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_unary_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8"> 2018 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">slogdet</span><span class="r14">(a):</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2019 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2020 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the sign and (natural) logarithm of the determinant of an array.</span><span class="r12">             </span> |
|<span class="r8"> 2021 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2022 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If an array has a very small or very large determinant, then a call to</span><span class="r12">               </span> |
|<span class="r8"> 2023 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `det` may overflow or underflow. This routine is more robust against such</span><span class="r12">            </span> |
|<span class="r8"> 2024 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    issues, because it computes the logarithm of the determinant rather than</span><span class="r12">             </span> |
|<span class="r8"> 2025 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    the determinant itself.</span><span class="r12">                                                              </span> |
|<span class="r8"> 2026 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2027 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2028 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2029 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8"> 2030 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Input array, has to be a square 2-D array.</span><span class="r12">                                       </span> |
|<span class="r8"> 2031 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2032 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2033 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2034 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    sign : (...) array_like</span><span class="r12">                                                              </span> |
|<span class="r8"> 2035 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        A number representing the sign of the determinant. For a real matrix,</span><span class="r12">            </span> |
|<span class="r8"> 2036 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        this is 1, 0, or -1. For a complex matrix, this is a complex number</span><span class="r12">              </span> |
|<span class="r8"> 2037 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        with absolute value 1 (i.e., it is on the unit circle), or else 0.</span><span class="r12">               </span> |
|<span class="r8"> 2038 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    logdet : (...) array_like</span><span class="r12">                                                            </span> |
|<span class="r8"> 2039 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The natural log of the absolute value of the determinant.</span><span class="r12">                        </span> |
|<span class="r8"> 2040 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2041 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If the determinant is zero, then `sign` will be 0 and `logdet` will be</span><span class="r12">               </span> |
|<span class="r8"> 2042 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -Inf. In all cases, the determinant is equal to ``sign * np.exp(logdet)``.</span><span class="r12">           </span> |
|<span class="r8"> 2043 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2044 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2045 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2046 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    det</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2047 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2048 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2049 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2050 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2051 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8"> 2052 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2053 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8"> 2054 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2055 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2056 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.6.0</span><span class="r12">                                                              </span> |
|<span class="r8"> 2057 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2058 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The determinant is computed via LU factorization using the LAPACK</span><span class="r12">                    </span> |
|<span class="r8"> 2059 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    routine ``z/dgetrf``.</span><span class="r12">                                                                </span> |
|<span class="r8"> 2060 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2061 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2062 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2063 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2064 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The determinant of a 2-D array ``[[a, b], [c, d]]`` is ``ad - bc``:</span><span class="r12">                  </span> |
|<span class="r8"> 2065 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2066 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1, 2], [3, 4]])</span><span class="r12">                                                   </span> |
|<span class="r8"> 2067 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; (sign, logdet) = np.linalg.slogdet(a)</span><span class="r12">                                            </span> |
|<span class="r8"> 2068 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; (sign, logdet)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2069 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (-1, 0.69314718055994529) # may vary</span><span class="r12">                                                 </span> |
|<span class="r8"> 2070 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; sign * np.exp(logdet)</span><span class="r12">                                                            </span> |
|<span class="r8"> 2071 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -2.0</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 2072 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2073 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Computing log-determinants for a stack of matrices:</span><span class="r12">                                  </span> |
|<span class="r8"> 2074 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2075 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([ [[1, 2], [3, 4]], [[1, 2], [2, 1]], [[1, 3], [3, 1]] ])</span><span class="r12">           </span> |
|<span class="r8"> 2076 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a.shape</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2077 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (3, 2, 2)</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2078 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; sign, logdet = np.linalg.slogdet(a)</span><span class="r12">                                              </span> |
|<span class="r8"> 2079 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; (sign, logdet)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2080 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (array([-1., -1., -1.]), array([ 0.69314718,  1.09861229,  2.07944154]))</span><span class="r12">             </span> |
|<span class="r8"> 2081 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; sign * np.exp(logdet)</span><span class="r12">                                                            </span> |
|<span class="r8"> 2082 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([-2., -3., -8.])</span><span class="r12">                                                               </span> |
|<span class="r8"> 2083 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2084 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This routine succeeds where ordinary `det` does not:</span><span class="r12">                                 </span> |
|<span class="r8"> 2085 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2086 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.linalg.det(np.eye(500) * 0.1)</span><span class="r12">                                                 </span> |
|<span class="r8"> 2087 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2088 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.linalg.slogdet(np.eye(500) * 0.1)</span><span class="r12">                                             </span> |
|<span class="r8"> 2089 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (1, -1151.2925464970228)</span><span class="r12">                                                             </span> |
|<span class="r8"> 2090 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2091 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2092 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> asarray(a)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2093 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 2094 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8"> 2095 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 2096 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    real_t </span><span class="r16">=</span><span class="r14"> _realType(result_t)</span><span class="r12">                                                         </span> |
|<span class="r8"> 2097 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;Dd&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;dd&#x27;</span><span class="r12">                                 </span> |
|<span class="r8"> 2098 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    sign, logdet </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">slogdet(a, signature</span><span class="r16">=</span><span class="r14">signature)</span><span class="r12">                         </span> |
|<span class="r8"> 2099 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    sign </span><span class="r16">=</span><span class="r14"> sign</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                             </span> |
|<span class="r8"> 2100 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    logdet </span><span class="r16">=</span><span class="r14"> logdet</span><span class="r16">.</span><span class="r14">astype(real_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                           </span> |
|<span class="r8"> 2101 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> sign, logdet</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2102 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2103 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2104 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_unary_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8"> 2105 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">det</span><span class="r14">(a):</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2106 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2107 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the determinant of an array.</span><span class="r12">                                                 </span> |
|<span class="r8"> 2108 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2109 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2110 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2111 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (..., M, M) array_like</span><span class="r12">                                                           </span> |
|<span class="r8"> 2112 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Input array to compute determinants for.</span><span class="r12">                                         </span> |
|<span class="r8"> 2113 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2114 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2115 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2116 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    det : (...) array_like</span><span class="r12">                                                               </span> |
|<span class="r8"> 2117 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Determinant of `a`.</span><span class="r12">                                                              </span> |
|<span class="r8"> 2118 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2119 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2120 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2121 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    slogdet : Another way to represent the determinant, more suitable</span><span class="r12">                    </span> |
|<span class="r8"> 2122 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">      for large matrices where underflow/overflow may occur.</span><span class="r12">                             </span> |
|<span class="r8"> 2123 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.det : Similar function in SciPy.</span><span class="r12">                                        </span> |
|<span class="r8"> 2124 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2125 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2126 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2127 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2128 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. versionadded:: 1.8.0</span><span class="r12">                                                              </span> |
|<span class="r8"> 2129 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2130 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Broadcasting rules apply, see the `numpy.linalg` documentation for</span><span class="r12">                   </span> |
|<span class="r8"> 2131 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    details.</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2132 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2133 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The determinant is computed via LU factorization using the LAPACK</span><span class="r12">                    </span> |
|<span class="r8"> 2134 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    routine ``z/dgetrf``.</span><span class="r12">                                                                </span> |
|<span class="r8"> 2135 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2136 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2137 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2138 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The determinant of a 2-D array [[a, b], [c, d]] is ad - bc:</span><span class="r12">                          </span> |
|<span class="r8"> 2139 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2140 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([[1, 2], [3, 4]])</span><span class="r12">                                                   </span> |
|<span class="r8"> 2141 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.linalg.det(a)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2142 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -2.0 # may vary</span><span class="r12">                                                                      </span> |
|<span class="r8"> 2143 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2144 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Computing determinants for a stack of matrices:</span><span class="r12">                                      </span> |
|<span class="r8"> 2145 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2146 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.array([ [[1, 2], [3, 4]], [[1, 2], [2, 1]], [[1, 3], [3, 1]] ])</span><span class="r12">           </span> |
|<span class="r8"> 2147 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a.shape</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2148 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (3, 2, 2)</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2149 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; np.linalg.det(a)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2150 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([-2., -3., -8.])</span><span class="r12">                                                               </span> |
|<span class="r8"> 2151 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2152 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2153 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a </span><span class="r16">=</span><span class="r14"> asarray(a)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2154 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_2d(a)</span><span class="r12">                                                                </span> |
|<span class="r8"> 2155 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_stacked_square(a)</span><span class="r12">                                                            </span> |
|<span class="r8"> 2156 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a)</span><span class="r12">                                                         </span> |
|<span class="r8"> 2157 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;D-&gt;D&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;d-&gt;d&#x27;</span><span class="r12">                                   </span> |
|<span class="r8"> 2158 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    r </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">det(a, signature</span><span class="r16">=</span><span class="r14">signature)</span><span class="r12">                                        </span> |
|<span class="r8"> 2159 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    r </span><span class="r16">=</span><span class="r14"> r</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                                   </span> |
|<span class="r8"> 2160 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> r</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2161 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2162 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2163 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># Linear Least Squares</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2164 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2165 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_lstsq_dispatcher</span><span class="r14">(a, b, rcond</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                 </span> |
|<span class="r8"> 2166 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (a, b)</span><span class="r12">                                                                        </span> |
|<span class="r8"> 2167 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2168 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2169 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_lstsq_dispatcher)</span><span class="r12">                                              </span> |
|<span class="r8"> 2170 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">lstsq</span><span class="r14">(a, b, rcond</span><span class="r16">=</span><span class="r17">&quot;warn&quot;</span><span class="r14">):</span><span class="r12">                                                           </span> |
|<span class="r8"> 2171 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r17">r</span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 2172 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Return the least-squares solution to a linear matrix equation.</span><span class="r12">                       </span> |
|<span class="r8"> 2173 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2174 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Computes the vector x that approximatively solves the equation</span><span class="r12">                       </span> |
|<span class="r8"> 2175 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ``a @ x = b``. The equation may be under-, well-, or over-determined</span><span class="r12">                 </span> |
|<span class="r8"> 2176 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (i.e., the number of linearly independent rows of `a` can be less than,</span><span class="r12">              </span> |
|<span class="r8"> 2177 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    equal to, or greater than its number of linearly independent columns).</span><span class="r12">               </span> |
|<span class="r8"> 2178 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If `a` is square and of full rank, then `x` (but for round-off error)</span><span class="r12">                </span> |
|<span class="r8"> 2179 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    is the &quot;exact&quot; solution of the equation. Else, `x` minimizes the</span><span class="r12">                     </span> |
|<span class="r8"> 2180 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Euclidean 2-norm :math:`|| b - a x ||`.</span><span class="r12">                                              </span> |
|<span class="r8"> 2181 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2182 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2183 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2184 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    a : (M, N) array_like</span><span class="r12">                                                                </span> |
|<span class="r8"> 2185 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &quot;Coefficient&quot; matrix.</span><span class="r12">                                                            </span> |
|<span class="r8"> 2186 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    b : {(M,), (M, K)} array_like</span><span class="r12">                                                        </span> |
|<span class="r8"> 2187 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Ordinate or &quot;dependent variable&quot; values. If `b` is two-dimensional,</span><span class="r12">              </span> |
|<span class="r8"> 2188 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        the least-squares solution is calculated for each of the `K` columns</span><span class="r12">             </span> |
|<span class="r8"> 2189 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        of `b`.</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2190 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    rcond : float, optional</span><span class="r12">                                                              </span> |
|<span class="r8"> 2191 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Cut-off ratio for small singular values of `a`.</span><span class="r12">                                  </span> |
|<span class="r8"> 2192 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        For the purposes of rank determination, singular values are treated</span><span class="r12">              </span> |
|<span class="r8"> 2193 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        as zero if they are smaller than `rcond` times the largest singular</span><span class="r12">              </span> |
|<span class="r8"> 2194 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        value of `a`.</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2195 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2196 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionchanged:: 1.14.0</span><span class="r12">                                                       </span> |
|<span class="r8"> 2197 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           If not set, a FutureWarning is given. The previous default</span><span class="r12">                    </span> |
|<span class="r8"> 2198 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           of ``-1`` will use the machine precision as `rcond` parameter,</span><span class="r12">                </span> |
|<span class="r8"> 2199 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           the new default will use the machine precision times `max(M, N)`.</span><span class="r12">             </span> |
|<span class="r8"> 2200 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           To silence the warning and use the new default, use ``rcond=None``,</span><span class="r12">           </span> |
|<span class="r8"> 2201 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           to keep using the old behavior, use ``rcond=-1``.</span><span class="r12">                             </span> |
|<span class="r8"> 2202 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2203 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2204 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2205 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    x : {(N,), (N, K)} ndarray</span><span class="r12">                                                           </span> |
|<span class="r8"> 2206 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Least-squares solution. If `b` is two-dimensional,</span><span class="r12">                               </span> |
|<span class="r8"> 2207 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        the solutions are in the `K` columns of `x`.</span><span class="r12">                                     </span> |
|<span class="r8"> 2208 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    residuals : {(1,), (K,), (0,)} ndarray</span><span class="r12">                                               </span> |
|<span class="r8"> 2209 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Sums of squared residuals: Squared Euclidean 2-norm for each column in</span><span class="r12">           </span> |
|<span class="r8"> 2210 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``b - a @ x``.</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2211 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the rank of `a` is &lt; N or M &lt;= N, this is an empty array.</span><span class="r12">                     </span> |
|<span class="r8"> 2212 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If `b` is 1-dimensional, this is a (1,) shape array.</span><span class="r12">                             </span> |
|<span class="r8"> 2213 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Otherwise the shape is (K,).</span><span class="r12">                                                     </span> |
|<span class="r8"> 2214 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    rank : int</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2215 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Rank of matrix `a`.</span><span class="r12">                                                              </span> |
|<span class="r8"> 2216 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    s : (min(M, N),) ndarray</span><span class="r12">                                                             </span> |
|<span class="r8"> 2217 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Singular values of `a`.</span><span class="r12">                                                          </span> |
|<span class="r8"> 2218 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2219 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Raises</span><span class="r12">                                                                               </span> |
|<span class="r8"> 2220 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ------</span><span class="r12">                                                                               </span> |
|<span class="r8"> 2221 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    LinAlgError</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2222 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If computation does not converge.</span><span class="r12">                                                </span> |
|<span class="r8"> 2223 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2224 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2225 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2226 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.lstsq : Similar function in SciPy.</span><span class="r12">                                      </span> |
|<span class="r8"> 2227 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2228 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2229 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2230 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If `b` is a matrix, then all array results are returned as matrices.</span><span class="r12">                 </span> |
|<span class="r8"> 2231 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2232 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2233 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2234 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Fit a line, ``y = mx + c``, through some noisy data-points:</span><span class="r12">                          </span> |
|<span class="r8"> 2235 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2236 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; x = np.array([0, 1, 2, 3])</span><span class="r12">                                                       </span> |
|<span class="r8"> 2237 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; y = np.array([-1, 0.2, 0.9, 2.1])</span><span class="r12">                                                </span> |
|<span class="r8"> 2238 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2239 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    By examining the coefficients, we see that the line should have a</span><span class="r12">                    </span> |
|<span class="r8"> 2240 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    gradient of roughly 1 and cut the y-axis at, more or less, -1.</span><span class="r12">                       </span> |
|<span class="r8"> 2241 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2242 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    We can rewrite the line equation as ``y = Ap``, where ``A = [[x 1]]``</span><span class="r12">                </span> |
|<span class="r8"> 2243 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    and ``p = [[m], [c]]``.  Now use `lstsq` to solve for `p`:</span><span class="r12">                           </span> |
|<span class="r8"> 2244 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2245 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = np.vstack([x, np.ones(len(x))]).T</span><span class="r12">                                            </span> |
|<span class="r8"> 2246 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2247 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[ 0.,  1.],</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2248 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 1.,  1.],</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2249 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 2.,  1.],</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2250 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 3.,  1.]])</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2251 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2252 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; m, c = np.linalg.lstsq(A, y, rcond=None)[0]</span><span class="r12">                                      </span> |
|<span class="r8"> 2253 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; m, c</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2254 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (1.0 -0.95) # may vary</span><span class="r12">                                                               </span> |
|<span class="r8"> 2255 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2256 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Plot the data along with the fitted line:</span><span class="r12">                                            </span> |
|<span class="r8"> 2257 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2258 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span><span class="r12">                                                  </span> |
|<span class="r8"> 2259 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; _ = plt.plot(x, y, &#x27;o&#x27;, label=&#x27;Original data&#x27;, markersize=10)</span><span class="r12">                    </span> |
|<span class="r8"> 2260 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; _ = plt.plot(x, m*x + c, &#x27;r&#x27;, label=&#x27;Fitted line&#x27;)</span><span class="r12">                               </span> |
|<span class="r8"> 2261 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; _ = plt.legend()</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2262 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; plt.show()</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2263 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2264 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2265 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a, _ </span><span class="r16">=</span><span class="r14"> _makearray(a)</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2266 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    b, wrap </span><span class="r16">=</span><span class="r14"> _makearray(b)</span><span class="r12">                                                              </span> |
|<span class="r8"> 2267 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    is_1d </span><span class="r16">=</span><span class="r14"> b</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2268 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> is_1d:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2269 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        b </span><span class="r16">=</span><span class="r14"> b[:, newaxis]</span><span class="r12">                                                                </span> |
|<span class="r8"> 2270 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_2d(a, b)</span><span class="r12">                                                                     </span> |
|<span class="r8"> 2271 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    m, n </span><span class="r16">=</span><span class="r14"> a</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">:]</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2272 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    m2, n_rhs </span><span class="r16">=</span><span class="r14"> b</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">-2</span><span class="r14">:]</span><span class="r12">                                                             </span> |
|<span class="r8"> 2273 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> m </span><span class="r16">!=</span><span class="r14"> m2:</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2274 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> LinAlgError(</span><span class="r17">&#x27;Incompatible dimensions&#x27;</span><span class="r14">)</span><span class="r12">                                     </span> |
|<span class="r8"> 2275 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2276 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    t, result_t </span><span class="r16">=</span><span class="r14"> _commonType(a, b)</span><span class="r12">                                                      </span> |
|<span class="r8"> 2277 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># FIXME: real_t is unused</span><span class="r12">                                                            </span> |
|<span class="r8"> 2278 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    real_t </span><span class="r16">=</span><span class="r14"> _linalgRealType(t)</span><span class="r12">                                                          </span> |
|<span class="r8"> 2279 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    result_real_t </span><span class="r16">=</span><span class="r14"> _realType(result_t)</span><span class="r12">                                                  </span> |
|<span class="r8"> 2280 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2281 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Determine default rcond value</span><span class="r12">                                                      </span> |
|<span class="r8"> 2282 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> rcond </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;warn&quot;</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2283 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># 2017-08-19, 1.14.0</span><span class="r12">                                                             </span> |
|<span class="r8"> 2284 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        warnings</span><span class="r16">.</span><span class="r14">warn(</span><span class="r17">&quot;`rcond` parameter will change to the default of &quot;</span><span class="r12">                 </span> |
|<span class="r8"> 2285 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      </span><span class="r17">&quot;machine precision times ``max(M, N)`` where M and N &quot;</span><span class="r12">             </span> |
|<span class="r8"> 2286 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      </span><span class="r17">&quot;are the input matrix dimensions.</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r12">                               </span> |
|<span class="r8"> 2287 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      </span><span class="r17">&quot;To use the future default and silence this warning &quot;</span><span class="r12">              </span> |
|<span class="r8"> 2288 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      </span><span class="r17">&quot;we advise to pass `rcond=None`, to keep using the old, &quot;</span><span class="r12">          </span> |
|<span class="r8"> 2289 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      </span><span class="r17">&quot;explicitly pass `rcond=-1`.&quot;</span><span class="r14">,</span><span class="r12">                                     </span> |
|<span class="r8"> 2290 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                      </span><span class="r24">FutureWarning</span><span class="r14">, stacklevel</span><span class="r16">=3</span><span class="r14">)</span><span class="r12">                                       </span> |
|<span class="r8"> 2291 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        rcond </span><span class="r16">=</span><span class="r14"> </span><span class="r16">-1</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2292 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> rcond </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2293 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        rcond </span><span class="r16">=</span><span class="r14"> finfo(t)</span><span class="r16">.</span><span class="r14">eps </span><span class="r16">*</span><span class="r14"> </span><span class="r19">max</span><span class="r14">(n, m)</span><span class="r12">                                                 </span> |
|<span class="r8"> 2294 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2295 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> m </span><span class="r16">&lt;=</span><span class="r14"> n:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2296 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">lstsq_m</span><span class="r12">                                                   </span> |
|<span class="r8"> 2297 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2298 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        gufunc </span><span class="r16">=</span><span class="r14"> _umath_linalg</span><span class="r16">.</span><span class="r14">lstsq_n</span><span class="r12">                                                   </span> |
|<span class="r8"> 2299 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2300 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    signature </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&#x27;DDd-&gt;Ddid&#x27;</span><span class="r14"> </span><span class="r13">if</span><span class="r14"> isComplexType(t) </span><span class="r13">else</span><span class="r14"> </span><span class="r17">&#x27;ddd-&gt;ddid&#x27;</span><span class="r12">                         </span> |
|<span class="r8"> 2301 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    extobj </span><span class="r16">=</span><span class="r14"> get_linalg_error_extobj(_raise_linalgerror_lstsq)</span><span class="r12">                           </span> |
|<span class="r8"> 2302 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> n_rhs </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2303 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># lapack can&#x27;t handle n_rhs = 0 - so allocate the array one larger in that axis</span><span class="r12">  </span> |
|<span class="r8"> 2304 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        b </span><span class="r16">=</span><span class="r14"> zeros(b</span><span class="r16">.</span><span class="r14">shape[:</span><span class="r16">-2</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> (m, n_rhs </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r14">), dtype</span><span class="r16">=</span><span class="r14">b</span><span class="r16">.</span><span class="r14">dtype)</span><span class="r12">                          </span> |
|<span class="r8"> 2305 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    x, resids, rank, s </span><span class="r16">=</span><span class="r14"> gufunc(a, b, rcond, signature</span><span class="r16">=</span><span class="r14">signature, extobj</span><span class="r16">=</span><span class="r14">extobj)</span><span class="r12">         </span> |
|<span class="r8"> 2306 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> m </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2307 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        x[</span><span class="r16">...</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2308 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> n_rhs </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2309 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># remove the item we added</span><span class="r12">                                                       </span> |
|<span class="r8"> 2310 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        x </span><span class="r16">=</span><span class="r14"> x[</span><span class="r16">...</span><span class="r14">, :n_rhs]</span><span class="r12">                                                               </span> |
|<span class="r8"> 2311 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        resids </span><span class="r16">=</span><span class="r14"> resids[</span><span class="r16">...</span><span class="r14">, :n_rhs]</span><span class="r12">                                                     </span> |
|<span class="r8"> 2312 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2313 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># remove the axis we added</span><span class="r12">                                                           </span> |
|<span class="r8"> 2314 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> is_1d:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2315 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        x </span><span class="r16">=</span><span class="r14"> x</span><span class="r16">.</span><span class="r14">squeeze(axis</span><span class="r16">=-1</span><span class="r14">)</span><span class="r12">                                                           </span> |
|<span class="r8"> 2316 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># we probably should squeeze resids too, but we can&#x27;t</span><span class="r12">                            </span> |
|<span class="r8"> 2317 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># without breaking compatibility.</span><span class="r12">                                                </span> |
|<span class="r8"> 2318 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2319 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># as documented</span><span class="r12">                                                                      </span> |
|<span class="r8"> 2320 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> rank </span><span class="r16">!=</span><span class="r14"> n </span><span class="r22">or</span><span class="r14"> m </span><span class="r16">&lt;=</span><span class="r14"> n:</span><span class="r12">                                                              </span> |
|<span class="r8"> 2321 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        resids </span><span class="r16">=</span><span class="r14"> array([], result_real_t)</span><span class="r12">                                                </span> |
|<span class="r8"> 2322 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2323 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># coerce output arrays</span><span class="r12">                                                               </span> |
|<span class="r8"> 2324 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    s </span><span class="r16">=</span><span class="r14"> s</span><span class="r16">.</span><span class="r14">astype(result_real_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                              </span> |
|<span class="r8"> 2325 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    resids </span><span class="r16">=</span><span class="r14"> resids</span><span class="r16">.</span><span class="r14">astype(result_real_t, copy</span><span class="r16">=</span><span class="r13">False</span><span class="r14">)</span><span class="r12">                                    </span> |
|<span class="r8"> 2326 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    x </span><span class="r16">=</span><span class="r14"> x</span><span class="r16">.</span><span class="r14">astype(result_t, copy</span><span class="r16">=</span><span class="r13">True</span><span class="r14">)  </span><span class="r21"># Copying lets the memory in r_parts be freed</span><span class="r12">     </span> |
|<span class="r8"> 2327 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> wrap(x), wrap(resids), rank, s</span><span class="r12">                                                </span> |
|<span class="r8"> 2328 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2329 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2330 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_multi_svd_norm</span><span class="r14">(x, row_axis, col_axis, op):</span><span class="r12">                                          </span> |
|<span class="r8"> 2331 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;Compute a function of the singular values of the 2-D matrices in `x`.</span><span class="r12">             </span> |
|<span class="r8"> 2332 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2333 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This is a private utility function used by `numpy.linalg.norm()`.</span><span class="r12">                    </span> |
|<span class="r8"> 2334 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2335 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2336 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2337 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    x : ndarray</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2338 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    row_axis, col_axis : int</span><span class="r12">                                                             </span> |
|<span class="r8"> 2339 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The axes of `x` that hold the 2-D matrices.</span><span class="r12">                                      </span> |
|<span class="r8"> 2340 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    op : callable</span><span class="r12">                                                                        </span> |
|<span class="r8"> 2341 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        This should be either numpy.amin or `numpy.amax` or `numpy.sum`.</span><span class="r12">                 </span> |
|<span class="r8"> 2342 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2343 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2344 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2345 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    result : float or ndarray</span><span class="r12">                                                            </span> |
|<span class="r8"> 2346 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If `x` is 2-D, the return values is a float.</span><span class="r12">                                     </span> |
|<span class="r8"> 2347 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Otherwise, it is an array with ``x.ndim - 2`` dimensions.</span><span class="r12">                        </span> |
|<span class="r8"> 2348 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The return values are either the minimum or maximum or sum of the</span><span class="r12">                </span> |
|<span class="r8"> 2349 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        singular values of the matrices, depending on whether `op`</span><span class="r12">                       </span> |
|<span class="r8"> 2350 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        is `numpy.amin` or `numpy.amax` or `numpy.sum`.</span><span class="r12">                                  </span> |
|<span class="r8"> 2351 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2352 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2353 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    y </span><span class="r16">=</span><span class="r14"> moveaxis(x, (row_axis, col_axis), (</span><span class="r16">-2</span><span class="r14">, </span><span class="r16">-1</span><span class="r14">))</span><span class="r12">                                      </span> |
|<span class="r8"> 2354 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    result </span><span class="r16">=</span><span class="r14"> op(svd(y, compute_uv</span><span class="r16">=</span><span class="r13">False</span><span class="r14">), axis</span><span class="r16">=-1</span><span class="r14">)</span><span class="r12">                                       </span> |
|<span class="r8"> 2355 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> result</span><span class="r12">                                                                        </span> |
|<span class="r8"> 2356 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2357 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2358 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_norm_dispatcher</span><span class="r14">(x, </span><span class="r19">ord</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, axis</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, keepdims</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                             </span> |
|<span class="r8"> 2359 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (x,)</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2360 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2361 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2362 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_norm_dispatcher)</span><span class="r12">                                               </span> |
|<span class="r8"> 2363 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">norm</span><span class="r14">(x, </span><span class="r19">ord</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, axis</span><span class="r16">=</span><span class="r13">None</span><span class="r14">, keepdims</span><span class="r16">=</span><span class="r13">False</span><span class="r14">):</span><span class="r12">                                        </span> |
|<span class="r8"> 2364 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2365 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Matrix or vector norm.</span><span class="r12">                                                               </span> |
|<span class="r8"> 2366 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2367 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    This function is able to return one of eight different matrix norms,</span><span class="r12">                 </span> |
|<span class="r8"> 2368 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    or one of an infinite number of vector norms (described below), depending</span><span class="r12">            </span> |
|<span class="r8"> 2369 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    on the value of the ``ord`` parameter.</span><span class="r12">                                               </span> |
|<span class="r8"> 2370 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2371 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2372 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2373 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    x : array_like</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2374 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Input array.  If `axis` is None, `x` must be 1-D or 2-D, unless `ord`</span><span class="r12">            </span> |
|<span class="r8"> 2375 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        is None. If both `axis` and `ord` are None, the 2-norm of</span><span class="r12">                        </span> |
|<span class="r8"> 2376 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        ``x.ravel`` will be returned.</span><span class="r12">                                                    </span> |
|<span class="r8"> 2377 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ord : {non-zero int, inf, -inf, &#x27;fro&#x27;, &#x27;nuc&#x27;}, optional</span><span class="r12">                              </span> |
|<span class="r8"> 2378 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Order of the norm (see table under ``Notes``). inf means numpy&#x27;s</span><span class="r12">                 </span> |
|<span class="r8"> 2379 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        `inf` object. The default is None.</span><span class="r12">                                               </span> |
|<span class="r8"> 2380 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    axis : {None, int, 2-tuple of ints}, optional.</span><span class="r12">                                       </span> |
|<span class="r8"> 2381 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If `axis` is an integer, it specifies the axis of `x` along which to</span><span class="r12">             </span> |
|<span class="r8"> 2382 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        compute the vector norms.  If `axis` is a 2-tuple, it specifies the</span><span class="r12">              </span> |
|<span class="r8"> 2383 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        axes that hold 2-D matrices, and the matrix norms of these matrices</span><span class="r12">              </span> |
|<span class="r8"> 2384 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        are computed.  If `axis` is None then either a vector norm (when `x`</span><span class="r12">             </span> |
|<span class="r8"> 2385 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        is 1-D) or a matrix norm (when `x` is 2-D) is returned. The default</span><span class="r12">              </span> |
|<span class="r8"> 2386 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        is None.</span><span class="r12">                                                                         </span> |
|<span class="r8"> 2387 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2388 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionadded:: 1.8.0</span><span class="r12">                                                          </span> |
|<span class="r8"> 2389 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2390 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    keepdims : bool, optional</span><span class="r12">                                                            </span> |
|<span class="r8"> 2391 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If this is set to True, the axes which are normed over are left in the</span><span class="r12">           </span> |
|<span class="r8"> 2392 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        result as dimensions with size one.  With this option the result will</span><span class="r12">            </span> |
|<span class="r8"> 2393 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        broadcast correctly against the original `x`.</span><span class="r12">                                    </span> |
|<span class="r8"> 2394 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2395 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionadded:: 1.10.0</span><span class="r12">                                                         </span> |
|<span class="r8"> 2396 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2397 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2398 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2399 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    n : float or ndarray</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2400 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Norm of the matrix or vector(s).</span><span class="r12">                                                 </span> |
|<span class="r8"> 2401 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2402 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2403 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2404 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    scipy.linalg.norm : Similar function in SciPy.</span><span class="r12">                                       </span> |
|<span class="r8"> 2405 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2406 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2407 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2408 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    For values of ``ord &lt; 1``, the result is, strictly speaking, not a</span><span class="r12">                   </span> |
|<span class="r8"> 2409 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    mathematical &#x27;norm&#x27;, but it may still be useful for various numerical</span><span class="r12">                </span> |
|<span class="r8"> 2410 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    purposes.</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2411 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2412 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The following norms can be calculated:</span><span class="r12">                                               </span> |
|<span class="r8"> 2413 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2414 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    =====  ============================  ==========================</span><span class="r12">                      </span> |
|<span class="r8"> 2415 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ord    norm for matrices             norm for vectors</span><span class="r12">                                </span> |
|<span class="r8"> 2416 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    =====  ============================  ==========================</span><span class="r12">                      </span> |
|<span class="r8"> 2417 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    None   Frobenius norm                2-norm</span><span class="r12">                                          </span> |
|<span class="r8"> 2418 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &#x27;fro&#x27;  Frobenius norm                --</span><span class="r12">                                              </span> |
|<span class="r8"> 2419 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &#x27;nuc&#x27;  nuclear norm                  --</span><span class="r12">                                              </span> |
|<span class="r8"> 2420 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    inf    max(sum(abs(x), axis=1))      max(abs(x))</span><span class="r12">                                     </span> |
|<span class="r8"> 2421 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -inf   min(sum(abs(x), axis=1))      min(abs(x))</span><span class="r12">                                     </span> |
|<span class="r8"> 2422 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0      --                            sum(x != 0)</span><span class="r12">                                     </span> |
|<span class="r8"> 2423 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    1      max(sum(abs(x), axis=0))      as below</span><span class="r12">                                        </span> |
|<span class="r8"> 2424 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -1     min(sum(abs(x), axis=0))      as below</span><span class="r12">                                        </span> |
|<span class="r8"> 2425 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    2      2-norm (largest sing. value)  as below</span><span class="r12">                                        </span> |
|<span class="r8"> 2426 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -2     smallest singular value       as below</span><span class="r12">                                        </span> |
|<span class="r8"> 2427 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    other  --                            sum(abs(x)**ord)**(1./ord)</span><span class="r12">                      </span> |
|<span class="r8"> 2428 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    =====  ============================  ==========================</span><span class="r12">                      </span> |
|<span class="r8"> 2429 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2430 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The Frobenius norm is given by [1]_:</span><span class="r12">                                                 </span> |
|<span class="r8"> 2431 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2432 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        :math:`||A||_F = [\\sum_{i,j} abs(a_{i,j})^2]^{1/2}`</span><span class="r12">                             </span> |
|<span class="r8"> 2433 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2434 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The nuclear norm is the sum of the singular values.</span><span class="r12">                                  </span> |
|<span class="r8"> 2435 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2436 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Both the Frobenius and nuclear norm orders are only defined for</span><span class="r12">                      </span> |
|<span class="r8"> 2437 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    matrices and raise a ValueError when ``x.ndim != 2``.</span><span class="r12">                                </span> |
|<span class="r8"> 2438 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2439 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2440 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2441 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [1] G. H. Golub and C. F. Van Loan, *Matrix Computations*,</span><span class="r12">                        </span> |
|<span class="r8"> 2442 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           Baltimore, MD, Johns Hopkins University Press, 1985, pg. 15</span><span class="r12">                   </span> |
|<span class="r8"> 2443 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2444 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2445 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2446 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy import linalg as LA</span><span class="r12">                                                   </span> |
|<span class="r8"> 2447 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a = np.arange(9) - 4</span><span class="r12">                                                             </span> |
|<span class="r8"> 2448 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; a</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2449 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([-4, -3, -2, ...,  2,  3,  4])</span><span class="r12">                                                 </span> |
|<span class="r8"> 2450 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b = a.reshape((3, 3))</span><span class="r12">                                                            </span> |
|<span class="r8"> 2451 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; b</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2452 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([[-4, -3, -2],</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2453 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [-1,  0,  1],</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2454 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">           [ 2,  3,  4]])</span><span class="r12">                                                                </span> |
|<span class="r8"> 2455 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2456 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2457 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    7.745966692414834</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2458 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2459 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    7.745966692414834</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2460 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b, &#x27;fro&#x27;)</span><span class="r12">                                                                </span> |
|<span class="r8"> 2461 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    7.745966692414834</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2462 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, np.inf)</span><span class="r12">                                                               </span> |
|<span class="r8"> 2463 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    4.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2464 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b, np.inf)</span><span class="r12">                                                               </span> |
|<span class="r8"> 2465 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    9.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2466 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, -np.inf)</span><span class="r12">                                                              </span> |
|<span class="r8"> 2467 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2468 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b, -np.inf)</span><span class="r12">                                                              </span> |
|<span class="r8"> 2469 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    2.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2470 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2471 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, 1)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2472 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    20.0</span><span class="r12">                                                                                 </span> |
|<span class="r8"> 2473 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b, 1)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2474 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    7.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2475 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, -1)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2476 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -4.6566128774142013e-010</span><span class="r12">                                                             </span> |
|<span class="r8"> 2477 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b, -1)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2478 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    6.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2479 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, 2)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2480 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    7.745966692414834</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2481 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b, 2)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2482 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    7.3484692283495345</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2483 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2484 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, -2)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2485 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2486 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(b, -2)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2487 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    1.8570331885190563e-016 # may vary</span><span class="r12">                                                   </span> |
|<span class="r8"> 2488 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, 3)</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2489 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    5.8480354764257312 # may vary</span><span class="r12">                                                        </span> |
|<span class="r8"> 2490 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(a, -3)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2491 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    0.0</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2492 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2493 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Using the `axis` argument to compute vector norms:</span><span class="r12">                                   </span> |
|<span class="r8"> 2494 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2495 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; c = np.array([[ 1, 2, 3],</span><span class="r12">                                                        </span> |
|<span class="r8"> 2496 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ...               [-1, 1, 4]])</span><span class="r12">                                                       </span> |
|<span class="r8"> 2497 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(c, axis=0)</span><span class="r12">                                                               </span> |
|<span class="r8"> 2498 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([ 1.41421356,  2.23606798,  5.        ])</span><span class="r12">                                       </span> |
|<span class="r8"> 2499 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(c, axis=1)</span><span class="r12">                                                               </span> |
|<span class="r8"> 2500 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([ 3.74165739,  4.24264069])</span><span class="r12">                                                    </span> |
|<span class="r8"> 2501 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(c, ord=1, axis=1)</span><span class="r12">                                                        </span> |
|<span class="r8"> 2502 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([ 6.,  6.])</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2503 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2504 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Using the `axis` argument to compute matrix norms:</span><span class="r12">                                   </span> |
|<span class="r8"> 2505 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2506 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; m = np.arange(8).reshape(2,2,2)</span><span class="r12">                                                  </span> |
|<span class="r8"> 2507 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(m, axis=(1,2))</span><span class="r12">                                                           </span> |
|<span class="r8"> 2508 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    array([  3.74165739,  11.22497216])</span><span class="r12">                                                  </span> |
|<span class="r8"> 2509 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; LA.norm(m[0, :, :]), LA.norm(m[1, :, :])</span><span class="r12">                                         </span> |
|<span class="r8"> 2510 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    (3.7416573867739413, 11.224972160321824)</span><span class="r12">                                             </span> |
|<span class="r8"> 2511 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2512 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2513 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    x </span><span class="r16">=</span><span class="r14"> asarray(x)</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2514 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2515 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r19">issubclass</span><span class="r14">(x</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">type, (inexact, object_)):</span><span class="r12">                                 </span> |
|<span class="r8"> 2516 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        x </span><span class="r16">=</span><span class="r14"> x</span><span class="r16">.</span><span class="r14">astype(</span><span class="r19">float</span><span class="r14">)</span><span class="r12">                                                              </span> |
|<span class="r8"> 2517 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2518 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Immediately handle some default, simple, fast, and common cases.</span><span class="r12">                   </span> |
|<span class="r8"> 2519 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> axis </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                     </span> |
|<span class="r8"> 2520 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ndim </span><span class="r16">=</span><span class="r14"> x</span><span class="r16">.</span><span class="r14">ndim</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2521 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> ((</span><span class="r19">ord</span><span class="r14"> </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14">) </span><span class="r22">or</span><span class="r12">                                                             </span> |
|<span class="r8"> 2522 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            (</span><span class="r19">ord</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> (</span><span class="r17">&#x27;f&#x27;</span><span class="r14">, </span><span class="r17">&#x27;fro&#x27;</span><span class="r14">) </span><span class="r22">and</span><span class="r14"> ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">) </span><span class="r22">or</span><span class="r12">                                       </span> |
|<span class="r8"> 2523 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            (</span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">)):</span><span class="r12">                                                   </span> |
|<span class="r8"> 2524 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2525 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            x </span><span class="r16">=</span><span class="r14"> x</span><span class="r16">.</span><span class="r14">ravel(order</span><span class="r16">=</span><span class="r17">&#x27;K&#x27;</span><span class="r14">)</span><span class="r12">                                                       </span> |
|<span class="r8"> 2526 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> isComplexType(x</span><span class="r16">.</span><span class="r14">dtype</span><span class="r16">.</span><span class="r14">type):</span><span class="r12">                                              </span> |
|<span class="r8"> 2527 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                sqnorm </span><span class="r16">=</span><span class="r14"> dot(x</span><span class="r16">.</span><span class="r14">real, x</span><span class="r16">.</span><span class="r14">real) </span><span class="r16">+</span><span class="r14"> dot(x</span><span class="r16">.</span><span class="r14">imag, x</span><span class="r16">.</span><span class="r14">imag)</span><span class="r12">                       </span> |
|<span class="r8"> 2528 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8"> 2529 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                sqnorm </span><span class="r16">=</span><span class="r14"> dot(x, x)</span><span class="r12">                                                       </span> |
|<span class="r8"> 2530 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> sqrt(sqnorm)</span><span class="r12">                                                           </span> |
|<span class="r8"> 2531 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> keepdims:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2532 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ret </span><span class="r16">=</span><span class="r14"> ret</span><span class="r16">.</span><span class="r14">reshape(ndim</span><span class="r16">*</span><span class="r14">[</span><span class="r16">1</span><span class="r14">])</span><span class="r12">                                              </span> |
|<span class="r8"> 2533 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> ret</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2534 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2535 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Normalize the `axis` argument to a tuple.</span><span class="r12">                                          </span> |
|<span class="r8"> 2536 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    nd </span><span class="r16">=</span><span class="r14"> x</span><span class="r16">.</span><span class="r14">ndim</span><span class="r12">                                                                          </span> |
|<span class="r8"> 2537 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> axis </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                                     </span> |
|<span class="r8"> 2538 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        axis </span><span class="r16">=</span><span class="r14"> </span><span class="r19">tuple</span><span class="r14">(</span><span class="r19">range</span><span class="r14">(nd))</span><span class="r12">                                                          </span> |
|<span class="r8"> 2539 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r19">isinstance</span><span class="r14">(axis, </span><span class="r19">tuple</span><span class="r14">):</span><span class="r12">                                                    </span> |
|<span class="r8"> 2540 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">try</span><span class="r14">:</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2541 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            axis </span><span class="r16">=</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(axis)</span><span class="r12">                                                             </span> |
|<span class="r8"> 2542 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">except</span><span class="r14"> </span><span class="r24">Exception</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> e:</span><span class="r12">                                                           </span> |
|<span class="r8"> 2543 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">TypeError</span><span class="r14">(</span><span class="r17">&quot;&#x27;axis&#x27; must be None, an integer or a tuple of integers&quot;</span><span class="r14">) </span><span class="r13">fro</span> |
|<span class="r8"> 2544 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        axis </span><span class="r16">=</span><span class="r14"> (axis,)</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2545 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2546 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(axis) </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2547 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> Inf:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2548 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r19">abs</span><span class="r14">(x)</span><span class="r16">.</span><span class="r14">max(axis</span><span class="r16">=</span><span class="r14">axis, keepdims</span><span class="r16">=</span><span class="r14">keepdims)</span><span class="r12">                              </span> |
|<span class="r8"> 2549 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">-</span><span class="r14">Inf:</span><span class="r12">                                                                </span> |
|<span class="r8"> 2550 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> </span><span class="r19">abs</span><span class="r14">(x)</span><span class="r16">.</span><span class="r14">min(axis</span><span class="r16">=</span><span class="r14">axis, keepdims</span><span class="r16">=</span><span class="r14">keepdims)</span><span class="r12">                              </span> |
|<span class="r8"> 2551 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2552 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Zero norm</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2553 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> (x </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r14">)</span><span class="r16">.</span><span class="r14">astype(x</span><span class="r16">.</span><span class="r14">real</span><span class="r16">.</span><span class="r14">dtype)</span><span class="r16">.</span><span class="r14">sum(axis</span><span class="r16">=</span><span class="r14">axis, keepdims</span><span class="r16">=</span><span class="r14">keepdims)</span><span class="r12">       </span> |
|<span class="r8"> 2554 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2555 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># special case for speedup</span><span class="r12">                                                   </span> |
|<span class="r8"> 2556 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> add</span><span class="r16">.</span><span class="r14">reduce(</span><span class="r19">abs</span><span class="r14">(x), axis</span><span class="r16">=</span><span class="r14">axis, keepdims</span><span class="r16">=</span><span class="r14">keepdims)</span><span class="r12">                      </span> |
|<span class="r8"> 2557 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r14"> </span><span class="r22">or</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                    </span> |
|<span class="r8"> 2558 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># special case for speedup</span><span class="r12">                                                   </span> |
|<span class="r8"> 2559 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            s </span><span class="r16">=</span><span class="r14"> (x</span><span class="r16">.</span><span class="r14">conj() </span><span class="r16">*</span><span class="r14"> x)</span><span class="r16">.</span><span class="r14">real</span><span class="r12">                                                      </span> |
|<span class="r8"> 2560 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> sqrt(add</span><span class="r16">.</span><span class="r14">reduce(s, axis</span><span class="r16">=</span><span class="r14">axis, keepdims</span><span class="r16">=</span><span class="r14">keepdims))</span><span class="r12">                     </span> |
|<span class="r8"> 2561 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># None of the str-type keywords for ord (&#x27;fro&#x27;, &#x27;nuc&#x27;)</span><span class="r12">                           </span> |
|<span class="r8"> 2562 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># are valid for vectors</span><span class="r12">                                                          </span> |
|<span class="r8"> 2563 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">isinstance</span><span class="r14">(</span><span class="r19">ord</span><span class="r14">, </span><span class="r19">str</span><span class="r14">):</span><span class="r12">                                                       </span> |
|<span class="r8"> 2564 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">f&quot;Invalid norm order &#x27;</span><span class="r20">{</span><span class="r19">ord</span><span class="r20">}</span><span class="r17">&#x27; for vectors&quot;</span><span class="r14">)</span><span class="r12">                  </span> |
|<span class="r8"> 2565 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2566 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            absx </span><span class="r16">=</span><span class="r14"> </span><span class="r19">abs</span><span class="r14">(x)</span><span class="r12">                                                                </span> |
|<span class="r8"> 2567 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            absx </span><span class="r16">**=</span><span class="r14"> </span><span class="r19">ord</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2568 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> add</span><span class="r16">.</span><span class="r14">reduce(absx, axis</span><span class="r16">=</span><span class="r14">axis, keepdims</span><span class="r16">=</span><span class="r14">keepdims)</span><span class="r12">                         </span> |
|<span class="r8"> 2569 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">**=</span><span class="r14"> (</span><span class="r16">1</span><span class="r14"> </span><span class="r16">/</span><span class="r14"> </span><span class="r19">ord</span><span class="r14">)</span><span class="r12">                                                            </span> |
|<span class="r8"> 2570 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">return</span><span class="r14"> ret</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2571 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(axis) </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2572 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        row_axis, col_axis </span><span class="r16">=</span><span class="r14"> axis</span><span class="r12">                                                        </span> |
|<span class="r8"> 2573 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        row_axis </span><span class="r16">=</span><span class="r14"> normalize_axis_index(row_axis, nd)</span><span class="r12">                                    </span> |
|<span class="r8"> 2574 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        col_axis </span><span class="r16">=</span><span class="r14"> normalize_axis_index(col_axis, nd)</span><span class="r12">                                    </span> |
|<span class="r8"> 2575 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> row_axis </span><span class="r16">==</span><span class="r14"> col_axis:</span><span class="r12">                                                         </span> |
|<span class="r8"> 2576 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">&#x27;Duplicate axes given.&#x27;</span><span class="r14">)</span><span class="r12">                                    </span> |
|<span class="r8"> 2577 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                     </span> |
|<span class="r8"> 2578 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14">  _multi_svd_norm(x, row_axis, col_axis, amax)</span><span class="r12">                          </span> |
|<span class="r8"> 2579 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">-2</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2580 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> _multi_svd_norm(x, row_axis, col_axis, amin)</span><span class="r12">                           </span> |
|<span class="r8"> 2581 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2582 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> col_axis </span><span class="r16">&gt;</span><span class="r14"> row_axis:</span><span class="r12">                                                      </span> |
|<span class="r8"> 2583 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                col_axis </span><span class="r16">-=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                            </span> |
|<span class="r8"> 2584 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> add</span><span class="r16">.</span><span class="r14">reduce(</span><span class="r19">abs</span><span class="r14">(x), axis</span><span class="r16">=</span><span class="r14">row_axis)</span><span class="r16">.</span><span class="r14">max(axis</span><span class="r16">=</span><span class="r14">col_axis)</span><span class="r12">                   </span> |
|<span class="r8"> 2585 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> Inf:</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2586 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> row_axis </span><span class="r16">&gt;</span><span class="r14"> col_axis:</span><span class="r12">                                                      </span> |
|<span class="r8"> 2587 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                row_axis </span><span class="r16">-=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                            </span> |
|<span class="r8"> 2588 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> add</span><span class="r16">.</span><span class="r14">reduce(</span><span class="r19">abs</span><span class="r14">(x), axis</span><span class="r16">=</span><span class="r14">col_axis)</span><span class="r16">.</span><span class="r14">max(axis</span><span class="r16">=</span><span class="r14">row_axis)</span><span class="r12">                   </span> |
|<span class="r8"> 2589 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">-1</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2590 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> col_axis </span><span class="r16">&gt;</span><span class="r14"> row_axis:</span><span class="r12">                                                      </span> |
|<span class="r8"> 2591 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                col_axis </span><span class="r16">-=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                            </span> |
|<span class="r8"> 2592 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> add</span><span class="r16">.</span><span class="r14">reduce(</span><span class="r19">abs</span><span class="r14">(x), axis</span><span class="r16">=</span><span class="r14">row_axis)</span><span class="r16">.</span><span class="r14">min(axis</span><span class="r16">=</span><span class="r14">col_axis)</span><span class="r12">                   </span> |
|<span class="r8"> 2593 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r16">-</span><span class="r14">Inf:</span><span class="r12">                                                                </span> |
|<span class="r8"> 2594 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> row_axis </span><span class="r16">&gt;</span><span class="r14"> col_axis:</span><span class="r12">                                                      </span> |
|<span class="r8"> 2595 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                row_axis </span><span class="r16">-=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                            </span> |
|<span class="r8"> 2596 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> add</span><span class="r16">.</span><span class="r14">reduce(</span><span class="r19">abs</span><span class="r14">(x), axis</span><span class="r16">=</span><span class="r14">col_axis)</span><span class="r16">.</span><span class="r14">min(axis</span><span class="r16">=</span><span class="r14">row_axis)</span><span class="r12">                   </span> |
|<span class="r8"> 2597 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r22">in</span><span class="r14"> [</span><span class="r13">None</span><span class="r14">, </span><span class="r17">&#x27;fro&#x27;</span><span class="r14">, </span><span class="r17">&#x27;f&#x27;</span><span class="r14">]:</span><span class="r12">                                                  </span> |
|<span class="r8"> 2598 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> sqrt(add</span><span class="r16">.</span><span class="r14">reduce((x</span><span class="r16">.</span><span class="r14">conj() </span><span class="r16">*</span><span class="r14"> x)</span><span class="r16">.</span><span class="r14">real, axis</span><span class="r16">=</span><span class="r14">axis))</span><span class="r12">                       </span> |
|<span class="r8"> 2599 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">elif</span><span class="r14"> </span><span class="r19">ord</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;nuc&#x27;</span><span class="r14">:</span><span class="r12">                                                               </span> |
|<span class="r8"> 2600 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> _multi_svd_norm(x, row_axis, col_axis, </span><span class="r19">sum</span><span class="r14">)</span><span class="r12">                            </span> |
|<span class="r8"> 2601 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2602 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">&quot;Invalid norm order for matrices.&quot;</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8"> 2603 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> keepdims:</span><span class="r12">                                                                     </span> |
|<span class="r8"> 2604 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret_shape </span><span class="r16">=</span><span class="r14"> </span><span class="r19">list</span><span class="r14">(x</span><span class="r16">.</span><span class="r14">shape)</span><span class="r12">                                                    </span> |
|<span class="r8"> 2605 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret_shape[axis[</span><span class="r16">0</span><span class="r14">]] </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                       </span> |
|<span class="r8"> 2606 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret_shape[axis[</span><span class="r16">1</span><span class="r14">]] </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                       </span> |
|<span class="r8"> 2607 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ret </span><span class="r16">=</span><span class="r14"> ret</span><span class="r16">.</span><span class="r14">reshape(ret_shape)</span><span class="r12">                                                 </span> |
|<span class="r8"> 2608 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> ret</span><span class="r12">                                                                       </span> |
|<span class="r8"> 2609 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2610 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">&quot;Improper number of dimensions to norm.&quot;</span><span class="r14">)</span><span class="r12">                       </span> |
|<span class="r8"> 2611 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2612 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2613 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r21"># multi_dot</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2614 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2615 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_multidot_dispatcher</span><span class="r14">(arrays, </span><span class="r16">*</span><span class="r14">, out</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                           </span> |
|<span class="r8"> 2616 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">yield from</span><span class="r14"> arrays</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2617 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">yield</span><span class="r14"> out</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2618 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2619 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2620 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@array_function_dispatch</span><span class="r14">(_multidot_dispatcher)</span><span class="r12">                                           </span> |
|<span class="r8"> 2621 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">multi_dot</span><span class="r14">(arrays, </span><span class="r16">*</span><span class="r14">, out</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                      </span> |
|<span class="r8"> 2622 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2623 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Compute the dot product of two or more arrays in a single function call,</span><span class="r12">             </span> |
|<span class="r8"> 2624 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    while automatically selecting the fastest evaluation order.</span><span class="r12">                          </span> |
|<span class="r8"> 2625 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2626 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `multi_dot` chains `numpy.dot` and uses optimal parenthesization</span><span class="r12">                     </span> |
|<span class="r8"> 2627 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    of the matrices [1]_ [2]_. Depending on the shapes of the matrices,</span><span class="r12">                  </span> |
|<span class="r8"> 2628 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    this can speed up the multiplication a lot.</span><span class="r12">                                          </span> |
|<span class="r8"> 2629 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2630 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If the first argument is 1-D it is treated as a row vector.</span><span class="r12">                          </span> |
|<span class="r8"> 2631 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    If the last argument is 1-D it is treated as a column vector.</span><span class="r12">                        </span> |
|<span class="r8"> 2632 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The other arguments must be 2-D.</span><span class="r12">                                                     </span> |
|<span class="r8"> 2633 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2634 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Think of `multi_dot` as::</span><span class="r12">                                                            </span> |
|<span class="r8"> 2635 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2636 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        def multi_dot(arrays): return functools.reduce(np.dot, arrays)</span><span class="r12">                   </span> |
|<span class="r8"> 2637 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2638 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2639 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Parameters</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2640 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2641 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    arrays : sequence of array_like</span><span class="r12">                                                      </span> |
|<span class="r8"> 2642 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the first argument is 1-D it is treated as row vector.</span><span class="r12">                        </span> |
|<span class="r8"> 2643 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        If the last argument is 1-D it is treated as column vector.</span><span class="r12">                      </span> |
|<span class="r8"> 2644 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        The other arguments must be 2-D.</span><span class="r12">                                                 </span> |
|<span class="r8"> 2645 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    out : ndarray, optional</span><span class="r12">                                                              </span> |
|<span class="r8"> 2646 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Output argument. This must have the exact kind that would be returned</span><span class="r12">            </span> |
|<span class="r8"> 2647 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        if it was not used. In particular, it must have the right type, must be</span><span class="r12">          </span> |
|<span class="r8"> 2648 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        C-contiguous, and its dtype must be the dtype that would be returned</span><span class="r12">             </span> |
|<span class="r8"> 2649 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        for `dot(a, b)`. This is a performance feature. Therefore, if these</span><span class="r12">              </span> |
|<span class="r8"> 2650 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        conditions are not met, an exception is raised, instead of attempting</span><span class="r12">            </span> |
|<span class="r8"> 2651 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        to be flexible.</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2652 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2653 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        .. versionadded:: 1.19.0</span><span class="r12">                                                         </span> |
|<span class="r8"> 2654 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2655 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Returns</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2656 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -------</span><span class="r12">                                                                              </span> |
|<span class="r8"> 2657 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    output : ndarray</span><span class="r12">                                                                     </span> |
|<span class="r8"> 2658 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Returns the dot product of the supplied arrays.</span><span class="r12">                                  </span> |
|<span class="r8"> 2659 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2660 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    See Also</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2661 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2662 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    numpy.dot : dot multiplication with two arguments.</span><span class="r12">                                   </span> |
|<span class="r8"> 2663 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2664 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    References</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2665 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    ----------</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2666 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2667 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [1] Cormen, &quot;Introduction to Algorithms&quot;, Chapter 15.2, p. 370-378</span><span class="r12">                </span> |
|<span class="r8"> 2668 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    .. [2] https://en.wikipedia.org/wiki/Matrix_chain_multiplication</span><span class="r12">                     </span> |
|<span class="r8"> 2669 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2670 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Examples</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2671 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    --------</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2672 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    `multi_dot` allows you to write::</span><span class="r12">                                                    </span> |
|<span class="r8"> 2673 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2674 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; from numpy.linalg import multi_dot</span><span class="r12">                                               </span> |
|<span class="r8"> 2675 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # Prepare some data</span><span class="r12">                                                              </span> |
|<span class="r8"> 2676 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; A = np.random.random((10000, 100))</span><span class="r12">                                               </span> |
|<span class="r8"> 2677 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; B = np.random.random((100, 1000))</span><span class="r12">                                                </span> |
|<span class="r8"> 2678 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; C = np.random.random((1000, 5))</span><span class="r12">                                                  </span> |
|<span class="r8"> 2679 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; D = np.random.random((5, 333))</span><span class="r12">                                                   </span> |
|<span class="r8"> 2680 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # the actual dot multiplication</span><span class="r12">                                                  </span> |
|<span class="r8"> 2681 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; _ = multi_dot([A, B, C, D])</span><span class="r12">                                                      </span> |
|<span class="r8"> 2682 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2683 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    instead of::</span><span class="r12">                                                                         </span> |
|<span class="r8"> 2684 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2685 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; _ = np.dot(np.dot(np.dot(A, B), C), D)</span><span class="r12">                                           </span> |
|<span class="r8"> 2686 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; # or</span><span class="r12">                                                                             </span> |
|<span class="r8"> 2687 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &gt;&gt;&gt; _ = A.dot(B).dot(C).dot(D)</span><span class="r12">                                                       </span> |
|<span class="r8"> 2688 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2689 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Notes</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2690 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    -----</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2691 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The cost for a matrix multiplication can be calculated with the</span><span class="r12">                      </span> |
|<span class="r8"> 2692 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    following function::</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2693 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2694 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        def cost(A, B):</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2695 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            return A.shape[0] * A.shape[1] * B.shape[1]</span><span class="r12">                                  </span> |
|<span class="r8"> 2696 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2697 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Assume we have three matrices</span><span class="r12">                                                        </span> |
|<span class="r8"> 2698 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    :math:`A_{10x100}, B_{100x5}, C_{5x50}`.</span><span class="r12">                                             </span> |
|<span class="r8"> 2699 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2700 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The costs for the two different parenthesizations are as follows::</span><span class="r12">                   </span> |
|<span class="r8"> 2701 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2702 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        cost((AB)C) = 10*100*5 + 10*5*50   = 5000 + 2500   = 7500</span><span class="r12">                        </span> |
|<span class="r8"> 2703 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        cost(A(BC)) = 10*100*50 + 100*5*50 = 50000 + 25000 = 75000</span><span class="r12">                       </span> |
|<span class="r8"> 2704 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2705 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2706 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    n </span><span class="r16">=</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(arrays)</span><span class="r12">                                                                      </span> |
|<span class="r8"> 2707 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># optimization only makes sense for len(arrays) &gt; 2</span><span class="r12">                                  </span> |
|<span class="r8"> 2708 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> n </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8"> 2709 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">raise</span><span class="r14"> </span><span class="r24">ValueError</span><span class="r14">(</span><span class="r17">&quot;Expecting at least two arrays.&quot;</span><span class="r14">)</span><span class="r12">                               </span> |
|<span class="r8"> 2710 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> n </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">:</span><span class="r12">                                                                         </span> |
|<span class="r8"> 2711 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> dot(arrays[</span><span class="r16">0</span><span class="r14">], arrays[</span><span class="r16">1</span><span class="r14">], out</span><span class="r16">=</span><span class="r14">out)</span><span class="r12">                                        </span> |
|<span class="r8"> 2712 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2713 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    arrays </span><span class="r16">=</span><span class="r14"> [asanyarray(a) </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays]</span><span class="r12">                                             </span> |
|<span class="r8"> 2714 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2715 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># save original ndim to reshape the result array into the proper form later</span><span class="r12">          </span> |
|<span class="r8"> 2716 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ndim_first, ndim_last </span><span class="r16">=</span><span class="r14"> arrays[</span><span class="r16">0</span><span class="r14">]</span><span class="r16">.</span><span class="r14">ndim, arrays[</span><span class="r16">-1</span><span class="r14">]</span><span class="r16">.</span><span class="r14">ndim</span><span class="r12">                              </span> |
|<span class="r8"> 2717 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Explicitly convert vectors to 2D arrays to keep the logic of the internal</span><span class="r12">          </span> |
|<span class="r8"> 2718 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># _multi_dot_* functions as simple as possible.</span><span class="r12">                                      </span> |
|<span class="r8"> 2719 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> arrays[</span><span class="r16">0</span><span class="r14">]</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                              </span> |
|<span class="r8"> 2720 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        arrays[</span><span class="r16">0</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> atleast_2d(arrays[</span><span class="r16">0</span><span class="r14">])</span><span class="r12">                                                </span> |
|<span class="r8"> 2721 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> arrays[</span><span class="r16">-1</span><span class="r14">]</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                                             </span> |
|<span class="r8"> 2722 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        arrays[</span><span class="r16">-1</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> atleast_2d(arrays[</span><span class="r16">-1</span><span class="r14">])</span><span class="r16">.</span><span class="r14">T</span><span class="r12">                                            </span> |
|<span class="r8"> 2723 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    _assert_2d(</span><span class="r16">*</span><span class="r14">arrays)</span><span class="r12">                                                                  </span> |
|<span class="r8"> 2724 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2725 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># _multi_dot_three is much faster than _multi_dot_matrix_chain_order</span><span class="r12">                 </span> |
|<span class="r8"> 2726 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> n </span><span class="r16">==</span><span class="r14"> </span><span class="r16">3</span><span class="r14">:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2727 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        result </span><span class="r16">=</span><span class="r14"> _multi_dot_three(arrays[</span><span class="r16">0</span><span class="r14">], arrays[</span><span class="r16">1</span><span class="r14">], arrays[</span><span class="r16">2</span><span class="r14">], out</span><span class="r16">=</span><span class="r14">out)</span><span class="r12">              </span> |
|<span class="r8"> 2728 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2729 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        order </span><span class="r16">=</span><span class="r14"> _multi_dot_matrix_chain_order(arrays)</span><span class="r12">                                    </span> |
|<span class="r8"> 2730 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        result </span><span class="r16">=</span><span class="r14"> _multi_dot(arrays, order, </span><span class="r16">0</span><span class="r14">, n </span><span class="r16">-</span><span class="r14"> </span><span class="r16">1</span><span class="r14">, out</span><span class="r16">=</span><span class="r14">out)</span><span class="r12">                            </span> |
|<span class="r8"> 2731 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2732 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># return proper shape</span><span class="r12">                                                                </span> |
|<span class="r8"> 2733 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> ndim_first </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> ndim_last </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                               </span> |
|<span class="r8"> 2734 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> result[</span><span class="r16">0</span><span class="r14">, </span><span class="r16">0</span><span class="r14">]  </span><span class="r21"># scalar</span><span class="r12">                                                    </span> |
|<span class="r8"> 2735 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">elif</span><span class="r14"> ndim_first </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14"> </span><span class="r22">or</span><span class="r14"> ndim_last </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">:</span><span class="r12">                                              </span> |
|<span class="r8"> 2736 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> result</span><span class="r16">.</span><span class="r14">ravel()  </span><span class="r21"># 1-D</span><span class="r12">                                                     </span> |
|<span class="r8"> 2737 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2738 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> result</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2739 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2740 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2741 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_multi_dot_three</span><span class="r14">(A, B, C, out</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                                 </span> |
|<span class="r8"> 2742 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2743 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Find the best order for three arrays and do the multiplication.</span><span class="r12">                      </span> |
|<span class="r8"> 2744 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2745 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    For three arguments `_multi_dot_three` is approximately 15 times faster</span><span class="r12">              </span> |
|<span class="r8"> 2746 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    than `_multi_dot_matrix_chain_order`</span><span class="r12">                                                 </span> |
|<span class="r8"> 2747 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2748 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2749 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    a0, a1b0 </span><span class="r16">=</span><span class="r14"> A</span><span class="r16">.</span><span class="r14">shape</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2750 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    b1c0, c1 </span><span class="r16">=</span><span class="r14"> C</span><span class="r16">.</span><span class="r14">shape</span><span class="r12">                                                                   </span> |
|<span class="r8"> 2751 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># cost1 = cost((AB)C) = a0*a1b0*b1c0 + a0*b1c0*c1</span><span class="r12">                                    </span> |
|<span class="r8"> 2752 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    cost1 </span><span class="r16">=</span><span class="r14"> a0 </span><span class="r16">*</span><span class="r14"> b1c0 </span><span class="r16">*</span><span class="r14"> (a1b0 </span><span class="r16">+</span><span class="r14"> c1)</span><span class="r12">                                                      </span> |
|<span class="r8"> 2753 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># cost2 = cost(A(BC)) = a1b0*b1c0*c1 + a0*a1b0*c1</span><span class="r12">                                    </span> |
|<span class="r8"> 2754 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    cost2 </span><span class="r16">=</span><span class="r14"> a1b0 </span><span class="r16">*</span><span class="r14"> c1 </span><span class="r16">*</span><span class="r14"> (a0 </span><span class="r16">+</span><span class="r14"> b1c0)</span><span class="r12">                                                      </span> |
|<span class="r8"> 2755 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2756 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> cost1 </span><span class="r16">&lt;</span><span class="r14"> cost2:</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2757 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> dot(dot(A, B), C, out</span><span class="r16">=</span><span class="r14">out)</span><span class="r12">                                                </span> |
|<span class="r8"> 2758 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2759 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> dot(A, dot(B, C), out</span><span class="r16">=</span><span class="r14">out)</span><span class="r12">                                                </span> |
|<span class="r8"> 2760 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2761 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2762 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_multi_dot_matrix_chain_order</span><span class="r14">(arrays, return_costs</span><span class="r16">=</span><span class="r13">False</span><span class="r14">):</span><span class="r12">                           </span> |
|<span class="r8"> 2763 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2764 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Return a np.array that encodes the optimal order of mutiplications.</span><span class="r12">                  </span> |
|<span class="r8"> 2765 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2766 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The optimal order array is then used by `_multi_dot()` to do the</span><span class="r12">                     </span> |
|<span class="r8"> 2767 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    multiplication.</span><span class="r12">                                                                      </span> |
|<span class="r8"> 2768 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2769 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Also return the cost matrix if `return_costs` is `True`</span><span class="r12">                              </span> |
|<span class="r8"> 2770 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2771 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    The implementation CLOSELY follows Cormen, &quot;Introduction to Algorithms&quot;,</span><span class="r12">             </span> |
|<span class="r8"> 2772 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Chapter 15.2, p. 370-378.  Note that Cormen uses 1-based indices.</span><span class="r12">                    </span> |
|<span class="r8"> 2773 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2774 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        cost[i, j] = min([</span><span class="r12">                                                               </span> |
|<span class="r8"> 2775 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            cost[prefix] + cost[suffix] + cost_mult(prefix, suffix)</span><span class="r12">                      </span> |
|<span class="r8"> 2776 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            for k in range(i, j)])</span><span class="r12">                                                       </span> |
|<span class="r8"> 2777 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2778 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8"> 2779 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    n </span><span class="r16">=</span><span class="r14"> </span><span class="r19">len</span><span class="r14">(arrays)</span><span class="r12">                                                                      </span> |
|<span class="r8"> 2780 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># p stores the dimensions of the matrices</span><span class="r12">                                            </span> |
|<span class="r8"> 2781 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># Example for p: A_{10x100}, B_{100x5}, C_{5x50} --&gt; p = [10, 100, 5, 50]</span><span class="r12">            </span> |
|<span class="r8"> 2782 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    p </span><span class="r16">=</span><span class="r14"> [a</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">0</span><span class="r14">] </span><span class="r13">for</span><span class="r14"> a </span><span class="r22">in</span><span class="r14"> arrays] </span><span class="r16">+</span><span class="r14"> [arrays[</span><span class="r16">-1</span><span class="r14">]</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">1</span><span class="r14">]]</span><span class="r12">                             </span> |
|<span class="r8"> 2783 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># m is a matrix of costs of the subproblems</span><span class="r12">                                          </span> |
|<span class="r8"> 2784 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># m[i,j]: min number of scalar multiplications needed to compute A_{i..j}</span><span class="r12">            </span> |
|<span class="r8"> 2785 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    m </span><span class="r16">=</span><span class="r14"> zeros((n, n), dtype</span><span class="r16">=</span><span class="r14">double)</span><span class="r12">                                                      </span> |
|<span class="r8"> 2786 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># s is the actual ordering</span><span class="r12">                                                           </span> |
|<span class="r8"> 2787 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r21"># s[i, j] is the value of k at which we split the product A_i..A_j</span><span class="r12">                   </span> |
|<span class="r8"> 2788 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    s </span><span class="r16">=</span><span class="r14"> empty((n, n), dtype</span><span class="r16">=</span><span class="r14">intp)</span><span class="r12">                                                        </span> |
|<span class="r8"> 2789 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2790 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> l </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(</span><span class="r16">1</span><span class="r14">, n):</span><span class="r12">                                                                </span> |
|<span class="r8"> 2791 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(n </span><span class="r16">-</span><span class="r14"> l):</span><span class="r12">                                                           </span> |
|<span class="r8"> 2792 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            j </span><span class="r16">=</span><span class="r14"> i </span><span class="r16">+</span><span class="r14"> l</span><span class="r12">                                                                    </span> |
|<span class="r8"> 2793 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            m[i, j] </span><span class="r16">=</span><span class="r14"> Inf</span><span class="r12">                                                                </span> |
|<span class="r8"> 2794 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> k </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(i, j):</span><span class="r12">                                                        </span> |
|<span class="r8"> 2795 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                q </span><span class="r16">=</span><span class="r14"> m[i, k] </span><span class="r16">+</span><span class="r14"> m[k</span><span class="r16">+1</span><span class="r14">, j] </span><span class="r16">+</span><span class="r14"> p[i]</span><span class="r16">*</span><span class="r14">p[k</span><span class="r16">+1</span><span class="r14">]</span><span class="r16">*</span><span class="r14">p[j</span><span class="r16">+1</span><span class="r14">]</span><span class="r12">                             </span> |
|<span class="r8"> 2796 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> q </span><span class="r16">&lt;</span><span class="r14"> m[i, j]:</span><span class="r12">                                                          </span> |
|<span class="r8"> 2797 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    m[i, j] </span><span class="r16">=</span><span class="r14"> q</span><span class="r12">                                                          </span> |
|<span class="r8"> 2798 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    s[i, j] </span><span class="r16">=</span><span class="r14"> k  </span><span class="r21"># Note that Cormen uses 1-based index</span><span class="r12">                   </span> |
|<span class="r8"> 2799 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2800 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> (s, m) </span><span class="r13">if</span><span class="r14"> return_costs </span><span class="r13">else</span><span class="r14"> s</span><span class="r12">                                                 </span> |
|<span class="r8"> 2801 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2802 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2803 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">_multi_dot</span><span class="r14">(arrays, order, i, j, out</span><span class="r16">=</span><span class="r13">None</span><span class="r14">):</span><span class="r12">                                           </span> |
|<span class="r8"> 2804 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;Actually do the multiplication with the given order.&quot;&quot;&quot;</span><span class="r12">                           </span> |
|<span class="r8"> 2805 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> i </span><span class="r16">==</span><span class="r14"> j:</span><span class="r12">                                                                           </span> |
|<span class="r8"> 2806 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># the initial call with non-None out should never get here</span><span class="r12">                       </span> |
|<span class="r8"> 2807 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> out </span><span class="r22">is</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                               </span> |
|<span class="r8"> 2808 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8"> 2809 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> arrays[i]</span><span class="r12">                                                                 </span> |
|<span class="r8"> 2810 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                                </span> |
|<span class="r8"> 2811 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> dot(_multi_dot(arrays, order, i, order[i, j]),</span><span class="r12">                            </span> |
|<span class="r8"> 2812 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                   _multi_dot(arrays, order, order[i, j] </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r14">, j),</span><span class="r12">                        </span> |
|<span class="r8"> 2813 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                   out</span><span class="r16">=</span><span class="r14">out)</span><span class="r12">                                                              </span> |
|<span class="r8"> 2814 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|                                                                                          |
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r27">function summary for c:\users\robertwenink\appdata\local\programs\python\python39\lib\si…</span> |
|<span class="r8">  476 </span>|<span class="r9">    6% </span>|<span class="r9">    2% </span>|<span class="r9">   7%  </span>|<span class="r10"> 15%   </span>|<span class="r14">geneticalgorithm</span><span class="r16">.</span><span class="r14">inv</span><span class="r12">                                                                     </span> |
+---------------------------------------------------------------------------------------------------------------------------------+
<span class="r1">                                       C:\Users\RobertWenink\OneDrive - Delft University of                                        </span>
<span class="r1">   Technology\Documents\TUDelft\Master\Afstuderen\INC-EGO\models\kriging\hyperparameter_tuning\GA.py: % of time =   2.49% out of   </span>
<span class="r1">                                                              17.27s.                                                              </span>
+---------------------------------------------------------------------------------------------------------------------------------+
|<span class="r2"> </span><span class="r3">Line</span><span class="r2"> </span>|<span class="r4">Time</span><span class="r2">   </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r4">––––––</span><span class="r2"> </span>|<span class="r5">––––––</span><span class="r2"> </span>|<span class="r2">                                                                                          </span>|
|      |<span class="r6">Python</span><span class="r2"> </span>|<span class="r6">native</span><span class="r2"> </span>|<span class="r6">system</span><span class="r2"> </span>|<span class="r7">GPU</span><span class="r2">    </span>|<span class="r2">C:\Users\RobertWenink\OneDrive - Delft University of Technology\Documents\TUDelft\Master… </span>|
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">    1 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">&quot;&quot;&quot; Adapted from: Copyright at end of file &quot;&quot;&quot;</span><span class="r12">                                           </span> |
|<span class="r8">    2 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">from</span><span class="r14"> </span><span class="r15">numba</span><span class="r14"> </span><span class="r13">import</span><span class="r14"> njit</span><span class="r12">                                                                   </span> |
|<span class="r8">    3 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">numpy</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> </span><span class="r15">np</span><span class="r12">                                                                       </span> |
|<span class="r8">    4 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">sys</span><span class="r12">                                                                               </span> |
|<span class="r8">    5 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">time</span><span class="r12">                                                                              </span> |
|<span class="r8">    6 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">import</span><span class="r14"> </span><span class="r15">matplotlib.pyplot</span><span class="r14"> </span><span class="r13">as</span><span class="r14"> </span><span class="r15">plt</span><span class="r12">                                                          </span> |
|<span class="r8">    7 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">    8 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">class</span><span class="r14"> </span><span class="r15">geneticalgorithm</span><span class="r14">:</span><span class="r12">                                                                  </span> |
|<span class="r8">    9 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   10 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">   11 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    Elitist genetic algorithm for solving problems with</span><span class="r12">                                  </span> |
|<span class="r8">   12 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    continuous variables.</span><span class="r12">                                                                </span> |
|<span class="r8">   13 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   14 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    run(): implements the genetic algorithm</span><span class="r12">                                              </span> |
|<span class="r8">   15 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   16 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    outputs:</span><span class="r12">                                                                             </span> |
|<span class="r8">   17 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            output_dict:  a dictionary including the best set of variables</span><span class="r12">               </span> |
|<span class="r8">   18 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        found and the value of the given function associated to it.</span><span class="r12">                      </span> |
|<span class="r8">   19 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        {&#x27;variable&#x27;: , &#x27;function&#x27;: }</span><span class="r12">                                                     </span> |
|<span class="r8">   20 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   21 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            report: a list including the record of the progress of the</span><span class="r12">                   </span> |
|<span class="r8">   22 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            algorithm over iterations</span><span class="r12">                                                    </span> |
|<span class="r8">   23 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   24 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">    &quot;&quot;&quot;</span><span class="r12">                                                                                  </span> |
|<span class="r8">   25 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   26 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">__init__</span><span class="r14">(</span><span class="r12">                                                                        </span> |
|<span class="r8">   27 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r14">,</span><span class="r12">                                                                            </span> |
|<span class="r8">   28 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        function,</span><span class="r12">                                                                        </span> |
|<span class="r8">   29 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        other_function_arguments,</span><span class="r12">                                                        </span> |
|<span class="r8">   30 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        hps_constraints,</span><span class="r12">                                                                 </span> |
|<span class="r8">   31 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        hps_init</span><span class="r16">=</span><span class="r13">None</span><span class="r14">,</span><span class="r12">                                                                   </span> |
|<span class="r8">   32 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        algorithm_parameters</span><span class="r16">=</span><span class="r14">{</span><span class="r12">                                                           </span> |
|<span class="r8">   33 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;max_num_iteration&quot;</span><span class="r14">: </span><span class="r13">None</span><span class="r14">,</span><span class="r12">                                                   </span> |
|<span class="r8">   34 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;population_size&quot;</span><span class="r14">: </span><span class="r16">100</span><span class="r14">,</span><span class="r12">                                                      </span> |
|<span class="r8">   35 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;mutation_probability&quot;</span><span class="r14">: </span><span class="r16">0.1</span><span class="r14">,</span><span class="r12">                                                 </span> |
|<span class="r8">   36 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;elit_ratio&quot;</span><span class="r14">: </span><span class="r16">0.05</span><span class="r14">,</span><span class="r12">                                                          </span> |
|<span class="r8">   37 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;crossover_probability&quot;</span><span class="r14">: </span><span class="r16">0.5</span><span class="r14">,</span><span class="r12">                                                </span> |
|<span class="r8">   38 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;parents_portion&quot;</span><span class="r14">: </span><span class="r16">0.3</span><span class="r14">,</span><span class="r12">                                                      </span> |
|<span class="r8">   39 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;crossover_type&quot;</span><span class="r14">: </span><span class="r17">&quot;uniform&quot;</span><span class="r14">,</span><span class="r12">                                                 </span> |
|<span class="r8">   40 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;max_iteration_without_improv&quot;</span><span class="r14">: </span><span class="r13">None</span><span class="r14">,</span><span class="r12">                                        </span> |
|<span class="r8">   41 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        },</span><span class="r12">                                                                               </span> |
|<span class="r8">   42 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        convergence_curve</span><span class="r16">=</span><span class="r13">True</span><span class="r14">,</span><span class="r12">                                                          </span> |
|<span class="r8">   43 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        progress_bar</span><span class="r16">=</span><span class="r13">True</span><span class="r14">,</span><span class="r12">                                                               </span> |
|<span class="r8">   44 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        reuse_pop</span><span class="r16">=</span><span class="r13">True</span><span class="r14">,</span><span class="r12">                                                                  </span> |
|<span class="r8">   45 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ):</span><span class="r12">                                                                                   </span> |
|<span class="r8">   46 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">   47 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        @param function &lt;Callable&gt; - the given objective function to be minimized</span><span class="r12">        </span> |
|<span class="r8">   48 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        NOTE: This implementation minimizes the given objective function.</span><span class="r12">                </span> |
|<span class="r8">   49 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        (For maximization multiply function by a negative sign: the absolute</span><span class="r12">             </span> |
|<span class="r8">   50 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        value of the output would be the actual objective function)</span><span class="r12">                      </span> |
|<span class="r8">   51 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   52 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        @param dimension &lt;integer&gt; - the number of decision variables</span><span class="r12">                    </span> |
|<span class="r8">   53 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   54 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        @param hps_constraints &lt;numpy array/None&gt; - provide an array of tuples</span><span class="r12">           </span> |
|<span class="r8">   55 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        of length two as boundaries for each variable; the length of the array must be eq</span> |
|<span class="r8">   56 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        For example, np.array([0,100],[0,200]) determines lower boundary 0 and upper boun</span> |
|<span class="r8">   57 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   58 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        @param algorithm_parameters:</span><span class="r12">                                                     </span> |
|<span class="r8">   59 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ max_num_iteration &lt;int&gt; - stoping criteria of the genetic algorithm (GA)</span><span class="r12">   </span> |
|<span class="r8">   60 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ population_size &lt;int&gt;</span><span class="r12">                                                      </span> |
|<span class="r8">   61 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ mutation_probability &lt;float in [0,1]&gt;</span><span class="r12">                                      </span> |
|<span class="r8">   62 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ elit_ration &lt;float in [0,1]&gt;</span><span class="r12">                                               </span> |
|<span class="r8">   63 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ crossover_probability &lt;float in [0,1]&gt;</span><span class="r12">                                     </span> |
|<span class="r8">   64 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ parents_portion &lt;float in [0,1]&gt;</span><span class="r12">                                           </span> |
|<span class="r8">   65 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ crossover_type &lt;string&gt; - Default is &#x27;uniform&#x27;; &#x27;one_point&#x27; or</span><span class="r12">             </span> |
|<span class="r8">   66 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            &#x27;two_point&#x27; are other options</span><span class="r12">                                                </span> |
|<span class="r8">   67 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            @ max_iteration_without_improv &lt;int&gt; - maximum number of</span><span class="r12">                     </span> |
|<span class="r8">   68 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">            successive iterations without improvement. If None it is ineffective</span><span class="r12">         </span> |
|<span class="r8">   69 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   70 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        @param convergence_curve &lt;True/False&gt; - Plot the convergence curve or not</span><span class="r12">        </span> |
|<span class="r8">   71 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        Default is True.</span><span class="r12">                                                                 </span> |
|<span class="r8">   72 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        @progress_bar &lt;True/False&gt; - Show progress bar or not. Default is True.</span><span class="r12">          </span> |
|<span class="r8">   73 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        @reuse_po &lt;True/False&gt; - on a later run, do we want to re-use the last population</span> |
|<span class="r8">   74 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">   75 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r25">__name__</span><span class="r14"> </span><span class="r16">=</span><span class="r14"> geneticalgorithm</span><span class="r12">                                                 </span> |
|<span class="r8">   76 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   77 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># input function</span><span class="r12">                                                                 </span> |
|<span class="r8">   78 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> callable(function), </span><span class="r17">&quot;function must be callable&quot;</span><span class="r12">                           </span> |
|<span class="r8">   79 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">f </span><span class="r16">=</span><span class="r14"> function</span><span class="r12">                                                                </span> |
|<span class="r8">   80 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   81 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># NOTE own additions</span><span class="r12">                                                             </span> |
|<span class="r8">   82 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">other_function_arguments </span><span class="r16">=</span><span class="r14"> other_function_arguments</span><span class="r12">                         </span> |
|<span class="r8">   83 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">reuse_pop </span><span class="r16">=</span><span class="r14"> reuse_pop</span><span class="r12">                                                       </span> |
|<span class="r8">   84 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r12">                                                                                 </span> |
|<span class="r8">   85 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># input variables&#x27; boundaries</span><span class="r12">                                                    </span> |
|<span class="r8">   86 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                         </span> |
|<span class="r8">   87 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">type</span><span class="r14">(hps_constraints)</span><span class="r16">.</span><span class="r25">__module__</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;numpy&quot;</span><span class="r12">                                  </span> |
|<span class="r8">   88 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ), </span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17"> hps_constraints must be numpy array&quot;</span><span class="r12">                                      </span> |
|<span class="r8">   89 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   90 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (hps_constraints</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r14">), </span><span class="r17">&quot;hps_constraints must be of dimension 2&quot;</span><span class="r12">     </span> |
|<span class="r8">   91 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">   92 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> hps_constraints:</span><span class="r12">                                                        </span> |
|<span class="r8">   93 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                     </span> |
|<span class="r8">   94 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">len</span><span class="r14">(i) </span><span class="r16">==</span><span class="r14"> </span><span class="r16">2</span><span class="r12">                                                              </span> |
|<span class="r8">   95 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ), </span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17"> boundary for each variable must be a tuple of length two.&quot;</span><span class="r12">            </span> |
|<span class="r8">   96 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                     </span> |
|<span class="r8">   97 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                i[</span><span class="r16">0</span><span class="r14">] </span><span class="r16">&lt;=</span><span class="r14"> i[</span><span class="r16">1</span><span class="r14">]</span><span class="r12">                                                             </span> |
|<span class="r8">   98 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ), </span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17"> lower_boundaries must be smaller than upper_boundaries [lower,upper]&quot;</span><span class="r12"> </span> |
|<span class="r8">   99 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">var_bound </span><span class="r16">=</span><span class="r14"> hps_constraints</span><span class="r12">                                                 </span> |
|<span class="r8">  100 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  101 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># check correctness of hps_init wrt boundaries</span><span class="r12">                                   </span> |
|<span class="r8">  102 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> hps_init </span><span class="r22">is</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                         </span> |
|<span class="r8">  103 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">assert</span><span class="r14"> (hps_init</span><span class="r16">.</span><span class="r14">ndim </span><span class="r16">==</span><span class="r14"> </span><span class="r16">1</span><span class="r14">), </span><span class="r17">&#x27;</span><span class="r26">\n</span><span class="r17"> please define hps_init as an 1d array of sha</span> |
|<span class="r8">  104 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">assert</span><span class="r14"> (hps_constraints</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">0</span><span class="r14">] </span><span class="r16">==</span><span class="r14"> hps_init</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">0</span><span class="r14">]), </span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17"> please define hps</span> |
|<span class="r8">  105 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r12">                                                                             </span> |
|<span class="r8">  106 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># check if the hyperparameters adhere to the constraints</span><span class="r12">                     </span> |
|<span class="r8">  107 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(hps_constraints</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">0</span><span class="r14">]):</span><span class="r12">                                    </span> |
|<span class="r8">  108 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">if</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> (hps_init[i] </span><span class="r16">&gt;=</span><span class="r14"> hps_constraints[i][</span><span class="r16">0</span><span class="r14">] </span><span class="r22">and</span><span class="r14"> hps_init[i] </span><span class="r16">&lt;=</span><span class="r14"> hps_const</span> |
|<span class="r8">  109 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r19">print</span><span class="r14">(</span><span class="r17">&#x27;WARNING: provided hps_init does not adhere to the constraints,</span> |
|<span class="r8">  110 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    hps_init </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                      </span> |
|<span class="r8">  111 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r13">break</span><span class="r12">                                                                </span> |
|<span class="r8">  112 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    </span><span class="r12">                                                                     </span> |
|<span class="r8">  113 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_shape </span><span class="r16">=</span><span class="r14"> hps_init</span><span class="r16">.</span><span class="r14">shape</span><span class="r12">                                              </span> |
|<span class="r8">  114 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  115 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_shape </span><span class="r16">=</span><span class="r14"> hps_constraints</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                    </span> |
|<span class="r8">  116 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  117 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_init </span><span class="r16">=</span><span class="r14"> hps_init</span><span class="r12">                                                         </span> |
|<span class="r8">  118 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_shape[</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                                     </span> |
|<span class="r8">  119 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  120 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r12">                                                                                 </span> |
|<span class="r8">  121 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># convergence_curve</span><span class="r12">                                                              </span> |
|<span class="r8">  122 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">convergence_curve </span><span class="r16">=</span><span class="r14"> convergence_curve</span><span class="r12">                                       </span> |
|<span class="r8">  123 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> convergence_curve </span><span class="r16">==</span><span class="r14"> </span><span class="r13">True</span><span class="r14">:</span><span class="r12">                                                    </span> |
|<span class="r8">  124 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            plt</span><span class="r16">.</span><span class="r14">close(</span><span class="r17">&quot;GA&quot;</span><span class="r14">)</span><span class="r12">                                                              </span> |
|<span class="r8">  125 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">fig,</span><span class="r19">self</span><span class="r16">.</span><span class="r14">ax </span><span class="r16">=</span><span class="r14"> plt</span><span class="r16">.</span><span class="r14">subplots()</span><span class="r12">                                            </span> |
|<span class="r8">  126 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">fig</span><span class="r16">.</span><span class="r14">set_label(</span><span class="r17">&quot;GA&quot;</span><span class="r14">)</span><span class="r12">                                                     </span> |
|<span class="r8">  127 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  128 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># progress_bar</span><span class="r12">                                                                   </span> |
|<span class="r8">  129 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">progress_bar </span><span class="r16">=</span><span class="r14"> progress_bar</span><span class="r12">                                                 </span> |
|<span class="r8">  130 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  131 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># input algorithm&#x27;s parameters</span><span class="r12">                                                   </span> |
|<span class="r8">  132 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param </span><span class="r16">=</span><span class="r14"> algorithm_parameters</span><span class="r12">                                                </span> |
|<span class="r8">  133 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s </span><span class="r16">=</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;population_size&quot;</span><span class="r14">])</span><span class="r12">                                  </span> |
|<span class="r8">  134 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  135 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                         </span> |
|<span class="r8">  136 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;parents_portion&quot;</span><span class="r14">] </span><span class="r16">&lt;=</span><span class="r14"> </span><span class="r16">1</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;parents_portion&quot;</span><span class="r14">] </span><span class="r16">&gt;=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">    </span> |
|<span class="r8">  137 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ), </span><span class="r17">&quot;parents_portion must be in range [0,1]&quot;</span><span class="r12">                                      </span> |
|<span class="r8">  138 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  139 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s </span><span class="r16">=</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;parents_portion&quot;</span><span class="r14">] </span><span class="r16">*</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s)</span><span class="r12">                     </span> |
|<span class="r8">  140 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> (</span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s </span><span class="r16">-</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s) </span><span class="r16">%</span><span class="r14"> </span><span class="r16">2</span><span class="r14"> </span><span class="r16">!=</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                           </span> |
|<span class="r8">  141 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                              </span> |
|<span class="r8">  142 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  143 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_mut </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;mutation_probability&quot;</span><span class="r14">]</span><span class="r12">                               </span> |
|<span class="r8">  144 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  145 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                         </span> |
|<span class="r8">  146 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_mut </span><span class="r16">&lt;=</span><span class="r14"> </span><span class="r16">1</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_mut </span><span class="r16">&gt;=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                    </span> |
|<span class="r8">  147 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ), </span><span class="r17">&quot;mutation_probability must be in range [0,1]&quot;</span><span class="r12">                                 </span> |
|<span class="r8">  148 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  149 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_cross </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;crossover_probability&quot;</span><span class="r14">]</span><span class="r12">                            </span> |
|<span class="r8">  150 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                         </span> |
|<span class="r8">  151 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_cross </span><span class="r16">&lt;=</span><span class="r14"> </span><span class="r16">1</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_cross </span><span class="r16">&gt;=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                </span> |
|<span class="r8">  152 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ), </span><span class="r17">&quot;mutation_probability must be in range [0,1]&quot;</span><span class="r12">                                 </span> |
|<span class="r8">  153 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  154 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                         </span> |
|<span class="r8">  155 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;elit_ratio&quot;</span><span class="r14">] </span><span class="r16">&lt;=</span><span class="r14"> </span><span class="r16">1</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;elit_ratio&quot;</span><span class="r14">] </span><span class="r16">&gt;=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">              </span> |
|<span class="r8">  156 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ), </span><span class="r17">&quot;elit_ratio must be in range [0,1]&quot;</span><span class="r12">                                           </span> |
|<span class="r8">  157 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  158 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        trl </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s </span><span class="r16">*</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;elit_ratio&quot;</span><span class="r14">]</span><span class="r12">                                      </span> |
|<span class="r8">  159 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> trl </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">1</span><span class="r14"> </span><span class="r22">and</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;elit_ratio&quot;</span><span class="r14">] </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                     </span> |
|<span class="r8">  160 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">num_elit </span><span class="r16">=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                            </span> |
|<span class="r8">  161 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  162 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">num_elit </span><span class="r16">=</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(trl)</span><span class="r12">                                                     </span> |
|<span class="r8">  163 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  164 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                         </span> |
|<span class="r8">  165 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s </span><span class="r16">&gt;=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">num_elit</span><span class="r12">                                                  </span> |
|<span class="r8">  166 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ), </span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17"> number of parents must be greater than number of elits&quot;</span><span class="r12">                   </span> |
|<span class="r8">  167 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  168 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># SET max numbers of iteration </span><span class="r12">                                                  </span> |
|<span class="r8">  169 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;max_num_iteration&quot;</span><span class="r14">] </span><span class="r16">==</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                      </span> |
|<span class="r8">  170 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">iterate </span><span class="r16">=</span><span class="r14"> </span><span class="r19">round</span><span class="r14">(</span><span class="r19">round</span><span class="r14">((</span><span class="r16">10000/</span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s)</span><span class="r16">**</span><span class="r14">(((</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim</span><span class="r16">-1</span><span class="r14">)</span><span class="r16">/2</span><span class="r14"> </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r14">)</span><span class="r16">**</span><span class="r14">(</span><span class="r16">1/2</span><span class="r14">)))</span> |
|<span class="r8">  171 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  172 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">iterate </span><span class="r16">=</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;max_num_iteration&quot;</span><span class="r14">])</span><span class="r12">                          </span> |
|<span class="r8">  173 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  174 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">c_type </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;crossover_type&quot;</span><span class="r14">]</span><span class="r12">                                       </span> |
|<span class="r8">  175 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">assert</span><span class="r14"> (</span><span class="r12">                                                                         </span> |
|<span class="r8">  176 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">c_type </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;uniform&quot;</span><span class="r12">                                                     </span> |
|<span class="r8">  177 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r22">or</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">c_type </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;one_point&quot;</span><span class="r12">                                                </span> |
|<span class="r8">  178 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r22">or</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">c_type </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;two_point&quot;</span><span class="r12">                                                </span> |
|<span class="r8">  179 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ), </span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17"> crossover_type must &#x27;uniform&#x27;, &#x27;one_point&#x27;, or &#x27;two_point&#x27; Enter string&quot;</span><span class="r12">  </span> |
|<span class="r8">  180 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  181 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">stop_mniwi </span><span class="r16">=</span><span class="r14"> </span><span class="r13">False</span><span class="r12">                                                          </span> |
|<span class="r8">  182 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;max_iteration_without_improv&quot;</span><span class="r14">] </span><span class="r16">==</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                           </span> |
|<span class="r8">  183 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">mniwi </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">iterate </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                </span> |
|<span class="r8">  184 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  185 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">mniwi </span><span class="r16">=</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">param[</span><span class="r17">&quot;max_iteration_without_improv&quot;</span><span class="r14">])</span><span class="r12">                 </span> |
|<span class="r8">  186 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  187 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  188 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># if all correct, run</span><span class="r12">                                                            </span> |
|<span class="r8">  189 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">run()</span><span class="r12">                                                                       </span> |
|<span class="r8">  190 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  191 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">initialize_population</span><span class="r14">(</span><span class="r19">self</span><span class="r14">):</span><span class="r12">                                                     </span> |
|<span class="r8">  192 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># do we want to re-use the previous population?</span><span class="r12">                                  </span> |
|<span class="r8">  193 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">hasattr</span><span class="r14">(</span><span class="r19">self</span><span class="r14">, </span><span class="r17">&#x27;pop&#x27;</span><span class="r14">) </span><span class="r22">and</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">reuse_pop:</span><span class="r12">                                      </span> |
|<span class="r8">  194 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            pop </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop</span><span class="r12">                                                               </span> |
|<span class="r8">  195 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  196 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># if so, set the max nr of iterations without improvement</span><span class="r12">                    </span> |
|<span class="r8">  197 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">mniwi </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">iterate</span><span class="r16">/5</span><span class="r12">                                                  </span> |
|<span class="r8">  198 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                            </span> |
|<span class="r8">  199 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># new initial Population</span><span class="r12">                                                     </span> |
|<span class="r8">  200 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            pop </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">zeros((</span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s,</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r14">))</span><span class="r12">                                    </span> |
|<span class="r8">  201 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r12">                                                                             </span> |
|<span class="r8">  202 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            p </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">arange(</span><span class="r16">0</span><span class="r14">, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s)            </span><span class="r12">                                     </span> |
|<span class="r8">  203 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            i </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">arange(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim)</span><span class="r12">                                                      </span> |
|<span class="r8">  204 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            i,p </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">meshgrid(i,p)</span><span class="r12">                                                       </span> |
|<span class="r8">  205 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r12">                                                                             </span> |
|<span class="r8">  206 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            pop[p,i] </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">var_bound[i,</span><span class="r16">0</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random(size </span><span class="r16">=</span><span class="r14"> (p</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">0</span><span class="r14">],</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim</span> |
|<span class="r8">  207 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">self</span><span class="r16">.</span><span class="r14">var_bound[i,</span><span class="r16">1</span><span class="r14">] </span><span class="r16">-</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">var_bound[i,</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                </span> |
|<span class="r8">  208 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  209 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  210 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># include hps_init if defined </span><span class="r12">                                                   </span> |
|<span class="r8">  211 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># if hps_init is a good solution it will end up in the elitists</span><span class="r12">                  </span> |
|<span class="r8">  212 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_init </span><span class="r22">is</span><span class="r14"> </span><span class="r22">not</span><span class="r14"> </span><span class="r13">None</span><span class="r14">:</span><span class="r12">                                                    </span> |
|<span class="r8">  213 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># replace worst individual with hps_init, hps_init might differ from pop[0,..</span> |
|<span class="r8">  214 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            pop[</span><span class="r16">-1</span><span class="r14">,:</span><span class="r16">-1</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_init</span><span class="r12">                                                  </span> |
|<span class="r8">  215 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r12">                                                                             </span> |
|<span class="r8">  216 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> pop</span><span class="r12">                                                                       </span> |
|<span class="r8">  217 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r12">                                                                                 </span> |
|<span class="r8">  218 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">run</span><span class="r14">(</span><span class="r19">self</span><span class="r14">):</span><span class="r12">                                                                       </span> |
|<span class="r8">  219 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># inits</span><span class="r12">                                                                          </span> |
|<span class="r8">  220 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        pop </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">initialize_population()</span><span class="r12">                                               </span> |
|<span class="r8">  221 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  222 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Fitness of whole population at once.</span><span class="r12">                                           </span> |
|<span class="r8">  223 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        pop[:,</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim] </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">sim(pop[:,:</span><span class="r16">-1</span><span class="r14">])</span><span class="r12">                                           </span> |
|<span class="r8">  224 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        pop </span><span class="r16">=</span><span class="r14"> pop[pop[:, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r16">.</span><span class="r14">argsort()]</span><span class="r12">                                            </span> |
|<span class="r8">  225 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  226 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Report       </span><span class="r12">                                                                  </span> |
|<span class="r8">  227 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">report </span><span class="r16">=</span><span class="r14"> []</span><span class="r12">                                                                 </span> |
|<span class="r8">  228 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_variable </span><span class="r16">=</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">,:</span><span class="r16">-1</span><span class="r14">]</span><span class="r12">                                                  </span> |
|<span class="r8">  229 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function </span><span class="r16">=</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">,</span><span class="r16">-1</span><span class="r14">]</span><span class="r12">                                                   </span> |
|<span class="r8">  230 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">write(</span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17"> Initial objective function:</span><span class="r26">\n</span><span class="r17"> </span><span class="r20">%s</span><span class="r26">\n\n</span><span class="r17">&quot;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (</span><span class="r16">-</span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function</span> |
|<span class="r8">  231 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">flush()</span><span class="r12">                                                               </span> |
|<span class="r8">  232 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  233 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        t </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                            </span> |
|<span class="r8">  234 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        counter </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                      </span> |
|<span class="r8">  235 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">while</span><span class="r14"> t </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">iterate:</span><span class="r12">                                                          </span> |
|<span class="r8">  236 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  237 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">progress_bar </span><span class="r16">==</span><span class="r14"> </span><span class="r13">True</span><span class="r14">:</span><span class="r12">                                                </span> |
|<span class="r8">  238 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">self</span><span class="r16">.</span><span class="r14">progress(t, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">iterate, status</span><span class="r16">=</span><span class="r17">&quot;GA is running...&quot;</span><span class="r14">)</span><span class="r12">                </span> |
|<span class="r8">  239 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  240 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Sort</span><span class="r12">                                                                       </span> |
|<span class="r8">  241 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            pop </span><span class="r16">=</span><span class="r14"> pop[pop[:, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r16">.</span><span class="r14">argsort()]</span><span class="r12">                                        </span> |
|<span class="r8">  242 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  243 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim] </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function:</span><span class="r12">                                    </span> |
|<span class="r8">  244 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                counter </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                              </span> |
|<span class="r8">  245 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function </span><span class="r16">=</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r16">.</span><span class="r14">copy()</span><span class="r12">                             </span> |
|<span class="r8">  246 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_variable </span><span class="r16">=</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">, :</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r16">.</span><span class="r14">copy()</span><span class="r12">                            </span> |
|<span class="r8">  247 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  248 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                counter </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                             </span> |
|<span class="r8">  249 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  250 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Normalizing objective function</span><span class="r12">                                             </span> |
|<span class="r8">  251 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            minobj </span><span class="r16">=</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r12">                                                    </span> |
|<span class="r8">  252 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> minobj </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                               </span> |
|<span class="r8">  253 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                normobj </span><span class="r16">=</span><span class="r14"> pop[:, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim] </span><span class="r16">+</span><span class="r14"> </span><span class="r19">abs</span><span class="r14">(minobj)</span><span class="r12">                                 </span> |
|<span class="r8">  254 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  255 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                normobj </span><span class="r16">=</span><span class="r14"> pop[:, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r12">                                               </span> |
|<span class="r8">  256 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  257 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            maxnorm </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">amax(normobj)</span><span class="r12">                                                   </span> |
|<span class="r8">  258 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            normobj </span><span class="r16">=</span><span class="r14"> maxnorm </span><span class="r16">-</span><span class="r14"> normobj </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                              </span> |
|<span class="r8">  259 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  260 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Calculate probability</span><span class="r12">                                                      </span> |
|<span class="r8">  261 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sum_normobj </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">sum(normobj)</span><span class="r12">                                                </span> |
|<span class="r8">  262 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            prob </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">zeros(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s)</span><span class="r12">                                                  </span> |
|<span class="r8">  263 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            prob </span><span class="r16">=</span><span class="r14"> normobj </span><span class="r16">/</span><span class="r14"> sum_normobj</span><span class="r12">                                                 </span> |
|<span class="r8">  264 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            cumprob </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">cumsum(prob)</span><span class="r12">                                                    </span> |
|<span class="r8">  265 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  266 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># select random parents while keeping elitists.</span><span class="r12">                              </span> |
|<span class="r8">  267 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># works for the elitists because we sorted earlier.</span><span class="r12">                          </span> |
|<span class="r8">  268 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            index </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">searchsorted(cumprob, np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random()) </span><span class="r12">                        </span> |
|<span class="r8">  269 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            pop[</span><span class="r19">self</span><span class="r16">.</span><span class="r14">num_elit:</span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s] </span><span class="r16">=</span><span class="r14"> pop[index]</span><span class="r12">                                   </span> |
|<span class="r8">  270 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  271 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            par_count </span><span class="r16">=</span><span class="r14"> </span><span class="r16">0</span><span class="r12">                                                                </span> |
|<span class="r8">  272 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">while</span><span class="r14"> par_count </span><span class="r16">==</span><span class="r14"> </span><span class="r16">0</span><span class="r14">:</span><span class="r12">                                                        </span> |
|<span class="r8">  273 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ef_par_list </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s) </span><span class="r16">&lt;=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_cross</span><span class="r12">            </span> |
|<span class="r8">  274 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                par_count </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">sum(ef_par_list)</span><span class="r12">                                          </span> |
|<span class="r8">  275 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  276 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ef_par </span><span class="r16">=</span><span class="r14"> pop[:</span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s][ef_par_list]</span><span class="r12">                                       </span> |
|<span class="r8">  277 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  278 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">for</span><span class="r14"> k </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop_s, </span><span class="r16">2</span><span class="r14">):</span><span class="r12">                                   </span> |
|<span class="r8">  279 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                r1 </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">randint(</span><span class="r16">0</span><span class="r14">, par_count)</span><span class="r12">                                     </span> |
|<span class="r8">  280 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                r2 </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">randint(</span><span class="r16">0</span><span class="r14">, par_count)</span><span class="r12">                                     </span> |
|<span class="r8">  281 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                pvar1 </span><span class="r16">=</span><span class="r14"> ef_par[r1, :</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r12">                                            </span> |
|<span class="r8">  282 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                pvar2 </span><span class="r16">=</span><span class="r14"> ef_par[r2, :</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r12">                                            </span> |
|<span class="r8">  283 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  284 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ch1,ch2 </span><span class="r16">=</span><span class="r14"> cross(pvar1, pvar2, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">c_type)</span><span class="r12">                     </span> |
|<span class="r8">  285 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  286 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ch1 </span><span class="r16">=</span><span class="r14"> mut(ch1, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">var_bound, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_mut, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim)</span><span class="r12">                  </span> |
|<span class="r8">  287 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ch2 </span><span class="r16">=</span><span class="r14"> mutmidle(ch2, pvar1, pvar2, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">var_bound, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">prob_mut, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim</span> |
|<span class="r8">  288 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                pop[k,:</span><span class="r16">-1</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> ch1</span><span class="r12">                                                         </span> |
|<span class="r8">  289 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                pop[k </span><span class="r16">+</span><span class="r14"> </span><span class="r16">1</span><span class="r14">,:</span><span class="r16">-1</span><span class="r14">] </span><span class="r16">=</span><span class="r14"> ch2</span><span class="r12">                                                     </span> |
|<span class="r8">  290 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r12">                                                                             </span> |
|<span class="r8">  291 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Fitness of whole population at once.</span><span class="r12">                                       </span> |
|<span class="r8">  292 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            pop[</span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s:,</span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim] </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">sim(pop[</span><span class="r19">self</span><span class="r16">.</span><span class="r14">par_s:,:</span><span class="r16">-1</span><span class="r14">])</span><span class="r12">                   </span> |
|<span class="r8">  293 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r12">                                                                         </span> |
|<span class="r8">  294 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21">#############################################################</span><span class="r12">                </span> |
|<span class="r8">  295 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            t </span><span class="r16">+=</span><span class="r14"> </span><span class="r16">1</span><span class="r12">                                                                       </span> |
|<span class="r8">  296 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> counter </span><span class="r16">&gt;</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">mniwi:</span><span class="r12">                                                     </span> |
|<span class="r8">  297 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r19">self</span><span class="r16">.</span><span class="r14">stop_mniwi </span><span class="r16">=</span><span class="r14"> </span><span class="r13">True</span><span class="r12">                                                   </span> |
|<span class="r8">  298 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r13">break</span><span class="r12">                                                                    </span> |
|<span class="r8">  299 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  300 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r21"># Report</span><span class="r12">                                                                     </span> |
|<span class="r8">  301 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">report</span><span class="r16">.</span><span class="r14">append(</span><span class="r16">-</span><span class="r14">pop[</span><span class="r16">0</span><span class="r14">, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim])</span><span class="r12">                                        </span> |
|<span class="r8">  302 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  303 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Sort</span><span class="r12">                                                                           </span> |
|<span class="r8">  304 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        pop </span><span class="r16">=</span><span class="r14"> pop[pop[:, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r16">.</span><span class="r14">argsort()]</span><span class="r12">                                            </span> |
|<span class="r8">  305 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">pop </span><span class="r16">=</span><span class="r14"> pop</span><span class="r12">                                                                   </span> |
|<span class="r8">  306 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  307 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim] </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function:</span><span class="r12">                                        </span> |
|<span class="r8">  308 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function </span><span class="r16">=</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">, </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r12">                                        </span> |
|<span class="r8">  309 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_variable </span><span class="r16">=</span><span class="r14"> pop[</span><span class="r16">0</span><span class="r14">, : </span><span class="r19">self</span><span class="r16">.</span><span class="r14">dim]</span><span class="r12">                                      </span> |
|<span class="r8">  310 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  311 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># if we reuse the previous population in a next run,</span><span class="r12">                             </span> |
|<span class="r8">  312 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># we wont use the same hps_init again next run, unless we set it explicitly.</span><span class="r12">     </span> |
|<span class="r8">  313 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">reuse_pop:</span><span class="r12">                                                               </span> |
|<span class="r8">  314 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_init </span><span class="r16">=</span><span class="r14"> </span><span class="r13">None</span><span class="r12">                                                         </span> |
|<span class="r8">  315 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r12">                                                                                 </span> |
|<span class="r8">  316 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r21"># Report</span><span class="r12">                                                                         </span> |
|<span class="r8">  317 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_variable </span><span class="r16">=</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_variable</span><span class="r16">.</span><span class="r14">reshape(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">hps_shape)</span><span class="r12">                  </span> |
|<span class="r8">  318 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r19">self</span><span class="r16">.</span><span class="r14">output_dict </span><span class="r16">=</span><span class="r14"> {</span><span class="r12">                                                             </span> |
|<span class="r8">  319 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;variable&quot;</span><span class="r14">: </span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_variable,</span><span class="r12">                                              </span> |
|<span class="r8">  320 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r17">&quot;function&quot;</span><span class="r14">: </span><span class="r16">-</span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function,</span><span class="r12">                                             </span> |
|<span class="r8">  321 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        }</span><span class="r12">                                                                                </span> |
|<span class="r8">  322 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  323 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">progress_bar </span><span class="r16">==</span><span class="r14"> </span><span class="r13">True</span><span class="r14">:</span><span class="r12">                                                    </span> |
|<span class="r8">  324 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            show </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot; &quot;</span><span class="r14"> </span><span class="r16">*</span><span class="r14"> </span><span class="r16">100</span><span class="r12">                                                             </span> |
|<span class="r8">  325 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">write(</span><span class="r17">&quot;</span><span class="r26">\r</span><span class="r20">%s</span><span class="r17">&quot;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (</span><span class="r17">&quot; &quot;</span><span class="r14"> </span><span class="r16">*</span><span class="r14"> </span><span class="r16">100</span><span class="r14">))</span><span class="r12">                                       </span> |
|<span class="r8">  326 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">write(</span><span class="r17">&quot;</span><span class="r26">\r</span><span class="r17"> The best solution found:</span><span class="r26">\n</span><span class="r17"> </span><span class="r20">%s</span><span class="r17">&quot;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (</span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_variable))</span><span class="r12">      </span> |
|<span class="r8">  327 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">write(</span><span class="r17">&quot;</span><span class="r26">\n\n</span><span class="r17"> Objective function:</span><span class="r26">\n</span><span class="r17"> </span><span class="r20">%s</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (</span><span class="r16">-</span><span class="r19">self</span><span class="r16">.</span><span class="r14">best_function))</span><span class="r12">      </span> |
|<span class="r8">  328 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">flush()</span><span class="r12">                                                               </span> |
|<span class="r8">  329 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  330 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">convergence_curve </span><span class="r16">==</span><span class="r14"> </span><span class="r13">True</span><span class="r14">:</span><span class="r12">                                               </span> |
|<span class="r8">  331 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">ax</span><span class="r16">.</span><span class="r14">plot(</span><span class="r19">self</span><span class="r16">.</span><span class="r14">report,label</span><span class="r16">=</span><span class="r17">&quot;Objective function&quot;</span><span class="r14">)</span><span class="r12">                         </span> |
|<span class="r8">  332 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">ax</span><span class="r16">.</span><span class="r14">set_xlabel(</span><span class="r17">&quot;Iteration&quot;</span><span class="r14">)</span><span class="r12">                                              </span> |
|<span class="r8">  333 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">ax</span><span class="r16">.</span><span class="r14">set_ylabel(</span><span class="r17">&quot;log likelihood&quot;</span><span class="r14">)</span><span class="r12">                                         </span> |
|<span class="r8">  334 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r19">self</span><span class="r16">.</span><span class="r14">fig</span><span class="r16">.</span><span class="r14">suptitle(</span><span class="r17">&quot;Genetic Algorithm&quot;</span><span class="r14">)</span><span class="r12">                                       </span> |
|<span class="r8">  335 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            plt</span><span class="r16">.</span><span class="r14">draw()</span><span class="r12">                                                                   </span> |
|<span class="r8">  336 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  337 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> </span><span class="r19">self</span><span class="r16">.</span><span class="r14">stop_mniwi </span><span class="r16">==</span><span class="r14"> </span><span class="r13">True</span><span class="r14">:</span><span class="r12">                                                      </span> |
|<span class="r8">  338 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">write(</span><span class="r12">                                                            </span> |
|<span class="r8">  339 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r17">&quot;</span><span class="r26">\n</span><span class="r17">GA is terminated due to the&quot;</span><span class="r12">                                          </span> |
|<span class="r8">  340 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                </span><span class="r16">+</span><span class="r14"> </span><span class="r17">&quot; maximum number of iterations without improvement was met!</span><span class="r26">\n</span><span class="r17">&quot;</span><span class="r12">         </span> |
|<span class="r8">  341 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  342 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r12">                                                                                     </span> |
|<span class="r8">  343 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  344 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">sim</span><span class="r14">(</span><span class="r19">self</span><span class="r14">, X):</span><span class="r12">                                                                    </span> |
|<span class="r8">  345 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        obj </span><span class="r16">=</span><span class="r14"> </span><span class="r16">-</span><span class="r19">self</span><span class="r16">.</span><span class="r14">f(X, </span><span class="r16">*</span><span class="r19">self</span><span class="r16">.</span><span class="r14">other_function_arguments)</span><span class="r12">                                 </span> |
|<span class="r8">  346 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">return</span><span class="r14"> obj</span><span class="r12">                                                                       </span> |
|<span class="r8">  347 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  348 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">def</span><span class="r14"> </span><span class="r18">progress</span><span class="r14">(</span><span class="r19">self</span><span class="r14">, count, total, status</span><span class="r16">=</span><span class="r17">&quot;&quot;</span><span class="r14">):</span><span class="r12">                                         </span> |
|<span class="r8">  349 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  350 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        This is a relatively expensive function due to stdout.</span><span class="r12">                           </span> |
|<span class="r8">  351 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">        &quot;&quot;&quot;</span><span class="r12">                                                                              </span> |
|<span class="r8">  352 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14">  count </span><span class="r16">%</span><span class="r14"> (</span><span class="r19">int</span><span class="r14">(total</span><span class="r16">/100</span><span class="r14">))</span><span class="r16">==0</span><span class="r14">:</span><span class="r12">                                                 </span> |
|<span class="r8">  353 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            bar_len </span><span class="r16">=</span><span class="r14"> </span><span class="r16">50</span><span class="r12">                                                                 </span> |
|<span class="r8">  354 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            filled_len </span><span class="r16">=</span><span class="r14"> </span><span class="r19">int</span><span class="r14">(</span><span class="r19">round</span><span class="r14">(bar_len </span><span class="r16">*</span><span class="r14"> count </span><span class="r16">/</span><span class="r14"> </span><span class="r19">float</span><span class="r14">(total)))</span><span class="r12">                      </span> |
|<span class="r8">  355 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  356 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            percents </span><span class="r16">=</span><span class="r14"> </span><span class="r19">round</span><span class="r14">(</span><span class="r16">100.0</span><span class="r14"> </span><span class="r16">*</span><span class="r14"> count </span><span class="r16">/</span><span class="r14"> </span><span class="r19">float</span><span class="r14">(total), </span><span class="r16">1</span><span class="r14">)</span><span class="r12">                            </span> |
|<span class="r8">  357 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            bar </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;|&quot;</span><span class="r14"> </span><span class="r16">*</span><span class="r14"> filled_len </span><span class="r16">+</span><span class="r14"> </span><span class="r17">&quot;_&quot;</span><span class="r14"> </span><span class="r16">*</span><span class="r14"> (bar_len </span><span class="r16">-</span><span class="r14"> filled_len)</span><span class="r12">                        </span> |
|<span class="r8">  358 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  359 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">write(</span><span class="r17">&quot;</span><span class="r26">\r</span><span class="r20">%s</span><span class="r17"> </span><span class="r20">%s%s</span><span class="r17"> </span><span class="r20">%s</span><span class="r17">&quot;</span><span class="r14"> </span><span class="r16">%</span><span class="r14"> (bar, percents, </span><span class="r17">&quot;%&quot;</span><span class="r14">, status))</span><span class="r12">              </span> |
|<span class="r8">  360 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            sys</span><span class="r16">.</span><span class="r14">stdout</span><span class="r16">.</span><span class="r14">flush()</span><span class="r12">                                                           </span> |
|<span class="r8">  361 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  362 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@njit</span><span class="r14">(cache</span><span class="r16">=</span><span class="r13">True</span><span class="r14">, fastmath</span><span class="r16">=</span><span class="r13">True</span><span class="r14">)</span><span class="r12">                                                         </span> |
|<span class="r8">  363 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">mut</span><span class="r14">(x,var_bound,prob_mut,dim):</span><span class="r12">                                                       </span> |
|<span class="r8">  364 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(dim):</span><span class="r12">                                                                 </span> |
|<span class="r8">  365 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ran </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random()</span><span class="r12">                                                         </span> |
|<span class="r8">  366 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> ran </span><span class="r16">&lt;</span><span class="r14"> prob_mut:</span><span class="r12">                                                               </span> |
|<span class="r8">  367 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            x[i] </span><span class="r16">=</span><span class="r14"> var_bound[i,</span><span class="r16">0</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random() </span><span class="r16">*</span><span class="r14"> (</span><span class="r12">                               </span> |
|<span class="r8">  368 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                var_bound[i,</span><span class="r16">1</span><span class="r14">] </span><span class="r16">-</span><span class="r14"> var_bound[i,</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                          </span> |
|<span class="r8">  369 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            )</span><span class="r12">                                                                            </span> |
|<span class="r8">  370 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> x</span><span class="r12">                                                                             </span> |
|<span class="r8">  371 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  372 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@njit</span><span class="r14">(cache</span><span class="r16">=</span><span class="r13">True</span><span class="r14">, fastmath</span><span class="r16">=</span><span class="r13">True</span><span class="r14">)</span><span class="r12">                                                         </span> |
|<span class="r8">  373 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">mutmidle</span><span class="r14">(x, p1, p2,var_bound,prob_mut,dim):</span><span class="r12">                                          </span> |
|<span class="r8">  374 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(dim):</span><span class="r12">                                                                 </span> |
|<span class="r8">  375 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ran </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random()</span><span class="r12">                                                         </span> |
|<span class="r8">  376 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">if</span><span class="r14"> ran </span><span class="r16">&lt;</span><span class="r14"> prob_mut:</span><span class="r12">                                                               </span> |
|<span class="r8">  377 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> p1[i] </span><span class="r16">&lt;</span><span class="r14"> p2[i]:</span><span class="r12">                                                            </span> |
|<span class="r8">  378 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                x[i] </span><span class="r16">=</span><span class="r14"> p1[i] </span><span class="r16">+</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random() </span><span class="r16">*</span><span class="r14"> (p2[i] </span><span class="r16">-</span><span class="r14"> p1[i])</span><span class="r12">                      </span> |
|<span class="r8">  379 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">elif</span><span class="r14"> p1[i] </span><span class="r16">&gt;</span><span class="r14"> p2[i]:</span><span class="r12">                                                          </span> |
|<span class="r8">  380 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                x[i] </span><span class="r16">=</span><span class="r14"> p2[i] </span><span class="r16">+</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random() </span><span class="r16">*</span><span class="r14"> (p1[i] </span><span class="r16">-</span><span class="r14"> p2[i])</span><span class="r12">                      </span> |
|<span class="r8">  381 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">else</span><span class="r14">:</span><span class="r12">                                                                        </span> |
|<span class="r8">  382 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                x[i] </span><span class="r16">=</span><span class="r14"> var_bound[i,</span><span class="r16">0</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random() </span><span class="r16">*</span><span class="r14"> (</span><span class="r12">                           </span> |
|<span class="r8">  383 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                    var_bound[i,</span><span class="r16">1</span><span class="r14">] </span><span class="r16">-</span><span class="r14"> var_bound[i,</span><span class="r16">0</span><span class="r14">]</span><span class="r12">                                      </span> |
|<span class="r8">  384 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                )</span><span class="r12">                                                                        </span> |
|<span class="r8">  385 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> x</span><span class="r12">                                                                             </span> |
|<span class="r8">  386 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  387 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r23">@njit</span><span class="r14">(cache</span><span class="r16">=</span><span class="r13">True</span><span class="r14">, fastmath</span><span class="r16">=</span><span class="r13">True</span><span class="r14">)</span><span class="r12">                                                         </span> |
|<span class="r8">  388 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r13">def</span><span class="r14"> </span><span class="r18">cross</span><span class="r14">(x, y, dim, c_type):</span><span class="r12">                                                            </span> |
|<span class="r8">  389 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  390 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ofs1 </span><span class="r16">=</span><span class="r14"> x</span><span class="r16">.</span><span class="r14">copy()</span><span class="r12">                                                                      </span> |
|<span class="r8">  391 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    ofs2 </span><span class="r16">=</span><span class="r14"> y</span><span class="r16">.</span><span class="r14">copy()</span><span class="r12">                                                                      </span> |
|<span class="r8">  392 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  393 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> c_type </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;one_point&quot;</span><span class="r14">:</span><span class="r12">                                                            </span> |
|<span class="r8">  394 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ran </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">randint(</span><span class="r16">0</span><span class="r14">, dim)</span><span class="r12">                                                  </span> |
|<span class="r8">  395 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(</span><span class="r16">0</span><span class="r14">, ran):</span><span class="r12">                                                          </span> |
|<span class="r8">  396 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ofs1[i] </span><span class="r16">=</span><span class="r14"> y[i]</span><span class="r12">                                                               </span> |
|<span class="r8">  397 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ofs2[i] </span><span class="r16">=</span><span class="r14"> x[i]</span><span class="r12">                                                               </span> |
|<span class="r8">  398 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  399 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> c_type </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;two_point&quot;</span><span class="r14">:</span><span class="r12">                                                            </span> |
|<span class="r8">  400 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ran1 </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">randint(</span><span class="r16">0</span><span class="r14">, dim)</span><span class="r12">                                                 </span> |
|<span class="r8">  401 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        ran2 </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">randint(ran1, dim)</span><span class="r12">                                              </span> |
|<span class="r8">  402 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  403 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(ran1, ran2):</span><span class="r12">                                                      </span> |
|<span class="r8">  404 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ofs1[i] </span><span class="r16">=</span><span class="r14"> y[i]</span><span class="r12">                                                               </span> |
|<span class="r8">  405 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ofs2[i] </span><span class="r16">=</span><span class="r14"> x[i]</span><span class="r12">                                                               </span> |
|<span class="r8">  406 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  407 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">if</span><span class="r14"> c_type </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;uniform&quot;</span><span class="r14">:</span><span class="r12">                                                              </span> |
|<span class="r8">  408 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">        </span><span class="r13">for</span><span class="r14"> i </span><span class="r22">in</span><span class="r14"> </span><span class="r19">range</span><span class="r14">(</span><span class="r16">0</span><span class="r14">, dim):</span><span class="r12">                                                          </span> |
|<span class="r8">  409 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            ran </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">random</span><span class="r16">.</span><span class="r14">random()</span><span class="r12">                                                     </span> |
|<span class="r8">  410 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">            </span><span class="r13">if</span><span class="r14"> ran </span><span class="r16">&lt;</span><span class="r14"> </span><span class="r16">0.5</span><span class="r14">:</span><span class="r12">                                                                </span> |
|<span class="r8">  411 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ofs1[i] </span><span class="r16">=</span><span class="r14"> y[i]</span><span class="r12">                                                           </span> |
|<span class="r8">  412 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">                ofs2[i] </span><span class="r16">=</span><span class="r14"> x[i]</span><span class="r12">                                                           </span> |
|<span class="r8">  413 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  414 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r14">    </span><span class="r13">return</span><span class="r14"> ofs1, ofs2</span><span class="r12">                                                                    </span> |
|<span class="r8">  415 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  416 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                      </span> |
|<span class="r8">  417 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  418 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">Copyright 2020 Ryan (Mohammad) Solgi</span><span class="r12">                                                     </span> |
|<span class="r8">  419 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  420 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">Permission is hereby granted, free of charge, to any person obtaining a copy of </span><span class="r12">         </span> |
|<span class="r8">  421 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">this software and associated documentation files (the &quot;Software&quot;), to deal in </span><span class="r12">           </span> |
|<span class="r8">  422 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">the Software without restriction, including without limitation the rights to use, </span><span class="r12">       </span> |
|<span class="r8">  423 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the </span><span class="r12">         </span> |
|<span class="r8">  424 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">Software, and to permit persons to whom the Software is furnished to do so, </span><span class="r12">             </span> |
|<span class="r8">  425 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">subject to the following conditions:</span><span class="r12">                                                     </span> |
|<span class="r8">  426 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  427 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">The above copyright notice and this permission notice shall be included in all</span><span class="r12">           </span> |
|<span class="r8">  428 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">copies or substantial portions of the Software.</span><span class="r12">                                          </span> |
|<span class="r8">  429 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  430 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR </span><span class="r12">              </span> |
|<span class="r8">  431 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, </span><span class="r12">                </span> |
|<span class="r8">  432 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL </span><span class="r12">                 </span> |
|<span class="r8">  433 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER </span><span class="r12">              </span> |
|<span class="r8">  434 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, </span><span class="r12">           </span> |
|<span class="r8">  435 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE </span><span class="r12">           </span> |
|<span class="r8">  436 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">SOFTWARE.</span><span class="r12">                                                                                </span> |
|<span class="r8">  437 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">  438 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r11">&quot;&quot;&quot;</span><span class="r12">                                                                                      </span> |
|<span class="r8">  439 </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r12">                                                                                         </span> |
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|                                                                                          |
|------+-------+-------+-------+-------+------------------------------------------------------------------------------------------|
|<span class="r8">      </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r9">       </span>|<span class="r10">       </span>|<span class="r27">function summary for C:\Users\RobertWenink\OneDrive - Delft University of Technology\Doc…</span> |
|<span class="r8">  218 </span>|<span class="r9">    1% </span>|<span class="r9">       </span>|<span class="r9">   1%  </span>|<span class="r10">  2%   </span>|<span class="r14">geneticalgorithm</span><span class="r16">.</span><span class="r14">run</span><span class="r12">                                                                     </span> |
+---------------------------------------------------------------------------------------------------------------------------------+
generated by the <a class="r28" href="https://github.com/plasma-umass/scalene">scalene</a> profiler                                                                                                   
</pre>
    </code>
</body>
</html>
